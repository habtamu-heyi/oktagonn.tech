/* @license GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function($,Drupal,drupalSettings,once,cookies){'use strict';const euList=["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","EL","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","CH","IS","LI","NO"];window.userTracker={country:null,initialisationComplete:false,euSubdomain:false,getUserCountry:function getUserCountry(){return userTracker.country;},setUserCountry:function setUserCountry(){if(userTracker.initialisationComplete)return;let storedCountry=sessionStorage.getItem('userCountry'),locationStatus=cookies.get('location_is_verified');if(storedCountry&&typeof (locationStatus)!=='undefined'&&locationStatus){userTracker.country=storedCountry;userTracker.initialisationComplete=true;if(once('locationLoad','html').length)$(window).trigger('userTracker:load');}else{var endpoint='https://pro.ip-api.com/json/?key=NsI877AefRmEbY3&fields=countryCode';if(typeof (drupalSettings.apiEndpoint)!=='undefined'&&drupalSettings.apiEndpoint)endpoint=drupalSettings.apiEndpoint;var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(this.readyState===4&&this.status===200){var response=JSON.parse(this.responseText);if(response.countryCode){userTracker.country=response.countryCode;sessionStorage.setItem('userCountry',userTracker.country);userTracker.initialisationComplete=true;if(once('locationLoad','html').length)$(window).trigger('userTracker:load');userTracker.verifyLocation(true);}}};xhr.open('GET',endpoint,true);xhr.send();}if(typeof (drupalSettings.disableModal)!=='undefined'&&drupalSettings.disableModal)localStorage.setItem('automaticRedirect','accept');},verifyLocation:function verifyLocation(verified){let domain="."+document.domain;if(verified)cookies.set('location_is_verified',1,{expires:1,path:'/',domain});else cookies.remove('location_is_verified',{path:'/',domain});},executeOnCountryLookup:function executeOnCountryLookup(callback,callbackData){if(typeof callback==="function")if(userTracker.initialisationComplete)callback(callbackData);else $(window).on('userTracker:load',function(){callback(callbackData);});}};userTracker.setUserCountry();}(jQuery,Drupal,window.drupalSettings,once,window.Cookies));;
(function($,Drupal,drupalSettings,once){'use strict';function initCountryRedirect(redirects){let country=userTracker.getUserCountry(),redirectData=redirects[country];if(redirectData){let automaticRedirect=localStorage.getItem('automaticRedirect');if(automaticRedirect==='accept'){let targetUrl=redirectData['to'];if(window.location.href!==targetUrl)if(localStorage.getItem('stopRedirect'))console.log('no redirect');else window.location.replace(targetUrl);}else if(automaticRedirect==='decline')$('.block-regional-redirect-block').remove();else{injectRedirectModal(redirectData);initRedirectEventListeners(redirectData);}}else $('.block-regional-redirect-block').remove();}const injectRedirectModal=function(redirectData){let $modalCopy=$(once('inject-modal-copy','.modal-redirect-copy')),$acceptLink=$(once('inject-accept','.accept-redirect')),$cancelLink=$(once('inject-accept','.cancel-redirect')),$rememberBox=$(once('inject-modal-box','.form-item-remember-choice label'));$modalCopy.append(redirectData['modalCopy']);$rememberBox.text(redirectData['modalBoxText']);$acceptLink.val(redirectData['acceptText']);$cancelLink.val(redirectData['cancelText']);$('.regional-redirect-wrapper').removeClass('hidden');};const initRedirectEventListeners=function(redirectData){let $acceptLink=$(once('accept-redirect-click','.accept-redirect')),$cancelLink=$(once('cancel-redirect-click','.cancel-redirect')),$rememberBox=$('.modal-redirect-remember'),targetUrl=redirectData['to'];$acceptLink.click(function(e){e.preventDefault();if($rememberBox.prop('checked'))localStorage.setItem('automaticRedirect','accept');else localStorage.removeItem('automaticRedirect');setTimeout(function(){window.location.replace(targetUrl);},200);});$cancelLink.click(function(e){e.preventDefault();if($rememberBox.prop('checked'))localStorage.setItem('automaticRedirect','decline');else localStorage.removeItem('automaticRedirect');});$(once('modal-injected','.regional-redirect-wrapper')).trigger('regionRedirect:load').addClass('modal-injected');};Drupal.behaviors.countryRedirects={attach:function(context,settings){const preInit=function(){if(settings.disableModal==='undefined'){let $redirectModal=$('.regional-redirect-wrapper');if(!$redirectModal.length)return false;}let redirects=getRedirects();userTracker.executeOnCountryLookup(initCountryRedirect,redirects);};const getRedirects=function(){if(typeof (settings.crrData)!=='undefined'&&settings.crrData)return settings.crrData;return [];};preInit();}};}(jQuery,Drupal,window.drupalSettings,once));;
