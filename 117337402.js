var cPubgJNt = '{"campaigns":{"217066648":{"name":"NORAM Request Demo Thank You Pages with Resources","metrics":[{"id":"197954557","name":"AutoGoal: On-page engagement","eventIds":["157019326"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":true},{"id":"197954558","name":"Click Resources","eventIds":["157019327","157019329","157019330","157019331","157019332","157019333","157019334"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":false}],"experiences":{"417217493":{"name":"NORAM Request Demo Thank You Pages with Resources","type":"ab","pageIds":["137703900"],"state":"live","ignore":0,"variations":{"617079772":{"name":"Version 1 - Single Resource (No Change)","state":"live","preconditions":[],"changes":[]},"617079800":{"name":"Version 2 - Generic Resources","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(5)","attributes":{"css":{},"html":"\\n    <div class=\\"layout-content\\">\\n              <div class=\\"layout__region layout__region--first\\">\\n          \\n\\n\\n<div class=\\"block block-layout-builder block-inline-blockcustom-code block--custom-code\\">\\n  \\n    \\n      \\n            <div class=\\"clearfix text-formatted field field--name-field-source-code field--type-text-long field--label-hidden field__item\\"><style>\\n/*Adjust alternate blob to appear lower*/\\n.paragraph--type--header-banner-basic.blob-alt:before{\\nheight: 140%;\\n}\\n\\n/*Invert Banner Text to white and remove white box*/\\n.block--cta.with-bg-image .field--name-field-heading{\\nfont-size: 56px;\\n}\\n.block--cta.with-bg-image .field--name-field-description, .block--cta.with-bg-image .field--name-field-heading{\\ncolor: #fff;\\n}\\n\\n.block--cta.with-bg-image .content-wrapper{\\nbox-shadow: none;\\nbackground-color: rgba(0, 0, 0, 0);\\n}\\n\\n/*Hide Version 1 Selector to remove header when needed*/\\n#asset > div.paragraph.paragraph--type--header-banner-basic.paragraph--view-mode--default.blob-alt, #asset > div.node__content > div:nth-child(1), #asset > div.node__content > div.layout.twocol-layout.bg-color--none.m-top--half.m-bottom--half.width--50-50.vertical-align--center{\\ndisplay: none;\\n}\\n\\n/*Hide Version 2 with Generic Resources*/\\n#asset > div.node__content > div:nth-child(3){\\n\\n}\\n\\n/*Hide Version 3 with Curated Resources*/\\n#asset > div.node__content > div:nth-child(4){\\ndisplay: none;\\n}\\n\\n</style></div>\\n      \\n  </div>\\n\\n        </div>\\n          </div>\\n  "}}]},"617079801":{"name":"Version 3 - Curated Resources","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(5)","attributes":{"css":{},"html":"\\n    <div class=\\"layout-content\\">\\n              <div class=\\"layout__region layout__region--first\\">\\n          \\n\\n\\n<div class=\\"block block-layout-builder block-inline-blockcustom-code block--custom-code\\">\\n  \\n    \\n      \\n            <div class=\\"clearfix text-formatted field field--name-field-source-code field--type-text-long field--label-hidden field__item\\"><style>\\n/*Adjust alternate blob to appear lower*/\\n.paragraph--type--header-banner-basic.blob-alt:before{\\nheight: 140%;\\n}\\n\\n/*Invert Banner Text to white and remove white box*/\\n.block--cta.with-bg-image .field--name-field-heading{\\nfont-size: 56px;\\n}\\n.block--cta.with-bg-image .field--name-field-description, .block--cta.with-bg-image .field--name-field-heading{\\ncolor: #fff;\\n}\\n\\n.block--cta.with-bg-image .content-wrapper{\\nbox-shadow: none;\\nbackground-color: rgba(0, 0, 0, 0);\\n}\\n\\n/*Hide Version 1 Selector to remove header when needed*/\\n#asset > div.paragraph.paragraph--type--header-banner-basic.paragraph--view-mode--default.blob-alt, #asset > div.node__content > div:nth-child(1), #asset > div.node__content > div.layout.twocol-layout.bg-color--none.m-top--half.m-bottom--half.width--50-50.vertical-align--center{\\ndisplay: none;\\n}\\n\\n/*Hide Version 2 with Generic Resources*/\\n#asset > div.node__content > div:nth-child(3){\\nvisibility: hidden;\\nheight: 0;\\npadding-bottom: 0;\\n}\\n\\n/*Hide Version 3 with Curated Resources*/\\n#asset > div.node__content > div:nth-child(4){\\n\\n}\\n\\n</style></div>\\n      \\n  </div>\\n\\n        </div>\\n          </div>\\n  "}}]}},"trafficAllocation":{"617079772":{"lowerEndpoint":0,"upperEndpoint":334},"617079800":{"lowerEndpoint":334,"upperEndpoint":667},"617079801":{"lowerEndpoint":667,"upperEndpoint":1000}},"preconditions":[],"boundingSelectors":[]}}},"217074366":{"name":"Lifelong Learning Resource Report v3","metrics":[{"id":"197967031","name":"Form Submit","eventIds":["157025105"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":false}],"experiences":{"417225213":{"name":"Lifelong Learning Resource Report v3","type":"ab","pageIds":["137708359"],"state":"live","ignore":0,"variations":{"617097930":{"name":"No Change","state":"live","preconditions":[]},"617097931":{"name":"Low Value Form","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(5)","attributes":{"css":{"display":"none"}}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(7)","attributes":{"html":"\\n    <div class=\\"layout-content\\">\\n              <div class=\\"layout__region layout__region--first\\">\\n          \\n\\n  \\n\\n\\n\\n<div class=\\"block block-layout-builder block-inline-blockcta block--cta with-bg-image\\" style=\\"\\">\\n  \\n    \\n\\n  \\n            <div class=\\"field field--name-field-media-background field--type-entity-reference field--label-hidden field__item\\"><article class=\\"media media--type-image media--view-mode-entity-embed\\">\\n  \\n      \\n            <div class=\\"field field--name-field-media-image field--type-image field--label-hidden field__item\\">  <img loading=\\"lazy\\" src=\\"/sites/default/files/image/2024-10/2024_Lifelong-Learning-Report-Web-Images-06%20%281%29.png\\" width=\\"1920\\" height=\\"801\\" title=\\"2024_Lifelong-Learning-Report-Web-Images-06 (1).png\\" typeof=\\"foaf:Image\\">\\n\\n</div>\\n      \\n  </article>\\n</div>\\n      \\n\\n      <div class=\\"content-wrapper\\" style=\\"\\">\\n              \\n  <label class=\\"field heading field--name-field-micro-heading field--type-text-long field--label-hidden field__item\\" id=\\"get-the-full-report-\\"><p>Get the Full Report</p>\\n</label>\\n\\n  <h2 class=\\"field heading field--name-field-heading field--type-text-long field--label-hidden field__item\\" id=\\"the-lifelong-learning-report-trends-and-insights-from-k-12-to-career\\"><p>The Lifelong Learning Report: Trends and Insights from K-12 to Career</p>\\n</h2>\\n\\n            <div class=\\"field field--name-field-p-link field--type-entity-reference-revisions field--label-hidden field__item\\">  \\n\\n\\n\\n\\n\\n<div class=\\"paragraph paragraph--type--link-default paragraph--view-mode--default\\">\\n  <div class=\\"field field--name-field-link field--type-link field--label-hidden field__item\\">  \\n    <a href=\\"#llr-gate\\" id=\\"button-25841-block_content-58204\\" aria-label=\\"Download Now\\">\\n      Download Now\\n    </a>\\n  </div>\\n</div>\\n</div>\\n      \\n          </div>\\n  </div>\\n\\n\\n\\n<div class=\\"block block-layout-builder block-inline-blockcustom-code block--custom-code\\">\\n  \\n    \\n      \\n            <div class=\\"clearfix text-formatted field field--name-field-source-code field--type-text-long field--label-hidden field__item\\"><style>\\n#pk-12-hidep, #phe-hidep, #ppl-hidenbspp {display: none;}\\n#asset > div.node__content > div:nth-child(6) {display: block;}\\n</style></div>\\n      \\n  </div>\\n\\n        </div>\\n          </div>\\n  "}}]}},"trafficAllocation":{"617097930":{"lowerEndpoint":0,"upperEndpoint":500},"617097931":{"lowerEndpoint":500,"upperEndpoint":1000}},"preconditions":[],"boundingSelectors":[]}}},"217078606":{"name":"EMEA - UK - Canvas LMS Demo Request - H1","metrics":[{"id":"197973926","name":"P1","eventIds":["157030730"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":false}],"experiences":{"417229453":{"name":"EMEA - UK - Canvas LMS Demo Request - H1","type":"cc","pageIds":["137709521"],"state":"live","ignore":0,"variations":{"617107238":{"name":"No Change","state":"live","preconditions":[]},"617107239":{"name":"Empower Learners with Canvas LMS","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":"#pyes-you-can-with-span-classemphasiscanvasspanp > p","attributes":{"css":{},"html":"Empower Learners with <span class=\\"emphasis\\">Canvas LMS</span>"}}]},"617107241":{"name":"Brilliant Learning with Canvas LMS","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":"#pyes-you-can-with-span-classemphasiscanvasspanp > p","attributes":{"css":{},"html":"Brilliant Learning with <span class=\\"emphasis\\">Canvas LMS</span>"}}]},"617107244":{"name":"Simplify Teaching with Canvas LMS","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":"#pyes-you-can-with-span-classemphasiscanvasspanp > p","attributes":{"css":{},"html":"Simplify Teaching with <span class=\\"emphasis\\">Canvas LMS</span>"}}]}},"preconditions":[],"boundingSelectors":[]}}},"217078912":{"name":"NORAM - K12 - MPA States (1)","metrics":[{"id":"197973667","name":"AutoGoal: On-page engagement","eventIds":["157029316"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":true},{"id":"197974056","name":"P1 Form Fill","eventIds":["157030730"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":false}],"experiences":{"417229759":{"name":"NORAM - K12 - MPA States","type":"rbp","pageIds":["137709589"],"state":"live","ignore":0,"variations":{"617107951":{"name":"Default","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".title-container > .field--name-field-micro-heading.text-formatted > p","attributes":{"html":"PREDICTIVE ASSESSMENTS FOR SCHOOL DISTRICTS"}},{"type":"ATTRIBUTE","selector":".paragraph--type--header-banner-basic .content-container p","attributes":{"html":"Aligned to state-specific learning standards, Mastery Predictive Assessments are rigorous, prebuilt benchmarks that measure students\' academic progress and accurately predict performance on end-of-year state summative assessments."}},{"type":"ATTRIBUTE","selector":"#ppower-arizona-classrooms-with-actionable-datap > p","attributes":{"html":"Power Classrooms With Actionable Data"}}]},"617107952":{"name":"State - Arizona","state":"live","condition":{"type":"audience","audienceId":"187601164"},"preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":"#learn-more > p","attributes":{"html":"Discover More"}}]},"617107953":{"name":"State - Illinois","state":"live","condition":{"type":"audience","audienceId":"187601161"},"preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".title-container > .field--name-field-micro-heading.text-formatted > p","attributes":{"html":"MASTERY PREDICTIVE ASSESSMENTS FOR ILLINOIS"}},{"type":"ATTRIBUTE","selector":".paragraph--type--header-banner-basic .content-container p","attributes":{"html":"Aligned to the Illinois Learning Standards, Mastery Predictive Assessments are rigorous, prebuilt benchmarks that measure students\' academic progress and accurately predict performance on Illinois Assessment of Readiness (IAR)."}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-micro-heading.text-formatted > p","attributes":{"html":"PERSONALIZED LEARNING"}},{"type":"ATTRIBUTE","selector":"#ppower-arizona-classrooms-with-actionable-datap > p","attributes":{"html":"Power Illinois Classrooms With Connected Benchmark Data"}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-description > p","attributes":{"html":"Mastery Predictive Assessments provide insights into student learning, helping educators pinpoint specific learning gaps for each student. With this data, teachers can effectively adjust their instruction, implement personalized interventions, and ensure that all students are prepared to meet end-of-year expectations."}}]},"617107956":{"name":"State - Wisconsin","state":"live","condition":{"type":"audience","audienceId":"187601162"},"preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".title-container > .field--name-field-micro-heading.text-formatted > p","attributes":{"html":"MASTERY PREDICTIVE ASSESSMENTS FOR WISCONSIN"}},{"type":"ATTRIBUTE","selector":".paragraph--type--header-banner-basic .content-container p","attributes":{"html":"Aligned to the Wisconsin Standards, Mastery Predictive Assessments are rigorous, prebuilt benchmarks that measure students\' academic progress and accurately predict performance on the Wisconsin Forward Exam."}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-micro-heading.text-formatted > p","attributes":{"html":"CONNECTED BENCHMARK DATA"}},{"type":"ATTRIBUTE","selector":"#ppower-arizona-classrooms-with-actionable-datap > p","attributes":{"html":"Power Wisconsin Classrooms With Connected Benchmark Data"}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-description > p","attributes":{"html":"Report cards are just one part of effective progress monitoring. With Mastery Predictive Assessments, you can keep an eye on student performance at scale in real-time, and empower your teachers with insights they can use in their classroom to ensure that all students are prepared to meet end-of-year expectations."}}]},"617107959":{"name":"State - New York","state":"live","condition":{"type":"audience","audienceId":"187598677"},"preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".title-container > .field--name-field-micro-heading.text-formatted > p","attributes":{"html":"MASTERY PREDICTIVE ASSESSMENTS FOR NEW YORK"}},{"type":"ATTRIBUTE","selector":".paragraph--type--header-banner-basic .content-container p","attributes":{"html":"Aligned to the New York State Next Generation Learning Standards, Mastery Predictive Assessments are EdLaw 2-D Compliant benchmarks that measure students\' academic progress and accurately predict performance on the New York State Testing Program (NYSTP) and the Regents Examinations.&nbsp;"}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-micro-heading.text-formatted > p","attributes":{"html":"IMPACTFUL, INTEGRATED ASSESSMENT"}},{"type":"ATTRIBUTE","selector":"#ppower-arizona-classrooms-with-actionable-datap > p","attributes":{"html":"Power New York Classrooms With Real-Time Data"}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-description > p","attributes":{"html":"As an integral part of the assessment cycle, Mastery Predictive Assessments provide educators with actionable insights through intuitive reports. Educators can pinpoint specific learning gaps for each student, develop and implement timely interventions, and effectively measure student progress."}},{"type":"ATTRIBUTE","selector":"#panel-60830 .field--name-field-text-list-item","attributes":{"html":"\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr3-Math.png\\" style=\\"\\">Grade 3</a></p></div>\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr6-Math.png\\">Grade 6</a></p></div>\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr8-Math.png\\" style=\\"\\">Grade 8</a></p></div>\\n          <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-HS-Alg1.png\\" style=\\"\\">HS Algebra 1</a></p></div>"}},{"type":"ATTRIBUTE","selector":"#panel-60828 .field--name-field-text-list-item","attributes":{"html":"\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr3-ELA%20.png\\">Grade 3</a></p></div>\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr6-ELA.png\\">Grade 6</a></p></div>\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr8-ELA.png\\">Grade 8</a></p></div>\\n                        <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-HS-Eng1.png\\">HS English 1</a></p></div>"}}]},"617107960":{"name":"State - Pennsylvania","state":"live","condition":{"type":"audience","audienceId":"187598683"},"preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".title-container > .field--name-field-micro-heading.text-formatted > p","attributes":{"css":{},"html":"MASTERY PREDICTIVE ASSESSMENTS FOR PENNSLYVANIA"}},{"type":"ATTRIBUTE","selector":".paragraph--type--header-banner-basic .content-container p","attributes":{"css":{},"html":"Aligned to the Pennsylvania Core Standards, Mastery Predictive Assessments are rigorous, prebuilt benchmarks that measure students\' academic progress and accurately predict performance on the Pennsylvania System of School Assessment (PSSA)."}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-micro-heading.text-formatted > p","attributes":{"css":{},"html":"INFORMED &amp; PREPARED"}},{"type":"ATTRIBUTE","selector":"#ppower-arizona-classrooms-with-actionable-datap > p","attributes":{"css":{},"html":"Power Pennsylvania Classrooms With Real-Time Data"}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-description > p","attributes":{"css":{},"html":"Mastery Predictive Assessments give educators the insights they need to pinpoint specific learning gaps for each student, adjust classroom instruction, develop timely interventions, and keep parents and guardians informed."}},{"type":"ATTRIBUTE","selector":"#panel-60830 .field--name-field-text-list-item","attributes":{"css":{},"html":"\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr3-Math.png\\" style=\\"\\">Grade 3</a></p></div>\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr6-Math.png\\">Grade 6</a></p></div>\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr8-Math.png\\" style=\\"\\">Grade 8</a></p></div>\\n          <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-HS-Alg1.png\\" style=\\"\\">HS Algebra 1</a></p></div>"}},{"type":"ATTRIBUTE","selector":"#panel-60828 .field--name-field-text-list-item","attributes":{"css":{},"html":"\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr3-ELA%20.png\\">Grade 3</a></p></div>\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr6-ELA.png\\">Grade 6</a></p></div>\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr8-ELA.png\\">Grade 8</a></p></div>\\n                        <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-HS-Eng1.png\\">HS English 1</a></p></div>"}}]},"617107963":{"name":"State - Georgia","state":"live","condition":{"type":"audience","audienceId":"187601163"},"preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".title-container > .field--name-field-micro-heading.text-formatted > p","attributes":{"css":{},"html":"MASTERY PREDICTIVE ASSESSMENTS FOR GEORGIA"}},{"type":"ATTRIBUTE","selector":".paragraph--type--header-banner-basic .content-container p","attributes":{"css":{},"html":"Aligned to the Georgia Standards of Excellence, Mastery Predictive Assessments are rigorous, prebuilt benchmarks that measure students\' academic progress and accurately predict performance on the Georgia Milestones Assessment System."}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-micro-heading.text-formatted > p","attributes":{"css":{},"html":"INFORMED &amp; PREPARED"}},{"type":"ATTRIBUTE","selector":"#ppower-arizona-classrooms-with-actionable-datap > p","attributes":{"css":{},"html":"Power Georgia Classrooms With Predictive Performance Data"}},{"type":"ATTRIBUTE","selector":".node__content > div:nth-of-type(2) .field--name-field-description > p","attributes":{"css":{},"html":"As an integral part of the assessment cycle, Mastery Predictive Assessments give educators the insights they need to identify students performing below grade level and develop plans for targeted support. Teachers can then assess the impact of interventions and instructional strategies with formative assessments to drive continuous improvement."}},{"type":"ATTRIBUTE","selector":"#panel-60830 .field--name-field-text-list-item","attributes":{"css":{},"html":"\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr3-Math.png\\" style=\\"\\">Grade 3</a></p></div>\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr6-Math.png\\">Grade 6</a></p></div>\\n              <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr8-Math.png\\" style=\\"\\">Grade 8</a></p></div>\\n          <div class=\\"field__item\\" style=\\"\\"><p style=\\"\\"><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-HS-Alg1.png\\" style=\\"\\">HS Algebra 1</a></p></div>"}},{"type":"ATTRIBUTE","selector":"#panel-60828 .field--name-field-text-list-item","attributes":{"css":{},"html":"\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr3-ELA%20.png\\">Grade 3</a></p></div>\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr6-ELA.png\\">Grade 6</a></p></div>\\n              <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-Gr8-ELA.png\\">Grade 8</a></p></div>\\n                        <div class=\\"field__item\\"><p><a class=\\"modalTrigger\\" href=\\"https://www.instructure.com/sites/default/files/image/2025-02/Mastery-Predictive-Assessments-HS-Eng1.png\\">HS English 1</a></p></div>"}}]}},"variationPriority":["617107952","617107953","617107956","617107959","617107960","617107963","617107951"],"preconditions":[],"boundingSelectors":[]}}},"217079651":{"name":"EMEA - DE - Canvas Hero Image (1)","metrics":[{"id":"197975000","name":"On-page engagement","eventIds":["157029195"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":true},{"id":"197975001","name":"View Demo Page","eventIds":["157031090"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":false},{"id":"197975002","name":"P1 CTA Click","eventIds":["157031466"],"scope":"session","type":"conversion","countingMethod":"unique","isGoal":false}],"experiences":{"417230498":{"name":"EMEA - DE - Canvas Hero Image","type":"cc","pageIds":["137709554"],"state":"live","ignore":0,"variations":{"617109444":{"name":"Original Image","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".paragraph--type--header-banner-hero-half .field--name-field-media.field--type-entity-reference","attributes":{"css":{},"html":"    <picture>\\n                  <source media=\\"all and (min-width: 640px)\\" type=\\"image/webp\\" width=\\"640\\" height=\\"640\\" data-srcset=\\"/sites/default/files/styles/large_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg.webp?h=57985f58&amp;itok=ibPEUOGz 1x, /sites/default/files/styles/x_large_square_hq/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg.webp?h=57985f58&amp;itok=1qXXu_K- 2x\\" srcset=\\"/sites/default/files/styles/large_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg.webp?h=57985f58&amp;itok=ibPEUOGz 1x, /sites/default/files/styles/x_large_square_hq/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg.webp?h=57985f58&amp;itok=1qXXu_K- 2x\\" style=\\"\\">\\n              <source type=\\"image/webp\\" width=\\"100\\" height=\\"100\\" data-srcset=\\"/sites/default/files/styles/x_small_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg.webp?h=57985f58&amp;itok=6EyAPauR 1x, /sites/default/files/styles/small_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg.webp?h=57985f58&amp;itok=OqKayu-J 2x\\" srcset=\\"/sites/default/files/styles/x_small_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg.webp?h=57985f58&amp;itok=6EyAPauR 1x, /sites/default/files/styles/small_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg.webp?h=57985f58&amp;itok=OqKayu-J 2x\\">\\n              <source media=\\"all and (min-width: 640px)\\" type=\\"image/jpeg\\" width=\\"640\\" height=\\"640\\" data-srcset=\\"/sites/default/files/styles/large_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg?h=57985f58&amp;itok=ibPEUOGz 1x, /sites/default/files/styles/x_large_square_hq/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg?h=57985f58&amp;itok=1qXXu_K- 2x\\" srcset=\\"/sites/default/files/styles/large_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg?h=57985f58&amp;itok=ibPEUOGz 1x, /sites/default/files/styles/x_large_square_hq/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg?h=57985f58&amp;itok=1qXXu_K- 2x\\">\\n              <source type=\\"image/jpeg\\" width=\\"100\\" height=\\"100\\" data-srcset=\\"/sites/default/files/styles/x_small_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg?h=57985f58&amp;itok=6EyAPauR 1x, /sites/default/files/styles/small_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg?h=57985f58&amp;itok=OqKayu-J 2x\\" srcset=\\"/sites/default/files/styles/x_small_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg?h=57985f58&amp;itok=6EyAPauR 1x, /sites/default/files/styles/small_square_hq_1_1/public/image/2021-01/Canvas-Overview-HeroImage-comp_0.jpg?h=57985f58&amp;itok=OqKayu-J 2x\\">\\n                  <img loading=\\"lazy\\" width=\\"480\\" height=\\"480\\" alt=\\"Person standing candid with floral print dress smiling\\" class=\\"optanon-category-C0002-C0003-C0004 ls-is-cached lazyloaded\\" typeof=\\"foaf:Image\\" src=\\"https://www.instructure.com/sites/default/files/image/2021-06/Clear.gif\\" style=\\"\\">\\n\\n  </picture>\\n\\n"}}]},"617109445":{"name":"Test Image B","state":"live","preconditions":[],"changes":[{"type":"ATTRIBUTE","selector":".paragraph--type--header-banner-hero-half .field--name-field-media.field--type-entity-reference","attributes":{"css":{},"html":"    <picture>\\r\\n                  <source media=\\"all and (min-width: 640px)\\" type=\\"image/webp\\" width=\\"640\\" height=\\"640\\" data-srcset=\\"/sites/default/files/styles/large_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg.webp?h=e3c77aae&amp;itok=rHOpAIoo 1x, /sites/default/files/styles/x_large_square_hq/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg.webp?h=e3c77aae&amp;itok=RD0VEASe 2x\\" srcset=\\"/sites/default/files/styles/large_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg.webp?h=e3c77aae&amp;itok=rHOpAIoo 1x, /sites/default/files/styles/x_large_square_hq/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg.webp?h=e3c77aae&amp;itok=RD0VEASe 2x\\">\\r\\n              <source type=\\"image/webp\\" width=\\"100\\" height=\\"100\\" data-srcset=\\"/sites/default/files/styles/x_small_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg.webp?h=e3c77aae&amp;itok=3GR4ZLI- 1x, /sites/default/files/styles/small_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg.webp?h=e3c77aae&amp;itok=46tCOLAA 2x\\" srcset=\\"/sites/default/files/styles/x_small_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg.webp?h=e3c77aae&amp;itok=3GR4ZLI- 1x, /sites/default/files/styles/small_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg.webp?h=e3c77aae&amp;itok=46tCOLAA 2x\\">\\r\\n              <source media=\\"all and (min-width: 640px)\\" type=\\"image/jpeg\\" width=\\"640\\" height=\\"640\\" data-srcset=\\"/sites/default/files/styles/large_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg?h=e3c77aae&amp;itok=rHOpAIoo 1x, /sites/default/files/styles/x_large_square_hq/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg?h=e3c77aae&amp;itok=RD0VEASe 2x\\" srcset=\\"/sites/default/files/styles/large_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg?h=e3c77aae&amp;itok=rHOpAIoo 1x, /sites/default/files/styles/x_large_square_hq/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg?h=e3c77aae&amp;itok=RD0VEASe 2x\\">\\r\\n              <source type=\\"image/jpeg\\" width=\\"100\\" height=\\"100\\" data-srcset=\\"/sites/default/files/styles/x_small_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg?h=e3c77aae&amp;itok=3GR4ZLI- 1x, /sites/default/files/styles/small_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg?h=e3c77aae&amp;itok=46tCOLAA 2x\\" srcset=\\"/sites/default/files/styles/x_small_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg?h=e3c77aae&amp;itok=3GR4ZLI- 1x, /sites/default/files/styles/small_square_hq_1_1/public/image/2021-06/2021_6_HE_Web_Image_Story_Point_2.jpeg?h=e3c77aae&amp;itok=46tCOLAA 2x\\">\\r\\n                  <img loading=\\"lazy\\" width=\\"480\\" height=\\"480\\" alt=\\"Impact HE Web Image Story Point 2\\" class=\\"optanon-category-C0002-C0003-C0004 ls-is-cached lazyloaded\\" typeof=\\"foaf:Image\\" src=\\"https://www.instructure.com/sites/default/files/image/2021-06/Clear.gif\\">\\r\\n\\r\\n  </picture>\\r\\n"}}]},"617109446":{"name":"Test Image A (No Change)","state":"live","preconditions":[],"changes":[]}},"preconditions":[],"boundingSelectors":[]}}}},"events":{"157015078":{"name":"On-page engagement (https://dev-inst.pantheonsite.io/ Page)","type":"click","pageIds":["137701837"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015657":{"name":"On-page engagement (NORAM - K12 Canvas Home Page)","type":"click","pageIds":["137702251","137702252"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015658":{"name":"View pages: \\"NORAM - K12 Request Demo\\"","type":"view","pageIds":["137702252"]},"157015659":{"name":"Click on .clearbit-next (NORAM - K12 Canvas Home Page, NORAM - K12 Request Demo Page)","type":"click","pageIds":["137702251","137702252"],"selector":".clearbit-next"},"157015660":{"name":"Click on #edit-actions-submit--2 (NORAM - K12 Canvas Home Page, NORAM - K12 Request Demo Page)","type":"click","pageIds":["137702251","137702252"],"selector":"#edit-actions-submit--2"},"157015661":{"name":"On-page engagement (Request Demo Page)","type":"click","pageIds":["137702253"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015694":{"name":"On-page engagement (APAC - Request Demo Page)","type":"click","pageIds":["137702272"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015695":{"name":"View pages: \\"APAC - Demo Thank You\\"","type":"view","pageIds":["137702273"]},"157015696":{"name":"Click on .clearbit-next (APAC - Request Demo Page)","type":"click","pageIds":["137702272"],"selector":".clearbit-next"},"157015727":{"name":"formFill","type":"custom","apiName":"formFill"},"157015811":{"name":"On-page engagement (Canvas LMS | Get a Demo Page)","type":"click","pageIds":["137702343"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015859":{"name":"On-page engagement (NORAM - Canvas for Higher Education | Overview Page)","type":"click","pageIds":["137702373"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015860":{"name":"Click on #button-20011-header_banner_hero_half-49206 (NORAM - Canvas for Higher Education | Overview Page) (1)","type":"click","pageIds":["137702373"],"selector":"#button-20011-header_banner_hero_half-49206"},"157015861":{"name":"Click on #button-20011-header_banner_hero_half-49206 (NORAM - Canvas for Higher Education | Overview Page)","type":"click","pageIds":["137702373"],"selector":"#button-20011-header_banner_hero_half-49206"},"157015862":{"name":"View pages: \\"NORAM - Request Demo\\", \\"NORAM - Canvas LMS for Higher Education | Request Demo\\"","type":"view","pageIds":["137702253","137702378"]},"157015864":{"name":"On-page engagement (NORAM - Canvas for Higher Education | Overview Page, NORAM - Canvas LMS for Higher Education | Request Demo Page)","type":"click","pageIds":["137702373","137702378"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015872":{"name":"On-page engagement (NORAM - Canvas for Higher Education | Overview Page) (1)","type":"click","pageIds":["137702373"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015873":{"name":"On-page engagement (NORAM - Canvas LMS for Higher Education | Request Demo Page)","type":"click","pageIds":["137702378"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015874":{"name":"On-page engagement (NORAM - Canvas for K12 | Overview Page)","type":"click","pageIds":["137702251"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015875":{"name":"Click on #button-20016-header_banner_hero_half-49201 (NORAM - Canvas for K12 | Overview Page)","type":"click","pageIds":["137702251"],"selector":"#button-20016-header_banner_hero_half-49201"},"157015876":{"name":"On-page engagement (NORAM - Canvas LMS for K12 | Request Demo Page)","type":"click","pageIds":["137702252"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157015987":{"name":"Click on #button-1426-block_content-51017 (APAC - Home Page)","type":"click","pageIds":["137702372"],"selector":"#button-1426-block_content-51017"},"157016103":{"name":"On-page engagement (Canvas Page)","type":"click","pageIds":["137702488"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157016104":{"name":"Click on #button-20978-header_banner_video_hero-41542 (Canvas Page)","type":"click","pageIds":["137702488"],"selector":"#button-20978-header_banner_video_hero-41542"},"157016245":{"name":"On-page engagement (Higher Ed | Canvas Product Page )","type":"click","pageIds":["137702587"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157016246":{"name":"On-page engagement (K12 Canvas Product Page)","type":"click","pageIds":["137702588"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157016279":{"name":"On-page engagement (Homepage)","type":"click","pageIds":["137702617"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157016393":{"name":"On-page engagement (APAC - Canvas Learning Management System Page)","type":"click","pageIds":["137702678"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157016580":{"name":"On-page engagement (Chandler Test Page)","type":"click","pageIds":["137702767"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157017042":{"name":"On-page engagement (APAC - AU - State Of Vocational Webinar Page)","type":"click","pageIds":["137703142"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157017043":{"name":"View pages: \\"APAC - Event Thank You\\"","type":"view","pageIds":["137703143"]},"157017044":{"name":"Click on #edit-actions-submit--Z-Y7t0NRo5I (APAC - AU - State Of Vocational Webinar Page)","type":"click","pageIds":["137703142"],"selector":"#edit-actions-submit--Z-Y7t0NRo5I"},"157017718":{"name":"On-page engagement (Jordan Test Page)","type":"click","pageIds":["137703882"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157017730":{"name":"Click on #edit-actions-submit--2 (NORAM - Request Demo Page)","type":"click","pageIds":["137702253"],"selector":"#edit-actions-submit--2"},"157017731":{"name":"View pages: \\"NORAM Request Demo | Thank You\\"","type":"view","pageIds":["137703889"]},"157017736":{"name":"View pages: \\"NORAM - Request Demo | Thank You\\"","type":"view","pageIds":["137703900"]},"157019326":{"name":"On-page engagement (NORAM - Request Demo | Thank You Page)","type":"click","pageIds":["137703900"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157019327":{"name":"Click on #button-25118-block_content-51938 (NORAM - Request Demo | Thank You Page)","type":"click","pageIds":["137703900"],"selector":"#button-25118-block_content-51938"},"157019329":{"name":"Click on #asset > div.node__content > div:nth-child(3) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div.glide__slide.glide__slide--active > a (NORAM - Request Demo | Thank You Page)","type":"click","pageIds":["137703900"],"selector":"#asset > div.node__content > div:nth-child(3) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div.glide__slide.glide__slide--active > a"},"157019330":{"name":"Click on #asset > div.node__content > div:nth-child(3) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div:nth-child(2) > a (NORAM - Request Demo | Thank You Page)","type":"click","pageIds":["137703900"],"selector":"#asset > div.node__content > div:nth-child(3) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div:nth-child(2) > a"},"157019331":{"name":"Click on #asset > div.node__content > div:nth-child(3) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div:nth-child(3) > a (NORAM - Request Demo | Thank You Page)","type":"click","pageIds":["137703900"],"selector":"#asset > div.node__content > div:nth-child(3) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div:nth-child(3) > a"},"157019332":{"name":"Click on #asset > div.node__content > div:nth-child(4) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div.glide__slide.glide__slide--active > a (NORAM - Request Demo | Thank You Page)","type":"click","pageIds":["137703900"],"selector":"#asset > div.node__content > div:nth-child(4) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div.glide__slide.glide__slide--active > a"},"157019333":{"name":"Click on #asset > div.node__content > div:nth-child(4) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div:nth-child(2) > a (NORAM - Request Demo | Thank You Page)","type":"click","pageIds":["137703900"],"selector":"#asset > div.node__content > div:nth-child(4) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div:nth-child(2) > a"},"157019334":{"name":"Click on #asset > div.node__content > div:nth-child(4) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div:nth-child(3) > a (NORAM - Request Demo | Thank You Page)","type":"click","pageIds":["137703900"],"selector":"#asset > div.node__content > div:nth-child(4) > div > div > div.block.block-layout-builder.block-inline-blockcontent-slider.block--content-slider > div > div > div.glide__track > div > div:nth-child(3) > a"},"157019851":{"name":"On-page engagement (Student Data Privacy Page)","type":"click","pageIds":["137705500"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157020636":{"name":"On-page engagement (Test Page)","type":"click","pageIds":["137705855"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157020637":{"name":"On-page engagement (Test Page 2)","type":"click","pageIds":["137705856"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021089":{"name":"On-page engagement (Test Page for Dev)","type":"click","pageIds":["137706063"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021090":{"name":"On-page engagement (Test Page for Dev 2)","type":"click","pageIds":["137706065"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021091":{"name":"On-page engagement (Test Page for Dev 3)","type":"click","pageIds":["137706067"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021173":{"name":"On-page engagement (Homepage | APAC)","type":"click","pageIds":["137706109"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021225":{"name":"Click on #button-1426-block_content-53489 (APAC - Home Page)","type":"click","pageIds":["137702372"],"selector":"#button-1426-block_content-53489"},"157021227":{"name":"Click on #button-1426-block_content-51017 (APAC - Home Page) (2)","type":"click","pageIds":["137702372"],"selector":"#button-1426-block_content-51017"},"157021264":{"name":"Click on #edit-actions-submit (NORAM - Canvas + Mastery Better Together Page)","type":"click","pageIds":["137706179"],"selector":"#edit-actions-submit"},"157021344":{"name":"Click on #button-1426-block_content-45413 (EMEA - German(DE) | Homepage )","type":"click","pageIds":["137706244"],"selector":"#button-1426-block_content-45413"},"157021346":{"name":"View pages: \\"EMEA - German(DE) | Canvas Request Demo\\"","type":"view","pageIds":["137706247"]},"157021347":{"name":"Click on #button-21226-block_content-21606 (EMEA - German(DE) | Homepage )","type":"click","pageIds":["137706244"],"selector":"#button-21226-block_content-21606"},"157021348":{"name":"Click on #button-1426-header_banner_full_width-47407 (EMEA - German(DE) | Homepage )","type":"click","pageIds":["137706244"],"selector":"#button-1426-header_banner_full_width-47407"},"157021357":{"name":"On-page engagement (Multiple URLs Test Page)","type":"click","pageIds":["137706253"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021360":{"name":"On-page engagement (EMEA - German(DE) | Canvas Request Demo Page)","type":"click","pageIds":["137706247"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021387":{"name":"View pages: \\"EMEA - German(DE) | Thank You Page \\"","type":"view","pageIds":["137706246"]},"157021496":{"name":"On-page engagement (EMEA - German(DE) | Homepage )","type":"click","pageIds":["137706244"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021546":{"name":"Click on #edit-actions-submit (NORAM - Canvas + Mastery Better Together UTM Page) (1)","type":"click","pageIds":["137706359"],"selector":"#edit-actions-submit"},"157021547":{"name":"Click on .field--name-field-text-list-item > div:nth-of-type(1) a (NORAM - Canvas + Mastery Better Together UTM Page)","type":"click","pageIds":["137706359"],"selector":".field--name-field-text-list-item > div:nth-of-type(1) a"},"157021809":{"name":"On-page engagement (EMEA - Homepage)","type":"click","pageIds":["137706562"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021810":{"name":"Click on #block-getademo #button-1426-block_content-21611 (EMEA - Homepage)","type":"click","pageIds":["137706562"],"selector":"#block-getademo #button-1426-block_content-21611"},"157021811":{"name":"Click on #button-1426-header_banner_full_width-44891 (EMEA - Homepage)","type":"click","pageIds":["137706562"],"selector":"#button-1426-header_banner_full_width-44891"},"157021814":{"name":"On-page engagement (EMEA - Request Demo | Canvas Page)","type":"click","pageIds":["137706565"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157021816":{"name":"Click on #edit-actions-submit--2 (EMEA - Request Demo | Canvas Page)","type":"click","pageIds":["137706565"],"selector":"#edit-actions-submit--2"},"157022302":{"name":"View pages: \\"NORAM - Request Demo | Thank You\\", \\"NORAM - Request Demo | Canvas Support FAQ Thank You\\"","type":"view","pageIds":["137703900","137706790"]},"157022303":{"name":"View pages: \\"NORAM - Request Demo | Canvas Support FAQ Thank You\\"","type":"view","pageIds":["137706790"]},"157023252":{"name":"Click on .field--name-field-text-list-item > div:nth-of-type(2) a (NORAM - Canvas + Mastery Better Together UTM Page)","type":"click","pageIds":["137706359"],"selector":".field--name-field-text-list-item > div:nth-of-type(2) a"},"157023958":{"name":"On-page engagement (NORAM - Canvas Login Page)","type":"click","pageIds":["137707854"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157023962":{"name":"Click on .forced > div:nth-of-type(2) (NORAM - Canvas Login Page)","type":"click","pageIds":["137707854"],"selector":".forced > div:nth-of-type(2)"},"157023963":{"name":"Click on .content-container > div:nth-of-type(2) (NORAM - Canvas Login Page)","type":"click","pageIds":["137707854"],"selector":".content-container > div:nth-of-type(2)"},"157023968":{"name":"On-page engagement (Mastery Predictive Page)","type":"click","pageIds":["137707861"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157024230":{"name":"Click on #students-and-educators-label (NORAM - Canvas Login Page)","type":"click","pageIds":["137707854"],"selector":"#students-and-educators-label"},"157024231":{"name":"Click on #free-canvas-account-label (NORAM - Canvas Login Page)","type":"click","pageIds":["137707854"],"selector":"#free-canvas-account-label"},"157024232":{"name":"Click on #canvas-network-label (NORAM - Canvas Login Page)","type":"click","pageIds":["137707854"],"selector":"#canvas-network-label"},"157025102":{"name":"On-page engagement (Lifelong Learning Page)","type":"click","pageIds":["137708359"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157025104":{"name":"Click on #edit-actions-submit--O6XWxfUf6rA (Lifelong Learning Page)","type":"click","pageIds":["137708359"],"selector":"#edit-actions-submit--O6XWxfUf6rA"},"157025105":{"name":"View pages: \\"Lifelong Learning Report TY\\"","type":"view","pageIds":["137708360"]},"157025106":{"name":"Lifelong TY Page","type":"view","pageIds":["137708359","137708360"]},"157025107":{"name":"Mid Value Form Submit","type":"click","pageIds":["137708359"],"selector":"#edit-actions--2"},"157025108":{"name":"Mid Value Submit","type":"click","pageIds":["137708359"],"selector":"#edit-actions--4"},"157025109":{"name":"TY Page check","type":"view","pageIds":["137708360"]},"157025139":{"name":"Submit Mid Value Form","type":"click","pageIds":["137701771"],"selector":"#edit-actions--2"},"157025140":{"name":"Submit Low Value Form","type":"click","pageIds":["137701771"],"selector":"#edit-actions--4"},"157026024":{"name":"On-page engagement (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157026080":{"name":"On-page engagement (EN-AU Homepage)","type":"click","pageIds":["137708659"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157026081":{"name":"Click on #button--block_content-36511 (EN-AU Homepage)","type":"click","pageIds":["137708659"],"selector":"#button--block_content-36511"},"157026082":{"name":"Click on #button-1426-header_banner_full_width-47338 (EN-AU Homepage)","type":"click","pageIds":["137708659"],"selector":"#button-1426-header_banner_full_width-47338"},"157026701":{"name":"Click on #button-1426-block_content-58231 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button-1426-block_content-58231"},"157026702":{"name":"Click on #button-1426-feature_billboard_v2-45625 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button-1426-feature_billboard_v2-45625"},"157026703":{"name":"Click on #button-1426-feature_billboard_v2-45626 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button-1426-feature_billboard_v2-45626"},"157026704":{"name":"Click on #button-1426-feature_billboard_v2-45628 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button-1426-feature_billboard_v2-45628"},"157026705":{"name":"Click on #button-1426-feature_billboard_v2-45632 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button-1426-feature_billboard_v2-45632"},"157026706":{"name":"Click on #button-1426-feature_billboard_v2-45633 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button-1426-feature_billboard_v2-45633"},"157026707":{"name":"Click on #button-1426-block_content-43748 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button-1426-block_content-43748"},"157026801":{"name":"Click on #button-1426-header_banner_full_width-41883 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button-1426-header_banner_full_width-41883"},"157026937":{"name":"Click on #button--block_content-96 (NORAM - Home Page)","type":"click","pageIds":["137701771"],"selector":"#button--block_content-96"},"157026938":{"name":"Click on #button-1426-header_banner_full_width-41883 (NORAM - Home Page) (1)","type":"click","pageIds":["137701771"],"selector":"#button-1426-header_banner_full_width-41883"},"157028558":{"name":"On-page engagement (NORAM BizGov Canvas LMS Page)","type":"click","pageIds":["137709373"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157029120":{"name":"Click on #wistia_100\\\\.thumbnail (EMEA - UK - General Canvas LMS Request Demo Page)","type":"click","pageIds":["137709521"],"selector":"#wistia_100\\\\.thumbnail"},"157029125":{"name":"Click on #wistia_116\\\\.big_play_button_graphic (EMEA - UK - General Canvas LMS Request Demo Page)","type":"click","pageIds":["137709521"],"selector":"#wistia_116\\\\.big_play_button_graphic"},"157029126":{"name":"Click on #wistia_102\\\\.big_play_button_graphic (EMEA - UK - General Canvas LMS Request Demo Page)","type":"click","pageIds":["137709521"],"selector":"#wistia_102\\\\.big_play_button_graphic"},"157029127":{"name":"Click on .w-vulcan--background (EMEA - UK - General Canvas LMS Request Demo Page)","type":"click","pageIds":["137709521"],"selector":".w-vulcan--background"},"157029128":{"name":"Click on .six-sense-next (EMEA - UK - General Canvas LMS Request Demo Page)","type":"click","pageIds":["137709521"],"selector":".six-sense-next"},"157029130":{"name":"On-page engagement (EMEA - UK - HIED - Canvas Studio Demo Page)","type":"click","pageIds":["137709522"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157029195":{"name":"On-page engagement (EMEA - DE - Canvas Page)","type":"click","pageIds":["137709554"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157029216":{"name":"On-page engagement (EMEA - UK - Schools - Canvas LMS Demo Page)","type":"click","pageIds":["137709564"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157029316":{"name":"On-page engagement (NORAM - K12 - Predictive Assessments for States Page)","type":"click","pageIds":["137709589"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157030730":{"name":"P1 Form Fill","type":"custom","apiName":"p1FormFill"},"157030815":{"name":"P2 Form Fill","type":"custom","apiName":"p2FormFill"},"157030816":{"name":"P3 Form Fill","type":"custom","apiName":"p3FormFill"},"157030817":{"name":"SH Form Fill","type":"custom","apiName":"shFormFill"},"157030818":{"name":"Downloads","type":"custom","apiName":"fileDownload"},"157030826":{"name":"On-page engagement (NORAM - HIED - Canvas LMS Page)","type":"click","pageIds":["137709649"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157030851":{"name":"On-page engagement (NORAM - K12 - Mastery Connect Page)","type":"click","pageIds":["137709654"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157031014":{"name":"On-page engagement (Cody Test Page)","type":"click","pageIds":["137709694"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157031090":{"name":"View pages: \\"EMEA - DE - Canvas P1 Page\\"","type":"view","pageIds":["137709699"]},"157031101":{"name":"On-page engagement (APAC - AU - Canvas Page)","type":"click","pageIds":["137709701"],"selector":"a:not([href^=\\"(http:|https:)?//\\"],[href^=\\"#\\"])"},"157031102":{"name":"View pages: \\"APAC - AU - Canvas P1 \\"","type":"view","pageIds":["137709702"]},"157031103":{"name":"Click on #button-20978-header_banner_hero_half-60171 (APAC - AU - Canvas Page)","type":"click","pageIds":["137709701"],"selector":"#button-20978-header_banner_hero_half-60171"},"157031466":{"name":"Click on #button-20978-header_banner_hero_half-60214 (EMEA - DE - Canvas Page)","type":"click","pageIds":["137709554"],"selector":"#button-20978-header_banner_hero_half-60214"},"157032129":{"name":"MC P1 on Page Form Submit","type":"custom","apiName":"mcP1FormFill"},"157032130":{"name":"MC P1 Form Submit (On Demo Page)","type":"custom","apiName":"mcP1FormFillOriginal"}},"pages":{"137701771":{"name":"NORAM - Home","urls":[{"match":"regex","value":"^(https?:\\\\/\\\\/)?(www\\\\.)?instructure\\\\.com\\\\/?([?#].*?)?$"}]},"137701837":{"name":"Test Home For Dev ","type":"matching","urls":[{"match":"simple","value":"https://dev-inst.pantheonsite.io/"}]},"137702251":{"name":"NORAM - Canvas for K12 | Overview","urls":[{"match":"simple","value":"https://www.instructure.com/k12/products/canvas"},{"match":"simple","value":"https://www.instructure.com/k12/products/canvas/canvas-lms/request-demo"}]},"137702252":{"name":"NORAM - Canvas LMS for K12 | Request Demo","urls":[{"match":"simple","value":"https://www.instructure.com/k12/products/canvas/canvas-lms/request-demo"}]},"137702253":{"name":"NORAM - Request Demo","urls":[{"match":"simple","value":"https://www.instructure.com/request-demo"}]},"137702272":{"name":"APAC - Request Demo","urls":[{"match":"simple","value":"https://www.instructure.com/en-au/request-demo"},{"match":"simple","value":"https://www.instructure.com/en-au/thank-you"}]},"137702273":{"name":"APAC - Thank You","urls":[{"match":"simple","value":"https://www.instructure.com/en-au/thank-you"}]},"137702343":{"name":"NORAM - Canvas LMS | Request Demo","urls":[{"match":"simple","value":"https://www.instructure.com/products/canvas/canvas-lms/request-demo"}]},"137702372":{"name":"APAC - Home","urls":[{"match":"simple","value":"https://www.instructure.com/en-au"}]},"137702373":{"name":"NORAM - Canvas for Higher Education | Overview","urls":[{"match":"simple","value":"https://www.instructure.com/higher-education/products/canvas"}]},"137702374":{"name":"NORAM - Canvas for K-12 | Overview","urls":[{"match":"simple","value":"https://www.instructure.com/k12/products/canvas"}]},"137702375":{"name":"NORAM - Mastery for K-12 | Overview","urls":[{"match":"simple","value":"https://www.instructure.com/k12/products/mastery"}]},"137702377":{"name":"NORAM - Elevate for K-12 | Overview","urls":[{"match":"simple","value":"https://www.instructure.com/k12/products/elevate"}]},"137702378":{"name":"NORAM - Canvas LMS for Higher Education | Request Demo","urls":[{"match":"simple","value":"https://www.instructure.com/higher-education/products/canvas/canvas-lms/request-demo"}]},"137702488":{"name":"Canvas Page","urls":[{"match":"simple","value":"https://www.instructure.com/canvas"}]},"137702587":{"name":"Higher Ed | Canvas Product Page ","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/higher-education/products/canvas/canvas-lms"}]},"137702588":{"name":"K12 Canvas Product Page","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/k12/products/canvas/canvas-lms"}]},"137702617":{"name":"Homepage","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/"}]},"137702678":{"name":"APAC - Canvas Learning Management System","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-au/canvas-lms-learning-management-system"}]},"137702767":{"name":"Chandler Test Page","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/higher-education-chandler-test"}]},"137703142":{"name":"APAC - AU - State Of Vocational Webinar","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-au/events/webinars/vocational/staying-ahead-of-the-disruption"}]},"137703143":{"name":"APAC - Event Thank You","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-au/events/thank-you"}]},"137703882":{"name":"Jordan Test Page","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/j-o-r-d-n-t-e-s-t-p-g-e/schools"}]},"137703889":{"name":"NORAM Request Demo | Thank You","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/faq/canvas-support/thank-you"}]},"137703900":{"name":"NORAM - Request Demo | Thank You","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/request-demo/thank-you"}]},"137705457":{"name":"Products Canvas Request Demo Page","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/products/canvas/request-demo"}]},"137705500":{"name":"Student Data Privacy","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/k12/landing/student-data-privacy"}]},"137705855":{"name":"Test Page","type":"matching","urls":[{"match":"simple","value":"https://intmz-urls-inst.pantheonsite.io/k12/products/canvas/canvas-lms"}]},"137705856":{"name":"Test Page 2","type":"matching","urls":[{"match":"simple","value":"https://intmz-urls-inst.pantheonsite.io/resources/infographic"}]},"137706063":{"name":"Test Page for Dev","type":"matching","urls":[{"match":"simple","value":"https://dev-inst.pantheonsite.io/de"}]},"137706065":{"name":"Test Page for Dev 2","type":"matching","urls":[{"match":"simple","value":"https://dev-inst.pantheonsite.io/de/hochschule/produkt/canvas/canvas-lms"}]},"137706067":{"name":"Test Page for Dev 3","type":"matching","urls":[{"match":"simple","value":"https://dev-inst.pantheonsite.io"}]},"137706109":{"name":"Homepage | APAC","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-au"}]},"137706179":{"name":"NORAM - Canvas + Mastery Better Together","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/landing/canvas-mastery-better-together"}]},"137706244":{"name":"EMEA - German(DE) | Homepage ","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/de"}]},"137706246":{"name":"EMEA - German(DE) | Thank You Page ","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/de/danke"}]},"137706247":{"name":"EMEA - German(DE) | Canvas Request Demo","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/de/canvas/infos-anfordern"}]},"137706253":{"name":"Multiple URLs Test","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/de"},{"match":"simple","value":"https://www.instructure.com/de/canvas/infos-anfordern"}]},"137706359":{"name":"NORAM - Canvas + Mastery Better Together UTM","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/landing/canvas-mastery-better-together"}]},"137706562":{"name":"EMEA - Homepage","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-au"}]},"137706565":{"name":"EMEA - Request Demo | Canvas","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-gb/products/canvas/request-demo"}]},"137706790":{"name":"NORAM - Request Demo | Canvas Support FAQ Thank You","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/faq/canvas-support/thank-you"}]},"137707854":{"name":"NORAM - Canvas Login","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/canvas/login"}]},"137707861":{"name":"Mastery Predictive Page","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/k12/products/mastery/mastery-view-predictive-assessments"}]},"137708359":{"name":"Lifelong Learning","type":"matching","urls":[{"match":"substring","value":"/research/lifelong-learning"},{"match":"substring","value":"/resources/research-reports/lifelong-learning-report-trends-and-insights-k-12-career"}]},"137708360":{"name":"Lifelong Learning Report TY","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/resources/research-reports/lifelong-learning-report-trends-and-insights-k-12-career?ng=&filled"}]},"137708659":{"name":"EN-AU Homepage","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-au"}]},"137709373":{"name":"NORAM BizGov Canvas Career LMS","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/canvas-lms-career-learning-management"}]},"137709521":{"name":"EMEA - UK - General Canvas LMS Request Demo","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-gb/products/canvas/canvas-lms/request-demo"}]},"137709522":{"name":"EMEA - UK - HIED - Canvas Studio Demo","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-gb/higher-education/products/canvas/canvas-studio/lets-connect"}]},"137709554":{"name":"EMEA - DE - Canvas","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/de/canvas"}]},"137709564":{"name":"EMEA - UK - Schools - Canvas LMS Demo","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-gb/schools/products/canvas/canvas-lms/request-demo"}]},"137709589":{"name":"NORAM - K12 - Predictive Assessments for States","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/k12/landing/predictive-assessments-for-states"}]},"137709649":{"name":"NORAM - HIED - Canvas LMS","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/higher-education/products/canvas/canvas-lms"}]},"137709654":{"name":"NORAM - K12 - Mastery Connect","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/k12/products/mastery/mastery-connect"}]},"137709694":{"name":"Cody Test","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/cody-test"}]},"137709699":{"name":"EMEA - DE - Canvas P1 Page","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/de/canvas/infos-anfordern"}]},"137709701":{"name":"APAC - AU - Canvas","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-au/canvas"}]},"137709702":{"name":"APAC - AU - Canvas P1 ","type":"matching","urls":[{"match":"simple","value":"https://www.instructure.com/en-au/canvas/request-demo"}]}},"audiences":{"187597212":{"name":"Country - Australia","condition":{"type":"comparison-enum","operator":"eq","value":"AU","attrDefId":{"name":"country","namespace":"standard"}}},"187597213":{"name":"Country - New Zealand","condition":{"type":"comparison-enum","operator":"eq","value":"NZ","attrDefId":{"name":"country","namespace":"standard"}}},"187597214":{"name":"Country - Philippines","condition":{"type":"comparison-enum","operator":"eq","value":"PH","attrDefId":{"name":"country","namespace":"standard"}}},"187597240":{"name":"Get a Demo","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213080","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071346","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597241":{"name":"Experience was: Start a Conversation","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213080","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071345","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597242":{"name":"Experience was: Get a Consultation","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213080","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071344","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597243":{"name":"Experience was: Connect with Us","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213080","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071343","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597244":{"name":"Experience was: Lets Connect","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213080","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071342","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597245":{"name":"Experience was: Get a Quote","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213080","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071341","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597248":{"name":"Canvas for K12 | Overview: Start a Conversation","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213092","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071373","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597249":{"name":"Canvas for K12 | Overview: Get a Consultation","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213092","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071374","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597250":{"name":"Canvas for K12 | Overview: Connect with Us","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213092","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071375","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597252":{"name":"Canvas for K12 | Overview: Lets Connect","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213092","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071376","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597253":{"name":"Canvas for K12 | Overview: Get a Quote","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213092","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071377","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597254":{"name":"Canvas for K12 | Overview: Request Info","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417213092","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617071378","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187597370":{"name":"Higher Ed Paid Search | Q423","condition":{"type":"comparison-enum","operator":"eq","value":"SP","attrDefId":{"name":"traffic_source","namespace":"standard"}}},"187597371":{"name":"K12 Google Search | Q423","condition":{"type":"comparison-enum","operator":"eq","value":"SP","attrDefId":{"name":"traffic_source","namespace":"standard"}}},"187598051":{"name":"State - Florida","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-FL"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598052":{"name":"State - California","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-CA"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598659":{"name":"Country - New Zealand & Australia","condition":{"type":"logic-or","conditions":[{"type":"comparison-enum","operator":"eq","value":"NZ","attrDefId":{"name":"country","namespace":"standard"}},{"type":"comparison-enum","operator":"eq","value":"AU","attrDefId":{"name":"country","namespace":"standard"}}]}},"187598672":{"name":"State - Massachusetts","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-MA"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598673":{"name":"State - New Jersey","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-NJ"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598675":{"name":"State - Connecticut","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-CT"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598676":{"name":"State - Rhode Island","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-RI"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598677":{"name":"State - New York","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-NY"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598678":{"name":"State - Vermont","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-VT"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598679":{"name":"State - New Hampshire","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-NH"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598680":{"name":"State - Maine","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-ME"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598681":{"name":"State - Ohio","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-OH"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598682":{"name":"State - West Virginia","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-WV"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598683":{"name":"State - Pennsylvania","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-PA"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598684":{"name":"State - Maryland","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-MD"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598685":{"name":"State - Delaware","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-DE"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187598771":{"name":"Test","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417219803","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617085339","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187598775":{"name":"German Request Demo V1 Match","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417219803","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617085339","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187598776":{"name":"German Request Demo V2 Match","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417219803","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617085340","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187598777":{"name":"German Request Demo v3 Match","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417219803","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617085341","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187598847":{"name":"EMEA - Homepage CTAS | Let\'s Connect","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417220352","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617086441","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187598848":{"name":"EMEA - Homepage CTAs | Let\'s Talk","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417220352","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617086444","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187598849":{"name":"EMEA - Homepage CTAs | Book a Call","condition":{"type":"activity","filter":{"filters":[{"fieldName":"time","operation":{"argument":"P30D","operator":"withinPastDuration"},"type":"comparison-unix-time"},{"fieldName":"eventType","operation":{"argument":"v","operator":"eq"},"type":"comparison-enum"},{"fieldName":"experienceId","operation":{"argument":"417220352","operator":"eq"},"type":"comparison-enum"},{"fieldName":"variationId","operation":{"argument":"617086445","operator":"eq"},"type":"comparison-enum"}],"type":"logic-and"},"aggregation":{"type":"count"},"operation":{"argument":1,"operator":">="}}},"187601161":{"name":"State - Illinois","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-IL"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187601162":{"name":"State - Wisconsin","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-WI"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187601163":{"name":"State - Georgia","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-GA"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187601164":{"name":"State - Arizona","condition":{"type":"comparison-array-enum","operator":"includesAny","value":["US-AZ"],"attrDefId":{"name":"subdivision","namespace":"standard"}}},"187601167":{"name":"Desktop","condition":{"type":"comparison-enum","operator":"eq","value":"D","attrDefId":{"name":"device_type","namespace":"standard"}}},"187601185":{"name":"Instructure Users","condition":{"type":"logic-or","conditions":[{"type":"comparison-string","operator":"eq","value":"Instructure","attrDefId":{"name":"companyName","namespace":"firmographic"}},{"type":"comparison-string","operator":"eq","value":"instructure.com","attrDefId":{"name":"Company Domain","namespace":"custom"}}]}}},"model":{},"id":"117337402","name":"Instructure","encrypt":false,"iint":{"ga4":{"enabled":true,"autoConfig":true,"measurementIds":[]},"sixsense":{"enabled":false,"oemEnabled":true},"firmographic":{"enabled":true}},"code":"(()=>{var n=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var p=n((ic,Xr)=>{var L=function(r){return r&&r.Math==Math&&r};Xr.exports=L(typeof globalThis==\\"object\\"&&globalThis)||L(typeof window==\\"object\\"&&window)||L(typeof self==\\"object\\"&&self)||L(typeof global==\\"object\\"&&global)||function(){return this}()||Function(\\"return this\\")()});var q=n((oc,Jr)=>{Jr.exports=function(r){try{return!!r()}catch{return!0}}});var g=n((uc,Zr)=>{var fa=q();Zr.exports=!fa(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})});var M=n((cc,Qr)=>{var la=q();Qr.exports=!la(function(){var r=function(){}.bind();return typeof r!=\\"function\\"||r.hasOwnProperty(\\"prototype\\")})});var B=n((vc,re)=>{var pa=M(),A=Function.prototype.call;re.exports=pa?A.bind(A):function(){return A.apply(A,arguments)}});var ae=n(ne=>{\\"use strict\\";var ee={}.propertyIsEnumerable,te=Object.getOwnPropertyDescriptor,ya=te&&!ee.call({1:2},1);ne.f=ya?function(e){var t=te(this,e);return!!t&&t.enumerable}:ee});var $=n((fc,ie)=>{ie.exports=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}}});var l=n((lc,ce)=>{var oe=M(),ue=Function.prototype,qa=ue.bind,ar=ue.call,ga=oe&&qa.bind(ar,ar);ce.exports=oe?function(r){return r&&ga(r)}:function(r){return r&&function(){return ar.apply(r,arguments)}}});var ir=n((pc,se)=>{var ve=l(),ba=ve({}.toString),da=ve(\\"\\".slice);se.exports=function(r){return da(ba(r),8,-1)}});var le=n((yc,fe)=>{var ha=l(),Oa=q(),Ea=ir(),or=Object,Sa=ha(\\"\\".split);fe.exports=Oa(function(){return!or(\\"z\\").propertyIsEnumerable(0)})?function(r){return Ea(r)==\\"String\\"?Sa(r,\\"\\"):or(r)}:or});var ur=n((qc,pe)=>{pe.exports=function(r){return r==null}});var cr=n((gc,ye)=>{var ma=ur(),Pa=TypeError;ye.exports=function(r){if(ma(r))throw Pa(\\"Can\'t call method on \\"+r);return r}});var K=n((bc,qe)=>{var xa=le(),Ta=cr();qe.exports=function(r){return xa(Ta(r))}});var s=n((dc,ge)=>{ge.exports=function(r){return typeof r==\\"function\\"}});var E=n((hc,de)=>{var be=s(),vr=typeof document==\\"object\\"&&document.all,Ia=typeof vr>\\"u\\"&&vr!==void 0;de.exports=Ia?function(r){return typeof r==\\"object\\"?r!==null:be(r)||r===vr}:function(r){return typeof r==\\"object\\"?r!==null:be(r)}});var _=n((Oc,he)=>{var sr=p(),wa=s(),Ca=function(r){return wa(r)?r:void 0};he.exports=function(r,e){return arguments.length<2?Ca(sr[r]):sr[r]&&sr[r][e]}});var U=n((Ec,Oe)=>{var ja=l();Oe.exports=ja({}.isPrototypeOf)});var Se=n((Sc,Ee)=>{var _a=_();Ee.exports=_a(\\"navigator\\",\\"userAgent\\")||\\"\\"});var Ce=n((mc,we)=>{var Ie=p(),fr=Se(),me=Ie.process,Pe=Ie.Deno,xe=me&&me.versions||Pe&&Pe.version,Te=xe&&xe.v8,y,G;Te&&(y=Te.split(\\".\\"),G=y[0]>0&&y[0]<4?1:+(y[0]+y[1]));!G&&fr&&(y=fr.match(/Edge\\\\/(\\\\d+)/),(!y||y[1]>=74)&&(y=fr.match(/Chrome\\\\/(\\\\d+)/),y&&(G=+y[1])));we.exports=G});var lr=n((Pc,_e)=>{var je=Ce(),Ra=q();_e.exports=!!Object.getOwnPropertySymbols&&!Ra(function(){var r=Symbol();return!String(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&je&&je<41})});var pr=n((xc,Re)=>{var Na=lr();Re.exports=Na&&!Symbol.sham&&typeof Symbol.iterator==\\"symbol\\"});var yr=n((Tc,Ne)=>{var Fa=_(),Da=s(),La=U(),Ma=pr(),Aa=Object;Ne.exports=Ma?function(r){return typeof r==\\"symbol\\"}:function(r){var e=Fa(\\"Symbol\\");return Da(e)&&La(e.prototype,Aa(r))}});var De=n((Ic,Fe)=>{var Ba=String;Fe.exports=function(r){try{return Ba(r)}catch{return\\"Object\\"}}});var Me=n((wc,Le)=>{var $a=s(),Ka=De(),Ua=TypeError;Le.exports=function(r){if($a(r))return r;throw Ua(Ka(r)+\\" is not a function\\")}});var Be=n((Cc,Ae)=>{var Ga=Me(),ka=ur();Ae.exports=function(r,e){var t=r[e];return ka(t)?void 0:Ga(t)}});var Ke=n((jc,$e)=>{var qr=B(),gr=s(),br=E(),za=TypeError;$e.exports=function(r,e){var t,a;if(e===\\"string\\"&&gr(t=r.toString)&&!br(a=qr(t,r))||gr(t=r.valueOf)&&!br(a=qr(t,r))||e!==\\"string\\"&&gr(t=r.toString)&&!br(a=qr(t,r)))return a;throw za(\\"Can\'t convert object to primitive value\\")}});var dr=n((_c,Ue)=>{Ue.exports=!1});var k=n((Rc,ke)=>{var Ge=p(),Wa=Object.defineProperty;ke.exports=function(r,e){try{Wa(Ge,r,{value:e,configurable:!0,writable:!0})}catch{Ge[r]=e}return e}});var z=n((Nc,We)=>{var Va=p(),Ya=k(),ze=\\"__core-js_shared__\\",Ha=Va[ze]||Ya(ze,{});We.exports=Ha});var hr=n((Fc,Ye)=>{var Xa=dr(),Ve=z();(Ye.exports=function(r,e){return Ve[r]||(Ve[r]=e!==void 0?e:{})})(\\"versions\\",[]).push({version:\\"3.25.0\\",mode:Xa?\\"pure\\":\\"global\\",copyright:\\"\\\\xA9 2014-2022 Denis Pushkarev (zloirock.ru)\\",license:\\"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE\\",source:\\"https://github.com/zloirock/core-js\\"})});var Xe=n((Dc,He)=>{var Ja=cr(),Za=Object;He.exports=function(r){return Za(Ja(r))}});var b=n((Lc,Je)=>{var Qa=l(),ri=Xe(),ei=Qa({}.hasOwnProperty);Je.exports=Object.hasOwn||function(e,t){return ei(ri(e),t)}});var Or=n((Mc,Ze)=>{var ti=l(),ni=0,ai=Math.random(),ii=ti(1 .toString);Ze.exports=function(r){return\\"Symbol(\\"+(r===void 0?\\"\\":r)+\\")_\\"+ii(++ni+ai,36)}});var W=n((Ac,nt)=>{var oi=p(),ui=hr(),Qe=b(),ci=Or(),rt=lr(),tt=pr(),C=ui(\\"wks\\"),m=oi.Symbol,et=m&&m.for,vi=tt?m:m&&m.withoutSetter||ci;nt.exports=function(r){if(!Qe(C,r)||!(rt||typeof C[r]==\\"string\\")){var e=\\"Symbol.\\"+r;rt&&Qe(m,r)?C[r]=m[r]:tt&&et?C[r]=et(e):C[r]=vi(e)}return C[r]}});var ut=n((Bc,ot)=>{var si=B(),at=E(),it=yr(),fi=Be(),li=Ke(),pi=W(),yi=TypeError,qi=pi(\\"toPrimitive\\");ot.exports=function(r,e){if(!at(r)||it(r))return r;var t=fi(r,qi),a;if(t){if(e===void 0&&(e=\\"default\\"),a=si(t,r,e),!at(a)||it(a))return a;throw yi(\\"Can\'t convert object to primitive value\\")}return e===void 0&&(e=\\"number\\"),li(r,e)}});var Er=n(($c,ct)=>{var gi=ut(),bi=yr();ct.exports=function(r){var e=gi(r,\\"string\\");return bi(e)?e:e+\\"\\"}});var ft=n((Kc,st)=>{var di=p(),vt=E(),Sr=di.document,hi=vt(Sr)&&vt(Sr.createElement);st.exports=function(r){return hi?Sr.createElement(r):{}}});var mr=n((Uc,lt)=>{var Oi=g(),Ei=q(),Si=ft();lt.exports=!Oi&&!Ei(function(){return Object.defineProperty(Si(\\"div\\"),\\"a\\",{get:function(){return 7}}).a!=7})});var Pr=n(yt=>{var mi=g(),Pi=B(),xi=ae(),Ti=$(),Ii=K(),wi=Er(),Ci=b(),ji=mr(),pt=Object.getOwnPropertyDescriptor;yt.f=mi?pt:function(e,t){if(e=Ii(e),t=wi(t),ji)try{return pt(e,t)}catch{}if(Ci(e,t))return Ti(!Pi(xi.f,e,t),e[t])}});var gt=n((kc,qt)=>{var _i=g(),Ri=q();qt.exports=_i&&Ri(function(){return Object.defineProperty(function(){},\\"prototype\\",{value:42,writable:!1}).prototype!=42})});var V=n((zc,bt)=>{var Ni=E(),Fi=String,Di=TypeError;bt.exports=function(r){if(Ni(r))return r;throw Di(Fi(r)+\\" is not an object\\")}});var j=n(ht=>{var Li=g(),Mi=mr(),Ai=gt(),Y=V(),dt=Er(),Bi=TypeError,xr=Object.defineProperty,$i=Object.getOwnPropertyDescriptor,Tr=\\"enumerable\\",Ir=\\"configurable\\",wr=\\"writable\\";ht.f=Li?Ai?function(e,t,a){if(Y(e),t=dt(t),Y(a),typeof e==\\"function\\"&&t===\\"prototype\\"&&\\"value\\"in a&&wr in a&&!a[wr]){var i=$i(e,t);i&&i[wr]&&(e[t]=a.value,a={configurable:Ir in a?a[Ir]:i[Ir],enumerable:Tr in a?a[Tr]:i[Tr],writable:!1})}return xr(e,t,a)}:xr:function(e,t,a){if(Y(e),t=dt(t),Y(a),Mi)try{return xr(e,t,a)}catch{}if(\\"get\\"in a||\\"set\\"in a)throw Bi(\\"Accessors not supported\\");return\\"value\\"in a&&(e[t]=a.value),e}});var R=n((Vc,Ot)=>{var Ki=g(),Ui=j(),Gi=$();Ot.exports=Ki?function(r,e,t){return Ui.f(r,e,Gi(1,t))}:function(r,e,t){return r[e]=t,r}});var mt=n((Yc,St)=>{var Cr=g(),ki=b(),Et=Function.prototype,zi=Cr&&Object.getOwnPropertyDescriptor,jr=ki(Et,\\"name\\"),Wi=jr&&function(){}.name===\\"something\\",Vi=jr&&(!Cr||Cr&&zi(Et,\\"name\\").configurable);St.exports={EXISTS:jr,PROPER:Wi,CONFIGURABLE:Vi}});var xt=n((Hc,Pt)=>{var Yi=l(),Hi=s(),_r=z(),Xi=Yi(Function.toString);Hi(_r.inspectSource)||(_r.inspectSource=function(r){return Xi(r)});Pt.exports=_r.inspectSource});var wt=n((Xc,It)=>{var Ji=p(),Zi=s(),Tt=Ji.WeakMap;It.exports=Zi(Tt)&&/native code/.test(String(Tt))});var _t=n((Jc,jt)=>{var Qi=hr(),ro=Or(),Ct=Qi(\\"keys\\");jt.exports=function(r){return Ct[r]||(Ct[r]=ro(r))}});var Rr=n((Zc,Rt)=>{Rt.exports={}});var At=n((Qc,Mt)=>{var eo=wt(),Lt=p(),Nr=l(),to=E(),no=R(),Fr=b(),Dr=z(),ao=_t(),io=Rr(),Nt=\\"Object already initialized\\",Mr=Lt.TypeError,oo=Lt.WeakMap,H,N,X,uo=function(r){return X(r)?N(r):H(r,{})},co=function(r){return function(e){var t;if(!to(e)||(t=N(e)).type!==r)throw Mr(\\"Incompatible receiver, \\"+r+\\" required\\");return t}};eo||Dr.state?(S=Dr.state||(Dr.state=new oo),Ft=Nr(S.get),Lr=Nr(S.has),Dt=Nr(S.set),H=function(r,e){if(Lr(S,r))throw Mr(Nt);return e.facade=r,Dt(S,r,e),e},N=function(r){return Ft(S,r)||{}},X=function(r){return Lr(S,r)}):(P=ao(\\"state\\"),io[P]=!0,H=function(r,e){if(Fr(r,P))throw Mr(Nt);return e.facade=r,no(r,P,e),e},N=function(r){return Fr(r,P)?r[P]:{}},X=function(r){return Fr(r,P)});var S,Ft,Lr,Dt,P;Mt.exports={set:H,get:N,has:X,enforce:uo,getterFor:co}});var Kt=n((rv,$t)=>{var vo=q(),so=s(),J=b(),Ar=g(),fo=mt().CONFIGURABLE,lo=xt(),Bt=At(),po=Bt.enforce,yo=Bt.get,Z=Object.defineProperty,qo=Ar&&!vo(function(){return Z(function(){},\\"length\\",{value:8}).length!==8}),go=String(String).split(\\"String\\"),bo=$t.exports=function(r,e,t){String(e).slice(0,7)===\\"Symbol(\\"&&(e=\\"[\\"+String(e).replace(/^Symbol\\\\(([^)]*)\\\\)/,\\"$1\\")+\\"]\\"),t&&t.getter&&(e=\\"get \\"+e),t&&t.setter&&(e=\\"set \\"+e),(!J(r,\\"name\\")||fo&&r.name!==e)&&(Ar?Z(r,\\"name\\",{value:e,configurable:!0}):r.name=e),qo&&t&&J(t,\\"arity\\")&&r.length!==t.arity&&Z(r,\\"length\\",{value:t.arity});try{t&&J(t,\\"constructor\\")&&t.constructor?Ar&&Z(r,\\"prototype\\",{writable:!1}):r.prototype&&(r.prototype=void 0)}catch{}var a=po(r);return J(a,\\"source\\")||(a.source=go.join(typeof e==\\"string\\"?e:\\"\\")),r};Function.prototype.toString=bo(function(){return so(this)&&yo(this).source||lo(this)},\\"toString\\")});var Gt=n((ev,Ut)=>{var ho=s(),Oo=j(),Eo=Kt(),So=k();Ut.exports=function(r,e,t,a){a||(a={});var i=a.enumerable,o=a.name!==void 0?a.name:e;if(ho(t)&&Eo(t,o,a),a.global)i?r[e]=t:So(e,t);else{try{a.unsafe?r[e]&&(i=!0):delete r[e]}catch{}i?r[e]=t:Oo.f(r,e,{value:t,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return r}});var zt=n((tv,kt)=>{var mo=Math.ceil,Po=Math.floor;kt.exports=Math.trunc||function(e){var t=+e;return(t>0?Po:mo)(t)}});var Br=n((nv,Wt)=>{var xo=zt();Wt.exports=function(r){var e=+r;return e!==e||e===0?0:xo(e)}});var Yt=n((av,Vt)=>{var To=Br(),Io=Math.max,wo=Math.min;Vt.exports=function(r,e){var t=To(r);return t<0?Io(t+e,0):wo(t,e)}});var Xt=n((iv,Ht)=>{var Co=Br(),jo=Math.min;Ht.exports=function(r){return r>0?jo(Co(r),9007199254740991):0}});var Zt=n((ov,Jt)=>{var _o=Xt();Jt.exports=function(r){return _o(r.length)}});var en=n((uv,rn)=>{var Ro=K(),No=Yt(),Fo=Zt(),Qt=function(r){return function(e,t,a){var i=Ro(e),o=Fo(i),u=No(a,o),c;if(r&&t!=t){for(;o>u;)if(c=i[u++],c!=c)return!0}else for(;o>u;u++)if((r||u in i)&&i[u]===t)return r||u||0;return!r&&-1}};rn.exports={includes:Qt(!0),indexOf:Qt(!1)}});var an=n((cv,nn)=>{var Do=l(),$r=b(),Lo=K(),Mo=en().indexOf,Ao=Rr(),tn=Do([].push);nn.exports=function(r,e){var t=Lo(r),a=0,i=[],o;for(o in t)!$r(Ao,o)&&$r(t,o)&&tn(i,o);for(;e.length>a;)$r(t,o=e[a++])&&(~Mo(i,o)||tn(i,o));return i}});var un=n((vv,on)=>{on.exports=[\\"constructor\\",\\"hasOwnProperty\\",\\"isPrototypeOf\\",\\"propertyIsEnumerable\\",\\"toLocaleString\\",\\"toString\\",\\"valueOf\\"]});var vn=n(cn=>{var Bo=an(),$o=un(),Ko=$o.concat(\\"length\\",\\"prototype\\");cn.f=Object.getOwnPropertyNames||function(e){return Bo(e,Ko)}});var fn=n(sn=>{sn.f=Object.getOwnPropertySymbols});var pn=n((lv,ln)=>{var Uo=_(),Go=l(),ko=vn(),zo=fn(),Wo=V(),Vo=Go([].concat);ln.exports=Uo(\\"Reflect\\",\\"ownKeys\\")||function(e){var t=ko.f(Wo(e)),a=zo.f;return a?Vo(t,a(e)):t}});var Q=n((pv,qn)=>{var yn=b(),Yo=pn(),Ho=Pr(),Xo=j();qn.exports=function(r,e,t){for(var a=Yo(e),i=Xo.f,o=Ho.f,u=0;u<a.length;u++){var c=a[u];!yn(r,c)&&!(t&&yn(t,c))&&i(r,c,o(e,c))}}});var bn=n((yv,gn)=>{var Jo=q(),Zo=s(),Qo=/#|\\\\.prototype\\\\./,F=function(r,e){var t=eu[ru(r)];return t==nu?!0:t==tu?!1:Zo(e)?Jo(e):!!e},ru=F.normalize=function(r){return String(r).replace(Qo,\\".\\").toLowerCase()},eu=F.data={},tu=F.NATIVE=\\"N\\",nu=F.POLYFILL=\\"P\\";gn.exports=F});var Ur=n((qv,dn)=>{var Kr=p(),au=Pr().f,iu=R(),ou=Gt(),uu=k(),cu=Q(),vu=bn();dn.exports=function(r,e){var t=r.target,a=r.global,i=r.stat,o,u,c,v,f,I;if(a?u=Kr:i?u=Kr[t]||uu(t,{}):u=(Kr[t]||{}).prototype,u)for(c in e){if(f=e[c],r.dontCallGetSet?(I=au(u,c),v=I&&I.value):v=u[c],o=vu(a?c:t+(i?\\".\\":\\"#\\")+c,r.forced),!o&&v!==void 0){if(typeof f==typeof v)continue;cu(f,v)}(r.sham||v&&v.sham)&&iu(f,\\"sham\\",!0),ou(u,c,f,r)}}});var En=n((gv,On)=>{var su=W(),fu=su(\\"toStringTag\\"),hn={};hn[fu]=\\"z\\";On.exports=String(hn)===\\"[object z]\\"});var mn=n((bv,Sn)=>{var lu=En(),pu=s(),rr=ir(),yu=W(),qu=yu(\\"toStringTag\\"),gu=Object,bu=rr(function(){return arguments}())==\\"Arguments\\",du=function(r,e){try{return r[e]}catch{}};Sn.exports=lu?rr:function(r){var e,t,a;return r===void 0?\\"Undefined\\":r===null?\\"Null\\":typeof(t=du(e=gu(r),qu))==\\"string\\"?t:bu?rr(e):(a=rr(e))==\\"Object\\"&&pu(e.callee)?\\"Arguments\\":a}});var Gr=n((dv,Pn)=>{var hu=mn(),Ou=String;Pn.exports=function(r){if(hu(r)===\\"Symbol\\")throw TypeError(\\"Cannot convert a Symbol value to a string\\");return Ou(r)}});var Dn=n((hv,Fn)=>{var ju=M(),Nn=Function.prototype,_n=Nn.apply,Rn=Nn.call;Fn.exports=typeof Reflect==\\"object\\"&&Reflect.apply||(ju?Rn.bind(_n):function(){return Rn.apply(_n,arguments)})});var Mn=n((Ov,Ln)=>{var _u=s(),Ru=String,Nu=TypeError;Ln.exports=function(r){if(typeof r==\\"object\\"||_u(r))return r;throw Nu(\\"Can\'t set \\"+Ru(r)+\\" as a prototype\\")}});var zr=n((Ev,An)=>{var Fu=l(),Du=V(),Lu=Mn();An.exports=Object.setPrototypeOf||(\\"__proto__\\"in{}?function(){var r=!1,e={},t;try{t=Fu(Object.getOwnPropertyDescriptor(Object.prototype,\\"__proto__\\").set),t(e,[]),r=e instanceof Array}catch{}return function(i,o){return Du(i),Lu(o),r?t(i,o):i.__proto__=o,i}}():void 0)});var $n=n((Sv,Bn)=>{var Mu=j().f;Bn.exports=function(r,e,t){t in r||Mu(r,t,{configurable:!0,get:function(){return e[t]},set:function(a){e[t]=a}})}});var Gn=n((mv,Un)=>{var Au=s(),Bu=E(),Kn=zr();Un.exports=function(r,e,t){var a,i;return Kn&&Au(a=e.constructor)&&a!==t&&Bu(i=a.prototype)&&i!==t.prototype&&Kn(r,i),r}});var zn=n((Pv,kn)=>{var $u=Gr();kn.exports=function(r,e){return r===void 0?arguments.length<2?\\"\\":e:$u(r)}});var Vn=n((xv,Wn)=>{var Ku=E(),Uu=R();Wn.exports=function(r,e){Ku(e)&&\\"cause\\"in e&&Uu(r,\\"cause\\",e.cause)}});var Jn=n((Tv,Xn)=>{var Gu=l(),Yn=Error,ku=Gu(\\"\\".replace),zu=function(r){return String(Yn(r).stack)}(\\"zxcasd\\"),Hn=/\\\\n\\\\s*at [^:]*:[^\\\\n]*/,Wu=Hn.test(zu);Xn.exports=function(r,e){if(Wu&&typeof r==\\"string\\"&&!Yn.prepareStackTrace)for(;e--;)r=ku(r,Hn,\\"\\");return r}});var Qn=n((Iv,Zn)=>{var Vu=q(),Yu=$();Zn.exports=!Vu(function(){var r=Error(\\"a\\");return\\"stack\\"in r?(Object.defineProperty(r,\\"stack\\",Yu(1,7)),r.stack!==7):!0})});var oa=n((wv,ia)=>{\\"use strict\\";var ra=_(),Hu=b(),Wr=R(),Xu=U(),ea=zr(),ta=Q(),na=$n(),Ju=Gn(),Zu=zn(),Qu=Vn(),rc=Jn(),ec=Qn(),tc=g(),aa=dr();ia.exports=function(r,e,t,a){var i=\\"stackTraceLimit\\",o=a?2:1,u=r.split(\\".\\"),c=u[u.length-1],v=ra.apply(null,u);if(!!v){var f=v.prototype;if(!aa&&Hu(f,\\"cause\\")&&delete f.cause,!t)return v;var I=ra(\\"Error\\"),h=e(function(nr,sa){var Hr=Zu(a?sa:nr,void 0),w=a?new v(nr):new v;return Hr!==void 0&&Wr(w,\\"message\\",Hr),ec&&Wr(w,\\"stack\\",rc(w.stack,2)),this&&Xu(f,this)&&Ju(w,this,h),arguments.length>o&&Qu(w,arguments[o]),w});if(h.prototype=f,c!==\\"Error\\"?ea?ea(h,I):ta(h,I,{name:!0}):tc&&i in v&&(na(h,v,i),na(h,v,\\"prepareStackTrace\\")),ta(h,v),!aa)try{f.name!==c&&Wr(f,\\"name\\",c),f.constructor=h}catch{}return h}}});var Eu=Ur(),Su=g(),mu=p(),er=l(),Pu=b(),xu=s(),Tu=U(),Iu=Gr(),wu=j().f,Cu=Q(),O=mu.Symbol,x=O&&O.prototype;Su&&xu(O)&&(!(\\"description\\"in x)||O().description!==void 0)&&(kr={},D=function(){var e=arguments.length<1||arguments[0]===void 0?void 0:Iu(arguments[0]),t=Tu(x,this)?new O(e):e===void 0?O():O(e);return e===\\"\\"&&(kr[t]=!0),t},Cu(D,O),D.prototype=x,x.constructor=D,xn=String(O(\\"test\\"))==\\"Symbol(test)\\",Tn=er(x.valueOf),In=er(x.toString),wn=/^Symbol\\\\((.*)\\\\)[^)]+$/,Cn=er(\\"\\".replace),jn=er(\\"\\".slice),wu(x,\\"description\\",{configurable:!0,get:function(){var e=Tn(this);if(Pu(kr,e))return\\"\\";var t=In(e),a=xn?jn(t,7,-1):Cn(t,wn,\\"$1\\");return a===\\"\\"?void 0:a}}),Eu({global:!0,constructor:!0,forced:!0},{Symbol:D}));var kr,D,xn,Tn,In,wn,Cn,jn;var ca=Ur(),nc=p(),d=Dn(),va=oa(),Vr=\\"WebAssembly\\",ua=nc[Vr],tr=Error(\\"e\\",{cause:7}).cause!==7,T=function(r,e){var t={};t[r]=va(r,e,tr),ca({global:!0,constructor:!0,arity:1,forced:tr},t)},Yr=function(r,e){if(ua&&ua[r]){var t={};t[r]=va(Vr+\\".\\"+r,e,tr),ca({target:Vr,stat:!0,constructor:!0,arity:1,forced:tr},t)}};T(\\"Error\\",function(r){return function(t){return d(r,this,arguments)}});T(\\"EvalError\\",function(r){return function(t){return d(r,this,arguments)}});T(\\"RangeError\\",function(r){return function(t){return d(r,this,arguments)}});T(\\"ReferenceError\\",function(r){return function(t){return d(r,this,arguments)}});T(\\"SyntaxError\\",function(r){return function(t){return d(r,this,arguments)}});T(\\"TypeError\\",function(r){return function(t){return d(r,this,arguments)}});T(\\"URIError\\",function(r){return function(t){return d(r,this,arguments)}});Yr(\\"CompileError\\",function(r){return function(t){return d(r,this,arguments)}});Yr(\\"LinkError\\",function(r){return function(t){return d(r,this,arguments)}});Yr(\\"RuntimeError\\",function(r){return function(t){return d(r,this,arguments)}});})();\\n;\\n(()=>{var A=Object.defineProperty;var u=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var d=(n,t,e)=>t in n?A(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,o=(n,t)=>{for(var e in t||(t={}))p.call(t,e)&&d(n,e,t[e]);if(u)for(var e of u(t))b.call(t,e)&&d(n,e,t[e]);return n};(()=>{const n=\\"user\\",t=window.intellimize.getAllAttributes.bind(window.intellimize,n),e=window.intellimize.setAttributes.bind(window.intellimize,n);function l(){const r=t();return{currentAttrs:r,updatedAttrs:o({},r)}}function w(){Object.keys(i).some(s=>s in c?c[s]!==i[s]:!0)&&e(i)}const{currentAttrs:c,updatedAttrs:i}=l();i.IP=window.icntxtlftrs.IP,w()})();})();;","ictp":0.2,"ipcc":false,"plugins":[],"schemaVersion":"2","origins":[{"domain":"instructure.com","includeSubdomains":false},{"domain":"dev-inst.pantheonsite.io","includeSubdomains":false},{"domain":"urlmod-inst.pantheonsite.io","includeSubdomains":false}],"classicAccess":false}';
var iOverride = {};
(function(){"use strict";try{if(typeof document!="undefined"){var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__pow=Math.pow,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__spreadValues=(e,t)=>{for(var i in t||(t={}))__hasOwnProp.call(t,i)&&__defNormalProp(e,i,t[i]);if(__getOwnPropSymbols)for(var i of __getOwnPropSymbols(t))__propIsEnum.call(t,i)&&__defNormalProp(e,i,t[i]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__objRest=(e,t)=>{var i={};for(var s in e)__hasOwnProp.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&__getOwnPropSymbols)for(var s of __getOwnPropSymbols(e))t.indexOf(s)<0&&__propIsEnum.call(e,s)&&(i[s]=e[s]);return i},__publicField=(e,t,i)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,i),i),__async=(e,t,i)=>new Promise(((s,n)=>{var r=e=>{try{a(i.next(e))}catch(t){n(t)}},o=e=>{try{a(i.throw(e))}catch(t){n(t)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);a((i=i.apply(e,t)).next())}));!function(){"use strict";var e,t,i={},s={},n={};Object.defineProperty(n,"__esModule",{value:!0}),n.LogLevel=void 0,(t=e||(n.LogLevel=e={}))[t.OFF=5]="OFF",t[t.ERROR=4]="ERROR",t[t.WARN=3]="WARN",t[t.INFO=2]="INFO",t[t.DEBUG=1]="DEBUG",t[t.TRACE=0]="TRACE",Object.defineProperty(s,"__esModule",{value:!0}),s.BasicConsoleLogger=void 0;var r=n,o=function(){function e(e,t){this.prefix="",this.theConsole=e,this.minimumLogLevel=t}return e.prototype.getLevel=function(){return this.minimumLogLevel},e.prototype.error=function(e,t){this.minimumLogLevel<=r.LogLevel.ERROR&&this.theConsole.error("[".concat(t,"] ").concat(this.format(e)))},e.prototype.warn=function(e,t){this.minimumLogLevel<=r.LogLevel.WARN&&this.theConsole.warn("[".concat(t,"] ").concat(this.format(e)))},e.prototype.info=function(e,t){if(this.minimumLogLevel<=r.LogLevel.INFO){var i=void 0!==t?"[".concat(t,"] "):"";this.theConsole.info("".concat(i).concat(this.format(e)))}},e.prototype.debug=function(e,t){if(this.minimumLogLevel<=r.LogLevel.DEBUG){var i=void 0!==t?"[".concat(t,"] "):"";(this.theConsole.debug?this.theConsole.debug:this.theConsole.log)("".concat(i).concat(this.format(e)))}},e.prototype.group=function(e){this.minimumLogLevel<=r.LogLevel.DEBUG&&(this.prefix+=" ",this.theConsole.log("[1m"+this.format(e)+"[22m"))},e.prototype.groupEnd=function(){this.minimumLogLevel<=r.LogLevel.DEBUG&&(this.prefix=this.prefix.slice(0,-2))},e.prototype.time=function(e){this.minimumLogLevel<=r.LogLevel.DEBUG&&this.theConsole.time(this.format(e))},e.prototype.timeEnd=function(e){this.minimumLogLevel<=r.LogLevel.DEBUG&&this.theConsole.timeEnd(this.format(e))},e.prototype.format=function(e){return e.toString().replace(/^/gm,this.prefix)},e}();s.BasicConsoleLogger=o;var a={};Object.defineProperty(a,"__esModule",{value:!0}),a.NO_OP_LOGGER=void 0;var l=n;a.NO_OP_LOGGER=function(){return{getLevel:function(){return l.LogLevel.OFF},error:function(){},warn:function(){},info:function(){},debug:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){}}}();var c={};Object.defineProperty(c,"__esModule",{value:!0}),c.GroupConsoleLogger=void 0;var u=n,d=function(){function e(e,t){this.theConsole=e,this.minimumLogLevel=t}return e.prototype.getLevel=function(){return this.minimumLogLevel},e.prototype.error=function(e,t){this.minimumLogLevel<=u.LogLevel.ERROR&&this.theConsole.error("[".concat(t,"] ").concat(e))},e.prototype.warn=function(e,t){this.minimumLogLevel<=u.LogLevel.WARN&&this.theConsole.warn("[".concat(t,"] ").concat(e))},e.prototype.info=function(e,t){if(this.minimumLogLevel<=u.LogLevel.INFO){var i=void 0!==t?"[".concat(t,"] "):"";this.theConsole.info("".concat(i).concat(e))}},e.prototype.debug=function(e,t){if(this.minimumLogLevel<=u.LogLevel.DEBUG){var i=void 0!==t?"[".concat(t,"] "):"";(this.theConsole.debug?this.theConsole.debug:this.theConsole.log)("".concat(i).concat(e))}},e.prototype.group=function(e){this.minimumLogLevel<=u.LogLevel.DEBUG&&this.theConsole.group(e)},e.prototype.groupEnd=function(){this.minimumLogLevel<=u.LogLevel.DEBUG&&this.theConsole.groupEnd()},e.prototype.time=function(e){this.minimumLogLevel<=u.LogLevel.DEBUG&&this.theConsole.time(e)},e.prototype.timeEnd=function(e){this.minimumLogLevel<=u.LogLevel.DEBUG&&this.theConsole.timeEnd(e)},e}();c.GroupConsoleLogger=d,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GroupConsoleLogger=e.NO_OP_LOGGER=e.LogLevel=e.BasicConsoleLogger=void 0;var t=s;Object.defineProperty(e,"BasicConsoleLogger",{enumerable:!0,get:function(){return t.BasicConsoleLogger}});var i=n;Object.defineProperty(e,"LogLevel",{enumerable:!0,get:function(){return i.LogLevel}});var r=a;Object.defineProperty(e,"NO_OP_LOGGER",{enumerable:!0,get:function(){return r.NO_OP_LOGGER}});var o=c;Object.defineProperty(e,"GroupConsoleLogger",{enumerable:!0,get:function(){return o.GroupConsoleLogger}})}(i);const h=e=>"[object Array]"===Object.prototype.toString.call(e),g=e=>"boolean"==typeof e,p=e=>"number"==typeof e,m=e=>"[object Object]"===Object.prototype.toString.call(e),v=e=>"[object String]"===Object.prototype.toString.call(e),b=e=>v(e)&&e.length>0,f=e=>void 0===e,_=e=>v(e)&&/^[\da-f]{8}-[\da-f]{4}-4[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/.test(e),E=e=>{try{return b(e)&&/^[\u0020-\u007E]+$/.test(e)}catch(t){return!1}},y=(e,t)=>!!m(e)&&Object.keys(e).every((e=>t.includes(e))),S="imize-extension",w="imize-field-name";var I=(e=>(e.backgroundColor="backgroundColor",e.backgroundImage="backgroundImage",e.backgroundPosition="backgroundPosition",e.backgroundRepeat="backgroundRepeat",e.backgroundSize="backgroundSize",e.borderColor="borderColor",e.borderStyle="borderStyle",e.borderWidth="borderWidth",e.borderRadius="borderRadius",e.bottom="bottom",e.boxShadow="boxShadow",e.clear="clear",e.color="color",e.cursor="cursor",e.direction="direction",e.float="float",e.fontFamily="fontFamily",e.fontSize="fontSize",e.fontWeight="fontWeight",e.left="left",e.letterSpacing="letterSpacing",e.lineHeight="lineHeight",e.listStyleType="listStyleType",e.listStylePosition="listStylePosition",e.height="height",e.minHeight="minHeight",e.maxHeight="maxHeight",e.width="width",e.minWidth="minWidth",e.maxWidth="maxWidth",e.visibility="visibility",e.display="display",e.position="position",e.margin="margin",e.marginLeft="marginLeft",e.marginRight="marginRight",e.marginTop="marginTop",e.marginBottom="marginBottom",e.opacity="opacity",e.overflow="overflow",e.padding="padding",e.paddingLeft="paddingLeft",e.paddingRight="paddingRight",e.paddingTop="paddingTop",e.paddingBottom="paddingBottom",e.right="right",e.textAlign="textAlign",e.textShadow="textShadow",e.textTransform="textTransform",e.top="top",e.wordSpacing="wordSpacing",e.zIndex="zIndex",e))(I||{});const C=new Set(["beforebegin","afterbegin","beforeend","afterend"]),T=e=>v(e)&&C.has(e),x=e=>m(e)&&T(e.insertPosition)&&A(e.selector)&&y(e,["insertPosition","selector"]),A=E;var F=(e=>(e.UNAPPLIED="UNAPPLIED",e.APPLIED="APPLIED",e.ERROR="ERROR",e))(F||{});const k=e=>!!m(e)&&Object.keys(e).every((t=>t in I&&"string"==typeof e[t])),P=new Set(["rich-text","html-block","video","image","heading"]),D=e=>v(e)&&P.has(e);let M=class extends Error{constructor(e){super(e),this.name="UnexpectedNullException"}};function N(e,t){if(null==e||"string"==typeof e&&0===e.length)throw new M(t);return e}let O=class extends Error{constructor(e){super(e),this.name="IllegalArgumentException"}};function R(e,t){if(N(e),!e)throw new O(t)}let L=class extends Error{constructor(e){super(e),this.name="IllegalStateException"}};function $(e,t){if(N(e),!e)throw new L(t)}let V=class extends Error{constructor(e){super(e),this.name="NoSuchElementException"}};var U=Object.defineProperty,W=(e,t,i)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,z=(e,t,i)=>(W(e,"symbol"!=typeof t?t+"":t,i),i);let j=class{static empty(){return H.INSTANCE}static of(e){return new G(N(e))}static ofNullable(e){return null==e||"string"==typeof e&&0===e.length?H.INSTANCE:new G(e)}};class G extends j{constructor(e){super(),z(this,"value"),this.value=e}isPresent(){return!0}ifPresent(e){return e(this.value),this}ifAbsent(e){return this}get(){return this.value}orElse(e){return this.value}orElseRun(e){return this.value}toArray(){return[this.value]}map(e){return j.ofNullable(e(this.value))}flatMap(e){return e(this.value)}toString(){return`Optional[${this.value.toString()}]`}}const B=class extends j{isPresent(){return!1}ifPresent(e){return this}ifAbsent(e){return e(),this}get(){throw new V("No value present")}orElse(e){return e}orElseRun(e){return e()}toArray(){return[]}map(e){return j.empty()}flatMap(e){return j.empty()}toString(){return"Optional.empty"}};let H=B;z(H,"INSTANCE",new B);const Q=j.ofNullable("v5.aeb46746").orElse("NA"),q=1e3,K=50,NO_PROGRESS_TOLERANCE_TIME_MS=48e4,Y=1800,J=86400,X=3600,Z=500,ee=1e3,te=1,ie="api.intellimize.co",se="log.intellimize.co",ne="intellimize_api_",re="intellimize_attributes_",oe="intellimize_integrations_",ae="intellimize_",le="intellimize_policy_",ce="intellimize_server_context_",ue="intellimize_activity_",de="intellimize_user_",he="intellimize_opt_out_",ge="intellimize_shopify_",pe="intellimize_status_module_",me="_mkto_trk",ve="hubspotutk",be="wf",fe=`data-${be}-`,_e=`${fe}experience-`,Ee=`${fe}variation-`,ye=i.LogLevel.WARN,Se=i.LogLevel.OFF,we=["utt","utm","uts","utcn","utcm"],Ie="mkt_tok",Ce="_hsenc";function Te(e,t,i){try{return xe(e,t,i)}catch(s){return"CAN_NOT_SERIALIZE"}}function xe(e,t,i){let s;if(void 0!==Array.prototype.toJSON&&"[3]"!==JSON.stringify([3])){const n=Array.prototype.toJSON;delete Array.prototype.toJSON,s=JSON.stringify(e,t,i),Array.prototype.toJSON=n}else s=JSON.stringify(e,t,i);return s}function Ae(e){return JSON.parse(e)}function Fe(e){const t={type:e.type,target:Pe(e.target)};return e.addedNodes&&e.addedNodes.length>0&&(t.addedNodes=Array.prototype.map.call(e.addedNodes,Pe)),e.removedNodes&&e.removedNodes.length>0&&(t.removedNodes=Array.prototype.map.call(e.removedNodes,Pe)),e.attributeName&&(t.attributeName=e.attributeName),e.oldValue&&(t.oldValue=e.oldValue),xe(t)}function ke(e){return xe(Pe(e))}function Pe(e){const t={nodeName:e.nodeName};return null!==e.textContent&&e.textContent.length<500&&(t.textContent=e.textContent),e instanceof Element&&(e.id&&(t.id=e.id),e.classList&&e.classList.length>0&&(t.classList=e.classList),e.attributes&&e.attributes.length>0&&(t.attributes=De(e.attributes))),t}function De(e){const t=e.length,i=[];for(let s=0;s<t;s+=1){const t=e.item(s);null!==t&&i.push({name:t.name,value:t.value})}return i}function Me(e,t){const i=e.getWindow().atob(t),s=Oe(e,i);return decodeURIComponent(s)}function Ne(e,t){return Ae(Me(e,t))}function Oe(e,t){const i=[...e.getWindow().atob("YmdKTnQ=")],s=[];for(let n=0;n<t.length;n++){const e=t.codePointAt(n)^i[n%i.length].codePointAt(0);s.push(String.fromCodePoint(e))}return s.join("")}function Re(e){return e.getWindow().atob("Y1B1YmdKTnQ=")}function Le(e){let t;if(void 0!==e)t=e;else{if("undefined"==typeof window)return i.NO_OP_LOGGER;t=window}const s=We(t);return s===i.LogLevel.OFF?i.NO_OP_LOGGER:"group"in t.console?new $e(t,s):new Ve(t,s)}class $e extends i.GroupConsoleLogger{constructor(e,t){super(e.console,t),__publicField(this,"idebFilters"),this.idebFilters=Be(e)}debug(e,t,i,s){Ue(this.idebFilters,s)&&super.debug(e,t,i)}info(e,t,i,s){Ue(this.idebFilters,s)&&super.info(e,t,i)}warn(e,t,i,s){Ue(this.idebFilters,s)&&super.warn(e,t,i)}error(e,t,i,s){Ue(this.idebFilters,s)&&super.error(e,t,i)}group(e,t){Ue(this.idebFilters,t)&&super.group(e)}groupEnd(e){Ue(this.idebFilters,e)&&super.groupEnd()}time(e,t){Ue(this.idebFilters,t)&&super.time(e)}timeEnd(e,t){Ue(this.idebFilters,t)&&super.timeEnd(e)}}class Ve extends i.BasicConsoleLogger{constructor(e,t){super(e.console,t),__publicField(this,"idebFilters"),this.idebFilters=Be(e)}debug(e,t,i,s){Ue(this.idebFilters,s)&&super.debug(e,t,i)}info(e,t,i,s){Ue(this.idebFilters,s)&&super.info(e,t,i)}warn(e,t,i,s){Ue(this.idebFilters,s)&&super.warn(e,t,i)}error(e,t,i,s){Ue(this.idebFilters,s)&&super.error(e,t,i)}group(e,t){Ue(this.idebFilters,t)&&super.group(e)}groupEnd(e){Ue(this.idebFilters,e)&&super.groupEnd()}time(e,t){Ue(this.idebFilters,t)&&super.time(e)}timeEnd(e,t){Ue(this.idebFilters,t)&&super.timeEnd(e)}}function Ue(e,t){const i=[],s=[];for(const n of e)n.startsWith("!")?s.push(n.slice(1)):i.push(n);return void 0===t&&0===i.length||(!0===(null==t?void 0:t.some((e=>i.includes(e))))||!0!==(null==t?void 0:t.some((e=>s.includes(e))))&&(!(i.length>0)||void 0!==t&&!t.every((e=>!i.includes(e)))))}function We(e){let t=ze(e);return t.isPresent()?t.get():(t=je(e),t.isPresent()?t.get():(t=Ge(e),t.isPresent()?t.get():Se))}function ze(e){var t,i;return j.ofNullable(null==(i=null==(t=null==e?void 0:e.location)?void 0:t.search)?void 0:i.slice(1)).flatMap((e=>j.ofNullable(/(?:^|\?|&)ideb=([0-5])(?:$|&|#)/.exec(e)).map((e=>Number.parseInt(e[1],10)))))}function je(e){var t;return j.ofNullable(null==(t=null==e?void 0:e.localStorage)?void 0:t.getItem("ideb")).flatMap((e=>j.ofNullable(/^([0-5])$/.exec(e)).map((e=>Number.parseInt(e[1],10)))))}function Ge(e){var t;return j.ofNullable(null==(t=null==e?void 0:e.iOverride)?void 0:t.logLevel)}function Be(e){var t;return j.ofNullable(null==(t=null==e?void 0:e.localStorage)?void 0:t.getItem("ideb_filters")).map((e=>e.split(","))).orElse([])}class He{constructor({name:e,namespace:t}){__publicField(this,"name"),__publicField(this,"namespace"),this.name=e,this.namespace=t}getId(){return{name:this.name,namespace:this.namespace}}getName(){return this.name}getNamespace(){return this.namespace}getValue(e){return e.getAttributeValue(this)}}class Qe{constructor(e){__publicField(this,"audience"),this.audience=e}getId(){return this.audience.getId()}getName(){return this.audience.getName()}getState(){return this.audience.getState()}getCondition(){return this.audience.getCondition()}addExperience(e){this.audience.addExperience(e)}addVariation(e){this.audience.addVariation(e)}getCode(){return this.audience.getCode()}getExperiences(){return this.audience.getExperiences()}getVariations(){return this.audience.getVariations()}isInclude(){return!1}}class qe{constructor(e,t,i,s,n){__publicField(this,"logger"),__publicField(this,"json"),__publicField(this,"filter"),__publicField(this,"newAggregator"),__publicField(this,"operation"),this.json=e,this.filter=t,this.newAggregator=i,this.logger=n,this.operation=s}evaluate(e){this.logger.group("ActivityCondition.evaluate()"),this.logger.debug(`activity condition config: ${JSON.stringify(this.json)}`);const t=e.getActivities();this.logger.debug(`activities: ${JSON.stringify(t)}`),this.logger.info(`activity count: ${t.length}`);const i=t.filter((e=>this.filter.evaluate(e)));this.logger.debug(`filtered activities: ${JSON.stringify(i)}`),this.logger.info(`filtered activities count: ${i.length}`);const s=this.newAggregator();i.forEach((e=>{s.accept(e)}));const n=s.result();this.logger.info(`aggregator result: ${n}`);const r=this.operation(j.of(n));return this.logger.info(`condition result: ${r}`),this.logger.groupEnd(),r}toJSON(){return JSON.parse(JSON.stringify(this.json))}}class Ke{constructor(e,t){__publicField(this,"conditions"),this.conditions=e.conditions.map((e=>t.buildCondition(e)))}getConditions(){return this.conditions}evaluate(e){return this.conditions.every((t=>t.evaluate(e)))}toJSON(){return{conditions:this.conditions.map((e=>e.toJSON())),type:"logic-and"}}}class Ye{constructor(e,t,i){__publicField(this,"audience");const s=t.getAudience(e.audienceId);this.audience=!0===i?new Qe(s):s}getAudience(){return this.audience}evaluate(e){return this.audience.getCondition().evaluate(e)}toJSON(){return{audienceId:this.audience.getId(),type:"audience"}}}class Je{constructor(e){__publicField(this,"code"),this.code=e.code}getCode(){return this.code}evaluate(e){return e.evalBoolean(this.code)}toJSON(){return{code:this.code,type:"code"}}}class Xe{constructor(e,t,i){__publicField(this,"json"),__publicField(this,"attributeDefinition"),__publicField(this,"operation"),this.json=e,this.attributeDefinition=t,this.operation=i}getAttributeDefinition(){return this.attributeDefinition}getComparisonOperation(){return this.operation}evaluate(e){return this.operation(this.attributeDefinition.getValue(e))}toJSON(){return JSON.parse(JSON.stringify(this.json))}}class Ze{constructor(e,t){__publicField(this,"condition");const i="audience"===e.condition.type;this.condition=t.buildCondition(e.condition,i)}getCondition(){return this.condition}evaluate(e){return!this.condition.evaluate(e)}toJSON(){return{condition:this.condition.toJSON(),type:"logic-not"}}}class et{constructor(e,t){__publicField(this,"conditions"),this.conditions=e.conditions.map((e=>t.buildCondition(e)))}getConditions(){return this.conditions}evaluate(e){return this.conditions.some((t=>t.evaluate(e)))}toJSON(){return{conditions:this.conditions.map((e=>e.toJSON())),type:"logic-or"}}}class tt{constructor(e,t,i){var s;if(__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"state"),__publicField(this,"condition"),__publicField(this,"experiences",[]),__publicField(this,"variations",[]),this.id=e,this.name=t.name,this.state=null!=(s=t.state)?s:"live",void 0!==t.code&&void 0!==t.condition)this.condition=i.buildCondition({conditions:[{code:t.code,type:"code"},t.condition],type:"logic-and"});else if(void 0!==t.code)this.condition=i.buildCondition({code:t.code,type:"code"});else{if(void 0===t.condition)throw new M('Unable to build condition for audience. No "code" or "condition" property.');this.condition=i.buildCondition(t.condition)}}getId(){return this.id}getName(){return this.name}getState(){return this.state}getCondition(){return this.condition}addExperience(e){this.experiences.push(e)}addVariation(e){this.variations.push(e)}getCode(){return this.condition instanceof Je?j.of(this.condition.getCode()):j.empty()}getExperiences(){return[...this.experiences]}getVariations(){return[...this.variations]}isInclude(){return!0}}const it=["standard","custom","url_param","marketo","salesforce","firmographic","6sense","googleAds","demandbase","hubspot"];var st=(e=>(e.ATTRIBUTE="ATTRIBUTE",e.CUSTOM_CODE="CUSTOM_CODE",e.INSERT_ELEMENT="INSERT_ELEMENT",e.EXTENSION="EXTENSION",e.EXTENSION_ATTRIBUTE="EXTENSION_ATTRIBUTE",e.MOVE_ELEMENT="MOVE_ELEMENT",e.WEBFLOW="WEBFLOW",e))(st||{});const nt=["checkout_completed","checkout_started","collection_viewed","product_added_to_cart","product_viewed","search_submitted"],rt="118",ot="exists",at="notExists";var lt=function e(t){return Object.freeze(t),Object.getOwnPropertyNames(t).forEach((function(i){!t.hasOwnProperty(i)||null===t[i]||"object"!=typeof t[i]&&"function"!=typeof t[i]||Object.isFrozen(t[i])||e(t[i])})),t};function ct(e,t){const i=e.getReferrerUrl();if(!i.isPresent())return j.of(!1);const s=i.get(),n=e.getHostingPageUrl();return s.getOrigin()===n.getOrigin()?j.of(!0):ut(t,s.getOrigin())}function ut(e,t){const i=e.getCrossOrigin().isEnabled(),s=e.getOrigins().length>0;if(!i&&!s)return j.empty();const n=e.getCrossOrigin().isOriginAllowed(t),r=e.getOrigins().some((e=>e.isOriginAllowed(t)));return i&&s&&n!==r&&Io.error(`Customer crossOrigin ${n} does not match origins ${r} for origin ${t}`,251),j.of(n||r)}function dt(e,t){return new URL(`https://${e}${t}`)}class ht{constructor(e){__publicField(this,"optionalUrl"),__publicField(this,"optionalOrigin"),__publicField(this,"urlParamsUnsafe"),this.optionalUrl=ht.sanitizeUrl(e);const t=!0===(null==e?void 0:e.includes("?"))?e.slice(e.indexOf("?")):void 0;if(this.urlParamsUnsafe=lt(ht.parseQueryStringUnsafe(t)),this.optionalOrigin=j.empty(),this.optionalUrl.isPresent()){const e=this.optionalUrl.get();try{const{origin:t}=new URL(e);this.optionalOrigin=j.ofNullable(t)}catch(i){const e=new gi("Could not construct URL to determine origin",i);Io.warn(e,135)}}else Io.debug("cannot determine url origin")}static parseQueryStringUnsafe(e){const t={};return void 0!==e&&e.length>0&&e.slice(1).split("&").forEach((e=>{try{if(void 0!==e&&e.length>0){const i=e.split("=",2),s=decodeURIComponent(i[0]);if(!Object.prototype.hasOwnProperty.call(t,s)){let e="";void 0!==i[1]&&(e=decodeURIComponent(i[1].replace(/\+/g," "))),t[s]=e}}}catch(i){const e=hi(i);Io.warn(e,29)}})),t}static sanitizeUrl(e){try{if(void 0!==e)return j.ofNullable(decodeURI(e))}catch(t){Io.error(`Url could not be decoded: '${e}'`,44)}return j.ofNullable(e)}getAllUrlParamsUnsafe(){return this.urlParamsUnsafe}getUrl(){return this.optionalUrl}getOrigin(){return this.optionalOrigin}}class gt extends ht{constructor(e){super(e),__publicField(this,"urlParamsEncoded"),__publicField(this,"utmMedium"),__publicField(this,"utmSource"),this.urlParamsEncoded=lt(gt.standardUrlParameterParser(e)),this.utmSource=this.urlParamsUnsafe.utm_source,this.utmMedium=this.urlParamsUnsafe.utm_medium}static standardUrlParameterParser(e){const t={};if(void 0===e)return t;const i=e.indexOf("#");let s=e.length-1;-1!==i&&(s=i-1);const n=e.indexOf("?"),r=n+1;return-1===n||r>=s||e.slice(r,s+1).split("&").filter((e=>void 0!==e&&e.length>0)).forEach((e=>{let i=e,s="";const n=e.indexOf("=");-1!==n&&(i=e.slice(0,Math.max(0,n)),s=e.slice(n+1)),void 0===t[i]?t[i]=[s]:t[i].push(s)})),t}get emailTagRegExp(){return/email|^send|hs_em|[\W_^]mail[\W_$]|sms|newsletter|^em[\W_$]|^attentive$/}get searchTagRegExp(){return/(search|bing|google|googlepla|sem|adwords)/i}get socialTagRegExp(){return/facebook|[\W_^]fb[\W_$]|youtube|[\W_^]ig[\W_$]|twitter|igstories|^tw$|twtr|profile|pinterest|instagram|socialmedia|quora|newsfeed|reddit|social|influencer|yelp|snapchat|linkedin|googleplus|g\+|gplus|google\+/i}get paidSocialRegExp(){return/influencer|ctc|ocpm|smm|socialp|cbo|bid|paidsocial/i}get organicSocialRegExp(){return/organic|socialo|stories|story|profile/i}get paidRegExp1(){return/(placement|attentive|taboola|gdn|criteo|googlepla|mrkt_adwords|outbrain|shareasale|klaviyo|inboxdollars|liveintent|adwords|ads|listrak|gsp|bluecore)/i}get paidRegExp2(){return/(cpc|affiliate|paid|smm|sem|ocpm|adroll|reengagement|remarketing|retargeting|cpa|paids|native|ppc|leads|display|[\W_^]ad[\W_$]|cpm|advertising|channel_partner|sponsored)/i}get searchIdRegExp(){return/([?&])(gclid|msclkid)=/i}get socialIdRegEx(){return/([?&])fbclid=/i}getAllUrlParamsEncoded(){return this.urlParamsEncoded}getSourceFromAllParams(e){let t=!1;for(const i of Object.keys(this.urlParamsUnsafe))if(Object.prototype.hasOwnProperty.call(this.urlParamsUnsafe,i)){const s=this.urlParamsUnsafe[i];if(t=t||this.isParamPaid(s),this.isParamSocialTagged(s))return e||t||this.isParamSocialPaid(s)?"CP":"CO";if(this.isParamSearchTagged(s))return e||t||this.isSearchPaid()?"SP":"SO";if(this.getUrl().isPresent()&&this.isParamEmailTagged(s))return"EM"}return t?"OP":"OT"}isSocialTagged(){return!(!this.optionalUrl.isPresent()||!this.socialIdRegEx.test(this.optionalUrl.get()))||(this.isParamSocialTagged(this.utmMedium)||this.isParamSocialTagged(this.utmSource))}isSocialPaid(){return this.isParamSocialPaid(this.utmMedium)||this.isParamSocialPaid(this.utmSource)}isSearchTagged(e){return!(!this.optionalUrl.isPresent()||!this.searchIdRegExp.test(this.optionalUrl.get()))||(!(!this.isParamSearchTagged(this.utmSource)&&!this.isParamSearchTagged(this.utmMedium))||e.getUrl().isPresent()&&e.isFromSearchEngine()&&(Boolean(this.utmMedium)||Boolean(this.utmSource)))}isSearchPaid(){return!(!this.optionalUrl.isPresent()||!this.searchIdRegExp.test(this.optionalUrl.get()))||(this.isParamSearchPaid(this.utmMedium)||this.isParamSearchPaid(this.utmSource))}isPaidTraffic(){return this.isParamPaid(this.utmSource)||this.isParamPaid(this.utmMedium)}isEmailTagged(){return this.isParamEmailTagged(this.utmSource)||this.isParamEmailTagged(this.utmMedium)}isParamPaid(e){return void 0!==e&&(this.paidRegExp1.test(e)||this.paidRegExp2.test(e))}isParamEmailTagged(e){return void 0!==e&&this.emailTagRegExp.test(e)}isParamSearchTagged(e){return void 0!==e&&this.searchTagRegExp.test(e)}isParamSearchPaid(e){return void 0!==e&&/googlep|adwords/.test(e)}isParamSocialPaid(e){return(void 0===e||!this.organicSocialRegExp.test(e))&&(void 0!==e&&this.paidSocialRegExp.test(e))}isParamSocialTagged(e){return void 0!==e&&this.socialTagRegExp.test(e)}}class pt extends ht{get emailDomainRegExp(){return/([/.])(webmail|live|mail|inbox|zimbra|email|em)\d{0,2}\.|google.android.gm/i}get socialDomainRegExp(){return/([/.])(t\.co|(plus\.google|facebook|twitter|linkedin|youtube|instagram|pinterest|quora|reddit|github|medium|producthunt|yelp|ycombinator|messenger)\.)/i}get paidDomainRegExp(){return/([/.])(taboola|aimtell|attentive|googlesyndication|shareasale|outbrain|shareasale-analytics|doubleclick)\./i}get invalidSearchRegExp(){return/([/.])((plus|mail|myactivity|chrome|classroom|accounts|news|docs|keep|sites)\.google|googlesyndication|google\.android\.(?!googlequicksearchbox))/i}get paidSearchRegExp(){return/([/.])(google|googleadservices)\..*?\/aclk\?/i}get validSearchRegExp(){return/([/.])(google|bing|baidu|duckduckgo|ask|search\.(yahoo|xfinity|aol|naver))\./i}isFromSearchEngine(){return this.optionalUrl.isPresent()&&!this.invalidSearchRegExp.test(this.optionalUrl.get())&&this.validSearchRegExp.test(this.optionalUrl.get())}isFromEmail(){return this.optionalUrl.isPresent()&&this.emailDomainRegExp.test(this.optionalUrl.get())}isFromSocialNetwork(){return this.optionalUrl.isPresent()&&this.socialDomainRegExp.test(this.optionalUrl.get())}isPaidTraffic(){return this.optionalUrl.isPresent()&&this.paidDomainRegExp.test(this.optionalUrl.get())}isSearchPaid(){return this.optionalUrl.isPresent()&&!this.invalidSearchRegExp.test(this.optionalUrl.get())&&this.paidSearchRegExp.test(this.optionalUrl.get())}}function mt(e,t){const i=e.getReferrerUrl(),s=e.getHostingPageUrl(),n=new pt(i.map((e=>e.getRawUrl())).orElse(void 0)),r=new gt(s.getRawUrl()),o=n.isPaidTraffic()||r.isPaidTraffic();let a=vt(n,r,o);return"OT"===a&&(a=bt(n,r,o)),"OT"===a&&(a=r.getSourceFromAllParams(o)),"OT"===a&&(a=o?"OP":n.getUrl().isPresent()?ct(e,t).orElse(!1)?"RC":"OT":"DN"),a}function vt(e,t,i){return e.isFromEmail()?"EM":e.isFromSocialNetwork()?i||t.isSocialPaid()?"CP":"CO":e.isFromSearchEngine()?i||t.isSearchTagged(e)||e.isSearchPaid()||t.isSearchPaid()?"SP":"SO":"OT"}function bt(e,t,i){return t.isSocialTagged()?i||t.isSocialPaid()?"CP":"CO":t.isSearchTagged(e)?i||t.isSearchPaid()?"SP":"SO":t.getUrl().isPresent()&&t.isEmailTagged()?"EM":"OT"}function ft(){return[ae,re,le,ne,oe,de,ce,he,ue,pe]}function _t(e){return ft().map((t=>`${t}${e.getId()}`))}function Et(e){return ft().some((t=>e.startsWith(t)))}function yt(e){return e instanceof DOMException&&("QuotaExceededError"===e.name||"QUOTA_EXCEEDED_ERROR"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)}function St(e,t){let i=!1;try{const s=e.getWindow();if(t in s){const e="_test_",n="_test_val_";s[t].setItem(e,n);const r=s[t].getItem(e);s[t].removeItem(e),null!==r&&r===n&&(i=!0)}}catch(s){}return i}class wt{static evalBoolean(e){const t=wt.eval(e);if("boolean"==typeof t)return t;throw new TypeError("Expected boolean response, but got "+typeof t+": "+t)}static evalString(e){const t=wt.eval(e);if("string"==typeof t)return t;throw new TypeError("Expected string response, but got "+typeof t+": "+t)}static eval(e){return Io.info(`eval code: ${e}`),(0,eval)('"use strict";\n'+wt.reformatJqueryCode(e))}static injectCss(e,t,i){Io.info(`inject css: ${e}`);const s=`intellimize-${t}`,n=i.querySelectorAll(`head #${s}`),[r]=n;if(void 0===r){const t=i.createElement("style");t.id=s,t.className="iStyleBlock",t.append(e),i.head.append(t)}else r.innerHTML=e}static removeCss(e,t){var i;Io.info(`Remove css: ${e}`);const s=`intellimize-${e}`;null==(i=t.querySelector(`head #${s}`))||i.remove()}static executeFunction(e,t){try{e.call(void 0)}catch(i){const e=new gi("Caught exception in function callback",i);Io.error(e,t)}}static reformatJqueryCode(e){return`var $ = (window.intellimize && window.intellimize.plugins && window.intellimize.plugins.jquery) ? window.intellimize.plugins.jquery : window.$;\n${e}`}}var It=(e=>(e[e.NOT_STARTED=0]="NOT_STARTED",e[e.TRY_LATER=1]="TRY_LATER",e[e.WAITING=2]="WAITING",e[e.SUCCEEDED=3]="SUCCEEDED",e[e.FAILED=4]="FAILED",e[e.CANCELED=5]="CANCELED",e))(It||{});const Ct=new Set([0,1,2]),Tt=class{constructor(){__publicField(this,"manager"),__publicField(this,"id"),__publicField(this,"doneFunctions",[]),__publicField(this,"currentStatus",0),this.id=++Tt.lastId}static isDone(e){return!Ct.has(e)}getId(){return this.id}setManager(e){this.manager=e}cancel(){this.currentStatus=5,this.cleanup()}cleanup(){}runWrapper(){Io.group(this.toString()+".run()");const e=this.currentStatus;try{this.currentStatus=this.run()}catch(i){const e=new gi("Task exception",i);Io.error(e,179,this.getEntityIds()),this.currentStatus=4}const t=this.currentStatus;return!Tt.isDone(e)&&Tt.isDone(t)&&this.executeDoneFunctions(),Io.groupEnd(),this.currentStatus}onDone(e){this.isDone()?wt.executeFunction(e,153):this.doneFunctions.push(e)}getStatus(){return this.currentStatus}isDone(){return!Ct.has(this.currentStatus)}getNotDoneDependencies(){return[]}isBlocked(){if(2===this.currentStatus)return!0;return this.getNotDoneDependencies().filter((e=>e.isBlocked())).length>0}toString(){return`Task(${this.id})`}getEntityIds(){return{}}setStatusTryLater(){this.currentStatus=1}executeDoneFunctions(){for(let e=this.doneFunctions.shift();void 0!==e;e=this.doneFunctions.shift())wt.executeFunction(e,154)}};let xt=Tt;__publicField(xt,"lastId",0);const At=["xo"],Ft={debug(e,t,i){Io.debug(e,t,i,At)}};class kt extends xt{constructor(e,t,i){super(),__publicField(this,"localStorage"),__publicField(this,"storageKey"),__publicField(this,"storageDatum"),this.localStorage=e,this.storageKey=t,this.storageDatum=i}toString(){return`StorageCleanupTask(${this.storageKey})`}inTransaction(){return!1}isUnloading(){return!1}getStorageKey(){return this.storageKey}setStorageDatum(e){this.storageDatum=void 0===e?void 0:__spreadValues({},e)}getNotDoneDependencies(){return this.manager.findTasks((e=>!(e instanceof kt||e.isUnloading()||e.isDone())))}run(){return Ft.debug(`Running storage cleanup task for "${this.storageKey}".`),this.getNotDoneDependencies().length>0?(Ft.debug("Deferring storage cleanup; other tasks still running"),It.TRY_LATER):(void 0===this.storageDatum?(Ft.debug("Deleting data locally because the common origin is empty for this storageKey"),this.localStorage.delete(this.storageKey)):(Ft.debug(`Writing latest data from the common origin to the customer origin. ${Te(this.storageDatum,void 0,2)}`),this.localStorage.write(this.storageKey,xe(this.storageDatum))),It.SUCCEEDED)}}class Pt{constructor(e,t){__publicField(this,"localStorage"),__publicField(this,"taskManager"),this.localStorage=e,this.taskManager=t}run(){return __async(this,null,(function*(){return new Promise((e=>{this.taskManager.isDone()?(Ft.debug("[CleanupTaskManager]: no tasks to run"),e()):(Ft.debug("[CleanupTaskManager]: waiting for all tasks to complete"),this.taskManager.onDone((()=>{e()})))}))}))}queueCleanupTask(e,t){this.findNotDoneCleanupTask(e).ifPresent((i=>{Ft.debug(`Cleanup task already exists for ${e}; updating storageDatum`),i.setStorageDatum(t)})).ifAbsent((()=>{Ft.debug(`Creating cleanup task for ${e} with ${Te(t,void 0,2)}`),this.taskManager.addTask(new kt(this.localStorage,e,t))}))}findNotDoneCleanupTask(e){const[t]=this.taskManager.findTasks((t=>t instanceof kt&&t.getStorageKey()===e&&!t.isDone()));return j.ofNullable(t)}}function Dt(){return Ot("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}function Mt(){return Ot("xxxx-yxxx-xxxxxxxxxxxx")}function Nt(){return Ot("xxxxxxxxxx")}function Ot(e){let t=Date.now();return e.replace(/[xy]/g,(e=>{const i=Math.trunc((t+16*Math.random())%16);return t=Math.floor(t/16),("x"===e?i:3&i|8).toString(16)}))}class Rt{constructor(e,t,i){__publicField(this,"localStorage"),__publicField(this,"requestId"),__publicField(this,"storageOrigin"),__publicField(this,"message"),__publicField(this,"iframe"),__publicField(this,"resolver"),__publicField(this,"isDone",!1),__publicField(this,"timeStart"),this.localStorage=e,this.requestId=Dt(),this.storageOrigin=t,void 0!==i&&this.setMessage(i)}static get MESSAGE_EVENT_TIMEOUT_MS(){return 1e3}getRequestId(){return this.requestId}getStorageKey(){var e;return null==(e=this.message)?void 0:e.storageKey}setMessage(e){let t;this.getExpectedVersion(e.storageKey).ifPresent((e=>{t=e})),this.message=__spreadProps(__spreadValues({},e),{requestId:this.requestId,expectedVersion:t})}setIframe(e){this.iframe=e}send(){return __async(this,null,(function*(){if(void 0===this.iframe)throw new Error("Cannot call send() without setting the iframe");if(void 0===this.message)throw new Error("Cannot call send() without setting the message");const{iframe:e,message:t}=this;yield new Promise(((i,s)=>{var n;try{const r={resolve:i,reject:s};this.resolver=r,null===e.contentWindow?r.resolve():(Ft.debug(`send(): Sending message to storage domain (${this.storageOrigin}) ${Te(t,void 0,2)}`),this.timeStart=new Date,null==(n=e.contentWindow)||n.postMessage(t,this.storageOrigin),setTimeout((()=>{try{this.isDone||s(new Error(`Did not receive response within ${Rt.MESSAGE_EVENT_TIMEOUT_MS}ms`))}catch(e){const t=hi(e);Io.error(t,174)}}),Rt.MESSAGE_EVENT_TIMEOUT_MS))}catch(r){s(r)}}))}))}reply(e){if(void 0===this.resolver)throw new Error("Cannot reply to message request if the message has no resolver");if(void 0!==this.timeStart){const e=(new Date).getTime()-this.timeStart.getTime();this.timeStart=void 0,Ft.debug(`XO message round-trip time - ${e}ms`)}e.success?this.resolver.resolve():void 0===e.error?this.resolver.reject(new Error("Message request failed, but there is no error data (unexpected)")):this.resolver.reject(e),this.isDone=!0}getExpectedVersion(e){return this.localStorage.read(e).flatMap((e=>Vt.validateStorageDatumString(e))).flatMap((e=>j.ofNullable(e.version)))}}var Lt=(e=>(e.UNEXPECTED="UNEXPECTED",e.LOCALSTORAGE_ACCESS="LOCALSTORAGE_ACCESS",e.INVALID_OP="INVALID_OP",e.INVALID_MESSAGE_FORMAT="INVALID_MESSAGE_FORMAT",e.INVALID_MESSAGE_META_FORMAT="INVALID_MESSAGE_META_FORMAT",e.INVALID_DATUM_FORMAT="INVALID_DATUM_FORMAT",e.UNEXPECTED_VERSION="UNEXPECTED_VERSION",e))(Lt||{});function $t(e){return e}class Vt{constructor(e,t,i,s){__publicField(this,"taskManager"),__publicField(this,"localStorage"),__publicField(this,"environment"),__publicField(this,"customer"),__publicField(this,"messageRequests"),__publicField(this,"storageKeys"),__publicField(this,"storageOrigin"),__publicField(this,"cleanupTaskManager"),__publicField(this,"isFeatureMissing"),__publicField(this,"iframeLoadPromise"),__publicField(this,"iframe"),this.localStorage=e,this.taskManager=i,this.environment=t,this.messageRequests={},this.customer=s,this.isFeatureMissing=!1;const n="intellimizeio.com";this.storageOrigin=`https://${s.getId()}.${n}`,this.storageKeys=_t(s),this.cleanupTaskManager=new Pt(this.localStorage,this.taskManager),this.loadIframe().catch((()=>{this.isFeatureMissing=!0}))}static validateStorageDatumString(e){let t;try{if(t=Ae(e),"object"==typeof t&&null!==t&&("string"==typeof t.version||void 0===t.version)&&"string"==typeof t.data)return j.of(t)}catch(i){Ft.debug(`validateStorageDatumString(): Not a StorageDatum (got ${Te(t)})`)}return j.empty()}static getNormalizedStorageValue(e){return Vt.validateStorageDatumString(e).map((e=>e.data)).orElse(e)}static get READY_MESSAGE_TIMEOUT_MS(){return 3e3}static get WAIT_FOR_DATA_MS(){return 500}static isMessageReply(e){return"object"==typeof e&&null!==e&&"reply"===e.type}get isCrossOriginEnabled(){return!this.isFeatureMissing&&(this.customer.getCrossOrigin().isEnabled()||this.customer.getOrigins().length>0)}get shouldWaitForData(){if(this.environment.getReferrerUrl().isPresent()){const e=this.environment.getReferrerUrl().get(),t=this.environment.getHostingPageUrl();if(ut(this.customer,e.getOrigin()).orElse(!1)){if(e.getOrigin()!==t.getOrigin())return Ft.debug("shouldWaitForData(): Detected a switch to a different origin."),!0;let i=!1;for(const e of this.storageKeys)if(this.localStorage.read(e).isPresent()){i=!0;break}if(!i)return Io.warn("shouldWaitForData(): Detected an origin with no data.",63),!0;Ft.debug("shouldWaitForData(): not waiting (user didn't cross origins, and there is existing data in LocalStorage)")}else Ft.debug(`shouldWaitForData(): not waiting (referrer origin not allowed - ${e.getOrigin()})`)}else Ft.debug("shouldWaitForData(): not waiting (no referrer - can't determine if user has crossed origins");return!1}initialize(){return __async(this,null,(function*(){if(this.isCrossOriginEnabled){Ft.debug("Cross-Origin storage enabled by customer configuration. Persisting LocalStorage operations to the common origin.");const e=this.syncWithCommonOrigin().catch((e=>{const t=new gi("Error syncing with common origin",e);Io.error(t,130),this.isFeatureMissing=!0}));this.shouldWaitForData?(Ft.debug("initialize(): Blocking client execution until xd storage is ready (shouldWaitForData is true)"),yield this.waitForData(e)):Ft.debug("initialize(): Not waiting until xd storage is ready (shouldWaitForData is false)")}else Ft.debug("Cross-Origin storage disabled by customer configuration. Using LocalStorage only.");Ft.debug("crossOriginStorage.initialize() has finished")}))}read(e){const t=this.readFromLocalStorage(e);return this.readAsync(e).catch((()=>{this.isFeatureMissing=!0})),t.flatMap((e=>j.ofNullable(e.data)))}write(e,t){this.writeAsync(e,t).catch((()=>{this.isFeatureMissing=!0}))}delete(e){this.deleteAsync(e).catch((()=>{this.isFeatureMissing=!0}))}loadIframe(){return __async(this,null,(function*(){if(void 0===this.iframeLoadPromise){const{document:e}=this.environment.getWindow();let t;this.iframe=e.createElement("iframe"),this.iframeLoadPromise=new Promise(((s,n)=>{let r=!1,o=!1;this.iframe.setAttribute("hidden",""),this.iframe.setAttribute("tabIndex","-1"),this.iframe.setAttribute("width","0"),this.iframe.setAttribute("height","0"),this.iframe.setAttribute("style","display:none");let a=`${this.storageOrigin}/storage.html`;Io.getLevel()<i.LogLevel.OFF&&(a+=`?ideb=${Io.getLevel()}`),this.iframe.setAttribute("src",a),this.iframe.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),this.iframe.onerror=e=>{Ft.debug("XO iframe onerror callback triggered"),r||o||setTimeout((()=>{try{o=!0;const t=new gi("Iframe load error",e);Io.error(t,66),n()}catch(t){const e=hi(t);Io.error(e,170)}}),0)};const l=()=>{Ft.debug("XO iframe ready resolver triggered"),o||setTimeout((()=>{var e;try{if(Ft.debug("loadIframe(): iframe is ready"),r=!0,void 0===(null==(e=this.iframe.contentWindow)?void 0:e.postMessage))Io.error("postMessage() API not supported",65),n(),this.iframe.remove();else{if(void 0!==t){const e=(new Date).getTime()-t.getTime();Ft.debug(`iframe load + ready message time - ${e}ms`)}s(void 0)}}catch(i){const e=hi(i);Io.error(e,171)}}),0)};this.environment.addListener("message",(e=>{try{this.handleResponse(e,l)}catch(t){const e=new gi("Exception in XO message response handler",t);Io.error(e,237)}})),t=new Date,e.querySelectorAll("head")[0].insertAdjacentElement("afterbegin",this.iframe),setTimeout((()=>{try{r||(o=!0,Io.error(`iframe did not load & receive "ready" message within ${Vt.READY_MESSAGE_TIMEOUT_MS} ms`,67),n())}catch(e){const t=hi(e);Io.error(t,172)}}),Vt.READY_MESSAGE_TIMEOUT_MS)}))}return this.iframeLoadPromise}))}readFromLocalStorage(e){return this.localStorage.read(e).flatMap((e=>{try{return j.of(Ae(e))}catch(t){return Io.error(`readFromLocalStorage(): Unable to parse as JSON (${e})`,68),j.empty()}}))}writeToLocalStorage(e,t){this.localStorage.write(e,xe(t)),Ft.debug(`writeToLocalStorage(): Wrote "${e}" to LocalStorage (${Te(t,void 0,2)})`)}deleteFromLocalStorage(e){this.localStorage.delete(e),Ft.debug(`deleteFromLocalStorage(): Deleted "${e}" from LocalStorage`)}readAsync(e){return __async(this,null,(function*(){if(Ft.debug(`readAsync(): Called with storageKey: "${e}"`),this.isCrossOriginEnabled){const t=new Rt(this.localStorage,this.storageOrigin,{requestId:"",op:"read",storageKey:e});yield this.sendMessageRequest(t)}}))}writeAsync(e,t){return __async(this,null,(function*(){let i;if(Ft.debug(`writeAsync(): Called with storageKey: "${e}", data ${t}`),this.isCrossOriginEnabled){const s=new Rt(this.localStorage,this.storageOrigin);i={version:s.getRequestId(),data:t},s.setMessage({requestId:"",op:"write",storageKey:e,storageDatum:i}),this.writeToLocalStorage(e,i),yield this.sendMessageRequest(s)}else this.writeToLocalStorage(e,{data:t})}))}deleteAsync(e){return __async(this,null,(function*(){if(Ft.debug(`delete(): Called with storageKey: "${e}"`),this.isCrossOriginEnabled){const t=new Rt(this.localStorage,this.storageOrigin,{requestId:"",op:"delete",storageKey:e});this.deleteFromLocalStorage(e),yield this.sendMessageRequest(t)}else this.deleteFromLocalStorage(e)}))}syncWithCommonOrigin(){return __async(this,null,(function*(){const e=[];this.storageKeys.forEach((t=>{this.readFromLocalStorage(t).ifPresent((({data:i,version:s})=>{s?(Ft.debug(`syncWithCommonOrigin(): Existing storageDatum found with a version (storageKey: ${t}). Sending "read" message to the common origin.`),e.push(this.readAsync(t))):(Ft.debug(`syncWithCommonOrigin(): Existing storageDatum found without a version (storageKey: ${t}). Sending "write" message to the common origin.`),e.push(this.writeAsync(t,i)))})).ifAbsent((()=>{Ft.debug(`syncWithCommonOrigin(): No existing storageDatum found (storageKey: ${t}). Sending "read" message to the common origin.`),e.push(this.readAsync(t))}))})),yield Promise.all(e)}))}sendMessageRequest(e){return __async(this,null,(function*(){try{yield this.loadIframe()}catch(i){return void(this.isFeatureMissing=!0)}const t=e.getRequestId();e.setIframe(this.iframe),this.messageRequests[t]=e;try{yield e.send(),delete this.messageRequests[t]}catch(s){if(delete this.messageRequests[t],Vt.isMessageReply(s))this.handleMessageReplyErrors(e,s);else{const e=new gi("Could not send message request",s);Io.error(e,129),this.isFeatureMissing=!0}}}))}handleResponse(e,t){const{data:i,origin:s}=e;if(s!==this.storageOrigin)return;if(Ft.debug(`handleResponse(): Received message event from storage domain (${this.storageOrigin})`),void 0!==i&&Ft.debug(Te(i)),"object"!=typeof i||null===i)return void Io.debug("handleResponse(): Refusing to handle message with invalid response format",69);if("ready"===i.type)return Ft.debug('handleResponse(): Received "ready" message'),void t();if("sync"===i.type)return void this.handleSyncResponse($t(i));if("reply"!==i.type)return void Io.debug(`handleResponse(): Refusing to handle message with unknown type (${i.type})`,70);const{correlationId:n}=i,r=this.messageRequests[n];void 0!==r?r.reply(i):Io.error("handleResponse(): Could not find matching message in memory",71)}handleSyncResponse({storageKey:e,storageDatum:t}){this.cleanupTaskManager.queueCleanupTask(e,t)}handleMessageReplyErrors(e,t){const{code:i,msg:s}=t.error;if(Ft.debug(s),i===Lt.UNEXPECTED_VERSION)this.handleUnexpectedVersion(e,t);else{if(i!==Lt.LOCALSTORAGE_ACCESS)throw new Error(s);Ft.debug("LocalStorage is not accessible on the common origin (i.e. browser security setting)")}}handleUnexpectedVersion(e,t){const i=e.getStorageKey(),{storageDatum:s}=t;if(void 0===s){const e=`handleUnexpectedVersion(): Common origin has no data for storageKey: "${i}"`;Ft.debug(e)}else{const e=`handleUnexpectedVersion(): Common origin for storageKey: "${i}"`;Ft.debug(`${e} ${Te(s,void 0,2)}`)}this.cleanupTaskManager.queueCleanupTask(i,s)}waitForData(e){return __async(this,null,(function*(){return new Promise(((t,i)=>__async(this,null,(function*(){let s=!1;const n=this.environment.getWindow().setTimeout((()=>__async(this,null,(function*(){s=!0;try{t()}catch(e){const t=hi(e);Io.error(t,173)}}))),Vt.WAIT_FOR_DATA_MS),r=Date.now();try{const i=yield e,o=Date.now();Ft.debug(`waitForData(): iframe load + data sync time - ${o-r}ms`);const a=yield this.cleanupTaskManager.run(),l=Date.now();Ft.debug(`waitForData(): Cleanup task time - ${l-o}ms`),s?Io.warn(`waitForData(): Synchronization did not complete within ${Vt.WAIT_FOR_DATA_MS}ms. (Took ${l-r}ms)`,72):(Ft.debug(`waitForData(): Sync completed; finished in under ${Vt.WAIT_FOR_DATA_MS}ms (Took ${l-r}ms)`),this.environment.getWindow().clearTimeout(n),t([i,a]))}catch(o){s||(this.environment.getWindow().clearTimeout(n),i(o))}}))))}))}}class Ut{constructor(){__publicField(this,"storage"),this.storage={}}write(e,t){Et(e)||Io.error(`Writing an unknown key to MemoryStorage: ${e}`,180),this.storage[e]=t}read(e){return j.ofNullable(this.storage[e])}delete(e){delete this.storage[e]}}class Wt{constructor(e){if(__publicField(this,"environment"),!St(e,"sessionStorage"))throw new Error("sessionStorage is not available");this.environment=e}write(e,t){Et(e)||Io.error(`Writing an unknown key to SessionStorage: ${e}`,180),this.environment.writeSessionStorage(e,t)}read(e){return this.environment.readSessionStorage(e)}delete(e){this.environment.deleteSessionStorage(e)}}const zt=e=>"0"===e||"1"===e;function jt(e){return t=>new RegExp("^"+e+"$").test(t)}const Gt=e=>"true"===e||"false"===e;function Bt(e){return void 0!==e.error}function Ht(e,t,i){if(!ct(e,i).orElse(!1)){const s={utcm:"utm_campaign",utcn:"utm_content",utm:"utm_medium",uts:"utm_source",utt:"utm_term"},n=mt(e,i);t.setInternalAttributes("user",{ts:n}),t.deleteInternalAttributes("user",we);const r={};we.forEach((t=>{const i=s[t],n=e.getHostingPageUrl().getQueryParam(i,(()=>!0));n.isPresent()&&(r[t]=n.get())})),Object.keys(r).length>0&&t.setInternalAttributes("user",r)}}function Qt(e,t,i){e.getCss().ifPresent((s=>{try{Io.info(`Injecting customer ${e.getId()} css`),wt.injectCss(s,`customer-${e.getId()}`,i),t.setCustomer("css",!0)}catch(n){const i=new gi(`Customer (${e.getId()}) css injection failed`,n);Io.error(i,26),t.setCustomer("css",!1)}})),e.getCode().ifPresent((i=>{try{Io.info(`Running customer ${e.getId()} code`),wt.eval(i),t.setCustomer("code",!0)}catch(s){const i=new gi(`Customer (${e.getId()}) code execution failed`,s);Io.error(i,13),t.setCustomer("code",!1)}}))}function qt(e){return!e.startsWith('{"')}function Kt(e){const t=e.getWindow()[Re(e)];if(void 0===t)return Io.error("Missing customer JSON. Aborting.",145),j.empty();let i;if(Io.time("load json"),qt(t))try{i=Ne(e,t)}catch(n){const e=new gi("Could not decrypt CustomerJson",n);return Io.error(e,213),j.empty()}else try{i=Ae(t)}catch(n){const e=new gi("Could not parse CustomerJson",n);return Io.error(e,210),j.empty()}const s=lt(i);return Io.timeEnd("load json"),j.of(s)}function Yt(e){var t;const{name:i,audienceIds:s,condition:n,state:r,preconditions:o}=e,a=__spreadValues({name:i,condition:n,state:r,preconditions:o},void 0!==s&&{audienceIds:s});if(void 0!==e.changes&&e.changes.length>0)return __spreadProps(__spreadValues({},a),{type:"cl",changes:null!=(t=e.changes)?t:[]});if(void 0!==e.redirect)return __spreadProps(__spreadValues({},a),{type:"urlrd",redirect:e.redirect});if(void 0!==e.code||void 0!==e.css){const{code:t,css:i}=e;return __spreadProps(__spreadValues({},a),{type:"cl",changes:[__spreadValues(__spreadValues({type:st.CUSTOM_CODE},void 0!==t&&{code:t}),void 0!==i&&{css:i})]})}return o.length>0?__spreadProps(__spreadValues({},a),{type:"cl",changes:[]}):__spreadProps(__spreadValues({},a),{type:"nochange",preconditions:[]})}function Jt(e){return void 0===e.type?Yt(e):e}function Xt(e){Io.time("Build customer object time");const t=new bo(Io).buildCustomer(e);return Io.timeEnd("Build customer object time"),j.ofNullable(t)}function Zt(e,t,i){const s=`${he}${e.getId()}`;let n="true"===t.read(s).orElse("false");return n||i.getHostingPageUrl().getQueryParam("intellimize_opt_out",jt("true")).ifPresent((()=>{n=i.getWindow().confirm("Are you sure you want to opt out of Intellimize for this domain?"),n&&(t.write(s,"true"),i.getWindow().alert("You have successfully opted out of Intellimize for this domain."))})),!!n&&(Io.debug("User opt-out; cleanup and exit early"),_t(e).forEach((e=>{e!==s&&t.delete(e)})),i.getWindow().inrsgew=!0,!0)}function ei(e,t,i,s,n){return __async(this,null,(function*(){const r=n.useStorageType().orElse("CrossOriginStorage");switch(r){case"CrossOriginStorage":{const n=new Vt(e,t,i,s);return yield n.initialize(),n}case"MemoryStorage":return new Ut;case"SessionStorage":return new Wt(t);case"LocalStorage":return e;default:throw new Error(`Unknown storage type: ${r}`)}}))}class ti{constructor(){__publicField(this,"count",0)}accept(e){this.count++}result(){return this.count}}class ii{constructor(e){__publicField(this,"activityFieldFunction"),__publicField(this,"set",new Set),this.activityFieldFunction=e}accept(e){const t=this.activityFieldFunction(e);t.isPresent()&&this.set.add(t.get())}result(){return this.set.size}}class si{constructor(e){__publicField(this,"activityFieldFunction"),__publicField(this,"sum",0),__publicField(this,"count",0),this.activityFieldFunction=e}accept(e){const t=this.activityFieldFunction(e);t.isPresent()&&(this.count++,this.sum+=t.get())}result(){return this.count>0?this.sum/this.count:0}}class ni{constructor(e){__publicField(this,"activityFieldFunction"),__publicField(this,"sum",0),this.activityFieldFunction=e}accept(e){const t=this.activityFieldFunction(e);this.sum+=t.orElse(0)}result(){return this.sum}}class ri{constructor(e,t){__publicField(this,"filters"),this.filters=e.filters.map((e=>t.buildActivityFilter(e)))}evaluate(e){return this.filters.every((t=>t.evaluate(e)))}}class oi{constructor(e,t){__publicField(this,"activityFieldFunction"),__publicField(this,"operation"),this.activityFieldFunction=e,this.operation=t}evaluate(e){return this.operation(this.activityFieldFunction(e))}}class ai{constructor(e,t){__publicField(this,"filter"),this.filter=t.buildActivityFilter(e.filter)}evaluate(e){return!this.filter.evaluate(e)}}class li{constructor(e,t){__publicField(this,"filters"),this.filters=e.filters.map((e=>t.buildActivityFilter(e)))}evaluate(e){return this.filters.some((t=>t.evaluate(e)))}}class ci{constructor(e,t,i,s){__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"controlTrafficPercentage"),__publicField(this,"code"),__publicField(this,"css"),__publicField(this,"metrics"),__publicField(this,"experiences"),__publicField(this,"customer"),__publicField(this,"intervals"),__publicField(this,"intervalModifications"),__publicField(this,"important"),__publicField(this,"primaryMetrics"),this.id=e,this.customer=s,this.name=t.name,this.intervals=[],this.intervalModifications=[],void 0!==t.ictp&&(this.controlTrafficPercentage=t.ictp),void 0!==t.code&&(this.code=t.code),void 0!==t.css&&(this.css=t.css);const n=[];for(const[r,o]of Object.entries(t.experiences)){const e=i.buildExperience(r,o,this);n.push(e)}this.experiences=n,this.important=Boolean(t.important),void 0!==t.modifiedIntervals&&(this.intervals=t.modifiedIntervals),void 0!==t.intervalModifications&&(this.intervalModifications=t.intervalModifications),this.metrics=t.metrics.map((e=>i.buildMetric(e,this))),this.primaryMetrics=t.primaryMetrics}getId(){return this.id}getName(){return this.name}getControlTrafficPercentage(){return j.ofNullable(this.controlTrafficPercentage)}getCode(){return j.ofNullable(this.code)}getCss(){return j.ofNullable(this.css)}getExperiences(){return this.experiences}getMetrics(){return this.metrics}getMetric(e){const t=this.metrics.filter((t=>t.getId()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}getCustomer(){return this.customer}getExperience(e){const t=this.experiences.filter((t=>t.getId()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}getIntervals(){return this.intervals}getIntervalModifications(){return this.intervalModifications}isImportant(){return this.important}getPrimaryMetrics(){const{primaryMetrics:e}=this,t="customer"===e.level?this.customer.getMetrics():this.metrics;return 0===e.metricIds.length?t:t.filter((t=>e.metricIds.includes(t.getId())))}getPrimaryMetricLevel(){return this.primaryMetrics.level}}class ui{constructor(e){__publicField(this,"username"),__publicField(this,"role"),this.username=e.username,this.role=e.role}getUsername(){return this.username}getRole(){return this.role}}class di{constructor(e){var t,i;__publicField(this,"enabled"),__publicField(this,"originWhitelist"),__publicField(this,"originBlacklist"),void 0===e?(this.enabled=!1,this.originWhitelist=[],this.originBlacklist=[]):(this.enabled=e.enabled||!1,this.originWhitelist=null!=(t=e.originWhitelist)?t:[],this.originBlacklist=null!=(i=e.originBlacklist)?i:[])}static isMatchingOrigin(e,t){return new RegExp(`^${e}$`).test(t)}isEnabled(){return this.enabled}getOriginWhitelist(){return this.originWhitelist}getOriginBlacklist(){return this.originBlacklist}isOriginAllowed(e){let t=!1;for(const i of this.originWhitelist)if(di.isMatchingOrigin(i,e)){t=!0;break}if(t)for(const i of this.originBlacklist)if(di.isMatchingOrigin(i,e)){t=!1;break}return t}}function hi(e){return e instanceof Error?e:new Error(e)}class gi extends Error{constructor(e,t){super(e),__publicField(this,"cause"),this.name="ProxyError",this.cause=hi(t),this.message=this.getAggregateMessage(),void 0!==this.cause.stack&&(this.stack=this.cause.stack)}getCause(){return this.cause instanceof gi?this.cause.getCause():this.cause}getAggregateMessage(){let e=`${this.message}. `;return e+=this.cause instanceof gi?this.cause.getAggregateMessage():`${this.cause.name}: ${this.cause.message}`,e}}class pi{constructor(e,t,i){var s;__publicField(this,"logger"),__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"type"),__publicField(this,"state"),__publicField(this,"metrics",[]),this.logger=i.getLogger(),this.id=e,this.name=t.name,this.type=t.type,R(void 0!==this.type,"invalid event type: "+t.type),this.state=null!=(s=t.state)?s:"live"}addMetric(e){this.metrics.push(e)}getId(){return this.id}getName(){return this.name}getType(){return this.type}getState(){return this.state}getMetrics(){const e=[];return this.metrics.forEach((t=>{e.push(t)})),e}}class mi extends pi{}class vi extends mi{constructor(e,t,i){super(e,t,i),__publicField(this,"pages"),__publicField(this,"code"),__publicField(this,"selector"),this.pages=t.pageIds.flatMap((e=>i.getPage(e).toArray())),this.pages.forEach((e=>{e.addEvent(this)})),void 0!==t.code&&(this.code=t.code),this.selector=t.selector}static filterEvents(e){return e.filter((e=>"click"===e.getType()))}getPages(){return this.pages}getCode(){return j.ofNullable(this.code)}getSelector(){return this.selector}executeCode(e){this.logger.debug("executeCode() if present");let t=!0;if(this.getCode().isPresent()){const s=this.getCode().get();try{this.logger.info(`Event ${this.id} code running`),t=e(s),this.logger.info(`Event ${this.id} code result => ${t}`)}catch(i){const e=new gi(`Click event (${this.id}) code execution failed `,i);t=!1,this.logger.error(e,1007,{eventId:this.id})}}return t}}class bi extends pi{constructor(e,t,i){super(e,t,i),__publicField(this,"apiName"),this.apiName=t.apiName}static filterEvents(e){return e.filter((e=>"custom"===e.getType()))}getApiName(){return this.apiName}}class fi extends pi{constructor(e,t,i){super(e,t,i),__publicField(this,"formId"),this.formId=t.formId}static filterEvents(e){return e.filter((e=>"hubspot"===e.getType()))}getFormId(){return this.formId}}class _i extends pi{constructor(e,t,i){super(e,t,i),__publicField(this,"formId"),this.formId=t.formId}static filterEvents(e){return e.filter((e=>"marketo"===e.getType()))}getFormId(){return this.formId}}class Ei extends pi{constructor(e,t,i){super(e,t,i),__publicField(this,"customerEventName"),this.customerEventName=t.customerEventName}static filterEvents(e){return e.filter((e=>"shopify"===e.getType()))}getCustomerEventName(){return this.customerEventName}}class yi extends pi{constructor(e,t,i){super(e,t,i)}}class Si extends pi{constructor(e,t,i){super(e,t,i),__publicField(this,"pages"),__publicField(this,"code"),this.pages=t.pageIds.flatMap((e=>i.getPage(e).toArray())),this.pages.forEach((e=>{e.addEvent(this)})),void 0!==t.code&&(this.code=t.code)}static filterEvents(e){return e.filter((e=>"view"===e.getType()))}getPages(){return this.pages}getCode(){return j.ofNullable(this.code)}executeCode(e){this.logger.debug("executeCode() if present");let t=!0;if(this.getCode().isPresent()){const s=this.getCode().get();try{this.logger.info(`Event ${this.id} code running`),t=e(s),this.logger.info(`Event ${this.id} code result => ${t}`)}catch(i){const e=new gi(`View event (${this.id}) code execution failed `,i);t=!1,this.logger.error(e,1011,{eventId:this.id})}}return t}}class wi extends mi{static filterEvents(e){return e.filter((e=>"wf_engagement_click"===e.getType()))}constructor(e,t,i){super(e,t,i)}getSelector(){return"[data-wf-native-id-path]"}}class Ii extends mi{constructor(e,t,i){super(e,t,i),__publicField(this,"selector"),this.selector=`[data-wf-event-ids*="${e}"]`}static filterEvents(e){return e.filter((e=>"wf_click"===e.getType()))}getSelector(){return this.selector}}class Ci{constructor(e,t){var i,s,n,r,o,a,l;__publicField(this,"data"),__publicField(this,"active"),__publicField(this,"encrypt"),__publicField(this,"schemaVersion"),__publicField(this,"id"),__publicField(this,"version"),__publicField(this,"name"),__publicField(this,"controlStickyConfig"),__publicField(this,"campaignControl"),__publicField(this,"controlTrafficPercentage"),__publicField(this,"collaborators"),__publicField(this,"excludeIps"),__publicField(this,"plugins"),__publicField(this,"metrics"),__publicField(this,"campaigns"),__publicField(this,"pages"),__publicField(this,"audiences"),__publicField(this,"experiences"),__publicField(this,"iEvents"),__publicField(this,"code"),__publicField(this,"css"),__publicField(this,"snippetDomain"),__publicField(this,"urlParamFilters"),__publicField(this,"customAttributeFilters"),__publicField(this,"googleAnalytics4Integration"),__publicField(this,"segmentAnalyticsIntegration"),__publicField(this,"mixpanelIntegration"),__publicField(this,"marketoIntegration"),__publicField(this,"salesforceIntegration"),__publicField(this,"shopifyIntegration"),__publicField(this,"firmographicIntegration"),__publicField(this,"sixsenseIntegration"),__publicField(this,"googleAdsIntegration"),__publicField(this,"demandbaseIntegration"),__publicField(this,"hubspotIntegration"),__publicField(this,"mfa"),__publicField(this,"changelogInternal"),__publicField(this,"changelogExternal"),__publicField(this,"crossOrigin"),__publicField(this,"origins"),__publicField(this,"vertical"),__publicField(this,"currentContract"),__publicField(this,"timeZone"),__publicField(this,"classicAccess"),__publicField(this,"salesforceAccountId"),__publicField(this,"autoUpdateOrigins"),__publicField(this,"roiScenario"),__publicField(this,"webflowSiteId"),__publicField(this,"limitedModeCondition"),this.data=e,this.active=e.active,this.encrypt=e.encrypt,this.schemaVersion=null!=(i=e.schemaVersion)?i:"1",this.id=e.id,this.version=e.__v,this.name=e.name,this.controlStickyConfig=t.buildControlStickyConfig(e.scon),this.campaignControl=e.ipcc,this.campaignControl||void 0===e.ictp||(this.controlTrafficPercentage=e.ictp),void 0!==e.code&&(this.code=e.code),void 0!==e.css&&(this.css=e.css),void 0!==e.snippetDomain&&(this.snippetDomain=e.snippetDomain);const c=[];void 0!==e.collaborators&&e.collaborators.forEach((e=>{c.push(t.buildCollaborator(e))})),this.collaborators=c,this.excludeIps=null!=(s=e.excludeIps)?s:[],this.plugins=null!=(n=e.plugins)?n:[],this.urlParamFilters=null!=(r=e.urlParamFilters)?r:[],this.customAttributeFilters=null!=(o=e.customAttributeFilters)?o:[],this.changelogInternal=null!=(a=e.changelogInternal)?a:[],this.changelogExternal=null!=(l=e.changelogExternal)?l:[],this.crossOrigin=t.buildCrossOrigin(e.crossOrigin),this.origins=void 0!==e.origins&&e.origins.length>0?e.origins.map((e=>t.buildOrigin(e))):[];const u=[];for(const[v,b]of Object.entries(e.audiences)){const e=t.buildAudience(v,b);u.push(e)}this.audiences=u;const d=[];for(const[v,b]of Object.entries(e.pages)){const e=t.buildPage(v,b);d.push(e)}this.pages=d;const h=[];for(const[v,b]of Object.entries(e.events)){const e=t.buildEvent(v,b);h.push(e)}this.iEvents=h;for(const[v,b]of Object.entries(e.pages))"metrics"in b&&b.metrics.forEach((e=>{t.getPage(v).ifPresent((i=>{i.addMetric(t.buildMetric(e,void 0,i))}))}));let g=[];void 0!==e.metrics&&(g=e.metrics.map((e=>t.buildMetric(e,void 0,void 0,this)))),this.metrics=g;const p=[];for(const[v,b]of Object.entries(e.campaigns)){const e=t.buildCampaign(v,b,this);p.push(e)}this.campaigns=p;const m=new Map;this.campaigns.forEach((e=>{e.getExperiences().forEach((e=>{m.set(e.getId(),e)}))})),this.experiences=m,void 0!==e.iint&&(void 0!==e.iint.ga4&&(this.googleAnalytics4Integration=t.buildGoogleAnalytics4Integration(e.iint.ga4)),void 0!==e.iint.sg&&(this.segmentAnalyticsIntegration=t.buildSegmentIntegration(e.iint.sg)),void 0!==e.iint.mp&&(this.mixpanelIntegration=t.buildMixpanelIntegration(e.iint.mp)),void 0!==e.iint.marketo&&(this.marketoIntegration=t.buildMarketoIntegration(e.iint.marketo)),void 0!==e.iint.salesforce&&(this.salesforceIntegration=t.buildSalesforceIntegration(e.iint.salesforce)),void 0!==e.iint.shopify&&(this.shopifyIntegration=t.buildShopifyIntegration(e.iint.shopify,this.metrics,this.pages,this.iEvents)),void 0!==e.iint.firmographic&&(this.firmographicIntegration=t.buildFirmographicIntegration(e.iint.firmographic)),void 0!==e.iint.sixsense&&(this.sixsenseIntegration=t.buildSixsenseIntegration(e.iint.sixsense)),void 0!==e.iint.googleAds&&(this.googleAdsIntegration=t.buildGoogleAdsIntegration(e.iint.googleAds)),void 0!==e.iint.demandbase&&(this.demandbaseIntegration=t.buildDemandbaseIntegration(e.iint.demandbase)),void 0!==e.iint.hubspot&&(this.hubspotIntegration=t.buildHubspotIntegration(e.iint.hubspot))),this.mfa=Boolean(e.mfa),void 0!==e.vertical&&(this.vertical=e.vertical),void 0!==e.currentContract&&(this.currentContract=e.currentContract),void 0!==e.timeZone&&(this.timeZone=e.timeZone),void 0!==e.classicAccess&&(this.classicAccess=e.classicAccess),void 0!==e.salesforceAccountId&&(this.salesforceAccountId=e.salesforceAccountId),this.autoUpdateOrigins=e.autoUpdateOrigins,void 0!==e.roiScenario&&(this.roiScenario=e.roiScenario),this.webflowSiteId=e.webflowSiteId,void 0!==e.limitedModeCondition&&(this.limitedModeCondition=t.buildCondition(e.limitedModeCondition))}getData(){return this.data}isActive(){return this.active}shouldEncrypt(){return this.encrypt}getSchemaVersion(){return this.schemaVersion}getId(){return this.id}getVersion(){return this.version}getName(){return this.name}getCollaborators(){return this.collaborators}getExcludeIps(){return this.excludeIps}getPlugins(){return this.plugins}getMetrics(){return this.metrics}getControlStickyConfig(){return this.controlStickyConfig}isCampaignControl(){return this.campaignControl}getControlTrafficPercentage(){return j.ofNullable(this.controlTrafficPercentage)}getCode(){return j.ofNullable(this.code)}getCss(){return j.ofNullable(this.css)}getSnippetDomain(){return j.ofNullable(this.snippetDomain)}getCampaigns(){return this.campaigns}getPages(){return this.pages}getAudiences(){return this.audiences}getEvents(){return this.iEvents}getCampaign(e){const t=this.campaigns.filter((t=>t.getId()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}getExperience(e){return j.ofNullable(this.experiences.get(e))}getPage(e){const t=this.pages.filter((t=>t.getId()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}getEvent(e){const t=this.iEvents.filter((t=>t.getId()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}getCustomEvent(e){const t=this.iEvents.filter((t=>t instanceof bi&&t.getApiName()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}getShopifyEvent(e){const t=this.iEvents.filter((t=>t instanceof Ei&&t.getCustomerEventName()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}getShopifyServerSideEvent(){return j.ofNullable(this.iEvents.find((e=>e instanceof yi)))}getAudience(e){const t=this.audiences.filter((t=>t.getId()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}getIntegrationGoogle4Analytics(){return j.ofNullable(this.googleAnalytics4Integration)}getIntegrationSegmentAnalytics(){return j.ofNullable(this.segmentAnalyticsIntegration)}getIntegrationMixpanel(){return j.ofNullable(this.mixpanelIntegration)}getIntegrationMarketo(){return j.ofNullable(this.marketoIntegration)}getIntegrationSalesforce(){return j.ofNullable(this.salesforceIntegration)}getIntegrationShopify(){return j.ofNullable(this.shopifyIntegration)}getIntegrationFirmographic(){return j.ofNullable(this.firmographicIntegration)}getIntegrationSixsense(){return j.ofNullable(this.sixsenseIntegration)}getIntegrationGoogleAds(){return j.ofNullable(this.googleAdsIntegration)}getIntegrationDemandbase(){return j.ofNullable(this.demandbaseIntegration)}getIntegrationHubspot(){return j.ofNullable(this.hubspotIntegration)}getUrlParamFilters(){return this.urlParamFilters}getCustomAttributeFilters(){return this.customAttributeFilters}getChangelogInternal(){return this.changelogInternal}getChangelogExternal(){return this.changelogExternal}getCrossOrigin(){return this.crossOrigin}getOrigins(){return this.origins}isMfa(){return this.mfa}getVertical(){return j.ofNullable(this.vertical)}getCurrentContract(){return j.ofNullable(this.currentContract)}getTimeZone(){return j.ofNullable(this.timeZone)}hasClassicAccess(){return j.ofNullable(this.classicAccess).orElse(!1)}getSalesforceAccountId(){return j.ofNullable(this.salesforceAccountId)}shouldAutoUpdateOrigins(){return j.ofNullable(this.autoUpdateOrigins).orElse(!1)}getRoiScenario(){return j.ofNullable(this.roiScenario)}getWebflowSiteId(){return j.ofNullable(this.webflowSiteId)}getLimitedModeCondition(){return j.ofNullable(this.limitedModeCondition)}}class Ti{constructor(e){__publicField(this,"type"),__publicField(this,"id"),this.type=e.type,this.id=e.id}getType(){return this.type}getId(){return j.ofNullable(this.id)}}class xi extends Ti{constructor(e){super(e),__publicField(this,"attributes");const t=__spreadValues({},e.attributes.css);this.attributes=__spreadProps(__spreadValues({},e.attributes),{css:t})}getAttributes(){return this.attributes}isReadyToApply(e){return this.getSelectorElements(e).length>0}getSelectorElements(e){return e.querySelectorAll(this.getSelector())}}class Ai extends xi{constructor(e){super(e),__publicField(this,"selector"),this.selector=e.selector}getSelector(){return this.selector}}class Fi extends Ti{constructor(e){super(e),__publicField(this,"code"),__publicField(this,"css"),R(Boolean(e.code)||Boolean(e.css),'Either "code" or "css" must be specified'),this.code=e.code,this.css=e.css}getCode(){return j.ofNullable(this.code)}getCss(){return j.ofNullable(this.css)}isReadyToApply(e){return!0}}class ki extends xi{constructor(e){super(e),__publicField(this,"refId"),__publicField(this,"extensionName"),__publicField(this,"fieldName"),this.refId=e.refId,this.fieldName=e.fieldName,this.extensionName=e.extensionName}getSelector(){const e=`[data-${S}="${this.refId}"]`,t=`[data-${w}="${this.fieldName}"]`;return`${e}${t}, ${e} ${t}`}getRefId(){return this.refId}getExtensionName(){return this.extensionName}getFieldName(){return this.fieldName}}class Pi extends Ti{constructor(e){super(e),__publicField(this,"name"),__publicField(this,"executorJson"),this.name=e.name,this.executorJson=e.executorJson}getName(){return this.name}getExecutorJson(){return this.executorJson}}function Di(e){return e.replace(/['\\]/g,(e=>"\\"+e))}function Mi(e,t=!0){return`document.querySelectorAll('${Di(e)}').length ${t?"> 0":"=== 1"}`}function Ni(e,t){const i=e.querySelectorAll(t),s=null==i?void 0:i[0];return 1===i.length&&void 0!==s?j.of(s):j.empty()}class Oi extends Ti{constructor(e){super(e),__publicField(this,"elementType"),__publicField(this,"targetPosition"),__publicField(this,"idAttribute"),this.targetPosition=e.targetPosition,this.elementType=e.elementType,this.idAttribute=e.idAttribute}getElementType(){return this.elementType}getTargetPosition(){return this.targetPosition}getIdAttribute(){return this.idAttribute}getTargetElement(e){return Ni(e,this.targetPosition.selector)}isReadyToApply(e){return this.getTargetElement(e).isPresent()}}class Ri extends Oi{constructor(e){super(e),__publicField(this,"size"),this.size=e.size}getSize(){return this.size}}class Li extends Ti{constructor(e){super(e),__publicField(this,"targetPosition"),__publicField(this,"selector"),__publicField(this,"moveId"),this.targetPosition=e.targetPosition,this.selector=e.selector,this.moveId=e.moveId}getTargetPosition(){return this.targetPosition}getSelector(){return this.selector}getMoveId(){return this.moveId}getSelectorElement(e){return Ni(e,this.selector)}getTargetElement(e){return Ni(e,this.targetPosition.selector)}isReadyToApply(e){return this.getTargetElement(e).isPresent()&&this.getSelectorElement(e).isPresent()}}class $i extends Ti{constructor(e){super(e)}}const Vi=e=>{if(!rs(e))return!1;const t=e;return"ATTRIBUTE"===t.type&&A(t.selector)&&fs(t.attributes)},Ui=e=>Vi(e)&&y(e,["type","selector","attributes","id"]),Wi=new Set(["1","2","3","4","5","6"]),zi=e=>Wi.has(e),ji=e=>{if(!rs(e))return!1;const t=e;return"INSERT_ELEMENT"===t.type&&D(t.elementType)&&x(t.targetPosition)&&b(t.idAttribute)},Gi=e=>!!ji(e)&&("heading"!==e.elementType||zi(e.size)),Bi=["id","type","targetPosition","elementType","size","idAttribute"],Hi=e=>Gi(e)&&y(e,Bi),Qi=e=>m(e)&&Object.values(e).every((e=>v(e)||p(e)||g(e)||f(e))),qi=e=>m(e)&&(f(e.targetPosition)||x(e.targetPosition))&&Qi(e.fieldData)&&y(e,["targetPosition","fieldData"]),Ki=["id","type","name","executorJson"],Yi=e=>{if(!rs(e))return!1;const t=e;return t.type===st.EXTENSION&&b(t.name)&&qi(t.executorJson)},Ji=e=>Yi(e)&&y(e,Ki),Xi=e=>{if(!rs(e))return!1;const t=e;return"EXTENSION_ATTRIBUTE"===t.type&&_(t.refId)&&b(t.extensionName)&&b(t.fieldName)&&fs(t.attributes)},Zi=e=>Xi(e)&&y(e,["type","attributes","id","refId","extensionName","fieldName"]),es=e=>m(e)&&e.type===st.MOVE_ELEMENT&&_(e.moveId)&&A(e.selector)&&x(e.targetPosition),ts=["id","type","targetPosition","selector","moveId"],is=e=>es(e)&&y(e,ts),ss=e=>ns(e)&&y(e,["type"]),ns=e=>m(e)&&e.type===st.WEBFLOW,rs=e=>m(e)&&cs(e.type)&&(f(e.id)||b(e.id)),os=e=>{if(!rs(e))return!1;const t=e,{code:i,css:s}=t;return"CUSTOM_CODE"===t.type&&(void 0!==i||void 0!==s)&&(f(i)||b(i))&&(f(s)||b(s))},as=e=>os(e)&&y(e,["type","id","code","css"]),ls=(()=>new Set([st.ATTRIBUTE,st.CUSTOM_CODE,st.INSERT_ELEMENT,st.MOVE_ELEMENT,st.EXTENSION,st.EXTENSION_ATTRIBUTE,st.WEBFLOW]))(),cs=e=>ls.has(e),us=new Set(it),ds=e=>v(e)&&us.has(e),hs=e=>m(e)&&b(e.name)&&ds(e.namespace)&&y(e,["name","namespace"]),gs=e=>m(e)&&hs(e.attrDefId)&&v(e.defaultString)&&y(e,["defaultString","attrDefId"]),ps=e=>m(e)&&"attribute"===e.type&&gs(e.value)&&y(e,["type","value"]),ms=e=>m(e)&&"string"===e.type&&b(e.value)&&y(e,["type","value"]),vs=e=>ms(e)||ps(e),bs=e=>v(e)||h(e)&&e.every((e=>vs(e))),fs=e=>!!m(e)&&(!(!f(e.html)&&!bs(e.html)||!f(e.style)&&!v(e.style)||!f(e.className)&&!v(e.className)||!f(e.src)&&!v(e.src)||!f(e.alt)&&!v(e.alt)||!f(e.srcset)&&!v(e.srcset)||!f(e.sizes)&&!v(e.sizes)||!f(e.href)&&!v(e.href)||!f(e.value)&&!v(e.value)||!f(e.placeholder)&&!v(e.placeholder)||!f(e.maxlength)&&!p(e.maxlength)||!f(e.required)&&!g(e.required)||!f(e.poster)&&!v(e.poster)||!f(e.loop)&&!g(e.loop)||!f(e.autoplay)&&!g(e.autoplay)||!f(e.muted)&&!g(e.muted)||!f(e.controls)&&!g(e.controls))&&(!(!f(e.css)&&!k(e.css))&&y(e,["html","style","className","src","alt","srcset","sizes","href","css","value","placeholder","maxlength","required","poster","loop","autoplay","muted","controls"])));function _s(e){if(Ui(e))return new Ai(e);if(as(e))return new Fi(e);if(is(e))return new Li(e);if(Hi(e))return"heading"===e.elementType?new Ri(e):new Oi(e);if(Ji(e))return new Pi(e);if(Zi(e))return new ki(e);if(ss(e))return new $i(e);throw new M(`Invalid dom change type ${e.type}`)}class Es extends pi{static filterEvents(e){return e.filter((e=>"page_leave"===e.getType()))}constructor(e,t,i){super(e,t,i)}}class ys{constructor(e,t,i,s){var n,r,o,a;__publicField(this,"allVariationsMap",{}),__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"type"),__publicField(this,"state"),__publicField(this,"pages"),__publicField(this,"condition"),__publicField(this,"audiences"),__publicField(this,"realPreconditions"),__publicField(this,"preconditions"),__publicField(this,"dependsOnExperienceIds"),__publicField(this,"dependsOnExperiences",[]),__publicField(this,"realVariations"),__publicField(this,"campaign"),__publicField(this,"ignore"),__publicField(this,"inclusionStickyConfig"),__publicField(this,"variationStickyConfig"),__publicField(this,"boundingSelectors"),__publicField(this,"playbookId"),__publicField(this,"note"),this.id=e,this.name=t.name,this.type=null!=(n=t.type)?n:"cc",this.state=t.state,this.inclusionStickyConfig=i.buildExperienceIncludeStickyConfig(t.sinc),this.variationStickyConfig=i.buildVariationStickyConfig(t.svar),this.ignore=t.ignore,this.playbookId=t.playbookId,this.note=t.note,this.pages=t.pageIds.flatMap((e=>i.getPage(e).toArray())),this.pages.forEach((e=>{e.addExperience(this)})),this.condition=i.buildConditionFromVariationOrExperience(t),this.audiences=bo.addExperienceToAudiences(this),this.dependsOnExperienceIds=null!=(r=t.dependsOnExperienceIds)?r:[],this.dependsOnExperiences=[];const l=[];for(const[c,u]of Object.entries(t.variations)){const e=i.buildVariation(c,u,this);l.push(e),this.allVariationsMap[c]=e}this.realVariations=l,this.boundingSelectors=null!=(o=t.boundingSelectors)?o:[],this.realPreconditions=null!=(a=t.preconditions)?a:[],this.preconditions=[...this.realPreconditions,...this.generatePreconditionsForBoundingSelectors()],this.campaign=s}inflateDependsOnExperiences(e){this.dependsOnExperienceIds.forEach((t=>{const i=e[t];void 0!==i&&this.dependsOnExperiences.push(i)}))}getId(){return this.id}getName(){return this.name}getType(){return this.type}isEnabled(){return"live"===this.state}getState(){return this.state}getPages(){return this.pages}getCondition(){return j.ofNullable(this.condition)}getAudiences(){return this.audiences}getPreconditions(){return this.preconditions}getBoundingSelectors(){return this.boundingSelectors}getRealPreconditions(){return this.realPreconditions}getDependsOnExperiences(){return this.dependsOnExperiences}getRealVariations(){return this.realVariations}getVariation(e){return j.ofNullable(this.allVariationsMap[e])}getCampaign(){return this.campaign}getInclusionStickyConfig(){return this.inclusionStickyConfig}getVariationStickyConfig(){return this.variationStickyConfig}getIgnore(){return this.ignore}getPlaybookId(){return j.ofNullable(this.playbookId)}getNote(){return j.ofNullable(this.note)}generatePreconditionsForBoundingSelectors(){const e=[];return this.boundingSelectors.forEach((t=>{e.push(Mi(t))})),e}}class Ss extends ys{constructor(e,t,i,s){super(e,t,i,s),__publicField(this,"logger"),__publicField(this,"trafficAllocation"),this.logger=i.getLogger(),this.trafficAllocation=t.trafficAllocation}static filterExperiences(e){return e.filter((e=>"ab"===e.getType()))}selectVariation(e){let t;for(const[i,s]of Object.entries(this.trafficAllocation))if(e>=s.lowerEndpoint&&e<s.upperEndpoint){t=i;break}return void 0!==t?this.getVariation(t):(this.logger.error(`Could not determine A/B variation for ${e}`,1012,{experienceId:this.getId()}),j.empty())}getTrafficAllocation(){const e={};for(const[t,i]of Object.entries(this.trafficAllocation))e[t]=__spreadValues({},i);return e}}class ws extends ys{constructor(e,t,i,s){super(e,t,i,s),__publicField(this,"controlVariation");const n=i.buildControlVariation(this);this.controlVariation=n,this.allVariationsMap[n.getId()]=n}static filterExperiences(e){return e.filter((e=>"cc"===e.getType()))}getControlVariation(){return this.controlVariation}}class Is extends ys{constructor(e,t,i,s){super(e,t,i,s),__publicField(this,"logger"),__publicField(this,"variationPriority"),this.logger=i.getLogger(),this.variationPriority=t.variationPriority}static filterExperiences(e){return e.filter((e=>"rbp"===e.getType()))}getPrioritizedVariations(){const e=[];if(void 0!==this.variationPriority)for(const t of this.variationPriority)this.getVariation(t).ifPresent((t=>{e.push(t)})).ifAbsent((()=>{this.logger.debug("Could not find prioritized variation for RBP",1013,{experienceId:this.getId(),variationId:t})}));return e}}class Cs{constructor(e){__publicField(this,"enabled"),this.enabled=e.enabled}isEnabled(){return this.enabled}}class Ts{constructor(e){__publicField(this,"enabled"),this.enabled=e.enabled}isEnabled(){return this.enabled}}class xs{constructor(e){__publicField(this,"enabled"),__publicField(this,"managedAccounts"),this.enabled=e.enabled,this.managedAccounts=e.managedAccounts}isEnabled(){return this.enabled}getManagedAccounts(){return this.managedAccounts}}class As{constructor(e){__publicField(this,"enabled"),__publicField(this,"autoConfig"),__publicField(this,"measurementIds"),this.enabled=e.enabled,this.autoConfig=e.autoConfig,this.measurementIds=e.measurementIds}isEnabled(){return this.enabled}isAutoConfig(){return this.autoConfig}getMeasurementIds(){return this.measurementIds}}class Fs{constructor(e){__publicField(this,"enabled"),__publicField(this,"hubId"),__publicField(this,"objectsToIngest"),this.enabled=e.enabled,this.hubId=e.hubId,this.objectsToIngest=e.objectsToIngest}isEnabled(){return this.enabled}getHubId(){return this.hubId}getObjectsToIngest(){return this.objectsToIngest}}class ks{constructor(e){__publicField(this,"enabled"),__publicField(this,"munchkinId"),__publicField(this,"fieldsToIngest"),__publicField(this,"listsToIngest"),this.enabled=e.enabled,this.munchkinId=e.munchkinId,this.fieldsToIngest=e.fieldsToIngest,this.listsToIngest=e.listsToIngest}isEnabled(){return this.enabled}getMunchkinId(){return this.munchkinId}getFieldsToIngest(){return this.fieldsToIngest}getListsToIngest(){return this.listsToIngest}}const Ps="Optimization Viewed";class Ds{constructor(e){__publicField(this,"enabled"),__publicField(this,"eventName"),this.enabled=e.enabled,this.eventName=e.name}isEnabled(){return this.enabled}getEventName(){var e;return null!=(e=this.eventName)?e:Ps}}class Ms{constructor(e){__publicField(this,"enabled"),__publicField(this,"objectsToIngest"),__publicField(this,"outboundReport"),this.enabled=e.enabled,this.objectsToIngest=e.objectsToIngest,this.outboundReport=e.outboundReport}isEnabled(){return this.enabled}getObjectsToIngest(){return this.objectsToIngest}getOutboundReport(){return j.ofNullable(this.outboundReport)}}class Ns{constructor(e){__publicField(this,"enabled"),__publicField(this,"eventName"),this.enabled=e.enabled,this.eventName=e.dim}isEnabled(){return this.enabled}getEventName(){return this.eventName}}class Os{constructor(e,t,i){var s,n;__publicField(this,"logger"),__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"type"),__publicField(this,"state"),__publicField(this,"iEvents",[]),__publicField(this,"experiences",[]),__publicField(this,"metrics",[]),__publicField(this,"code"),__publicField(this,"timeBudget"),__publicField(this,"changes"),this.logger=i.getLogger(),this.id=e,this.name=t.name,this.type=null!=(s=t.type)?s:"matching",void 0!==t.code&&(this.code=t.code),void 0!==t.timeBudget&&(this.timeBudget=t.timeBudget);const r=[];void 0!==t.changes&&t.changes.forEach((e=>{r.push(i.buildDomChange(e))})),this.changes=r,this.state=null!=(n=t.state)?n:"live"}addEvent(e){this.iEvents.push(e)}addMetric(e){this.metrics.push(e)}addExperience(e){this.experiences.push(e)}getId(){return this.id}getName(){return this.name}getType(){return this.type}getState(){return this.state}getCode(){return j.ofNullable(this.code)}getChanges(){return[...this.changes]}getExperiences(){return[...this.experiences]}getEvents(){return[...this.iEvents]}getTimeBudgetMs(){return j.ofNullable(this.timeBudget)}getMetrics(){return[...this.metrics]}getMetric(e){const t=this.metrics.filter((t=>t.getId()===e));return 0===t.length?j.empty():j.ofNullable(t[0])}executeCode(e){this.logger.debug("executeCode() if present");let t=!0;if(this.getCode().isPresent()){const s=this.getCode().get();try{this.logger.info(`Page ${this.id} code running`),t=e(s),this.logger.info(`Page ${this.id} code result => ${t}`)}catch(i){const e=new gi(`Page (${this.id}) code execution failed`,i);t=!1,this.logger.error(e,1009,{pageId:this.id})}}return t}}class Rs extends Os{constructor(e,t,i){var s,n;super(e,t,i),__publicField(this,"templateUrl"),__publicField(this,"paramName"),__publicField(this,"paramValue"),this.templateUrl=t.templateUrl,this.paramName=null!=(s=t.paramName)?s:Rs.defaultParamName,this.paramValue=null!=(n=t.paramValue)?n:Rs.landingPageNameToParamValue(t.name)}static filterPages(e){return e.filter((e=>"landing"===e.getType()))}static removeWWW(e){return e.replace(/^www\./i,"")}static get defaultParamName(){return"page"}static landingPageNameToParamValue(e){return e.trim().replace(/[^\w\-._~!'()*]+/g,"-")}getTemplateUrl(){return this.templateUrl}getParamName(){return this.paramName}getParamValue(){return this.paramValue}getPreviewUrl(){const{name:e,value:t}=this.determineLandingParam(),i=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`,s=this.templateUrl.indexOf("?");if(-1!==s)return this.templateUrl.slice(0,s+1)+i+"&"+this.templateUrl.slice(s+1);const n=this.templateUrl.indexOf("#");return-1!==n?this.templateUrl.slice(0,n)+"?"+i+this.templateUrl.slice(n):this.templateUrl+"?"+i}matches(e,t){this.logger.group("check page matches");try{const i=new URL(e),s=new URL(this.templateUrl);let n=!0;s.searchParams.forEach(((e,t)=>{i.searchParams.getAll(t).includes(e)||(n=!1)}));const r=j.ofNullable(s.hash).map((e=>e===i.hash)).orElse(!0),{name:o,value:a}=this.determineLandingParam(),l=i.searchParams.getAll(o).includes(a),c=Rs.removeWWW(i.host)===Rs.removeWWW(s.host),u=i.protocol===s.protocol&&i.port===s.port&&i.pathname===s.pathname&&c&&n&&l&&r,d=this.executeCode(t);return this.logger.debug(`didMatch: ${u.toString()}, didPassCode: ${d.toString()}`),this.logger.groupEnd(),u&&d}catch(i){const e=new gi("Could not parse URL",i);return this.logger.warn(e,1018,{pageId:this.getId()}),!1}}determineLandingParam(){return{name:this.getParamName(),value:this.getParamValue()}}}const Ls=(e,t,i,s)=>{e.group("check page matches");const n=i.some((i=>{e.group("check url");const s=i.matches(t);return e.groupEnd(),s})),r=s();return e.debug(`didMatch: ${n.toString()}, didPassCode: ${r.toString()}`),e.groupEnd(),n&&r};class $s extends Os{constructor(e,t,i){super(e,t,i),__publicField(this,"urls"),__publicField(this,"previewUrl");const s=[];t.urls.forEach((e=>{s.push(i.buildUrl(e))})),this.urls=s,this.previewUrl=t.previewUrl}static filterPages(e){return e.filter((e=>"matching"===e.getType()))}getPreviewUrl(){return this.previewUrl}getUrls(){return this.urls}matches(e,t){return Ls(this.logger,e,this.urls,(()=>this.executeCode(t)))}}class Vs extends Os{constructor(e,t,i){super(e,t,i),__publicField(this,"urls"),__publicField(this,"previewUrl");const s=[];t.urls.forEach((e=>{s.push(i.buildUrl(e))})),this.urls=s,this.previewUrl=t.previewUrl}static filterPages(e){return e.filter((e=>"shopify"===e.getType()))}getPreviewUrl(){return this.previewUrl}getUrls(){return this.urls}matches(e,t){return Ls(this.logger,e,this.urls,(()=>this.executeCode(t)))}}class Us{constructor(e,t,i,s){let n;if(__publicField(this,"legacy"),__publicField(this,"shopifyMetric"),__publicField(this,"shopifyPages"),__publicField(this,"shopifyEvents"),__publicField(this,"shopifyCheckoutCompletedEvent"),__publicField(this,"shop"),__publicField(this,"snippet"),__publicField(this,"plus"),Us.isLegacyShopifyIntegrationJson(e)){this.legacy=!0;const t=e;n={shop:`${t.shop}.myshopify.com`,snippet:t.theme,plus:!0};const s=[];i.forEach((e=>{t.pages.includes(e.getId())&&s.push(e)})),this.shopifyPages=s}else this.legacy=!1,n=e,this.shopifyPages=Vs.filterPages(i);this.shop=n.shop,this.snippet=n.snippet,this.plus=n.plus,this.shopifyEvents=Ei.filterEvents(s);const r=this.shopifyEvents.find((e=>"checkout_completed"===e.getCustomerEventName()));N(r,'The shopify "checkout_completed" event must be present'),this.shopifyCheckoutCompletedEvent=r,this.shopifyMetric=t.find((e=>e.getIEvents().find((e=>e.getId()===this.shopifyCheckoutCompletedEvent.getId()))))}static isLegacyShopifyIntegrationJson(e){return void 0!==e.pixel}isPixelEnabled(){return!0}isLegacy(){return this.legacy}getShop(){return this.shop}getMetric(){return j.ofNullable(this.shopifyMetric)}getPages(){return this.shopifyPages}getEvents(){return this.shopifyEvents}getCheckoutCompletedEvent(){return this.shopifyCheckoutCompletedEvent}doesInjectSnippet(){return this.snippet}isShopifyPlus(){return this.plus}}class Ws{constructor(e){__publicField(this,"enabled"),__publicField(this,"oemEnabled"),this.enabled=e.enabled,this.oemEnabled=e.oemEnabled}isEnabled(){return this.enabled}isOemEnabled(){return this.oemEnabled}}class zs{constructor(e,t,i,s,n){__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"iEvents"),__publicField(this,"scope"),__publicField(this,"type"),__publicField(this,"countingMethod"),__publicField(this,"goal"),__publicField(this,"page"),__publicField(this,"campaign"),__publicField(this,"customer"),R(void 0===i||void 0===n),this.id=e.id,this.name=e.name,this.scope=e.scope,this.type=e.type,this.countingMethod=e.countingMethod,this.goal=e.isGoal,this.iEvents=e.eventIds.flatMap((e=>t.getEvent(e).toArray())),this.iEvents.forEach((e=>{e.addMetric(this)})),this.campaign=i,this.page=s,this.customer=n}getId(){return this.id}getName(){return this.name}getIEvents(){return this.iEvents}getScope(){return this.scope}getType(){return this.type}getCountingMethod(){return this.countingMethod}isGoal(){return this.goal}getCampaign(){return j.ofNullable(this.campaign)}getPage(){return j.ofNullable(this.page)}getCustomer(){return j.ofNullable(this.customer)}}class js extends zs{constructor(e,t,i,s,n){super(e,t,i,s,n),__publicField(this,"valueType"),this.valueType=e.valueType}getValueType(){return this.valueType}}class Gs extends js{constructor(e,t,i,s,n){super(e,t,i,s,n),__publicField(this,"value"),this.value=e.value}getValue(){return this.value}}function Bs(e,t=!1){return i=>i.map((t=>e(t))).orElse(t)}function Hs(e){switch(e.operator){case"includesAny":return Bs((t=>t.some((t=>e.argument.includes(t)))));case"excludesAll":return Bs((t=>!t.some((t=>e.argument.includes(t)))),!0);case ot:return e=>e.isPresent();case at:return e=>!e.isPresent();default:throw new Error(`Unknown array enum operator: ${e.operator}`)}}function Qs(e){switch(e.operator){case"includesAny":return Bs((t=>t.some((t=>e.argument.includes(t)))));case ot:return e=>e.isPresent();case at:return e=>!e.isPresent();default:throw new Error(`Unknown array string operator: ${e.operator}`)}}function qs(e){switch(e.operator){case"isTrue":return Bs((e=>e));case"isFalse":return Bs((e=>!e),!0);case ot:return e=>e.isPresent();case at:return e=>!e.isPresent();default:throw new Error(`Unknown boolean operator: ${e.operator}`)}}function Ks(e){switch(e.operator){case"eq":return Bs((t=>t===e.argument));case"ne":return Bs((t=>t!==e.argument),!0);case ot:return e=>e.isPresent();case at:return e=>!e.isPresent();default:throw new Error(`Unknown enum operator: ${e.operator}`)}}function Ys(e){switch(e.operator){case"==":return Bs((t=>t===e.argument));case"!=":return Bs((t=>t!==e.argument),!0);case">":return Bs((t=>t>e.argument));case"<":return Bs((t=>t<e.argument));case">=":return Bs((t=>t>=e.argument));case"<=":return Bs((t=>t<=e.argument));case ot:return e=>e.isPresent();case at:return e=>!e.isPresent();default:throw new Error(`Unknown number operator: ${e.operator}`)}}function Js(e){switch(e.operator){case"eq":return Bs((t=>t===e.argument));case"ne":return Bs((t=>t!==e.argument),!0);case"substr":return Bs((t=>t.includes(e.argument)));case"startsWith":return Bs((t=>t.startsWith(e.argument)));case"endsWith":return Bs((t=>t.endsWith(e.argument)));case"regex":return Bs((t=>new RegExp(e.argument).test(t)));case ot:return e=>e.isPresent();case at:return e=>!e.isPresent();default:throw new Error(`Unknown string operator: ${e.operator}`)}}function Xs(e){switch(e.operator){case"withinPastDuration":return Bs((t=>{const i=/^P(\d+)D$/.exec(e.argument);if(void 0===(null==i?void 0:i[1]))throw new Error(`Invalid unix time operator duration: ${e.argument}`);const s=24*Number(i[1])*60*60*1e3;return t>=Date.now()-s}));case"inBetween":return Bs((t=>{const[i,s]=e.argument;return t>=i&&t<s}));case ot:return e=>e.isPresent();case at:return e=>!e.isPresent();default:throw new Error(`Unknown unix time operator: ${e.operator}`)}}const Zs=e=>{const t=/[|\\{}()[\]^$+*?.-]/g;return e.replace(t,"\\$&")};class en{constructor(e){__publicField(this,"includeSubdomains"),__publicField(this,"domain"),__publicField(this,"port"),this.includeSubdomains=e.includeSubdomains,this.domain=e.domain,this.port=e.port}static isMatchingAllowedDomain(e,t){return new RegExp(`^${e}$`).test(t)}getIncludeSubdomains(){return this.includeSubdomains}getDomain(){return this.domain}getPort(){return j.ofNullable(this.port)}getDomainAndPort(){return void 0===this.port?this.domain:`${this.domain}:${this.port}`}isOriginAllowed(e){const t=this.getDomainAndPort();let i="https?://";return i+=this.includeSubdomains?"([^.]+\\.)?":"(www\\.)?",i+=Zs(t),en.isMatchingAllowedDomain(i,e)}}class tn{constructor(e,t,i){this.sticky=e,this.relativeExpirationTimeSec=t,this.absoluteExpirationTimeSec=i}isSticky(){return this.sticky}getRelativeExpirationTimeSec(){return j.ofNullable(this.relativeExpirationTimeSec)}getAbsoluteExpirationTimeSec(){return j.ofNullable(this.absoluteExpirationTimeSec)}isExpired(e,t){return void 0!==this.absoluteExpirationTimeSec&&t<this.absoluteExpirationTimeSec||void 0!==this.relativeExpirationTimeSec&&t+this.relativeExpirationTimeSec<e}}class sn{constructor(e,t){__publicField(this,"logger"),__publicField(this,"value"),__publicField(this,"match"),this.logger=t.getLogger(),this.value=e.value,this.match=e.match,R(void 0!==this.match,"invalid match type: "+e.match)}static simplifyUrl(e){let t=e;const i=t.indexOf("?");i>0&&(t=t.slice(0,Math.max(0,i)));const s=t.indexOf("#");s>0&&(t=t.slice(0,Math.max(0,s))),t.endsWith("/")&&(t=t.slice(0,Math.max(0,t.length-1)));const n=/^(?:https?:\/\/)?(?:www\.)?(.+)$/.exec(t);return void 0!==(null==n?void 0:n[1])&&(t=n[1]),t}getMatch(){return this.match}getValue(){return this.value}matches(e){let t=!1;switch(this.logger.debug("checking match: "+this.match+", value: "+this.value),this.match){case"simple":t=sn.simplifyUrl(this.value)===sn.simplifyUrl(e);break;case"regex":{const i=new RegExp(this.value);t=Boolean(i.test(e));break}case"exact":t=e===this.value;break;case"substring":t=e.includes(this.value);break;default:this.logger.error(`Unknown url match type: ${this.match}`,1010)}return this.logger.debug(t.toString()),t}}function nn(e){return"[object Array]"===Object.prototype.toString.call(e)}function rn(e){return"[object Arguments]"===Object.prototype.toString.call(e)}function on(e){return"[object Object]"===Object.prototype.toString.call(e)}function an(e){return"[object Function]"===Object.prototype.toString.call(e)}function ln(e){return"[object HTMLImageElement]"===Object.prototype.toString.call(e)}function cn(e,t){const i=[];for(const s of e)t.includes(s)||i.push(s);for(const s of t)e.includes(s)||i.push(s);return i}function un(e){return e.replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()}function dn(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}function hn(e){return Object.fromEntries(Object.entries(e).map((([e,t])=>[t,e])))}const gn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},pn=e=>String(e).replace(/[&<>"'`=/]/g,(e=>{var t;return null!=(t=gn[e])?t:e})),mn=(e,t,i=!0)=>{let s="";return t.forEach((t=>{s+=vn(e,t,i)})),s},vn=(e,t,i=!0)=>{switch(t.type){case"string":return t.value;case"attribute":return bn(e,t.value,i);default:throw new Error(`Unsupported TemplateFragment type: ${t.type}`)}},bn=(e,{attrDefId:t,defaultString:i},s)=>{const n=new He(t);let r=e.getAttributeValue(n).orElse(i);return nn(r)&&(r=fn(e,n,i)),s?pn(String(r)):String(r)},fn=(e,t,i)=>e.getAttributeValue(t).flatMap((([e])=>j.ofNullable(e))).orElse(i);class _n{constructor(e,t,i,s){__publicField(this,"attributeData"),__publicField(this,"environment"),__publicField(this,"localDocument"),__publicField(this,"parent"),__publicField(this,"changeIndex"),this.parent=e,this.changeIndex=t,this.attributeData=i,this.environment=s,this.localDocument=s.getWindow().document}getGuid(){return`${this.parent.getGuid()}-c${this.changeIndex}}`}getEntityIds(){return __spreadProps(__spreadValues({},this.parent.getEntityIds()),{changeId:String(this.changeIndex)})}}const En="data-imize";function yn(e,t,i){var s;const n=e;n.imizeChangeData=null!=(s=n.imizeChangeData)?s:{},m(n.imizeChangeData)?n.imizeChangeData[t]=i:Io.error("Invalid imizeChangeData value: must be an object",118)}function Sn(e,t){return j.ofNullable(Fn(e)[t])}function wn(e,t){delete Fn(e)[t],0===Object.keys(Fn(e)).length&&kn(e)}function In(e){const t=e;return void 0!==t.imizeChangeData&&Object.keys(t.imizeChangeData).length>0}function Cn(e){return`${En}-${e}`}function Tn(e){return document.querySelectorAll(`[${Cn(e)}]`)}function xn(e,t){e.setAttribute(Cn(t),t)}function An(e,t){e.removeAttribute(Cn(t))}function Fn(e){var t;const i=e;return m(i.imizeChangeData)||f(i.imizeChangeData)?null!=(t=i.imizeChangeData)?t:{}:(Io.error("Invalid imizeChangeData value: must be undefined or an object",119),{})}function kn(e){delete e.imizeChangeData}function Pn(e,t){const i={};for(const[s,n]of Object.entries(Fn(e)))n.type===t&&(i[s]=n.value);return i}function Dn(e){return{getGuid:()=>`e${e.getExperience().getId()}-v${e.getId()}`,getEntityIds:()=>({variationId:e.getId(),experienceId:e.getExperience().getId()})}}function Mn(e){return{getGuid:()=>`p${e.getId()}`,getEntityIds:()=>({pageId:e.getId()})}}function Nn(e){return{getGuid:()=>`ve${e.id}`,getEntityIds:()=>({})}}const On=class extends _n{constructor(e,t,i,s,n){super(t,i,s,n),__publicField(this,"attributeChange"),this.attributeChange=e}static getIsValidAttribute(e,t){const i=e.tagName.toLowerCase();return On.VALID_TAGS_BY_NON_STANDARD_ATTRIBUTE[t].includes(i)}isReadyToApply(){return this.attributeChange.isReadyToApply(this.localDocument)}apply(e,t){Io.group("EnhancedAttributeChange.apply()"),Io.debug(`Applying change: ${Te(this.attributeChange)}`),t.registerSelectorAndExecute(this.attributeChange.getSelector(),(t=>{this.applyChanges(t,e)}),{shouldReapply:e=>this.shouldReapply(e)},this.getEntityIds()),Io.groupEnd()}undo(){Io.debug(`[EnhancedAttributeChange]: Undoing change: ${Te(this.attributeChange)}`),this.attributeChange.getId().ifPresent((e=>{const t=Tn(e);Array.prototype.forEach.call(t,(t=>{if(t instanceof HTMLElement){const i=Sn(t,e);if(i.isPresent()){const e=i.get().value;Object.keys(this.attributeChange.getAttributes()).forEach((i=>{switch(i){case"html":void 0!==e.html&&(t.innerHTML=this.renderContent(e.html));break;case"className":void 0!==e.className&&(t.className=e.className);break;case"alt":case"src":case"srcset":case"sizes":case"href":{const s=e[i];void 0===s?t.removeAttribute(i):t.setAttribute(i,s);break}case"css":case"style":void 0!==e.style&&(t.style.cssText=e.style);break;default:Io.error(`[EnhancedAttributeChange]: Cannot undo unknown attribute: ${i}`,121,this.getEntityIds())}}))}else Io.error(`[EnhancedAttributeChange]: Expected change data, but there was none: ${Te(this.attributeChange)}`,122,this.getEntityIds())}else Io.error(new Error("[EnhancedAttributeChange]: Found matching element that is not an HTMLElement"),123,this.getEntityIds());An(t,e),wn(t,e)}))}))}getSelector(){return j.of(this.attributeChange.getSelector())}applyChanges(e,t){let i=!1;Io.group(`EnhancedAttributeChange.applyChanges(${Te(this.attributeChange)})`),this.attributeChange.getId().ifPresent((t=>{xn(e,t)}));const s={};Object.keys(this.attributeChange.getAttributes()).forEach((n=>{switch(n){case"html":{const{html:t}=this.attributeChange.getAttributes();void 0!==t&&(s.html=e.innerHTML,e.innerHTML=this.renderContent(t)),Io.debug("Applied html");break}case"css":case"style":break;case"className":{const{className:t}=this.attributeChange.getAttributes();void 0!==t&&(s.className=e.className,e.className=t),Io.debug("Applied className");break}case"src":this.applyNonStandardAttribute(n,e,s),ln(e)&&!e.complete&&(Io.debug("attaching listener for img src loading"),i=!0,e.addEventListener("load",(()=>{try{Io.debug("EnhancedAttributeChange() image loaded! calling onReadyToRender()"),t()}catch(e){const t=new gi("Exception in image onload handler",e);Io.error(t,236,this.getEntityIds())}}),{once:!0}));break;case"alt":case"srcset":case"sizes":case"href":this.applyNonStandardAttribute(n,e,s);break;default:Io.error(`[EnhancedAttributeChange]: Cannot apply unknown attribute: ${n}`,120,this.getEntityIds())}}));const n=this.createCssText(e);void 0!==n&&(s.style=e.style.cssText,e.style.cssText=n,Io.debug("Applied css")),this.attributeChange.getId().ifPresent((t=>{yn(e,t,{value:s,type:st.ATTRIBUTE})})),i||(Io.debug("EnhancedAttributeChange() not waiting; calling onReadyToRender()"),t()),Io.debug("DOM modifications successfully applied for this change."),Io.groupEnd()}applyNonStandardAttribute(e,t,i){const s=On.getIsValidAttribute(t,e),n=this.attributeChange.getAttributes()[e];if(s&&void 0!==n){const s=t.getAttribute(e);null!==s&&(i[e]=s),t.setAttribute(e,n)}else Io.error(`This ${t.tagName} does not support this attribute: ${e}`,131,this.getEntityIds());Io.debug(`Applied ${n}`)}createCssText(e){const{css:t,style:i}=this.attributeChange.getAttributes();if(f(t))return i;const s=null!=i?i:"";let n="";return Object.entries(t).forEach((([e,t])=>{const i=un(e);if(!new RegExp(i+"\\s*:").test(s)){const i=t.includes("!important")?t:`${t} !important`;n+=`${un(e)}:${i};`}})),f(i)?e.style.cssText+n:n+s}shouldReapply(e){for(const t in this.attributeChange.getAttributes())if(Object.prototype.hasOwnProperty.call(this.attributeChange.getAttributes(),t))switch(Io.debug(`shouldReapply(): CHECKING "${t}"`),t){case"css":case"className":case"style":case"alt":Io.debug(`shouldReapply(): SKIP (attribute "${t}" not checked)`);break;case"src":case"srcset":case"sizes":case"href":{const i=this.attributeChange.getAttributes()[t];if(void 0!==i){const s=e.getAttribute(t);if(""===i&&null===s){Io.debug(`shouldReapply(): SKIP (value of "${t}" is null; configured value is empty string)`);break}if(i!==s)return Io.debug(`shouldReapply(): YES (value of "${t}" changed from "${i}" to "${s}")`),!0;Io.debug(`shouldReapply(): SKIP (value of "${t}" did not change)`);break}Io.debug(`shouldReapply(): SKIP (configured value of "${t}" is undefined)`);break}case"html":{const i=this.attributeChange.getAttributes()[t],s=document.createElement("div");if(void 0!==i&&(s.innerHTML=this.renderContent(i)),e.textContent!==s.textContent)return Io.debug(`shouldReapply(): YES (The visible text of the element has changed from "${s.textContent}" to "${e.textContent}")`),!0;Io.debug(`shouldReapply(): SKIP (The text of the element has not changed; comparing configured "${s.textContent}" to current "${e.textContent}")`);break}default:Io.error(`[EnhancedAttributeChange]: shouldReapply() found unknown attribute: ${t}`,201,this.getEntityIds())}return Io.debug("shouldReapply(): NO (all attributes skipped)"),!1}renderContent(e){return"string"==typeof e?e:mn(this.attributeData,e,!0)}};let Rn=On;__publicField(Rn,"VALID_TAGS_BY_NON_STANDARD_ATTRIBUTE",{alt:["img"],src:["img"],srcset:["img"],sizes:["img"],href:["a"]});class Ln extends _n{constructor(e,t,i,s,n){super(t,i,s,n),__publicField(this,"customCodeChange"),this.customCodeChange=e}isReadyToApply(){return this.customCodeChange.isReadyToApply(this.localDocument)}apply(e,t){Io.group("EnhancedCustomCodeChange.apply()"),Io.debug(`Applying change: ${Te(this.customCodeChange)}`);try{this.customCodeChange.getCss().ifPresent((e=>{this.injectCss(e)})),t.detachObserver(),this.customCodeChange.getCode().ifPresent((e=>{this.runCode(e)}))}finally{t.attachObserver(),e(),Io.groupEnd()}}undo(){}getSelector(){return j.empty()}runCode(e){try{Io.info("Running code for CUSTOM_CODE change"),wt.eval(e)}catch(t){throw new gi("Code execution failed",t)}}injectCss(e){try{const t=this.customCodeChange.getId().orElseRun(Dt);Io.info("Injecting css for CUSTOM_CODE change"),wt.injectCss(e,`dom-change-${t}`,document)}catch(t){throw new gi("Css injection failed",t)}}}var $n={};!function(e){var t=Object.defineProperty,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s,o=(e,t,i)=>(r(e,"symbol"!=typeof t?t+"":t,i),i);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});let a=class extends Error{constructor(e){super(e),this.name="UnexpectedNullException"}};function l(e,t){if(null==e||"string"==typeof e&&0===e.length)throw new a(t);return e}class c extends Error{constructor(e){super(e),this.name="IllegalArgumentException"}}let u=class extends Error{constructor(e){super(e),this.name="NoSuchElementException"}};var d=Object.defineProperty,h=(e,t,i)=>{return r=i,(n="symbol"!=typeof t?t+"":t)in(s=e)?d(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r,i;var s,n,r};class g{static empty(){return v.INSTANCE}static of(e){return new p(l(e))}static ofNullable(e){return null==e||"string"==typeof e&&0===e.length?v.INSTANCE:new p(e)}}class p extends g{constructor(e){super(),h(this,"value"),this.value=e}isPresent(){return!0}ifPresent(e){return e(this.value),this}ifAbsent(e){return this}get(){return this.value}orElse(e){return this.value}orElseRun(e){return this.value}toArray(){return[this.value]}map(e){return g.ofNullable(e(this.value))}flatMap(e){return e(this.value)}toString(){return`Optional[${this.value.toString()}]`}}const m=class extends g{isPresent(){return!1}ifPresent(e){return this}ifAbsent(e){return e(),this}get(){throw new u("No value present")}orElse(e){return e}orElseRun(e){return e()}toArray(){return[]}map(e){return g.empty()}flatMap(e){return g.empty()}toString(){return"Optional.empty"}};let v=m;h(v,"INSTANCE",new m);const b="imize-extension";var f=Object.prototype.toString,_=Array.isArray||function(e){return"[object Array]"===f.call(e)};function E(e){return"function"==typeof e}function y(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function S(e,t){return null!=e&&"object"==typeof e&&t in e}var w=RegExp.prototype.test,I=/\S/;function C(e){return t=I,i=e,!w.call(t,i);var t,i}var T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},x=/\s*/,A=/\s+/,F=/\s*=/,k=/\s*\}/,P=/#|\^|\/|>|\{|&|=|!/;function D(e){this.string=e,this.tail=e,this.pos=0}function M(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function N(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}D.prototype.eos=function(){return""===this.tail},D.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var i=t[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},D.prototype.scanUntil=function(e){var t,i=this.tail.search(e);switch(i){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,i),this.tail=this.tail.substring(i)}return this.pos+=t.length,t},M.prototype.push=function(e){return new M(e,this)},M.prototype.lookup=function(e){var t,i,s,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var r,o,a,l=this,c=!1;l;){if(e.indexOf(".")>0)for(r=l.view,o=e.split("."),a=0;null!=r&&a<o.length;)a===o.length-1&&(c=S(r,o[a])||(i=r,s=o[a],null!=i&&"object"!=typeof i&&i.hasOwnProperty&&i.hasOwnProperty(s))),r=r[o[a++]];else r=l.view[e],c=S(l.view,e);if(c){t=r;break}l=l.parent}n[e]=t}return E(t)&&(t=t.call(this.view)),t},N.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},N.prototype.parse=function(e,t){var i=this.templateCache,s=e+":"+(t||O.tags).join(":"),n=void 0!==i,r=n?i.get(s):void 0;return null==r&&(r=function(e,t){if(!e)return[];var i,s,n,r=!1,o=[],a=[],l=[],c=!1,u=!1,d="",h=0;function g(){if(c&&!u)for(;l.length;)delete a[l.pop()];else l=[];c=!1,u=!1}function p(e){if("string"==typeof e&&(e=e.split(A,2)),!_(e)||2!==e.length)throw new Error("Invalid tags: "+e);i=new RegExp(y(e[0])+"\\s*"),s=new RegExp("\\s*"+y(e[1])),n=new RegExp("\\s*"+y("}"+e[1]))}p(t||O.tags);for(var m,v,b,f,E,S,w=new D(e);!w.eos();){if(m=w.pos,b=w.scanUntil(i))for(var I=0,T=b.length;I<T;++I)C(f=b.charAt(I))?(l.push(a.length),d+=f):(u=!0,r=!0,d+=" "),a.push(["text",f,m,m+1]),m+=1,"\n"===f&&(g(),d="",h=0,r=!1);if(!w.scan(i))break;if(c=!0,v=w.scan(P)||"name",w.scan(x),"="===v?(b=w.scanUntil(F),w.scan(F),w.scanUntil(s)):"{"===v?(b=w.scanUntil(n),w.scan(k),w.scanUntil(s),v="&"):b=w.scanUntil(s),!w.scan(s))throw new Error("Unclosed tag at "+w.pos);if(E=">"==v?[v,b,m,w.pos,d,h,r]:[v,b,m,w.pos],h++,a.push(E),"#"===v||"^"===v)o.push(E);else if("/"===v){if(!(S=o.pop()))throw new Error('Unopened section "'+b+'" at '+m);if(S[1]!==b)throw new Error('Unclosed section "'+S[1]+'" at '+m)}else"name"===v||"{"===v||"&"===v?u=!0:"="===v&&p(b)}if(g(),S=o.pop())throw new Error('Unclosed section "'+S[1]+'" at '+w.pos);return function(e){for(var t,i=[],s=i,n=[],r=0,o=e.length;r<o;++r)switch((t=e[r])[0]){case"#":case"^":s.push(t),n.push(t),s=t[4]=[];break;case"/":n.pop()[5]=t[2],s=n.length>0?n[n.length-1][4]:i;break;default:s.push(t)}return i}(function(e){for(var t,i,s=[],n=0,r=e.length;n<r;++n)(t=e[n])&&("text"===t[0]&&i&&"text"===i[0]?(i[1]+=t[1],i[3]=t[3]):(s.push(t),i=t));return s}(a))}(e,t),n&&i.set(s,r)),r},N.prototype.render=function(e,t,i,s){var n=this.getConfigTags(s),r=this.parse(e,n),o=t instanceof M?t:new M(t,void 0);return this.renderTokens(r,o,i,e,s)},N.prototype.renderTokens=function(e,t,i,s,n){for(var r,o,a,l="",c=0,u=e.length;c<u;++c)a=void 0,"#"===(o=(r=e[c])[0])?a=this.renderSection(r,t,i,s,n):"^"===o?a=this.renderInverted(r,t,i,s,n):">"===o?a=this.renderPartial(r,t,i,n):"&"===o?a=this.unescapedValue(r,t):"name"===o?a=this.escapedValue(r,t,n):"text"===o&&(a=this.rawValue(r)),void 0!==a&&(l+=a);return l},N.prototype.renderSection=function(e,t,i,s,n){var r=this,o="",a=t.lookup(e[1]);if(a){if(_(a))for(var l=0,c=a.length;l<c;++l)o+=this.renderTokens(e[4],t.push(a[l]),i,s,n);else if("object"==typeof a||"string"==typeof a||"number"==typeof a)o+=this.renderTokens(e[4],t.push(a),i,s,n);else if(E(a)){if("string"!=typeof s)throw new Error("Cannot use higher-order sections without the original template");null!=(a=a.call(t.view,s.slice(e[3],e[5]),(function(e){return r.render(e,t,i,n)})))&&(o+=a)}else o+=this.renderTokens(e[4],t,i,s,n);return o}},N.prototype.renderInverted=function(e,t,i,s,n){var r=t.lookup(e[1]);if(!r||_(r)&&0===r.length)return this.renderTokens(e[4],t,i,s,n)},N.prototype.indentPartial=function(e,t,i){for(var s=t.replace(/[^ \t]/g,""),n=e.split("\n"),r=0;r<n.length;r++)n[r].length&&(r>0||!i)&&(n[r]=s+n[r]);return n.join("\n")},N.prototype.renderPartial=function(e,t,i,s){if(i){var n=this.getConfigTags(s),r=E(i)?i(e[1]):i[e[1]];if(null!=r){var o=e[6],a=e[5],l=e[4],c=r;0==a&&l&&(c=this.indentPartial(r,l,o));var u=this.parse(c,n);return this.renderTokens(u,t,i,c,s)}}},N.prototype.unescapedValue=function(e,t){var i=t.lookup(e[1]);if(null!=i)return i},N.prototype.escapedValue=function(e,t,i){var s=this.getConfigEscape(i)||O.escape,n=t.lookup(e[1]);if(null!=n)return"number"==typeof n&&s===O.escape?String(n):s(n)},N.prototype.rawValue=function(e){return e[1]},N.prototype.getConfigTags=function(e){return _(e)?e:e&&"object"==typeof e?e.tags:void 0},N.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!_(e)?e.escape:void 0};var O={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){R.templateCache=e},get templateCache(){return R.templateCache}},R=new N;O.clearCache=function(){return R.clearCache()},O.parse=function(e,t){return R.parse(e,t)},O.render=function(e,t,i,s){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(_(n=e)?"array":typeof n)+'" was given as the first argument for mustache#render(template, view, partials)');var n;return R.render(e,t,i,s)},O.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return T[e]}))},O.Scanner=D,O.Context=M,O.Writer=N;const L="standard",$="custom",V="url_param",U="marketo",W="salesforce",z="firmographic",j="6sense",G="googleAds",B="demandbase",H=[L,$,V,U,W,z,j,G,B];function Q(e){return"object"==typeof e&&e instanceof Error?e:new Error(e)}function q(){return function(e){let t=Date.now();return e.replace(/[xy]/g,(e=>{const i=Math.trunc((t+16*Math.random())%16);return t=Math.floor(t/16),("x"===e?i:3&i|8).toString(16)}))}("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}class K{constructor(e,t){o(this,"storage"),o(this,"namespace"),this.storage=e,this.namespace=t}static get delimiter(){return"."}write(e,t){this.storage.write(this.getFullKey(e),t)}read(e){return this.storage.read(this.getFullKey(e))}delete(e){this.storage.delete(this.getFullKey(e))}getFullKey(e){return`${this.namespace}${K.delimiter}${e}`}}class Y{constructor(e,t){o(this,"logger"),o(this,"namespace"),this.logger=e,this.namespace=t}getLevel(){return this.logger.getLevel()}error(e,t,i){this.logger.error(this.getFullMessage(e),t,i)}warn(e,t,i){this.logger.warn(this.getFullMessage(e),t,i)}info(e,t,i){this.logger.info(this.getFullMessage(e),t,i)}debug(e,t,i){this.logger.debug(this.getFullMessage(e),t,i)}group(e){this.logger.group(this.getFullMessage(e))}groupEnd(){this.logger.groupEnd()}time(e){this.logger.time(this.getFullMessage(e))}timeEnd(e){this.logger.timeEnd(this.getFullMessage(e))}getFullMessage(e){return`[${this.namespace}]: ${e}`}}e.ATTRIBUTE_NAMESPACES=H,e.ATTRIBUTE_NAMESPACE_CUSTOM=$,e.ATTRIBUTE_NAMESPACE_DEMANDBASE=B,e.ATTRIBUTE_NAMESPACE_FIRMOGRAPHIC=z,e.ATTRIBUTE_NAMESPACE_GOOGLE_ADS=G,e.ATTRIBUTE_NAMESPACE_MARKETO=U,e.ATTRIBUTE_NAMESPACE_SALESFORCE=W,e.ATTRIBUTE_NAMESPACE_SIXSENSE=j,e.ATTRIBUTE_NAMESPACE_STANDARD=L,e.ATTRIBUTE_NAMESPACE_URL_PARAM=V,e.Extension=class{constructor(e){o(this,"config"),this.config=e}getName(){return this.config.name}getDescription(){return this.config.description}getLabel(){return this.config.label}getIconImgSrc(){return g.ofNullable(this.config.iconImageSrc)}getCss(){return g.ofNullable(this.config.css)}getDom(){return void 0===this.config.dom?g.empty():g.of({html:this.config.dom.html,targetPosition:g.ofNullable(this.config.dom.targetPosition)})}getFields(){return this.config.fields}getViewData(e,t){var i,s;return null==(s=(i=this.config).viewDataFn)?void 0:s.call(i,e,t)}getRunFn(){var e;return g.ofNullable(null==(e=this.config.code)?void 0:e.run)}getResetFn(){var e;return g.ofNullable(null==(e=this.config.code)?void 0:e.reset)}},e.ExtensionExecutor=class{constructor(e,t,i,s=q()){let n;o(this,"extension"),o(this,"runtime"),o(this,"extensionStorage"),o(this,"extensionLogger"),o(this,"config"),o(this,"styleElementId"),o(this,"instanceId"),o(this,"targetPositionTuple"),o(this,"viewData"),e.getDom().ifPresent((e=>{!function(e,t){if(l(e),!e)throw new c(t)}(e.targetPosition.isPresent()||void 0!==i.targetPosition,"ExtensionExecutor expects a TargetPosition for extensions that use HTML"),void 0===i.targetPosition?(t.logger.debug("Using TargetPosition from Extension config"),n=[e.html,e.targetPosition.get()]):(t.logger.debug("Using TargetPosition from Executor config"),n=[e.html,i.targetPosition])})),this.targetPositionTuple=n,this.extension=e,this.runtime=t,this.extensionStorage=new K(t.storage,e.getName()),this.extensionLogger=new Y(t.logger,`Extension: ${e.getName()}`),this.config=i,this.instanceId=s,this.styleElementId=`extension-${e.getName()}`,this.viewData=this.extension.getViewData(this.fieldData,this.runtime)}get fieldData(){const e=((e,t)=>{for(var o in t||(t={}))s.call(t,o)&&r(e,o,t[o]);if(i)for(var o of i(t))n.call(t,o)&&r(e,o,t[o]);return e})({},this.config.fieldData);return this.extension.getFields().forEach((t=>{"defaultValue"in t&&void 0===e[t.name]&&(e[t.name]=t.defaultValue)})),e}run(e){this.runtime.logger.debug(`ExtensionExecutor(${this.extension.getName()}): Calling run()`),this.injectCss(),this.insertElement((()=>{this.runCode(),void 0!==e&&e()}))}reset(){this.runtime.logger.debug(`ExtensionExecutor(${this.extension.getName()}): Calling reset()`),this.resetCode(),this.removeElement(),this.removeCss()}getTargetPosition(){return this.getTargetPositionTuple().isPresent()?g.of(this.getTargetPositionTuple().get()[1]):g.empty()}getTargetElement(){if(this.getTargetPosition().isPresent()){const{selector:e}=this.getTargetPosition().get(),t=this.runtime.localWindow.document.querySelectorAll(e);return t.length>1&&this.runtime.logger.error(`Expected exactly one target element; found ${t.length} elements matching selector "${e}"`,7e3),g.ofNullable(t[0])}return g.empty()}injectCss(){this.extension.getCss().ifPresent((e=>{this.runtime.logger.debug(`ExtensionExecutor(${this.extension.getName()}): Injecting CSS`),this.runtime.injectCss(e,this.styleElementId)}))}insertElement(e){this.getTargetPositionTuple().ifPresent((t=>{const[,{selector:i}]=t;this.getTargetElement().ifPresent((s=>{this.runtime.logger.debug(`ExtensionExecutor(${this.extension.getName()}): Inserting Extension HTML at "${i}" ${JSON.stringify(this.fieldData,void 0,2)}`);try{this.insertElementAtTarget(t,s)}catch(n){const e=Q(n);this.runtime.logger.error(e,7001)}e()})).ifAbsent((()=>{this.runtime.logger.error(`ExtensionExecutor(${this.extension.getName()}): Could not find a TargetElement for selector ${i}`,7002),e()}))})).ifAbsent((()=>{e()}))}insertElementAtTarget(e,t){const[i,{insertPosition:s}]=e,n=O.render(i,{extension:{fieldData:this.fieldData,viewData:this.viewData}}),r=this.createElement(n);t.insertAdjacentElement(s,r)}runCode(){this.extension.getRunFn().ifPresent((e=>{e(this.getContext())}))}resetCode(){this.extension.getResetFn().ifPresent((e=>{e(this.getContext())}))}removeElement(){this.getTargetPositionTuple().isPresent()&&Array.prototype.forEach.call(this.getElements(),(e=>{e.remove()}))}removeCss(){this.extension.getCss().isPresent()&&this.runtime.removeCss(this.styleElementId)}getTargetPositionTuple(){return g.ofNullable(this.targetPositionTuple)}getElements(){return this.getTargetPositionTuple().isPresent()?[...this.runtime.localWindow.document.querySelectorAll(`[data-${b}="${this.instanceId}"]`)]:[]}getContext(){return{fieldData:this.fieldData,localWindow:this.runtime.localWindow,logger:this.extensionLogger,storage:this.extensionStorage}}createElement(e){const t=function(e,t){const i=t.createElement("template");return i.innerHTML=e.trim(),[...i.content.childNodes]}(e,this.runtime.localWindow.document);if(1!==t.length)throw new Error(`Unable to create a single DOM Node from the extension HTML for "${this.extension.getName()}"`);const[i]=t;if(!(i instanceof HTMLElement))throw new TypeError(`The root Node of the tree constructed from the extension HTML for "${this.extension.getName()}" is not an instance of an Element`);return i.setAttribute(`data-${b}`,this.instanceId),i}},e.exceptionToError=Q}($n);class Vn extends _n{constructor(e,t,i,s,n,r,o){super(t,i,s,n),__publicField(this,"insertExtensionChange"),__publicField(this,"extensionManager"),__publicField(this,"runtime"),__publicField(this,"_executor"),this.insertExtensionChange=e,this.extensionManager=o;const a=n.getWindow();this.runtime={localWindow:a,logger:Io,storage:r,injectCss(e,t){wt.injectCss(e,t,a.document)},removeCss(e){wt.removeCss(e,a.document)}}}isReadyToApply(){return!this.getExecutor().getTargetPosition().isPresent()||this.getExecutor().getTargetElement().isPresent()}apply(e,t){Io.group("EnhancedExtensionChange.apply()"),Io.debug(`Applying change: ${Te(this.insertExtensionChange)}`),this.getExecutor().getTargetPosition().ifPresent((({selector:i})=>{t.registerSelectorAndExecute(i,(()=>{this.getExecutor().run(e)}),{shouldReapply:this.shouldReapply.bind(this)},this.getEntityIds())})),Io.groupEnd()}undo(){Io.group("EnhancedExtensionChange.undo()"),Io.debug(`Undoing change: ${Te(this.insertExtensionChange)}`),this.getExecutor().reset(),Io.groupEnd()}getSelector(){return j.empty()}shouldReapply(){return!this.getExecutor().getTargetPosition().isPresent()||!this.getExecutor().getTargetElement().isPresent()}getExecutor(){if(void 0===this._executor){const e=this.extensionManager.getExtension(this.insertExtensionChange.getName());if(!e.isPresent())throw new Error(`Could not find extension: ${this.insertExtensionChange.getName()}`);this._executor=new $n.ExtensionExecutor(e.get(),this.runtime,this.insertExtensionChange.getExecutorJson(),this.insertExtensionChange.getId().map((e=>e)).orElse(void 0))}return this._executor}}class Un extends _n{constructor(e,t,i,s,n){super(t,i,s,n),__publicField(this,"insertElementChange"),this.insertElementChange=e}isReadyToApply(){return this.insertElementChange.isReadyToApply(this.localDocument)}apply(e,t){Io.group("EnhancedInsertElementChange.apply()"),Io.debug(`Applying change: ${Te(this.insertElementChange)}`);const i=this.createInsertionElement();t.registerSelectorAndExecute(this.insertElementChange.getTargetPosition().selector,(()=>{this.insertElement(i,e)}),{shouldReapply:this.shouldReapply.bind(this)},this.getEntityIds()),Io.groupEnd()}undo(){Io.group("EnhancedInsertElementChange.undo()"),Io.debug(`Undoing change: ${Te(this.insertElementChange)}`),this.insertElementChange.getId().ifPresent((e=>{const t=Tn(e);1===t.length?t[0].remove():Io.warn(`Unexpected error when undoing insertElementChange. Auto-generated attribute\n        selector expected 1 element match but found ${t.length}`,191,this.getEntityIds())})),Io.groupEnd()}getSelector(){return j.empty()}insertElement(e,t){this.removeExistingElements(),this.insertElementChange.getTargetElement(this.localDocument).ifPresent((i=>{i.insertAdjacentElement(this.insertElementChange.getTargetPosition().insertPosition,e),t()})).ifAbsent((()=>{throw new Error("Unexpected error: targetElement not found")})),this.insertElementChange.getId().ifPresent((t=>{yn(e,t,{value:this.insertElementChange.getElementType(),type:st.INSERT_ELEMENT}),xn(e,t)}))}getInsertedElements(){return document.querySelectorAll(`#${this.insertElementChange.getIdAttribute()}`)}removeExistingElements(){const e=this.getInsertedElements();Array.prototype.forEach.call(e,(e=>{e.remove()}))}createInsertionElement(){let e;if(this.insertElementChange instanceof Ri)e=`h${this.insertElementChange.getSize()}`;else switch(this.insertElementChange.getElementType()){case"image":e="img";break;case"video":e="video";break;default:e="div"}const t=document.createElement(e);return t.id=this.insertElementChange.getIdAttribute(),t}shouldReapply(){return 0===this.getInsertedElements().length}}const Wn=`data-${"imize-move-id"}`;class zn extends _n{constructor(e,t,i,s,n){super(t,i,s,n),__publicField(this,"moveElementChange"),__publicField(this,"hasLoggedMutationWarning",!1),this.moveElementChange=e}static createAndInsertPlaceholderElement(e){const t=document.createElement("imizeplaceholder");return t.style.display="none",t.hidden=!0,e.after(t),t}isReadyToApply(){return this.moveElementChange.isReadyToApply(this.localDocument)}apply(e,t){Io.group("EnhancedMoveElementChange.apply()"),Io.debug(`Applying change: ${Te(this.moveElementChange)}`),t.registerSelectorAndExecute(this.moveElementChange.getSelector(),(()=>{}),{shouldReapply:this.shouldReapply.bind(this)},this.getEntityIds()),this.moveElement(e),Io.groupEnd()}undo(){Io.group("EnhancedMoveElementChange.undo()"),Io.debug(`Undoing change: ${Te(this.moveElementChange)}`),this.moveElementChange.getId().ifPresent((e=>{const t=Tn(e);if(1===t.length){const i=t[0];Sn(i,e).ifPresent((({value:e})=>{null!==e.parentElement&&e.parentElement.replaceChild(i,e)})).ifAbsent((()=>{Io.warn(`Unexpected error when undoing moveElementChange. getChangeData(${e}): could not find data`,195,this.getEntityIds())})),An(i,e),wn(i,e),i.removeAttribute(Wn)}else Io.warn(`Unexpected error when undoing moveElementChange. Auto-generated attribute\n        selector expected 1 element match but found ${t.length}`,196,this.getEntityIds())})),Io.groupEnd()}getSelector(){return j.of(this.moveElementChange.getSelector())}getMovedElement(){const e=document.querySelectorAll(`[${Wn}="${this.moveElementChange.getMoveId()}"]`);return 1===e.length?j.ofNullable(e[0]):j.empty()}shouldReapply(){return this.hasLoggedMutationWarning||(this.getMovedElement().ifPresent((()=>{Io.warn("[EnhancedMoveElementChange]: A mutation was observed for a move element change, however the moved element appears to still exists on the page",225,this.getEntityIds())})).ifAbsent((()=>{Io.warn("[EnhancedMoveElementChange]: A mutation was observed for a move element change and the moved element could not be found on the page.",226,this.getEntityIds())})),this.hasLoggedMutationWarning=!0),!1}moveElement(e){try{this.moveElementChange.getSelectorElement(this.localDocument).ifPresent((e=>{this.moveElementChange.getTargetElement(this.localDocument).ifPresent((t=>{if(e.contains(t))throw new Error("The target element cannot be a child of the selector element");this.moveElementChange.getId().ifPresent((t=>{xn(e,t);const i=zn.createAndInsertPlaceholderElement(e);yn(e,t,{value:i,type:st.MOVE_ELEMENT})})),t.insertAdjacentElement(this.moveElementChange.getTargetPosition().insertPosition,e),e.setAttribute(Wn,this.moveElementChange.getMoveId())})).ifAbsent((()=>{throw new Error("Unexpected error: target element could not be found)")}))})).ifAbsent((()=>{throw new Error("Unexpected error: selector element could not be found)")}))}finally{e()}}}const jn=`${fe}hidden-variation`,Gn="data-intellimize-var-";class Bn extends _n{constructor(e,t,i,s,n){super(t,i,s,n),__publicField(this,"webflowChange"),__publicField(this,"experienceId"),__publicField(this,"variationId"),__publicField(this,"selector"),this.webflowChange=e;const r=t.getEntityIds();this.experienceId=N(r.experienceId,"experienceId must be defined"),this.variationId=N(r.variationId,"variationId must be defined"),R(this.getSelector().isPresent(),"getSelector should always return a selector"),this.selector=this.getSelector().get()}isReadyToApply(){return this.localDocument.querySelectorAll("body").length>0}apply(e,t){Io.group("EnhancedWebflowChange.apply()"),Io.debug(`Applying change: ${Te(this.webflowChange)} - ${this.selector}`),t.registerSelectorAndExecute("body",(()=>{this.localDocument.querySelectorAll(`[${this.getWebflowExperienceAttribute()}]`).forEach((e=>{e.setAttribute(jn,"")})),this.localDocument.querySelectorAll(`[${this.getWebflowVariationAttribute()}]`).forEach((e=>{e.removeAttribute(jn)})),this.environment.getWindow().document.body.setAttribute(this.getIntellimizeVisibleVariationAttribute(),""),e()}),{shouldReapply:()=>this.shouldReapply()},this.getEntityIds()),Io.groupEnd()}undo(){}getSelector(){return j.of(`[${_e}${this.experienceId}]`)}getWebflowExperienceAttribute(){return`${_e}${this.experienceId}`}getWebflowVariationAttribute(){return`${Ee}${this.variationId}`}getIntellimizeVisibleVariationAttribute(){return`${Gn}${this.variationId}`}shouldReapply(){const{body:e}=this.environment.getWindow().document;for(const t of this.localDocument.querySelectorAll(`[${this.getWebflowExperienceAttribute()}]`)){const i=t.hasAttribute(this.getWebflowVariationAttribute());if(Io.debug(`CHECKING SHOULDREAPPLY: ${i}, ${t.hasAttribute(jn)}, ${e.hasAttribute(this.getIntellimizeVisibleVariationAttribute())}, ${t.outerHTML}`),!i&&!t.hasAttribute(jn))return Io.debug(`shouldReapply(): YES (The [${jn}] attribute is missing from a non-selected variation)`),!0;if(i&&t.hasAttribute(jn))return Io.debug(`shouldReapply(): YES (The [${jn}] attribute is present on the selected variation)`),!0}return e.hasAttribute(this.getIntellimizeVisibleVariationAttribute())?(Io.debug("shouldReapply(): NO (All data attributes are as expected)"),!1):(Io.debug(`shouldReapply(): YES (The [${Gn}${this.variationId}] attribute is missing from the body)`),!0)}}function Hn(e,t,i,s,n,r,o){switch(e.getType()){case st.ATTRIBUTE:case st.EXTENSION_ATTRIBUTE:return new Rn(e,t,i,s,n);case st.CUSTOM_CODE:return new Ln(e,t,i,s,n);case st.INSERT_ELEMENT:return new Un(e,t,i,s,n);case st.EXTENSION:return new Vn(e,t,i,s,n,r,o);case st.MOVE_ELEMENT:return new zn(e,t,i,s,n);case st.WEBFLOW:return new Bn(e,t,i,s,n);default:throw new Error(`Unknown DomChangeType: ${e.getType()}`)}}class Qn extends xt{constructor(e,t,i,s){super(),__publicField(this,"elementObserver"),__publicField(this,"entityIds"),__publicField(this,"workQueue",[]),__publicField(this,"readyToRender"),__publicField(this,"isTaskDone",!1),this.elementObserver=s,this.readyToRender=t,this.entityIds=i,this.workQueue=e.map((e=>({enhancedChange:e,applied:!1,rendered:!1})))}toString(){return`ChangelistTask(count:${this.workQueue.length}, ${Te(this.entityIds)})`}cleanup(){this.isTaskDone=!0,this.readyToRenderCallbackIfDone()}inTransaction(){return!0}isUnloading(){return!1}getEntityIds(){return this.entityIds}run(){for(const t of this.workQueue)if(!t.applied)try{if(!t.enhancedChange.isReadyToApply())return It.TRY_LATER;t.enhancedChange.apply((()=>{t.rendered=!0,this.readyToRenderCallbackIfDone()}),this.elementObserver),t.applied=!0}catch(e){const i=new gi(`Failed to apply change: ${Te(t.enhancedChange.getEntityIds())}`,e);return Io.error(i,125,t.enhancedChange.getEntityIds()),this.isTaskDone=!0,this.readyToRenderCallbackIfDone(),It.FAILED}return this.isTaskDone=!0,this.readyToRenderCallbackIfDone(),It.SUCCEEDED}readyToRenderCallbackIfDone(){if(!this.isTaskDone)return;this.workQueue.filter((e=>e.applied)).every((e=>__async(this,null,(function*(){return e.rendered}))))&&this.readyToRender()}}class qn extends xt{constructor(e,t){super(),__publicField(this,"variation"),__publicField(this,"environment"),__publicField(this,"browserStorage"),__publicField(this,"extensionManager"),__publicField(this,"browserEventLogger"),__publicField(this,"customerStorage"),__publicField(this,"attributeStorage"),__publicField(this,"activityStorage"),__publicField(this,"pageContext"),__publicField(this,"attributeData"),__publicField(this,"user"),__publicField(this,"decisionContext"),__publicField(this,"startPageviewId"),__publicField(this,"override"),__publicField(this,"statusModel"),__publicField(this,"getVariationRecordedCallbackTuples"),__publicField(this,"elementObserver"),__publicField(this,"hider"),this.variation=N(e),this.environment=N(t.environment),this.browserStorage=N(t.browserStorage),this.extensionManager=N(t.extensionManager),this.browserEventLogger=N(t.browserEventLogger),this.customerStorage=N(t.customerStorage),this.attributeStorage=N(t.attributeStorage),this.activityStorage=N(t.activityStorage),this.pageContext=N(t.pageContext),this.attributeData=N(t.attributeData),this.decisionContext=N(t.decisionContext),this.user=N(t.user),this.override=N(t.override),this.statusModel=N(t.statusModel),this.startPageviewId=N(t.startPageviewId),this.hider=N(t.hider),this.getVariationRecordedCallbackTuples=N(t.getVariationRecordedCallbackTuples),this.elementObserver=N(t.elementObserver)}toString(){return`ExecuteVariationTask(${this.variation.getId()})`}getEntityIds(){return{variationId:this.variation.getId(),experienceId:this.variation.getExperience().getId()}}inTransaction(){return this.isReadyToExecute()}isUnloading(){return!1}getNotDoneDependencies(){return this.findDependentPageChangelistTasks().filter((e=>!e.isDone()))}run(){let e=It.TRY_LATER;return this.isReadyToExecute()&&(e=this.executeVariation()),e}onReadyToRender(){this.hider.revealExperience(this.variation.getExperience(),this.browserStorage,this.attributeData)}isReadyToExecute(){const e=this.passDependencies(),t=this.passExperiencePreconditions(),i=this.passVariationPreconditions(),s=this.hasAppliedPageChanges();return e&&t&&i&&s}passDependencies(){const e=this.variation.getExperience();Io.group("check experience dependsOnExperiences "+e.getId());const t=e.getDependsOnExperiences().every((e=>!this.decisionContext.isDecidingExperience(e)));return Io.debug(t.toString()),Io.groupEnd(),this.statusModel.setExperience(e,"dependsOnExperiences",t),t}passExperiencePreconditions(){const e=this.variation.getExperience();Io.group("check experience preconditions "+e.getId());const t=e.getPreconditions().every((t=>{let i=!1;try{i=wt.evalBoolean(t),Io.info(`Experience ${e.getId()} precondition => ${i}`)}catch(s){const t=new gi(`Experience (${e.getId()}) precondition code execution failed`,s);i=!1,Io.error(t,15,{experienceId:e.getId()})}return i}));return Io.debug(t.toString()),Io.groupEnd(),this.statusModel.setExperience(e,"preconditions",t),t}passVariationPreconditions(){const e=this.variation.getExperience();Io.group("check variations preconditions "+this.variation.getId());const t=this.variation.getPreconditions().every((t=>{let i=!1;try{i=wt.evalBoolean(t),Io.info(`Variation ${e.getId()}/${this.variation.getId()} precondition => ${i}`)}catch(s){const t=new gi(`Variation (${this.variation.getId()}) precondition code execution failed`,s);i=!1,Io.error(t,16,{experienceId:e.getId(),variationId:this.variation.getId()})}return i}));return Io.debug(t.toString()),Io.groupEnd(),this.statusModel.setVariation(this.variation,"preconditions",t),t}hasAppliedPageChanges(){return this.findDependentPageChangelistTasks().every((e=>e.isDone()))}findDependentPageChangelistTasks(){return this.variation.getExperience().getPages().map((e=>this.pageContext.getPageChangelistTask(e))).filter((e=>e.isPresent())).map((e=>e.get()))}}class Kn{constructor(e,t,i,s){__publicField(this,"iEvent"),__publicField(this,"actionId"),__publicField(this,"eventInstanceId"),__publicField(this,"eventValue"),__publicField(this,"nativeClickEvent"),this.iEvent=e,this.actionId=t,this.eventInstanceId=`${e.getId()}:${t}`,this.eventValue=i,this.nativeClickEvent=s}getEvent(){return this.iEvent}getEventId(){return this.iEvent.getId()}getActionId(){return this.actionId}getEventInstanceId(){return this.eventInstanceId}getEventValue(){return j.ofNullable(this.eventValue)}getNativeMouseEvent(){return j.ofNullable(this.nativeClickEvent)}toString(){return`ConversionEventContext(${this.getEventId()}, ${this.getEventInstanceId()})`}}function Yn(e){return e.getIntegrationDemandbase().map((e=>e.isEnabled())).orElse(!1)}function Jn(e){return e.getIntegrationFirmographic().map((e=>e.isEnabled())).orElse(!1)}const Xn=["marketo","salesforce","firmographic","6sense","googleAds","demandbase","hubspot"],Zn=(e,t)=>`i${e}${t}`,er={adGroup:Zn("ga","ag"),campaign:Zn("ga","cm"),network:Zn("ga","nt"),adType:Zn("ga","at"),keyword:Zn("ga","kw"),creative:Zn("ga","cr"),matchType:Zn("ga","mt")};function tr(e){return e.getIntegrationGoogleAds().map((e=>e.isEnabled())).orElse(!1)}function ir(e,t,i){if(!ct(e,i).orElse(!1)){const i=sr(e);t.setDataAndMetadata("googleAds",i,void 0)}}function sr(e){const t={};return Object.entries(er).forEach((([i,s])=>{e.getHostingPageUrl().getQueryParam(s,b).ifPresent((e=>{t[i]=e}))})),t}function nr(e){return e.getIntegrationHubspot().map((e=>e.isEnabled())).orElse(!1)}function rr(e){return e.readCookie(ve)}function or(e){return"hsFormCallback"===e.data.type&&"onFormSubmitted"===e.data.eventName}function ar(e){return e.getIntegrationMarketo().map((e=>e.isEnabled())).orElse(!1)}function lr(e){return e.readCookie(me)}function cr(e){var t,i;return void 0!==(null==(t=null==e?void 0:e.lead)?void 0:t.fields)||void 0!==(null==(i=null==e?void 0:e.lead)?void 0:i.lists)}function ur(e){var t,i;return void 0===(null==(t=null==e?void 0:e.lead)?void 0:t.fields)&&void 0===(null==(i=null==e?void 0:e.lead)?void 0:i.lists)}function dr(e){if(void 0===e)return j.empty();if(cr(e))return j.of(e);if(ur(e)){const t=e,{smartLists:i,staticLists:s}=t,n=__objRest(t,["smartLists","staticLists"]),r=(null!=i?i:[]).map((e=>({type:"smart",id:Number(e)}))),o=(null!=s?s:[]).map((e=>({type:"static",id:Number(e)})));return j.of({lead:{fields:n,lists:[...r,...o]}})}return j.empty()}const hr=Zn("sf","lh"),gr=Zn("sf","ch");function pr(e){return e.getIntegrationSalesforce().map((e=>e.isEnabled())).orElse(!1)}function mr(e){const t=e.getHostingPageUrl().getQueryParam(hr,b),i=e.getHostingPageUrl().getQueryParam(gr,b);if(t.isPresent()||i.isPresent()){const e={};return t.ifPresent((t=>{e.leadIdHash=t})),i.ifPresent((t=>{e.contactIdHash=t})),j.of(e)}return j.empty()}function vr(e){return e.getIntegrationSixsense().map((e=>e.isEnabled())).orElse(!1)}const br={"6sense":e=>vr(e),demandbase:e=>Yn(e),firmographic:e=>Jn(e),googleAds:e=>tr(e),marketo:e=>ar(e),salesforce:e=>pr(e),hubspot:e=>nr(e)};class fr extends xt{constructor(e,t,i){super(),__publicField(this,"conversionEventContext"),__publicField(this,"browserEventLogger"),__publicField(this,"customerStorage"),__publicField(this,"trackBrowserEvents",{}),__publicField(this,"hasSentGoals",!1),this.conversionEventContext=N(e),this.browserEventLogger=N(t),this.customerStorage=N(i)}toString(){return"GoalTask("+this.conversionEventContext.toString()+")"}getEntityIds(){return{eventId:this.conversionEventContext.getEventId()}}inTransaction(){return!0}isUnloading(){return!1}run(){this.hasSentGoals||this.sendGoalsOnce();if(Object.keys(this.trackBrowserEvents).map((e=>this.trackBrowserEvents[e])).some((e=>void 0===e||!xt.isDone(e))))return Io.debug("Waiting for goal event delivery confirmation"),It.TRY_LATER;return Object.keys(this.trackBrowserEvents).map((e=>this.trackBrowserEvents[e])).every((e=>void 0!==e&&e===It.SUCCEEDED))?It.SUCCEEDED:It.FAILED}sendGoalsOnce(){Io.debug("sendGoalsOnce()"),this.hasSentGoals=!0;const e="click"!==this.conversionEventContext.getEvent().getType();let t=0;this.conversionEventContext.getEvent().getMetrics().forEach((i=>{i.getCampaign().ifPresent((s=>{s.getExperiences().forEach((s=>{this.customerStorage.getVariation(s).ifPresent((n=>{const r=i.getId()+":"+n.getId();this.trackBrowserEvents[r]=It.TRY_LATER,Io.info(`Sending goal ${i.getId()} event`),t++,this.browserEventLogger.sendGoal(n,i,this.conversionEventContext,e).then((()=>{Io.info(`Goal ${i.getId()} event delivery success`),this.trackBrowserEvents[r]=It.SUCCEEDED})).catch((e=>{const t=new gi(`Goal ${i.getId()} event delivery failed`,e);Io.error(t,78,{eventId:this.conversionEventContext.getEventId(),experienceId:s.getId(),variationId:n.getId()}),this.trackBrowserEvents[r]=It.FAILED}))}))}))}))})),Io.debug(`Sent ${t} goal events`)}}class _r extends xt{constructor(e,t,i,s,n){super(),__publicField(this,"conversionEventContext"),__publicField(this,"browserEventLogger"),__publicField(this,"customer"),__publicField(this,"customerStorage"),__publicField(this,"statusModel"),__publicField(this,"conversionSent",!1),__publicField(this,"conversionStatus",It.NOT_STARTED),__publicField(this,"goalTask"),this.conversionEventContext=N(e),this.browserEventLogger=N(t),this.customer=N(i),this.customerStorage=N(s),this.statusModel=N(n)}toString(){return`ConversionEventTask(${this.conversionEventContext.toString()})`}getEntityIds(){return{eventId:this.conversionEventContext.getEventId()}}inTransaction(){return!this.conversionSent}isUnloading(){return!1}run(){return this.sendOnce(),this.scheduleGoalTaskOnce(),xt.isDone(this.conversionStatus)?!this.customer.hasClassicAccess()||void 0!==this.goalTask&&xt.isDone(this.goalTask.getStatus())?this.conversionStatus===It.SUCCEEDED?It.SUCCEEDED:It.FAILED:(Io.debug("Waiting for goal task event confirmation"),It.TRY_LATER):(Io.debug("Waiting for conversion event delivery confirmation"),It.TRY_LATER)}sendOnce(){if(!this.conversionSent){Io.info(`Sending conversion event ${this.conversionEventContext.toString()}`);const e=this.conversionEventContext.getEvent(),t=[],i=e.getMetrics().map((i=>{const s=Nt();return t.push({metric:i,modelEventId:s}),{metric:i,event:e,status:It.WAITING,id:s}}));this.statusModel.setMetricEventData(i),this.browserEventLogger.sendConversion(this.conversionEventContext).then((()=>{Io.info(`Conversion event ${this.conversionEventContext.toString()} delivery success`),this.conversionStatus=It.SUCCEEDED,this.statusModel.setMetricEventData(t.map((({modelEventId:t,metric:i})=>({metric:i,event:e,status:It.SUCCEEDED,id:t}))))})).catch((i=>{const s=new gi(`Conversion event ${this.conversionEventContext.toString()} delivery failed`,i);Io.warn(s,76,{eventId:this.conversionEventContext.getEventId()}),this.conversionStatus=It.FAILED,this.statusModel.setMetricEventData(t.map((({modelEventId:t,metric:i})=>({metric:i,event:e,status:It.FAILED,id:t}))))})),this.conversionSent=!0}}scheduleGoalTaskOnce(){this.customer.hasClassicAccess()&&void 0===this.goalTask&&(this.goalTask=new fr(this.conversionEventContext,this.browserEventLogger,this.customerStorage),this.manager.addTask(this.goalTask))}}class Er extends xt{constructor(e,t,i,s,n,r){super(),__publicField(this,"sent",!1),__publicField(this,"deliveryStatus",It.NOT_STARTED),__publicField(this,"environment"),__publicField(this,"customer"),__publicField(this,"userDomain1"),__publicField(this,"userId1"),__publicField(this,"userDomain2"),__publicField(this,"userId2"),this.environment=e,this.customer=t,this.userDomain1=i,this.userId1=s,this.userDomain2=n,this.userId2=r}static get ENDPOINT(){return"/user-alias"}toString(){return`UserAliasTask(userDomain1: ${this.userDomain1}, userId1: ${this.userId1}, userDomain2: ${this.userDomain2}, userId2: ${this.userId2})`}inTransaction(){return!0}isUnloading(){return!1}run(){return this.sendOnce(),this.deliveryStatus===It.SUCCEEDED?It.SUCCEEDED:this.deliveryStatus===It.FAILED?It.FAILED:(Io.debug("Waiting for user alias delivery confirmation"),It.TRY_LATER)}sendOnce(){this.sent||(Io.info(`Sending request to set up user alias for userDomain1: ${this.userDomain1}, userId1: ${this.userId1}, userDomain2: ${this.userDomain2}, userId2: ${this.userId2}`),this.environment.fetch(se,Er.ENDPOINT,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:xe({customerId:this.customer.getId(),userDomain1:this.userDomain1,userId1:this.userId1,userDomain2:this.userDomain2,userId2:this.userId2})}).then((()=>{this.deliveryStatus=It.SUCCEEDED,Io.info(`Successfully set up user alias for userDomain1: ${this.userDomain1}, userId1: ${this.userId1}, userDomain2: ${this.userDomain2}, userId2: ${this.userId2}`)})).catch((e=>{const t=hi(e);Io.error(t,92),this.deliveryStatus=It.FAILED})),this.sent=!0)}}function yr(e){if("string"==typeof e){const t=e.search(/[.\-\d]/g);if(-1===t)return!1;const i=e.slice(Math.max(0,t));if(!/^-?\d*\.?\d{0,2}$/.test(i))return!1}else{if("number"!=typeof e)return!1;{const t=String(e);if(!/^-?\d*\.?\d{0,2}$/.test(t))return!1}}return!0}function Sr(e){return"string"==typeof e&&/^[\u0021-\u007E]{1,300}$/.test(e)}function wr(e){return on(e)&&("number"==typeof e.amount||"string"==typeof e.amount)&&"string"==typeof e.currencyCode}function Ir(e,t,i,s,n,r,o,a,l,c,u){Tr(e,t).ifPresent((({eventName:d,eventActionId:h,eventValue:g})=>{var p;if(i.getShopifyEvent(d).ifPresent((d=>{const p=new Kn(d,h,g,void 0);try{o.add(Vr.buildShopifyActivity(e,t,p,i,s,a,r,n))}catch(v){const e=new gi("Failed to build Shopify Activity",v);Io.error(e,234)}const m=new _r(p,u,i,n,l);c.addTask(m)})).ifAbsent((()=>{Io.error(`Shopify pixel event not configured for customer: "${e.name}"`,252)})),"checkout_completed"===d){const t=null==(p=e.data.checkout.order)?void 0:p.id;void 0===t?Io.error("Received a checkout_completed event without an order id",250):i.getShopifyServerSideEvent().ifPresent((()=>{const e=new Er(s,i,"__shopifyOrder",t,"intellimize",a.getId());c.addTask(e)})).ifAbsent((()=>{Io.error("Shopify server-side event not configured for customer",253)}))}}))}function Cr(e,t,i){let s;switch(e.name){case"collection_viewed":{const t=e;s=__spreadProps(__spreadValues({},i),{eventType:"s",customerEventName:"collection_viewed",data:Mr(t.data.collection)});break}case"product_viewed":{const n=e;s=__spreadProps(__spreadValues({},i),{eventType:"s",customerEventName:"product_viewed",data:Dr(n.data.productVariant,Ar("product_viewed"),t)});break}case"checkout_started":{const n=e;s=__spreadProps(__spreadValues({},i),{eventType:"s",customerEventName:"checkout_started",data:Nr(n.data.checkout,Ar("checkout_started"),t)});break}case"checkout_completed":{const n=e;s=__spreadProps(__spreadValues({},i),{eventType:"s",customerEventName:"checkout_completed",data:Nr(n.data.checkout,Ar("checkout_completed"),t)});break}case"product_added_to_cart":{const n=e;s=__spreadProps(__spreadValues({},i),{eventType:"s",customerEventName:"product_added_to_cart",data:Or(n.data.cartLine,Ar("product_added_to_cart"),t)});break}case"search_submitted":{const t=e;s=__spreadProps(__spreadValues({},i),{eventType:"s",customerEventName:"search_submitted",data:Rr(t.data.searchResult)});break}default:throw new Error(`Unsupported customer event: ${e.name}`)}return Io.debug(`Shopify activity (${e.name}): ${Te(s.data)}`),s}function Tr(e,t){var i,s;let n;if(!on(e))return Pr("Not an object"),j.empty();if(!b(e.name))return Pr(`Event name is not a valid event name: "${e.name}"`),j.empty();if(!xr(e.name))return j.empty();if(!Sr(e.id))return Pr(`Event ID is not a valid action id: "${e.id}"`),j.empty();if(!f(e.data)){if(!on(e.data))return Pr(`Event data is defined, and is not an object: "${Te(e.data)}"`),j.empty();Fr(e.name,e.data,t).ifPresent((e=>{n=e}))}let r=e.id;if("checkout_completed"===e.name){const t=e;(null==(s=null==(i=t.data)?void 0:i.checkout)?void 0:s.order)?r=t.data.checkout.order.id:Io.error("Received a checkout_completed event without an order id",249)}return j.of({eventName:e.name,eventActionId:r,eventValue:n})}function xr(e){return nt.includes(e)}function Ar(e){switch(e){case"product_viewed":return"productVariant.price.amount";case"product_added_to_cart":return"cartLine.merchandise.price.amount";case"checkout_started":case"checkout_completed":return"checkout.subtotalPrice.amount";default:throw new Error(`Cannot get event value path for ${e}`)}}function Fr(e,t,i){let s,n;function r(e){return on(e)?!!wr(e.subtotalPrice)||(Pr(`Checkout data exists, but subtotal price is not valid: "${Te(e.subtotalPrice)}"`),!1):(Pr("Checkout data is not an object"),!1)}switch(e){case"checkout_started":if(!r(t.checkout))return j.empty();s=t.checkout.subtotalPrice.amount,n=Ar("checkout_started");break;case"checkout_completed":if(!r(t.checkout))return j.empty();s=t.checkout.subtotalPrice.amount,n=Ar("checkout_completed");break;case"product_added_to_cart":if(!on(t.cartLine))return Pr("CartLine data is not an object"),j.empty();if(!on(t.cartLine.merchandise))return Pr("CartLine data exists, but does not include a product variant"),j.empty();if(!wr(t.cartLine.merchandise.price))return Pr(`CartLine ProductVariant data exists, but price is not valid: "${Te(t.cartLine.merchandise.price)}"`),j.empty();s=t.cartLine.merchandise.price.amount,n=Ar("product_added_to_cart");break;case"product_viewed":if(!on(t.productVariant))return Pr("ProductVariant data is not an object"),j.empty();if(!wr(t.productVariant.price))return Pr(`ProductVariant data exists, but price is not valid: "${Te(t.productVariant.price)}"`),j.empty();s=t.productVariant.price.amount,n=Ar("product_viewed");break;default:return j.empty()}const o=kr(s,n,i);return yr(o)?j.of(o):(Pr(`Event value is not valid: "${s}"`),j.empty())}function kr(e,t,i){let s=Number(e)/i;return/^-?\d*\.\d{3,}$/.test(String(s))&&(Io.debug(`Found currency with > 2 decimal places: "${t}" = "${s}"`),s=Math.round(100*(Number(s)+Number.EPSILON))/100),s}function Pr(e){Io.error(`Invalid Shopify Pixel Event: ${e}`,233)}function Dr(e,t,i){var s,n;return{productVariantPriceAdjusted:kr(e.price.amount,t,i),productVariantPrice:e.price.amount,productVariantPriceCode:e.price.currencyCode,productVariantSku:null!=(s=e.sku)?s:void 0,productVariantId:e.id,productVariantTitle:e.title,productId:e.product.id,productTitle:e.product.title,productType:null!=(n=e.product.type)?n:void 0}}function Mr(e){return{collectionId:e.id}}function Nr(e,t,i){const s=[],n=[];return e.lineItems.forEach((({variant:e})=>{null!==e&&(s.push(e.id),n.push(e.product.id))})),{checkoutSubtotalAdjusted:kr(e.subtotalPrice.amount,t,i),checkoutSubtotal:e.subtotalPrice.amount,checkoutSubtotalCode:e.subtotalPrice.currencyCode,productVariantIds:s,productIds:n}}function Or(e,t,i){return __spreadValues({cartTotalAdjusted:kr(e.cost.totalAmount.amount,t,i),cartTotal:e.cost.totalAmount.amount,cartTotalCode:e.cost.totalAmount.currencyCode},Dr(e.merchandise,t,i))}function Rr(e){return{searchQuery:e.query}}function Lr(){return{"data.productVariantPriceAdjusted":"spvpa","data.productVariantPrice":"spvp","data.productVariantPriceCode":"spvpc","data.productVariantSku":"spvsku","data.productVariantId":"spvid","data.productVariantTitle":"spvt","data.productId":"spid","data.productTitle":"spt","data.productType":"spty","data.collectionId":"scid","data.checkoutSubtotalAdjusted":"scosta","data.checkoutSubtotal":"scost","data.checkoutSubtotalCode":"scostc","data.productVariantIds":"spvids","data.productIds":"spids","data.cartTotalAdjusted":"scata","data.cartTotal":"scat","data.cartTotalCode":"scatc","data.searchQuery":"ssq"}}const $r=class{constructor(e,t,i,s){__publicField(this,"storageKey"),__publicField(this,"browserStorage"),__publicField(this,"environment"),__publicField(this,"override"),this.storageKey=ue+e.getId(),this.browserStorage=t,this.environment=i,this.override=s}static buildPageviewActivity(e,t,i,s,n){return __spreadValues({eventType:"pv"},$r.setCommonActivityFields(e,t,i,s,n))}static buildViewActivity(e,t,i,s,n){const r=e.getExperience(),o=r.getCampaign(),a=o.getCustomer();return __spreadValues({eventType:"v",campaignId:o.getId(),experienceId:r.getId(),variationId:e.getId()},$r.setCommonActivityFields(a,t,i,s,n))}static buildConversionActivity(e,t,i,s,n,r){const o=__spreadValues({eventType:"c",actionId:e.getActionId(),eventId:e.getEventId(),eventInstanceId:e.getEventInstanceId()},$r.setCommonActivityFields(t,i,s,n,r));return e.getEventValue().ifPresent((e=>{o.eventValue=$r.transformEventValue(e)})),o}static buildShopifyActivity(e,t,i,s,n,r,o,a){return Cr(e,t,$r.buildConversionActivity(i,s,n,r,o,a))}static setCommonActivityFields(e,t,i,s,n){const r={userVisitStatus:n.getUserVisitStatus(i),userBucket:i.getUserBucket(),pageviewId:t.getPageviewId(),sessionId:n.updateAndGetSessionId(),time:t.getNowUnixTimeMs(),timeZone:t.getTimeZone()};n.getCustomerControlStatus(e).ifPresent((e=>{r.controlStatus=e})),t.getReferrerUrl().ifPresent((e=>{r.referrerUrl=e.getRawUrl()})),r.hostingPageUrl=t.getHostingPageUrl().getRawUrl();const o=s.getFlattenedInternalAttributes();Object.keys(o).length>0&&(r.trafficSource=o.ts,r.utmTerm=o.utt,r.utmMedium=o.utm,r.utmSource=o.uts,r.utmContent=o.utcn,r.utmCampaign=o.utcm);const a=s.getFlattenedCustomAttributes();Object.keys(a).length>0&&(r.customAttributes=a);const l=t.getWebflowPageMetadata();return void 0!==l.domain&&(r.webflowDomain=l.domain),void 0!==l.siteId&&(r.webflowSiteId=l.siteId),void 0!==l.pageId&&(r.webflowPageId=l.pageId),void 0!==l.collectionId&&(r.webflowCollectionId=l.collectionId),void 0!==l.itemSlug&&(r.webflowItemSlug=l.itemSlug),r}static transformEventValue(e){if("string"==typeof e)return Number.parseFloat(e)}add(e){if(this.override.saveActivity().orElse(!0)){const t=this.compressActivity(e),i=this.getAllCompressed();i.push(t),this.save(i)}}getAll(){return this.getAllCompressed().map((e=>this.decompressActivity(e)))}backoffAndSave(e){e.shift(),this.save(e)}save(e){const t=xe(e);if(t.length>$r.CHARACTER_LIMIT&&e.length>0)this.backoffAndSave(e);else try{this.browserStorage.write(this.storageKey,t)}catch(i){if(!(yt(i)&&e.length>0))throw i;Io.warn("localStorage quota exceeded. Removing old activity",220),this.backoffAndSave(e)}}getAllCompressed(){let e=[];try{e=this.browserStorage.read(this.storageKey).map((e=>{const t=Ae(e);if(!Array.isArray(t))throw new TypeError("Expected an array");return t})).orElse([])}catch(i){e=[];const t=new gi("Could not read Activities from localStorage",i);Io.error(t,221)}const t=this.environment.getNowUnixTimeMs()-$r.TIME_LIMIT_MS;return e.filter((e=>e.t>=t))}compressActivity(e){const t={};for(const[i,s]of Object.entries(e))if("data"===i&&m(s))for(const[e,n]of Object.entries(s)){const i=`data.${e}`;void 0===$r.KEY_MAP[i]?(Io.error(`Unknown key ${i} in Activity`,222),t[i]=n):t[$r.KEY_MAP[i]]=n}else void 0===$r.KEY_MAP[i]?(Io.error(`Unknown key ${i} in Activity`,222),t[i]=s):t[$r.KEY_MAP[i]]=s;return t}decompressActivity(e){const t={};for(const[i,s]of Object.entries(e))if(void 0===$r.REVERSE_KEY_MAP[i])Io.error(`Unknown key ${i} in CompressedActivity`,223),t[i]=s;else if($r.REVERSE_KEY_MAP[i].startsWith("data.")){const e=$r.REVERSE_KEY_MAP[i].split(".");2===e.length&&(void 0===t.data&&(t.data={}),t.data[e[1]]=s)}else t[$r.REVERSE_KEY_MAP[i]]=s;return t}};let Vr=$r;__publicField(Vr,"TIME_LIMIT_MS",15552e6),__publicField(Vr,"CHARACTER_LIMIT",1048576),__publicField(Vr,"KEY_MAP",__spreadValues({eventType:"et",customerEventName:"en",campaignId:"cmid",experienceId:"eid",variationId:"vid",actionId:"acid",eventId:"evid",eventInstanceId:"eii",eventValue:"ev",userVisitStatus:"uvs",userBucket:"ub",pageviewId:"pvid",sessionId:"sid",controlStatus:"cs",referrerUrl:"rurl",hostingPageUrl:"hpurl",time:"t",timeZone:"tz",trafficSource:"ts",utmTerm:"utt",utmMedium:"utm",utmSource:"uts",utmContent:"utcn",utmCampaign:"utcm",customAttributes:"ca",webflowDomain:"wfd",webflowSiteId:"wfsid",webflowPageId:"wfpid",webflowCollectionId:"wfcid",webflowItemSlug:"wfis"},Lr())),__publicField(Vr,"REVERSE_KEY_MAP",hn($r.KEY_MAP));class Ur extends xt{constructor(e){super(),__publicField(this,"callbacks",[]),this.callbacks=e}toString(){return"ActivateTask()"}inTransaction(){return!1}isUnloading(){return!0}addCallback(e){this.callbacks.push(e)}run(){return this.manager.getClient().reRun(this.callbacks),It.SUCCEEDED}}class Wr extends xt{constructor(e,t,i){super(),__publicField(this,"environment"),__publicField(this,"callbacks",[]),__publicField(this,"startTimeMs"),this.environment=e,this.callbacks=i,this.resetExpiration(),t.requestAnimationFrame().orElse(!0)&&this.environment.getWindow().requestAnimationFrame((()=>{this.handleRaf()})),this.environment.getWindow().requestAnimationFrame((()=>{this.handleRaf()}))}handleRaf(){this.manager&&this.manager.runNow(),xt.isDone(this.getStatus())||this.environment.getWindow().requestAnimationFrame((()=>{this.handleRaf()}))}toString(){return"RequestActivateTask()"}inTransaction(){return!1}isUnloading(){return!1}resetExpiration(){Io.debug("RequestActivateTask.resetExpiration()"),this.startTimeMs=this.environment.getNowUnixTimeMs()}addCallback(e){this.callbacks.push(e)}run(){if(!this.environment.hasHostingPageUrlChanged())return Io.debug("URL has not changed yet"),this.hasExceededTimeBudget()?(Io.info(`activate() timeout due to URL not changing after ${Z}ms`),It.SUCCEEDED):It.TRY_LATER;if(0===this.manager.findTasks((e=>e instanceof Ur&&!e.isDone())).length){const e=new Ur(this.callbacks);this.manager.addTask(e)}else Io.debug("Not scheduling new ActivateTask since one is already running");return It.SUCCEEDED}hasExceededTimeBudget(){const e=this.environment.getNowUnixTimeMs(),t=e-this.startTimeMs,i=t>Z;return Io.debug("hasExceededTimeBudget: "+e+" - "+this.startTimeMs+" ("+t+") > "+Z+"? => "+i),i}}class zr extends xt{constructor(e,t,i,s,n,r,o,a,l,c,u,d,h,g,p,m,v){super(),__publicField(this,"environment"),__publicField(this,"browserStorage"),__publicField(this,"extensionManager"),__publicField(this,"browserEventLogger"),__publicField(this,"attributeStorage"),__publicField(this,"activityStorage"),__publicField(this,"customerStorage"),__publicField(this,"decisionContext"),__publicField(this,"pageContext"),__publicField(this,"attributeData"),__publicField(this,"user"),__publicField(this,"override"),__publicField(this,"statusModel"),__publicField(this,"hider"),__publicField(this,"getVariationRecordedCallbackTuples"),__publicField(this,"elementObserver"),__publicField(this,"startPageviewId"),__publicField(this,"startTimeMs"),__publicField(this,"executeVariationTasks",{}),__publicField(this,"didHide",!1),this.environment=N(e),this.browserStorage=N(t),this.extensionManager=N(i),this.environment=N(e),this.browserEventLogger=N(s),this.attributeStorage=N(n),this.activityStorage=N(r),this.customerStorage=N(o),this.decisionContext=N(a),this.pageContext=N(l),this.attributeData=N(c),this.user=N(u),this.override=N(d),this.statusModel=N(h),this.hider=N(g),this.getVariationRecordedCallbackTuples=N(m),this.elementObserver=N(v),this.startTimeMs=this.environment.getNowUnixTimeMs(),this.startPageviewId=e.getPageviewId(),this.override.requestAnimationFrame().orElse(p)&&this.environment.getWindow().requestAnimationFrame((()=>{this.handleRaf()}))}static get RAF_RUNTIME_MS(){return 3e4}toString(){return`ExecuteExperiencesTask(${this.startPageviewId})`}inTransaction(){return!1}isUnloading(){return!1}getStartPageviewId(){return this.startPageviewId}hideExperiencesOnce(){this.didHide||(this.hider.hideExperiences(this.decisionContext.getExperiences(),this.browserStorage,this.attributeData),this.hider.revealDocumentIfAllRegionsHidden(),this.didHide=!0)}run(){return this.decisionContext.getExperiences().forEach((e=>{if(this.decisionContext.hasNext(e.getId())){const t=this.decisionContext.getFirst(e.getId());void 0===this.executeVariationTasks[e.getId()]&&(Io.debug(`Queueing ExecuteVariationTask for ExperienceID: ${e.getId()}, Variation ID: ${t.getId()}`),this.executeVariationTasks[e.getId()]=t.buildExecutionTask({environment:this.environment,browserStorage:this.browserStorage,extensionManager:this.extensionManager,browserEventLogger:this.browserEventLogger,customerStorage:this.customerStorage,attributeStorage:this.attributeStorage,activityStorage:this.activityStorage,pageContext:this.pageContext,attributeData:this.attributeData,decisionContext:this.decisionContext,user:this.user,override:this.override,statusModel:this.statusModel,startPageviewId:this.startPageviewId,hider:this.hider,getVariationRecordedCallbackTuples:this.getVariationRecordedCallbackTuples,elementObserver:this.elementObserver}),this.manager.addTask(this.executeVariationTasks[e.getId()]));const i=this.executeVariationTasks[e.getId()];i.getStatus()===It.FAILED||i.getStatus()===It.CANCELED?this.handleOnExperienceError(e):i.getStatus()===It.SUCCEEDED&&this.handleOnExperienceSuccess(e)}})),this.decisionContext.isEmpty()?It.SUCCEEDED:It.TRY_LATER}handleOnExperienceSuccess(e){this.decisionContext.removeExperience(e.getId())}handleOnExperienceError(e){this.decisionContext.removeExperience(e.getId()),this.hider.revealExperience(e,this.browserStorage,this.attributeData)}handleRaf(){this.manager&&this.manager.runNow(),this.environment.getNowUnixTimeMs()-this.startTimeMs<zr.RAF_RUNTIME_MS&&!xt.isDone(this.getStatus())&&this.environment.getWindow().requestAnimationFrame((()=>{this.handleRaf()}))}}const jr=class extends xt{constructor(e,t,i,s,n){super(),__publicField(this,"instanceNumber"),__publicField(this,"pageviewId"),__publicField(this,"customer"),__publicField(this,"environment"),__publicField(this,"customerStorage"),__publicField(this,"success"),__publicField(this,"startTimeMs"),this.instanceNumber=++jr.instanceCount,this.environment=e,this.pageviewId=t,this.customerStorage=i,this.customer=s,this.success=n}static get DEPENDENCIES_TIME_BUDGET_MS(){return 3e3}toString(){return`SelectedVariationsCallbackTask(${this.pageviewId}, ${this.instanceNumber})`}inTransaction(){return!0}isUnloading(){return!1}getNotDoneDependencies(){const e=[],t=this.getRunningDependentRecordTasks();Array.prototype.push.apply(e,t);const i=this.getDependentExecuteExperiencesTask();return i.length>0&&!i[0].isDone()&&Array.prototype.push.apply(e,i),e}run(){this.startTimeMs||(this.startTimeMs=this.environment.getNowUnixTimeMs());const e=this.getRunningDependentRecordTasks();if(e.length>0)return Io.debug("Waiting for "+e[0].toString()+", "+It[e[0].getStatus()]),It.TRY_LATER;const t=this.getDependentExecuteExperiencesTask();if(t.length>1)return Io.error(`Found multiple ExecuteExperiencesTasks for pageviewId ${this.pageviewId}`,89),It.FAILED;if(0===t.length)return It.TRY_LATER;const i=t[0];return xt.isDone(i.getStatus())?(this.doCallback(),It.SUCCEEDED):this.hasExceededTimeBudget()?(Io.debug(`Time budget of ${jr.DEPENDENCIES_TIME_BUDGET_MS} ms exceeded while waiting for ExecuteVariationTasks to complete; triggering success callbacks now`),this.doCallback(),It.SUCCEEDED):(Io.debug("Waiting for "+i.toString()+", "+It[i.getStatus()]),It.TRY_LATER)}getRunningDependentRecordTasks(){return this.manager.findTasks((e=>e instanceof so&&!e.isDone()))}getDependentExecuteExperiencesTask(){return this.manager.findTasks((e=>e instanceof zr&&this.pageviewId===e.getStartPageviewId()))}doCallback(){const e=this.customerStorage.getPageviewSelections(this.pageviewId),t=this.generateResponse(e);Io.debug("Callback data: "+Te(t));try{this.success.call(void 0,t)}catch(i){const e=new gi("Caught exception in customer callback",i);Io.error(e,8)}}getTimeRemainingMs(){const e=this.environment.getNowUnixTimeMs()-this.startTimeMs,t=jr.DEPENDENCIES_TIME_BUDGET_MS;return Io.debug("getTimeRemainingMs elapsed: "+e+", budget: "+t),t-e}hasExceededTimeBudget(){return this.getTimeRemainingMs()<0}};let Gr=jr;__publicField(Gr,"instanceCount",0);class Br extends Gr{toString(){return"SelectedVariationIdsCallbackTask("+this.pageviewId+","+this.instanceNumber+")"}generateResponse(e){const t={};return e.forEach((e=>{t[e.experienceId]=e.variationId})),t}}class Hr extends Gr{toString(){return"SelectedVariationNamesCallbackTask("+this.pageviewId+","+this.instanceNumber+")"}generateResponse(e){const t={};return e.forEach((e=>{e.campaignId in t||(t[e.campaignId]={});const i={};i.varId=e.variationId,this.customer.getCampaign(e.campaignId).ifPresent((s=>{t[e.campaignId].campaignName=s.getName(),s.getExperience(e.experienceId).ifPresent((t=>{i.expName=t.getName(),t.getVariation(e.variationId).ifPresent((e=>{i.varName=e.getName()}))}))})),t[e.campaignId][e.experienceId]=i})),t}}class Qr{constructor(e,t,i,s,n,r,o,a,l,c,u,d,h,g,p){__publicField(this,"environment"),__publicField(this,"extensionManager"),__publicField(this,"browserEventLogger"),__publicField(this,"taskManager"),__publicField(this,"customerStorage"),__publicField(this,"attributeStorage"),__publicField(this,"activityStorage"),__publicField(this,"integrationDataStorage"),__publicField(this,"customer"),__publicField(this,"user"),__publicField(this,"override"),__publicField(this,"statusModel"),__publicField(this,"callQueue"),__publicField(this,"readyCallbackQueue"),__publicField(this,"addVariationRecordedCallbackTuple"),__publicField(this,"initialized"),this.environment=N(e),this.extensionManager=t,this.browserEventLogger=N(i),this.taskManager=N(s),this.customerStorage=N(n),this.attributeStorage=N(r),this.activityStorage=N(o),this.integrationDataStorage=N(a),this.customer=N(l),this.user=N(c),this.override=N(u),this.statusModel=N(d),this.callQueue=N(h),this.readyCallbackQueue=N(g),this.addVariationRecordedCallbackTuple=N(p),this.initialized=!1}static validatePushCommand(e){return e&&"object"==typeof e&&e.constructor===Array?!(!e[0]||"string"!=typeof e[0])||(Qr.consoleError(`intellimize.push(): First parameter must be a string: ${Te(e)}`,114),!1):(Qr.consoleError(`intellimize.push(): Parameter must be an array: ${Te(e)}`,113),!1)}static validateReadyCallback(e){return!!an(e)||(Qr.consoleError("ready() was called with a non-function argument",115),!1)}static consoleError(e,t){console.error(e),Io.error(e,t)}static validateAttributeScope(e){return"user"===e||"pageview"===e}static validateAttributes(e){return null!=e&&on(e)}static filterAttributePairs(e){for(const t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;if(!Qr.validateAttributeName(t)){Qr.consoleError(`setAttributes() invalid attribute ${t}`,96),delete e[t];continue}const i=Qr.transformAttributeValue(e[t]);Qr.validateAttributeValue(i)?e[t]=i:(Qr.consoleError(`setAttributes() invalid attribute ${t}: ${e[t]}`,97),delete e[t])}}static validateAttributeName(e){return/^[\u0020-\u003C\u003E-\u007E]{1,40}$/.test(e)}static transformAttributeValue(e){let t=e;return"boolean"==typeof t&&(t=t.toString()),"number"==typeof t&&(t=t.toString()),null===t&&(t=""),void 0===t&&(t=""),"string"==typeof t&&t.length>255&&(t=t.slice(0,255)),t}static validateAttributeValue(e){return void 0!==e&&"string"==typeof e&&e.length>=0&&e.length<256}static validateAttributeNames(e){if(void 0===e||!Array.isArray(e))return!1;for(const t of e)if(!Qr.validateAttributeName(t))return!1;return!0}static validateCustomEventApiName(e){return/^[\u0021-\u007E]{1,40}$/.test(e)}static validateCustomEventProperties(e){const t=new Set(["value","actionId"]);return!!Object.keys(e).every((e=>t.has(e)))&&(!(void 0!==e.value&&!yr(e.value))&&!(void 0!==e.actionId&&!Sr(e.actionId)))}static validateCustomerUserId(e){return/^[\u0021-\u007E]{1,300}$/.test(e)}static validateCustomerUserDomain(e){return"intellimize"!==e&&!e.startsWith("__")&&/^[\u0021-\u007E]{1,50}$/.test(e)}static doCallback(e){void 0!==e&&wt.executeFunction(e,5)}get isInitialized(){return this.initialized}initialize(){const e=this,t=this.environment.getWindow(),{intellimize:i,wf:s}=t;if(void 0===i)return void Io.error("window.intellimize is undefined: Cannot initialize ExternalApi",218);void 0===s&&Io.debug("window.wf is undefined: Can only initialize External API on the window.intellimize namespace"),i.getSelectedVariationIds=(e,t)=>{"function"==typeof e?void 0===t||"function"==typeof t?this.getSelectedVariationIds(e,t):Qr.consoleError("intellimize.getSelectedVariationIds() second parameter must be an error function",103):Qr.consoleError("intellimize.getSelectedVariationIds() first parameter must be a success function",102)},i.getSelectedVariationNames=(e,t)=>{"function"==typeof e?void 0===t||"function"==typeof t?this.getSelectedVariationNames(e,t):Qr.consoleError("intellimize.getSelectedVariationNames() second parameter must be an error function",105):Qr.consoleError("intellimize.getSelectedVariationNames() First parameter must be a success function",104)},i.onVariationRecorded=function(t,i){e.onVariationRecorded(t.bind(this),void 0===i?void 0:i.bind(this))},void 0!==s&&(s.onVariationRecorded=function(t,i){e.onVariationRecorded(t.bind(this),void 0===i?void 0:i.bind(this))});const n=(e,t)=>{this.setAttributes(e,t)};i.setAttributes=n,void 0!==s&&(s.setAttributes=n);const r=(e,t)=>this.getAttributes(e,t);i.getAttributes=r,void 0!==s&&(s.getAttributes=r);const o=e=>this.getAllAttributes(e);i.getAllAttributes=o,void 0!==s&&(s.getAllAttributes=o);const a=(e,t)=>{this.deleteAttributes(e,t)};i.deleteAttributes=a,void 0!==s&&(s.deleteAttributes=a);const l=e=>{this.deleteAllAttributes(e)};i.deleteAllAttributes=l,void 0!==s&&(s.deleteAllAttributes=l),i.getIntegrationData=e=>this.getIntegrationData(e),i.sendEvent=(e,t,i)=>{this.sendEvent(e,t,i)},i.activate=e=>{this.activate(e)},i.setUserId=(e,t)=>{this.setCustomerUserId(e,t)},i.getActivities=()=>this.getActivities(),i.registerExtension=e=>{Io.debug(`intellimize.registerExtension(${e.getName()})`),this.extensionManager.registerExtension(e)},i.push=e=>{Qr.validatePushCommand(e)&&this.push(e)};const c=e=>{Qr.validateReadyCallback(e)&&this.ready(e)};i.ready=c,void 0!==s&&(s.ready=c),this.callQueue.forEach((e=>{e&&"object"==typeof e&&e.constructor===Array?"push"!==e[0]?this.push(e):Qr.consoleError('intellimize.push() Refusing to process command "push", to prevent infinite recursion.',10):Qr.consoleError("intellimize.push() Parameter must be an array: "+Te(e),9)})),this.readyCallbackQueue.forEach(((e,t)=>{Io.debug(`ready() executing registered callback #${t+1}`),this.ready(e)})),this.initialized=!0}getSelectedVariationIds(e,t){Io.debug("getSelectedVariationIds()"),Io.warn("getSelectedVariationIds",160);const i=this.environment.getPageviewId(),s=new Br(this.environment,i,this.customerStorage,this.customer,e);this.taskManager.addTask(s)}getSelectedVariationNames(e,t){Io.debug("getSelectedVariationNames()"),Io.warn("getSelectedVariationNames",161);const i=this.environment.getPageviewId(),s=new Hr(this.environment,i,this.customerStorage,this.customer,e);this.taskManager.addTask(s)}onVariationRecorded(e,t){Io.debug("onVariationRecorded()"),Io.warn("onVariationRecorded",203),"function"==typeof e?void 0===t||"function"==typeof t?this.addVariationRecordedCallbackTuple([e,j.ofNullable(t)]):Qr.consoleError("onVariationRecorded() second parameter must be an error function",164):Qr.consoleError("onVariationRecorded() first parameter must be a success function",163)}setAttributes(e,t){Io.debug(`setAttributes(${e}, ${Te(t)})`),Qr.validateAttributeScope(e)?Qr.validateAttributes(t)?(Qr.filterAttributePairs(t),this.attributeStorage.setCustomAttributes(e,t)):Qr.consoleError("setAttributes() invalid attributes parameter",110):Qr.consoleError("setAttributes() invalid scope parameter",109)}getAttributes(e,t){return Io.debug(`getAttributes(${e}, ${t})`),Qr.validateAttributeScope(e)?Qr.validateAttributeNames(t)?this.attributeStorage.getCustomAttributes(e,t):(Qr.consoleError("getAttributes() invalid names parameter",100),{}):(Qr.consoleError("getAttributes() invalid scope parameter",99),{})}getAllAttributes(e){return Io.debug(`getAllAttributes(${e}`),Qr.validateAttributeScope(e)?this.attributeStorage.getCustomAttributes(e):(Qr.consoleError("getAllAttributes() invalid scope parameter",98),{})}deleteAttributes(e,t){Io.debug(`deleteAttributes(${e}, ${t})`),Qr.validateAttributeScope(e)?Qr.validateAttributeNames(t)?this.attributeStorage.deleteCustomAttributes(e,t):Qr.consoleError("deleteAttributes() invalid names parameter",95):Qr.consoleError("deleteAttributes() invalid scope parameter",94)}deleteAllAttributes(e){Io.debug(`deleteAllAttributes(${e})`),Qr.validateAttributeScope(e)?this.attributeStorage.deleteCustomAttributes(e):Qr.consoleError("deleteAllAttributes() invalid scope parameter",20)}getIntegrationData(e){var t;if(Io.debug(`getIntegrationData(${e})`),"marketoLead"===e){return null!=(t=this.integrationDataStorage.getData("marketo").flatMap((e=>dr(e))).orElse({lead:{fields:{},lists:[]}}).lead)?t:{}}return Xn.includes(e)?this.integrationDataStorage.getData(e).flatMap((e=>j.ofNullable(e))).orElse({}):(Qr.consoleError("intellimize.getData() invalid integration name parameter",101),{})}sendEvent(e,t,i){return Io.debug(`sendEvent(${e}, ${Te(t)} )`),Qr.validateCustomEventApiName(e)?void 0===t||Qr.validateCustomEventProperties(t)?void this.customer.getCustomEvent(e).flatMap((t=>this.override.isEventLive(t).orElse("live"===t.getState())?j.ofNullable(t):(Io.debug(`sendEvent(${e}) event is not live`),j.empty()))).ifPresent((e=>{const s=void 0===t?void 0:t.value;let n=void 0===t?void 0:t.actionId;void 0===n&&(n=this.environment.generateActionId());const r=new Kn(e,n,s,void 0);this.activityStorage.add(Vr.buildConversionActivity(r,this.customer,this.environment,this.user,this.attributeStorage,this.customerStorage));const o=new _r(r,this.browserEventLogger,this.customer,this.customerStorage,this.statusModel);void 0!==i&&o.onDone(i),this.taskManager.addTask(o)})).ifAbsent((()=>{Qr.consoleError(`intellimize.sendEvent() apiName not found "${e}"`,19),Qr.doCallback(i)})):(Qr.consoleError(`intellimize.sendEvent() invalid properties "${Te(t)}"`,108),void Qr.doCallback(i)):(Qr.consoleError(`intellimize.sendEvent() invalid apiName "${e}"`,107),void Qr.doCallback(i))}activate(e){Io.debug("activate()");const t=this.taskManager.findTasks((e=>e instanceof Ur&&!e.isDone()));if(t.length>0){Io.debug("Ignoring activate() since there is an outstanding ActivateTask");const i=t[0];return void(void 0!==e&&i.addCallback(e))}const i=this.taskManager.findTasks((e=>e instanceof Wr&&!e.isDone()));if(i.length>0){Io.debug("Extending activate() expiration time");const t=i[0];return void 0!==e&&t.addCallback(e),void t.resetExpiration()}const s=void 0===e?[]:[e],n=new Wr(this.environment,this.override,s);this.taskManager.addTask(n)}setCustomerUserId(e,t){if(Io.debug(`setCustomerUserId(${e}, ${t})`),!Qr.validateCustomerUserDomain(e))return void Qr.consoleError("intellimize.setCustomerUserId() invalid user domain",111);if(!Qr.validateCustomerUserId(t))return void Qr.consoleError("intellimize.setCustomerUserId() invalid user id",112);const i=new Er(this.environment,this.customer,"intellimize",this.user.getId(),e,t);this.taskManager.addTask(i)}getActivities(){return Io.debug("getActivities()"),this.activityStorage.getAll()}push(e){Io.debug("push("+e[0]+")");const t=this.environment.getWindow();try{if(void 0===t.intellimize)return void Io.error("push() called, but window.intellimize undefined",30);const i=e.shift();if(void 0===t.intellimize[i])return void Qr.consoleError(`intellimize.${i}() is not a valid function`,106);t.intellimize[i].apply(void 0,e)}catch(i){const e=new gi("Error executing push()",i);Io.error(e,3)}}ready(e){Qr.doCallback(e)}}const qr=/^G-[\dA-Z]+$/,Kr=e=>"string"==typeof e&&qr.test(e),Yr=e=>{const t=[],i=e=>{Kr(e)&&!t.includes(e)&&(Io.debug(`Found GA4 Measurement ID: ${e}`),t.push(e))},s=e.google_tag_data;m(s)&&Object.values(s).forEach((e=>{m(e)&&Object.keys(e).forEach((e=>{i(e)}))}));const n=e.google_tag_manager;m(n)&&Object.values(n).forEach((e=>{m(e)&&Object.values(e).forEach((e=>{h(e)&&e.forEach((({message:e})=>{rn(e)&&"config"===e[0]&&i(e[1])}))}))}));const{dataLayer:r}=e;return h(r)&&r.forEach((e=>{m(e)?Object.values(e).forEach((e=>{rn(e)&&"config"===e[0]&&i(e[1])})):rn(e)&&"config"===e[0]&&i(e[1])})),{ga4:t}};class Jr extends xt{constructor(e,t,i){super(),__publicField(this,"targetUrl"),__publicField(this,"environment"),__publicField(this,"variation"),this.targetUrl=e,this.environment=t,this.variation=i}toString(){return"RedirectTask("+this.targetUrl+")"}inTransaction(){return!1}isUnloading(){return!0}getRedirectVariation(){return this.variation}run(){return Io.info("Executing redirect to "+this.targetUrl),this.environment.redirect(this.targetUrl),It.SUCCEEDED}}class Xr extends xt{constructor(e,t,i,s){super(),__publicField(this,"environment"),__publicField(this,"ga4Integration"),__publicField(this,"variation"),__publicField(this,"override"),__publicField(this,"states",{ga4State:"notStarted"}),__publicField(this,"ga4MeasurementIdQueue",[]),__publicField(this,"taskStartTime"),this.environment=e,this.ga4Integration=t,this.variation=i,this.override=s,R(!t.isPresent()||t.get().isEnabled())}static get GA4_EVENT_NAME(){return"variation_viewed"}static get WAIT_FOR_GA_TIMEOUT_MS(){return 3e3}static get WAIT_FOR_PROPERTY_IDS_MS(){return 5e3}static isSent(e){return"sent"===e||Xr.isCompleted(e)}static isCompleted(e){return Xr.isSuccessful(e)||"failed"===e}static isSuccessful(e){return"delivered"===e||"skipped"===e}cleanup(){Io.group("GoogleAnalyticsTask.cleanup()");const e=this.ga4Integration.map((e=>e.isEnabled())).orElse(!1),t=this.manager.findTasks((e=>e instanceof Jr)).map((e=>e.getRedirectVariation().getId())),i=`GoogleAnalyticsTask did not complete. Enabled: { ga4: ${e} }, GaStates: ${Te(this.states)}, ga4MeasurementIdQueue: ${Te(this.ga4MeasurementIdQueue)}, redirectVariationId(s): ${Te(t)}, Task ran for: ${this.getTimePassedMs()}ms`;Io.error(i,258),Io.groupEnd()}toString(){return"GoogleAnalyticsTask("+this.variation.getId()+")"}inTransaction(){return!0}isUnloading(){return!1}run(){return this.sendOnce(),this.isAllCompleted()?this.isAllSuccessful()?It.SUCCEEDED:It.FAILED:(Io.debug("Waiting for GA delivery confirmation"),It.TRY_LATER)}isAllSent(){return Xr.isSent(this.states.ga4State)}isAllCompleted(){return Xr.isCompleted(this.states.ga4State)}isAllSuccessful(){return Xr.isSuccessful(this.states.ga4State)}setState(e,t){this.states[e]!==t&&(Io.debug(`Transitioning ${e} from ${this.states[e]} to ${t}`),this.states[e]=this.isValidStateTransition(this.states[e],t)?t:"failed")}isValidStateTransition(e,t){switch(e){case"notStarted":if("polling"===t||"skipped"===t)return!0;break;case"polling":if("sent"===t||"failed"===t)return!0;break;case"sent":if("delivered"===t)return!0}return this.sendError(`Invalid state transition. Cannot transition from "${e}" to "${t}".`,189),!1}sendOnce(){if(!this.isAllSent()){void 0===this.taskStartTime&&(this.taskStartTime=this.environment.getNowDate(),Io.debug(`GoogleAnalyticsTask start time: ${this.taskStartTime.getTime()}`));const e=this.getTimePassedMs();if(this.override.sendGoogleAnalytics().orElse(!0)){this.ga4Integration.ifPresent((()=>{Io.debug("GoogleAnalytics4 - integration is enabled")})).ifAbsent((()=>{Io.debug("Google Analytics 4 - integration is not enabled"),this.setState("ga4State","skipped")}));this.waitForDataLayer(e).ifPresent((t=>{this.ga4Integration.ifPresent((i=>{if(i.isAutoConfig()){Io.debug("GoogleAnalytics4 - AutoConfig is enabled");const s=this.waitForMeasurementId(e);s.length>0&&this.sendToGa4Once(i,t,s)}else Io.debug("GoogleAnalytics4 - AutoConfig is disabled"),this.sendToGa4Once(i,t)}))}))}else Io.debug("Google Analytics - Override behavior has prevented all events from being sent"),this.setState("ga4State","skipped")}}sendError(e,t){Io.error(e,t,{variationId:this.variation.getId(),experienceId:this.variation.getExperience().getId()})}shimGtag(e){return function(){e.push(arguments)}}waitForDataLayer(e){const t=this.environment.getWindow();if(Xr.isSent(this.states.ga4State)||Xr.isCompleted(this.states.ga4State)||this.setState("ga4State","polling"),void 0===t.dataLayer)Io.debug(`window.dataLayer not defined after ${e} ms`);else{if(nn(t.dataLayer))return j.of(t.dataLayer);Io.debug("window.dataLayer is not an array")}return e>=Xr.WAIT_FOR_GA_TIMEOUT_MS&&(Xr.isCompleted(this.states.ga4State)||this.setState("ga4State","failed"),this.sendError(`window.dataLayer not present within ${Xr.WAIT_FOR_GA_TIMEOUT_MS} ms`,185)),j.empty()}waitForMeasurementId(e){const t=Yr(this.environment.getWindow());return 0===t.ga4.length?(Io.debug(`Auto-configured Measurement ID not present after ${e} ms`),this.setState("ga4State","polling"),e>=Xr.WAIT_FOR_PROPERTY_IDS_MS&&(this.setState("ga4State","failed"),this.sendError(`GoogleAnalytics4 - Auto-configured Measurement ID is not present within ${Xr.WAIT_FOR_PROPERTY_IDS_MS} ms`,187)),[]):t.ga4}sendToGa4Once(e,t,i){if(!Xr.isSent(this.states.ga4State)){const s=this.shimGtag(t),n=null!=i?i:e.getMeasurementIds(),r={experienceId:this.variation.getExperience().getId(),experienceName:this.variation.getExperience().getName(),experienceType:this.variation.getExperience().getType(),variationId:this.variation.getId(),variationName:this.variation.getName(),ccStatus:this.variation.getId()===rt?"holdout":"optimized",send_to:n,event_callback:e=>{Kr(e)&&(this.handleGaEventSuccess(`GA4 configuration (iint.ga4) + gtag.js. Measurement ID: ${e}`),this.checkDelivered("ga4State",e))}};Io.debug(`Sending GA4 event using gtag.js: ${Te(r)}`),this.ga4MeasurementIdQueue.push(...n),Io.debug("Google Analytics 4 payload sent"),this.setState("ga4State","sent"),s("event",Xr.GA4_EVENT_NAME,r)}}handleGaEventSuccess(e){Io.debug(`Google Analytics payload delivery complete - using ${e}`)}checkDelivered(e,t){const i=this.ga4MeasurementIdQueue;dn(i,t),0===i.length&&this.setState(e,"delivered")}getTimePassedMs(){if(void 0===this.taskStartTime)return 0;return this.environment.getNowDate().getTime()-this.taskStartTime.getTime()}}class Zr extends xt{constructor(e,t,i,s){super(),__publicField(this,"environment"),__publicField(this,"mixpanelIntegration"),__publicField(this,"variation"),__publicField(this,"override"),__publicField(this,"sent",!1),__publicField(this,"delivered",!1),__publicField(this,"timedOut",!1),__publicField(this,"taskStartTime"),this.environment=e,this.mixpanelIntegration=t,this.variation=i,this.override=s}static get WAIT_FOR_MIXPANEL_TIMEOUT_MS(){return 3e3}toString(){return"MixpanelTask("+this.variation.getId()+")"}inTransaction(){return!0}isUnloading(){return!1}run(){return this.sendOnce(),this.timedOut?It.FAILED:this.sent?this.delivered?It.SUCCEEDED:(Io.debug("Waiting for Mixpanel delivery confirmation"),It.TRY_LATER):It.TRY_LATER}sendOnce(){if(!this.sent){void 0===this.taskStartTime&&(this.taskStartTime=this.environment.getNowDate(),Io.debug(`MixpanelTask start time: ${this.taskStartTime.getTime()}`));if(this.environment.getNowDate().getTime()-this.taskStartTime.getTime()>=Zr.WAIT_FOR_MIXPANEL_TIMEOUT_MS)return Io.error(`MixpanelTask - window.mixpanel.track not present within ${Zr.WAIT_FOR_MIXPANEL_TIMEOUT_MS} ms`,199),void(this.timedOut=!0);if(this.override.sendMixpanel().orElse(!0)){const e=this.environment.getWindow();if(void 0===e.mixpanel)return void Io.debug("window.mixpanel not defined");if(void 0===e.mixpanel.track)return void Io.debug("window.mixpanel.track not defined");const t=this.mixpanelIntegration.getEventName(),i={[`${this.variation.getExperience().getName()} (${this.variation.getExperience().getId()})`]:`${this.variation.getName()} (${this.variation.getId()})`};e.mixpanel.track(t,i,{send_immediately:!0},(()=>{Io.debug("Mixpanel payload delivery complete"),this.delivered=!0})),Io.debug("Mixpanel payload sent")}else this.delivered=!0,Io.debug("Skipping Mixpanel");this.sent=!0}}}class eo extends xt{constructor(e,t,i,s){super(),__publicField(this,"environment"),__publicField(this,"segmentIntegration"),__publicField(this,"variation"),__publicField(this,"override"),__publicField(this,"sent",!1),__publicField(this,"delivered",!1),__publicField(this,"timedOut",!1),__publicField(this,"onTrack",!1),__publicField(this,"onReady",!1),__publicField(this,"trackCallback",!1),__publicField(this,"taskStartTime"),this.environment=e,this.segmentIntegration=t,this.variation=i,this.override=s}static get WAIT_FOR_SEGMENT_TIMEOUT_MS(){return 3e3}toString(){return"SegmentAnalyticsTask("+this.variation.getId()+")"}inTransaction(){return!0}isUnloading(){return!1}run(){return this.sendOnce(),this.timedOut?It.FAILED:this.sent?this.delivered||this.onReady&&this.onTrack&&this.trackCallback?It.SUCCEEDED:(Io.debug("Waiting for Segment delivery confirmation"),It.TRY_LATER):It.TRY_LATER}sendOnce(){if(!this.sent){void 0===this.taskStartTime&&(this.taskStartTime=this.environment.getNowDate(),Io.debug(`SegmentAnalyticsTask start time: ${this.taskStartTime.getTime()}`));if(this.environment.getNowDate().getTime()-this.taskStartTime.getTime()>=eo.WAIT_FOR_SEGMENT_TIMEOUT_MS)return Io.error(`SegmentAnalyticsTask - window.analytics.track not present within ${eo.WAIT_FOR_SEGMENT_TIMEOUT_MS} ms`,200),void(this.timedOut=!0);if(this.override.sendSegmentAnalytics().orElse(!0)){const e=this.environment.getWindow();if(void 0===e.analytics)return void Io.debug("window.analytics not defined");if(void 0===e.analytics.track)return void Io.debug("window.analytics.track not defined");const t=this.segmentIntegration.getEventName();e.analytics.on("track",((e,i)=>{e===t&&void 0!==i.variationId&&i.variationId===this.variation.getId()&&(Io.debug("Segment on track event received"),this.onTrack=!0)}));const i={campaignId:this.variation.getExperience().getCampaign().getId(),campaignName:this.variation.getExperience().getCampaign().getName(),experimentId:this.variation.getExperience().getId(),experimentName:this.variation.getExperience().getName(),variationName:this.variation.getName(),variationId:this.variation.getId(),nonInteraction:1};e.analytics.track(t,i,(()=>{Io.debug("Segment track() callback called"),this.trackCallback=!0})),e.analytics.ready((()=>{Io.debug("Segment ready() callback called"),this.onReady=!0}))}else this.delivered=!0;Io.debug("Segment payload sent"),this.sent=!0}}}class to extends xt{constructor(e,t,i){super(),__publicField(this,"variation"),__publicField(this,"browserEventLogger"),__publicField(this,"decisionContext"),__publicField(this,"sent",!1),__publicField(this,"deliveryStatus",It.NOT_STARTED),this.variation=N(e),this.browserEventLogger=N(t),this.decisionContext=N(i)}toString(){return"ViewEventTask("+this.variation.getId()+")"}getEntityIds(){return{variationId:this.variation.getId(),experienceId:this.variation.getExperience().getId()}}inTransaction(){return!0}isUnloading(){return!1}run(){return this.sendOnce(),this.deliveryStatus===It.SUCCEEDED?It.SUCCEEDED:this.deliveryStatus===It.FAILED?It.FAILED:(Io.debug("Waiting for view event delivery confirmation"),It.TRY_LATER)}sendOnce(){this.sent||(Io.info(`Variation ${this.variation.getExperience().getId()}/${this.variation.getId()} sending view event`),this.browserEventLogger.sendView(this.variation,this.decisionContext).then((()=>{Io.info(`Variation ${this.variation.getExperience().getId()}/${this.variation.getId()} view event delivery success`),this.deliveryStatus=It.SUCCEEDED})).catch((e=>{const t=new gi(`Variation ${this.variation.getExperience().getId()}/${this.variation.getId()} view event delivery failed`,e);Io.warn(t,93,{experienceId:this.variation.getExperience().getId(),variationId:this.variation.getId()}),this.deliveryStatus=It.FAILED})),this.sent=!0)}}class io extends xt{constructor(e,t){super(),__publicField(this,"environment"),__publicField(this,"viewabilityTimeMs"),__publicField(this,"startViewableTimeMs"),__publicField(this,"ignoreCallback",!1),__publicField(this,"activeEventListener",!1),this.environment=e,this.viewabilityTimeMs=t}toString(){return"ViewabilityTask()"}inTransaction(){return!1}isUnloading(){return!1}cleanup(){this.ignoreCallback=!0}run(){const e=this.environment.getNowUnixTimeMs();if(!this.environment.isNowDocumentHidden().orElse(!0)){void 0===this.startViewableTimeMs&&(this.startViewableTimeMs=e);const t=e-this.startViewableTimeMs;return t>=this.viewabilityTimeMs?(Io.debug(`page viewable for ${t}ms > threshold ${this.viewabilityTimeMs}ms`),It.SUCCEEDED):(Io.debug(`page viewable for ${t}ms < threshold ${this.viewabilityTimeMs}ms`),It.TRY_LATER)}return this.startViewableTimeMs=void 0,this.activeEventListener||(Io.debug("page not viewable, scheduling visibility change listener"),this.environment.addListenerVisibilityChange((()=>{try{this.ignoreCallback?Io.debug("visibility change event - ignoring"):(Io.debug("visibility change event - ask TM for polling"),this.setStatusTryLater(),this.manager.runNow())}catch(e){const t=new gi("Exception in ViewabilityTask visibilitychange handler",e);Io.error(t,238)}})),this.activeEventListener=!0),It.WAITING}}class so extends xt{constructor(e,t,i,s,n,r,o,a,l,c,u){super(),__publicField(this,"variation"),__publicField(this,"environment"),__publicField(this,"browserEventLogger"),__publicField(this,"customerStorage"),__publicField(this,"attributeStorage"),__publicField(this,"activityStorage"),__publicField(this,"user"),__publicField(this,"decisionContext"),__publicField(this,"startPageviewId"),__publicField(this,"override"),__publicField(this,"viewabilityTask"),__publicField(this,"getVariationRecordedCallbackTuples"),__publicField(this,"haveUpdatedCustomerStorage",!1),__publicField(this,"haveUpdatedActivityStorage",!1),__publicField(this,"haveScheduledGoogleAnalytics",!1),__publicField(this,"googleAnalyticsTask"),__publicField(this,"haveScheduledSegmentAnalytics",!1),__publicField(this,"segmentAnalyticsTask"),__publicField(this,"haveScheduledMixpanel",!1),__publicField(this,"mixpanelTask"),__publicField(this,"viewEventTask"),__publicField(this,"haveRunSuccessCallbacks",!1),this.variation=N(e),this.environment=N(t),this.browserEventLogger=N(i),this.customerStorage=N(s),this.attributeStorage=N(n),this.activityStorage=N(r),this.user=N(o),this.decisionContext=N(a),this.startPageviewId=N(l),this.override=N(c),this.getVariationRecordedCallbackTuples=N(u)}toString(){return"RecordVariationTask("+this.variation.getId()+")"}getEntityIds(){return{variationId:this.variation.getId(),experienceId:this.variation.getExperience().getId()}}inTransaction(){return!1}isUnloading(){return!1}getNotDoneDependencies(){const e=[];return void 0===this.googleAnalyticsTask||this.googleAnalyticsTask.isDone()||e.push(this.googleAnalyticsTask),void 0===this.segmentAnalyticsTask||this.segmentAnalyticsTask.isDone()||e.push(this.segmentAnalyticsTask),void 0===this.mixpanelTask||this.mixpanelTask.isDone()||e.push(this.mixpanelTask),void 0===this.viewEventTask||this.viewEventTask.isDone()||e.push(this.viewEventTask),void 0===this.viewabilityTask||this.viewabilityTask.isDone()||e.push(this.viewabilityTask),e}updateCustomerStorageOnce(){this.haveUpdatedCustomerStorage||(Io.debug("RecordVariationTask.updateCustomerStorageOnce() "+this.variation.getId()),this.decisionContext.isStickyVariation(this.variation)?this.customerStorage.saveVariationStickySelection(this.variation,this.environment.getPageviewId()):this.customerStorage.saveVariationPredictionSelection(this.variation,this.decisionContext.getModelVersion(this.variation.getExperience().getId()),this.environment.getPageviewId()),this.haveUpdatedCustomerStorage=!0)}updateActivityStorageOnce(){if(!this.haveUpdatedActivityStorage){Io.debug(`RecordVariationTask.haveUpdatedActivityStorage() ${this.variation.getId()}`);const e=Vr.buildViewActivity(this.variation,this.environment,this.user,this.attributeStorage,this.customerStorage);this.activityStorage.add(e),this.haveUpdatedActivityStorage=!0}}sendGoogleAnalyticsOnce(){if(!this.haveScheduledGoogleAnalytics){const e=this.variation.getExperience().getCampaign().getCustomer().getIntegrationGoogle4Analytics(),t=e.isPresent()&&e.get().isEnabled();t&&(this.googleAnalyticsTask=new Xr(this.environment,t?e:j.empty(),this.variation,this.override),this.manager.addTask(this.googleAnalyticsTask)),this.haveScheduledGoogleAnalytics=!0}}sendSegmentAnalyticsOnce(){this.haveScheduledSegmentAnalytics||(this.variation.getExperience().getCampaign().getCustomer().getIntegrationSegmentAnalytics().ifPresent((e=>{e.isEnabled()&&(this.segmentAnalyticsTask=new eo(this.environment,e,this.variation,this.override),this.manager.addTask(this.segmentAnalyticsTask))})),this.haveScheduledSegmentAnalytics=!0)}sendMixpanelOnce(){this.haveScheduledMixpanel||(this.variation.getExperience().getCampaign().getCustomer().getIntegrationMixpanel().ifPresent((e=>{e.isEnabled()&&(this.mixpanelTask=new Zr(this.environment,e,this.variation,this.override),this.manager.addTask(this.mixpanelTask))})),this.haveScheduledMixpanel=!0)}sendViewEventOnce(){void 0===this.viewEventTask&&(this.viewEventTask=new to(this.variation,this.browserEventLogger,this.decisionContext),this.manager.addTask(this.viewEventTask))}checkDependency(e){switch(e.getStatus()){case It.NOT_STARTED:case It.TRY_LATER:case It.WAITING:return It.TRY_LATER;case It.FAILED:case It.CANCELED:return It.FAILED;case It.SUCCEEDED:return It.SUCCEEDED;default:return Io.error(`Unrecognized status from dependency ${e.getStatus()}`,88,{variationId:this.variation.getId(),experienceId:this.variation.getExperience().getId()}),It.FAILED}}getRecordViewStatus(){if(!this.haveUpdatedCustomerStorage)return Io.debug("Waiting for CustomerStorage to be updated"),It.TRY_LATER;if(!this.haveScheduledGoogleAnalytics)return Io.debug("Waiting for GoogleAnalytics to be scheduled"),It.TRY_LATER;if(void 0!==this.googleAnalyticsTask){const e=this.checkDependency(this.googleAnalyticsTask);if(e!==It.SUCCEEDED)return Io.debug(`GoogleAnalytics returned ${It[e]}`),e}if(!this.haveScheduledSegmentAnalytics)return Io.debug("Waiting for SegmentAnalytics to be scheduled"),It.TRY_LATER;if(void 0!==this.segmentAnalyticsTask){const e=this.checkDependency(this.segmentAnalyticsTask);if(e!==It.SUCCEEDED)return Io.debug(`SegmentAnalytics returned ${It[e]}`),e}if(!this.haveScheduledMixpanel)return Io.debug("Waiting for Mixpanel to be scheduled"),It.TRY_LATER;if(void 0!==this.mixpanelTask){const e=this.checkDependency(this.mixpanelTask);if(e!==It.SUCCEEDED)return Io.debug(`Mixpanel returned ${It[e]}`),e}if(void 0===this.viewEventTask)return Io.debug("Waiting for ViewEvent to be scheduled"),It.TRY_LATER;const e=this.checkDependency(this.viewEventTask);return e!==It.SUCCEEDED?(Io.debug(`ViewEvent returned ${It[e]}`),e):It.SUCCEEDED}doSuccessCallbacksOnce(){this.haveRunSuccessCallbacks||(this.getVariationRecordedCallbackTuples().forEach((e=>{const t=e[0];try{t({experienceId:this.variation.getExperience().getId(),experienceName:this.variation.getExperience().getName(),experienceType:this.variation.getExperience().getType(),variationId:this.variation.getId(),variationName:this.variation.getName(),ccStatus:this.variation.getId()===rt?"holdout":"optimized"})}catch(i){const e=new gi("Caught exception in onVariationRecorded success callback",i);Qr.consoleError(e.message,165)}})),this.haveRunSuccessCallbacks=!0)}scheduleViewabilityOnce(e){void 0===this.viewabilityTask&&(this.viewabilityTask=new io(this.environment,e),this.manager.addTask(this.viewabilityTask))}}class no extends so{toString(){return"RecordCodeVariationTask("+this.variation.getId()+")"}run(){this.startPageviewId!==this.environment.getPageviewId()&&Io.error(`RecordCodeVariationTask executing, but pageviewId has changed from ${this.startPageviewId} to ${this.environment.getPageviewId()}`,85,{variationId:this.variation.getId(),experienceId:this.variation.getExperience().getId()}),this.scheduleViewabilityOnce(ee);const e=j.ofNullable(this.viewabilityTask).map((e=>e.getStatus())).orElse(It.NOT_STARTED);return xt.isDone(e)?e!==It.SUCCEEDED?(Io.info(`Variation ${this.variation.getExperience().getId()}/${this.variation.getId()} aborting record view event since viewability did not succeed`),It.CANCELED):(this.updateCustomerStorageOnce(),this.updateActivityStorageOnce(),this.sendGoogleAnalyticsOnce(),this.sendSegmentAnalyticsOnce(),this.sendMixpanelOnce(),this.sendViewEventOnce(),this.doSuccessCallbacksOnce(),this.getRecordViewStatus()):(Io.debug("RecordCodeVariationTask waiting for viewability"),It.TRY_LATER)}}class ro extends qn{constructor(){super(...arguments),__publicField(this,"changelistTask")}toString(){return`ExecuteChangelistVariationTask(${this.variation.getId()})`}getNotDoneDependencies(){return void 0===this.changelistTask||this.changelistTask.isDone()?[]:[this.changelistTask]}isReadyToExecute(){if(void 0===this.changelistTask){const e=this.passDependencies(),t=this.passExperiencePreconditions(),i=this.passVariationPreconditions(),s=this.hasAppliedPageChanges();return e&&t&&i&&s}return!0}executeVariation(){if(void 0===this.changelistTask){const e=this.variation.getChanges().map(((e,t)=>Hn(e,Dn(this.variation),t,this.attributeData,this.environment,this.browserStorage,this.extensionManager)));this.changelistTask=new Qn(e,(()=>{this.onReadyToRender()}),{variationId:this.variation.getId(),experienceId:this.variation.getExperience().getId()},this.elementObserver),this.manager.addTask(this.changelistTask)}if(this.changelistTask.isDone()){if(this.changelistTask.getStatus()===It.FAILED||this.changelistTask.getStatus()===It.CANCELED)return this.statusModel.setVariation(this.variation,"failChange",!0),It.FAILED;if(this.changelistTask.getStatus()===It.SUCCEEDED)return this.manager.addTask(new no(this.variation,this.environment,this.browserEventLogger,this.customerStorage,this.attributeStorage,this.activityStorage,this.user,this.decisionContext,this.startPageviewId,this.override,this.getVariationRecordedCallbackTuples)),this.statusModel.setVariation(this.variation,"apply",!0),It.SUCCEEDED}return It.TRY_LATER}}class oo{constructor(e,t,i,s){__publicField(this,"experience"),__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"state"),__publicField(this,"condition"),__publicField(this,"audiences"),__publicField(this,"preconditions"),this.id=e,this.name=t.name,this.state=t.state,this.preconditions=t.preconditions,this.condition=i.buildConditionFromVariationOrExperience(t),this.audiences=bo.addVariationToAudiences(this),this.experience=s}getId(){return this.id}getName(){return this.name}isEnabled(){return"live"===this.state}getState(){return this.state}getPreconditions(){return this.preconditions}getCondition(){return j.ofNullable(this.condition)}getAudiences(){return this.audiences}getExperience(){return this.experience}}class ao extends oo{constructor(e,t,i,s){super(e,t,i,s),__publicField(this,"changes");const n=[];void 0!==t.changes&&t.changes.forEach((e=>{n.push(i.buildDomChange(e))})),this.changes=n}buildExecutionTask(e){return new ro(this,e)}getSelectors(e,t,i,s){const n={};return this.changes.forEach(((r,o)=>{Hn(r,Dn(this),o,s,e,i,t).getSelector().ifPresent((e=>{n[e]=!0}))})),Object.keys(n)}getChanges(){return this.changes}}class lo extends qn{toString(){return`ExecuteNoChangeVariationTask(${this.variation.getId()})`}executeVariation(){return this.onReadyToRender(),this.manager.addTask(new no(this.variation,this.environment,this.browserEventLogger,this.customerStorage,this.attributeStorage,this.activityStorage,this.user,this.decisionContext,this.startPageviewId,this.override,this.getVariationRecordedCallbackTuples)),this.statusModel.setVariation(this.variation,"apply",!0),It.SUCCEEDED}}class co extends oo{buildExecutionTask(e){return new lo(this,e)}getSelectors(){return[]}}class uo extends oo{getSelectors(){return["body"]}generateRedirectUrl(e){return this.generateRawRedirectUrl(e).map((t=>this.getRedirectUrlWithMergedQueryParams(t,e)))}getRedirectUrlWithMergedQueryParams(e,t){const i=t.getHostingPageUrl();try{const t=new URL(e,i.getRawUrl());return Object.entries(i.getAllQueryParamsUnsafe()).forEach((([e,i])=>{t.searchParams.has(e)||t.searchParams.set(e,i)})),t.toString()}catch(s){Io.warn(`redirectUrl ${e} is invalid`,268)}return e}}class ho extends so{constructor(e,t,i,s,n,r,o,a,l,c,u,d,h){super(e,t,i,s,n,r,o,a,l,c,u),__publicField(this,"redirectUrl"),__publicField(this,"onReadyToRender"),__publicField(this,"startTimeMs"),__publicField(this,"redirectScheduled",!1),this.redirectUrl=N(d),this.onReadyToRender=N(h)}static get REDIRECT_TIME_BUDGET_MS(){return 3e3}toString(){return"RecordRedirectVariationTask("+this.variation.getId()+")"}cleanup(){this.onReadyToRender()}run(){this.startPageviewId!==this.environment.getPageviewId()&&Io.error(`RecordRedirectVariationTask executing, but pageviewId has changed from ${this.startPageviewId} to ${this.environment.getPageviewId()}`,87,{variationId:this.variation.getId(),experienceId:this.variation.getExperience().getId()}),this.scheduleViewabilityOnce(te);const e=j.ofNullable(this.viewabilityTask).map((e=>e.getStatus())).orElse(It.NOT_STARTED);if(!xt.isDone(e))return Io.debug("RecordCodeVariationTask waiting for viewability"),It.TRY_LATER;if(e!==It.SUCCEEDED)return Io.info(`Variation ${this.variation.getExperience().getId()}/${this.variation.getId()} aborting record view event since viewability did not succeed`),It.CANCELED;this.startTimeMs||(this.startTimeMs=this.environment.getNowUnixTimeMs());let t=this.runSteps();return!xt.isDone(t)&&this.hasExceededTimeBudget()&&(this.scheduleRedirectOnce(),t=It.FAILED),this.doSuccessCallbacksOnce(),t}runSteps(){this.updateCustomerStorageOnce(),this.updateActivityStorageOnce(),this.sendGoogleAnalyticsOnce(),this.sendSegmentAnalyticsOnce(),this.sendMixpanelOnce(),this.sendViewEventOnce();const e=this.getRecordViewStatus();return xt.isDone(e)?(this.scheduleRedirectOnce(),It.SUCCEEDED):e}scheduleRedirectOnce(){if(!this.redirectScheduled){const e=new Jr(this.redirectUrl,this.environment,this.variation);this.manager.addTask(e),this.redirectScheduled=!0,this.environment.getWindow().setTimeout((()=>{this.onReadyToRender()}),this.getTimeRemainingMs()+q)}}getTimeRemainingMs(){const e=this.environment.getNowUnixTimeMs()-this.startTimeMs,t=ho.REDIRECT_TIME_BUDGET_MS;return Io.debug("getTimeRemainingMs elapsed: "+e+", budget: "+t),t-e}hasExceededTimeBudget(){return this.getTimeRemainingMs()<0}}class go extends qn{toString(){return`ExecuteRedirectVariationTask(${this.variation.getId()})`}executeVariation(){const e=this.variation.generateRedirectUrl(this.environment);return e.isPresent()?(this.manager.addTask(new ho(this.variation,this.environment,this.browserEventLogger,this.customerStorage,this.attributeStorage,this.activityStorage,this.user,this.decisionContext,this.startPageviewId,this.override,this.getVariationRecordedCallbackTuples.bind(this),e.get(),this.onReadyToRender.bind(this))),this.statusModel.setVariation(this.variation,"apply",!0),It.SUCCEEDED):(this.onReadyToRender(),It.FAILED)}}class po extends uo{constructor(e,t,i,s){super(e,t,i,s),__publicField(this,"redirect"),void 0!==t.redirect&&(this.redirect=t.redirect)}buildExecutionTask(e){return new go(this,e)}generateRawRedirectUrl(e){var t;let i;try{Io.info(`Variation ${this.getExperience().getId()}/${this.getId()} running redirect code`),i=wt.evalString(null!=(t=this.redirect)?t:""),Io.info(`Redirect URL is ${i}`)}catch(s){const e=new gi(`Variation (${this.getId()}) redirect code execution failed`,s);Io.error(e,18,{variationId:this.getId(),experienceId:this.getExperience().getId()}),i=void 0}return j.ofNullable(i)}}const mo=`${fe}redirect`;class vo extends uo{buildExecutionTask(e){return new go(this,e)}generateRawRedirectUrl(e){var t;let i;const s=this.getExperience().getId(),n=this.getId(),{head:r}=e.getWindow().document,o=r.querySelector(`meta[${_e}${s}][${Ee}${n}]`);return null===o?Io.warn(`Could not find webflowRedirectElement with experienceId ${s} and variationId ${n}`,267):(i=null!=(t=o.getAttribute(mo))?t:void 0,void 0===i&&Io.warn(`webflowRedirectElement with experienceId ${s} and variationId ${n} does not have a attribute value with name ${mo}`,266)),j.ofNullable(i)}}class bo{constructor(e){__publicField(this,"logger"),__publicField(this,"experienceMap",{}),__publicField(this,"pageMap",{}),__publicField(this,"audienceMap",{}),__publicField(this,"eventMap",{}),this.logger=e}static buildStickyConfiguration(e,t){let i,s,n;return void 0!==e&&(void 0!==e.s&&(i=e.s),void 0!==e.r&&(s=e.r),void 0!==e.a&&(n=e.a)),void 0===i&&(i=t.s),void 0===s&&void 0!==t.r&&(s=t.r),void 0===n&&void 0!==t.a&&(n=t.a),new tn(i,s,n)}static addExperienceToAudiences(e){const t=[];return e.getCondition().ifPresent((i=>{if(i instanceof Ye)t.push(bo.addExperienceToAudience(e,i));else if(i instanceof Ke||i instanceof et)i.getConditions().forEach((i=>{if(i instanceof Ye)t.push(bo.addExperienceToAudience(e,i));else if(i instanceof Ze){const s=i.getCondition();s instanceof Ye&&(s.getAudience().addExperience(e),t.push(s.getAudience()))}}));else if(i instanceof Ze){const s=i.getCondition();s instanceof Ye&&(s.getAudience().addExperience(e),t.push(s.getAudience()))}})),t}static addVariationToAudiences(e){const t=[];return e.getCondition().ifPresent((i=>{if(i instanceof Ye)t.push(bo.addVariationToAudience(e,i));else if(i instanceof Ke||i instanceof et)i.getConditions().forEach((i=>{if(i instanceof Ye)t.push(bo.addVariationToAudience(e,i));else if(i instanceof Ze){const s=i.getCondition();s instanceof Ye&&(s.getAudience().addVariation(e),t.push(s.getAudience()))}}));else if(i instanceof Ze){const s=i.getCondition();s instanceof Ye&&(s.getAudience().addVariation(e),t.push(s.getAudience()))}})),t}static addExperienceToAudience(e,t){const i=t.getAudience();return t.getAudience().addExperience(e),i}static addVariationToAudience(e,t){const i=t.getAudience();return t.getAudience().addVariation(e),i}static audienceIdToConditionJson(e){let t=!1,i=e;e.startsWith("!")&&(t=!0,i=e.slice(1));const s={audienceId:i,type:"audience"};let n=s;return t&&(n={type:"logic-not",condition:s}),n}getLogger(){return this.logger}buildCustomer(e){const t=new Ci(e,this);return t.getCampaigns().forEach((e=>{e.getExperiences().forEach((e=>{e.inflateDependsOnExperiences(this.experienceMap)}))})),t}buildCollaborator(e){return new ui(e)}buildCrossOrigin(e){return new di(e)}buildOrigin(e){return new en(e)}buildPage(e,t){const i=this.pageMap[e];if(void 0!==i)return this.logger.warn(`Trying to build page twice ${e}`,1e3,{pageId:e}),i;const s=this.buildTypedPage(e,t);return this.pageMap[e]=s,s}buildTypedPage(e,t){return"matching"===t.type?new $s(e,t,this):"landing"===t.type?new Rs(e,t,this):"shopify"===t.type?new Vs(e,t,this):new $s(e,t,this)}getPage(e){return j.ofNullable(this.pageMap[e]).ifAbsent((()=>{this.logger.error(`Could not find page in builder map ${e}`,1001,{pageId:e})}))}buildAudience(e,t){const i=this.audienceMap[e];if(void 0!==i)return this.logger.warn(`Trying to build audience twice ${e}`,1002,{audienceId:e}),i;const s=new tt(e,t,this);return this.audienceMap[e]=s,s}buildConditionFromVariationOrExperience({audienceIds:e,condition:t}){const i=[];if(void 0!==e&&e.length>0&&e.forEach((e=>{i.push(bo.audienceIdToConditionJson(e))})),void 0!==t&&("logic-and"===t.type?i.push(...t.conditions):i.push(t)),0===i.length)return;const[s]=i;return 1===i.length&&void 0!==s?this.buildCondition(s):this.buildCondition({conditions:i,type:"logic-and"})}buildCondition(e,t){switch(e.type){case"logic-not":return new Ze(e,this);case"logic-and":return new Ke(e,this);case"logic-or":return new et(e,this);case"comparison-number":return new Xe(e,new He(e.attrDefId),Ys({operator:e.operator,argument:e.value}));case"comparison-string":return new Xe(e,new He(e.attrDefId),Js({operator:e.operator,argument:e.value}));case"comparison-enum":return new Xe(e,new He(e.attrDefId),Ks({operator:e.operator,argument:e.value}));case"comparison-boolean":return new Xe(e,new He(e.attrDefId),qs({operator:e.operator,argument:void 0}));case"comparison-array-string":return new Xe(e,new He(e.attrDefId),Qs({operator:e.operator,argument:e.value}));case"comparison-array-enum":return new Xe(e,new He(e.attrDefId),Hs({operator:e.operator,argument:e.value}));case"audience":return new Ye(e,this,t);case"code":return new Je(e);case"activity":return new qe(e,this.buildActivityFilter(e.filter),(()=>this.buildAggregator(e.aggregation)),Ys(e.operation),this.getLogger());default:throw new Error(`Unknown ConditionType: ${e.type}`)}}buildActivityFilter(e){switch(e.type){case"logic-not":return new ai(e,this);case"logic-and":return new ri(e,this);case"logic-or":return new li(e,this);case"comparison-number":return new oi(this.getActivityPathValue(e.fieldName,["number"]),Ys(e.operation));case"comparison-string":return new oi(this.getActivityPathValue(e.fieldName,["string"]),Js(e.operation));case"comparison-enum":return new oi(this.getActivityPathValue(e.fieldName,["string"]),Ks(e.operation));case"comparison-array-enum":return new oi(this.getActivityPathValue(e.fieldName,["array-enum"]),Hs(e.operation));case"comparison-unix-time":return new oi(this.getActivityPathValue(e.fieldName,["number"]),Xs(e.operation));default:throw new Error(`Unknown activity filter type: ${e.type}`)}}buildAggregator(e){switch(e.type){case"count":return new ti;case"sum":return new ni(this.getActivityPathValue(e.fieldName,["number"]));case"mean":return new si(this.getActivityPathValue(e.fieldName,["number"]));case"countDistinct":return new ii(this.getActivityPathValue(e.fieldName,["string","number"]));default:throw new Error(`Unknown aggregator type: ${e.type}`)}}getAudience(e){return j.ofNullable(this.audienceMap[e]).orElseRun((()=>(this.logger.error(`Could not find audience in builder map ${e}`,1003,{audienceId:e}),new tt(e,{name:`Missing Audience ${e}`,code:'throw new Error("Missing audience");'},this))))}buildEvent(e,t){const i=this.eventMap[e];if(void 0!==i)return this.logger.warn(`Trying to build event twice ${e}`,1004,{eventId:e}),i;const s=this.buildTypedEvent(e,t);return this.eventMap[e]=s,s}buildTypedEvent(e,t){if("click"===t.type)return new vi(e,t,this);if("view"===t.type)return new Si(e,t,this);if("custom"===t.type)return new bi(e,t,this);if("shopify"===t.type)return new Ei(e,t,this);if("shopify_server_side"===t.type)return new yi(e,t,this);if("marketo"===t.type)return new _i(e,t,this);if("hubspot"===t.type)return new fi(e,t,this);if("wf_engagement_click"===t.type)return new wi(e,t,this);if("wf_click"===t.type)return new Ii(e,t,this);if("page_leave"===t.type)return new Es(e,t,this);throw new M(`Invalid event type ${t.type}`)}getEvent(e){return j.ofNullable(this.eventMap[e]).ifAbsent((()=>{this.logger.error(`Could not find event in builder map ${e}`,1005,{eventId:e})}))}buildCampaign(e,t,i){return new ci(e,t,this,i)}buildExperience(e,t,i){const s=this.experienceMap[e];if(void 0!==s)return this.logger.warn(`Trying to build experience twice ${e}`,1006,{experienceId:e}),s;const n=this.buildTypedExperience(e,t,i);return this.experienceMap[e]=n,n}buildTypedExperience(e,t,i){return"ab"===t.type?new Ss(e,t,this,i):"rbp"===t.type?new Is(e,t,this,i):new ws(e,t,this,i)}buildMetric(e,t,i,s){return R(Boolean(t)&&void 0===s&&void 0===i||Boolean(s)&&void 0===t&&void 0===i||Boolean(i)&&void 0===s&&void 0===t),"value"===e.type?"static"===e.valueType?new Gs(e,this,t,i,s):new js(e,this,t,i,s):new zs(e,this,t,i,s)}buildUrl(e){return new sn(e,this)}buildVariation(e,t,i){return this.buildTypedVariation(e,Jt(t),i)}buildTypedVariation(e,t,i){return"cl"===t.type?new ao(e,t,this,i):"urlrd"===t.type?new po(e,t,this,i):"wfrd"===t.type?new vo(e,t,this,i):new co(e,t,this,i)}buildControlVariation(e){const t={name:"Intellimize Control",state:"live",preconditions:[]};return this.buildVariation(rt,t,e)}buildControlStickyConfig(e){return bo.buildStickyConfiguration(e,{s:!0})}buildExperienceIncludeStickyConfig(e){return bo.buildStickyConfiguration(e,{s:!0})}buildVariationStickyConfig(e){return bo.buildStickyConfiguration(e,{s:!0,r:302400})}buildGoogleAnalytics4Integration(e){return new As(e)}buildSegmentIntegration(e){return new Ns(e)}buildMixpanelIntegration(e){return new Ds(e)}buildMarketoIntegration(e){return new ks(e)}buildSalesforceIntegration(e){return new Ms(e)}buildShopifyIntegration(e,t,i,s){return new Us(e,t,i,s)}buildFirmographicIntegration(e){return new Ts(e)}buildSixsenseIntegration(e){return new Ws(e)}buildGoogleAdsIntegration(e){return new xs(e)}buildDemandbaseIntegration(e){return new Cs(e)}buildHubspotIntegration(e){return new Fs(e)}buildDomChange(e){return _s(e)}getActivityPathValue(e,t){return i=>{let s=e,n=i;for(;void 0!==n&&void 0!==s;){const i=s.split(".");if(!(i.length>1&&void 0!==i[0])){const i=n[s];let r=typeof i;return h(i)&&i.every((e=>"string"==typeof e))&&(r="array-enum"),t.includes(r)?j.ofNullable(i):(void 0!==i&&this.logger.warn(`Field "${e}" is not an allowed type (wanted ${t.join(", ")}; found ${r})`,1017),j.empty())}n=n[i[0]],s=i.slice(1).join(".")}return j.empty()}}}function fo(e){return new So(e)}const _o={[i.LogLevel.OFF]:"o",[i.LogLevel.ERROR]:"e",[i.LogLevel.WARN]:"w",[i.LogLevel.INFO]:"i",[i.LogLevel.DEBUG]:"d",[i.LogLevel.TRACE]:"t"},Eo=["audienceId","campaignId","experienceId","variationId","eventId","pageId","changeId"],yo={audienceId:"aid",campaignId:"cmid",experienceId:"eid",variationId:"vid",eventId:"ei",pageId:"pid",changeId:"chid"};class So{constructor(e){__publicField(this,"minimumLogLevel"),__publicField(this,"customer"),__publicField(this,"environment"),__publicField(this,"serverContext"),__publicField(this,"user"),this.minimumLogLevel=e}static get LOGGING_APP_STRING(){return"client"}static get PATH(){return"/clientlogger"}configureCustomer(e){this.customer=e}configureEnvironment(e){this.environment=e}configureServerContext(e){this.serverContext=e}configureUser(e){this.user=e}getLevel(){return this.minimumLogLevel}error(e,t,s){this.log(i.LogLevel.ERROR,e,t,s)}warn(e,t,s){this.log(i.LogLevel.WARN,e,t,s)}info(e,t,s){this.log(i.LogLevel.INFO,e,t,s)}debug(e,t,s){this.log(i.LogLevel.DEBUG,e,t,s)}group(e){}groupEnd(){}time(e){}timeEnd(e){}log(e,t,i,s){this.minimumLogLevel<=e&&this.send(__spreadProps(__spreadValues(__spreadValues(__spreadValues({},this.buildCommonPayload()),this.entityIdsToPayload(s)),this.messageToPayload(t)),{app:So.LOGGING_APP_STRING,mc:i,ll:_o[e]}))}buildCommonPayload(){const e={v:Q};return void 0!==this.customer&&(e.cid=this.customer.getId()),void 0!==this.serverContext&&(e.rid=this.serverContext.requestId),void 0!==this.environment&&(e.pvid=this.environment.getPageviewId(),e.hpurl=this.environment.getHostingPageUrl().getRawUrl(),e.lut=this.environment.getNowUnixTimeMs(),e.ltz=this.environment.getTimeZone()),void 0!==this.user&&(e.uid=this.user.getId()),e}messageToPayload(e){return e instanceof gi?{m:e.message,en:e.getCause().name,es:e.getCause().stack}:e instanceof Error?{m:e.message,en:e.name,es:e.stack}:{m:e}}entityIdsToPayload(e){const t={};return void 0!==e&&Eo.forEach((i=>{void 0!==e[i]&&(t[yo[i]]=e[i])})),t}convertToStringValues(e){return Object.assign({},...Object.entries(e).map((([e,t])=>({[e]:String(t)}))))}send(e){const t=dt(se,So.PATH),i=xe(this.convertToStringValues(e));void 0===this.environment?navigator.sendBeacon(t,i):this.environment.sendBeacon(t,i)}}class wo{constructor(){__publicField(this,"consoleLogger"),__publicField(this,"serverLogger"),__publicField(this,"isLogging",!1),this.consoleLogger=Le(),this.serverLogger=fo(ye)}configureCustomer(e){this.serverLogger.configureCustomer(e)}configureEnvironment(e){this.serverLogger.configureEnvironment(e)}configureServerContext(e){this.serverLogger.configureServerContext(e)}configureUser(e){this.serverLogger.configureUser(e)}getLevel(){return this.consoleLogger.getLevel()}error(e,t,i,s){this.isLogging||(this.isLogging=!0,this.consoleLogger.error(e,t,i,s),this.serverLogger.error(e,t,i),this.isLogging=!1)}warn(e,t,i,s){this.isLogging||(this.isLogging=!0,this.consoleLogger.warn(e,t,i,s),this.serverLogger.warn(e,t,i),this.isLogging=!1)}info(e,t,i,s){this.isLogging||(this.isLogging=!0,this.consoleLogger.info(e,t,i,s),this.serverLogger.info(e,t,i),this.isLogging=!1)}debug(e,t,i,s){this.isLogging||(this.isLogging=!0,this.consoleLogger.debug(e,t,i,s),this.serverLogger.debug(e,t,i),this.isLogging=!1)}group(e,t){this.isLogging||(this.isLogging=!0,this.consoleLogger.group(e,t),this.isLogging=!1)}groupEnd(e){this.isLogging||(this.isLogging=!0,this.consoleLogger.groupEnd(e),this.isLogging=!1)}time(e,t){this.isLogging||(this.isLogging=!0,this.consoleLogger.time(e,t),this.isLogging=!1)}timeEnd(e,t){this.isLogging||(this.isLogging=!0,this.consoleLogger.timeEnd(e,t),this.isLogging=!1)}}const Io=new wo,Co="Other";class To{constructor(e,t,i,s,n,r,o){__publicField(this,"environment"),__publicField(this,"attributeStorage"),__publicField(this,"override"),__publicField(this,"customerStorage"),__publicField(this,"integrationDataStorage"),__publicField(this,"user"),__publicField(this,"data"),__publicField(this,"serverContext"),this.environment=e,this.serverContext=t,this.attributeStorage=i,this.override=s,this.customerStorage=n,this.integrationDataStorage=r,this.user=o,this.reinitialize()}reinitialize(){this.data=this.withAttributeDataOverrides({location:this.initializeLocationData(),utmParams:this.initializeUtmParamData(),userAgent:this.initializeUserAgentData(),dayPart:this.environment.getDayPart(),weekPart:this.environment.getWeekPart(),trafficSource:this.initializeTrafficSourceData(),custom:this.initializeCustomData(),urlParam:this.initializeUrlParamData(),userVisitStatus:this.initializeUserVisitStatusData(),userBucket:this.initializeUserBucketData(),marketo:this.initializeMarketoData(),salesforce:this.initializeSalesforceData(),firmographic:this.initializeFirmographicData(),"6sense":this.initializeSixsenseData(),googleAds:this.initializeGoogleAdsData(),demandbase:this.initializeDemandbaseData(),hubspot:this.initializeHubspotData()}),Io.debug(`[AttributeData] Initialized: ${Te(this.data)}`)}getLocationData(){return this.data.location}getUtmParamsData(){return this.data.utmParams}getUserAgentData(){return this.data.userAgent}getDayPartData(){return this.data.dayPart}getWeekPartData(){return this.data.weekPart}getTrafficSourceData(){return this.data.trafficSource}getCustomData(){return this.data.custom}getUrlParamData(){return this.data.urlParam}getUserVisitStatusData(){return this.data.userVisitStatus}getUserBucketData(){return this.data.userBucket}getMarketoData(){return this.data.marketo}getSalesforceData(){return this.data.salesforce}getFirmographicData(){return this.data.firmographic}getSixsenseData(){return this.data["6sense"]}getGoogleAdsData(){return this.data.googleAds}getDemandbaseData(){return this.data.demandbase}getHubspotData(){return this.data.hubspot}getAttributeValue(e){switch(e.getNamespace()){case"standard":switch(e.getName()){case"utm_source":return j.ofNullable(this.getUtmParamsData().utmSource);case"utm_medium":return j.ofNullable(this.getUtmParamsData().utmMedium);case"utm_campaign":return j.ofNullable(this.getUtmParamsData().utmCampaign);case"utm_content":return j.ofNullable(this.getUtmParamsData().utmContent);case"utm_term":return j.ofNullable(this.getUtmParamsData().utmTerm);case"country":return j.ofNullable(this.getLocationData().country);case"state":return j.ofNullable(this.getLocationData().state);case"subdivision":return j.ofNullable(this.getLocationData().subdivision);case"city":return j.ofNullable(this.getLocationData().city);case"postal":return j.ofNullable(this.getLocationData().postal);case"dma":return j.ofNullable(this.getLocationData().dma);case"timezone":return j.ofNullable(this.getLocationData().tz);case"device_type":return j.ofNullable(this.getUserAgentData().deviceType);case"day_part":return j.ofNullable(this.getDayPartData());case"week_part":return j.ofNullable(this.getWeekPartData());case"traffic_source":return j.ofNullable(this.getTrafficSourceData());case"user_visit_status":return j.ofNullable(this.getUserVisitStatusData());case"user_bucket":return j.ofNullable(this.getUserBucketData());default:return Io.error(`Standard attribute name (${e.getName()}) not supported`,214),j.empty()}case"url_param":return j.ofNullable(this.getUrlParamData()[e.getName()]);case"custom":return j.ofNullable(this.getCustomData()[e.getName()]);case"marketo":return j.ofNullable(this.getMarketoData()[e.getName()]);case"salesforce":return j.ofNullable(this.getSalesforceData()[e.getName()]);case"firmographic":return j.ofNullable(this.getFirmographicData()[e.getName()]);case"6sense":return j.ofNullable(this.getSixsenseData()[e.getName()]);case"googleAds":return j.ofNullable(this.getGoogleAdsData()[e.getName()]);case"demandbase":return j.ofNullable(this.getDemandbaseData()[e.getName()]);case"hubspot":return j.ofNullable(this.getHubspotData()[e.getName()]);default:return Io.error(`Attribute namespace (${e.getNamespace()}) not supported`,215),j.empty()}}setServerContext(e){this.serverContext=e,this.reinitialize()}initializeCustomData(){return this.attributeStorage.getFlattenedCustomAttributes()}initializeUrlParamData(){return this.environment.getHostingPageUrl().getAllQueryParamsUnsafe()}initializeUserVisitStatusData(){return this.customerStorage.getUserVisitStatus(this.user)}initializeUserBucketData(){return this.user.getUserBucket()}initializeLocationData(){var e,t,i,s,n,r;const o=null!=(t=null==(e=this.serverContext)?void 0:e.location)?t:{},a=null!=(s=null!=(i=o.subdivision2Iso)?i:o.subdivision1Iso)?s:Co,l=[];void 0!==o.countryIso&&(void 0!==o.subdivision1Iso&&l.push(`${o.countryIso}-${o.subdivision1Iso}`),void 0!==o.subdivision2Iso&&l.push(`${o.countryIso}-${o.subdivision2Iso}`));let c=Co;return void 0!==o.countryIso&&void 0!==o.postalCode&&(c=`${o.countryIso}-${o.postalCode}`),{country:null!=(n=o.countryIso)?n:Co,state:a,subdivision:l,city:null!=(r=o.geonameId)?r:Co,dma:void 0===o.dmaCode?Co:o.dmaCode.toString(),postal:c,tz:this.environment.getTimeZone()}}initializeUserAgentData(){var e,t,i,s,n,r,o,a,l,c,u;const d=null!=(t=null==(e=this.serverContext)?void 0:e.userAgent)?t:{};let h,g,p;switch(d.deviceClass){case"Desktop":case"Set-top box":case"TV":case"Game Console":default:h="D";break;case"Mobile":case"Phone":case"Handheld Game Console":h="P";break;case"Tablet":case"eReader":h="T"}switch(d.agentName){case"Firefox":case"Gecko":case"Camino":case"SeaMonkey":g="Firefox";break;case"Chrome":case"Chrome Webview":case"Chromium":case"Epiphany":g="Chrome";break;case"Edge":case"Edge Webview":g="Edge";break;case"Safari":case"Mobile Safari":g="Safari";break;case"Internet Explorer":case"IE Mobile":case"Internet Explorer Webview":g="IE";break;default:g=Co}switch(d.osName){case"Mac OS X":p="Macintosh";break;case"Windows Phone":p="WindowsPhone";break;case"Windows NT":case"Windows 9x":case"Windows CE":p="Windows";break;case"Android":p="Android";break;case"Linux":case"Fedora":p="Linux";break;case"iOS":p="iOS";break;default:p=Co}return{deviceType:h,browser:g,os:p,deviceClass:null!=(i=d.deviceClass)?i:Co,deviceName:null!=(s=d.deviceName)?s:Co,deviceBrand:null!=(n=d.deviceBrand)?n:Co,osClass:null!=(r=d.osClass)?r:Co,osName:null!=(o=d.osName)?o:Co,osVersion:null!=(a=d.osVersion)?a:Co,agentClass:null!=(l=d.agentClass)?l:Co,agentName:null!=(c=d.agentName)?c:Co,agentVersionMajor:null!=(u=d.agentVersionMajor)?u:Co}}initializeUtmParamData(){const e=this.attributeStorage.getInternalAttributes("user",we);return{utmSource:e.uts,utmMedium:e.utm,utmCampaign:e.utcm,utmContent:e.utcn,utmTerm:e.utt}}initializeTrafficSourceData(){const{ts:e}=this.attributeStorage.getInternalAttributes("user",["ts"]);return null!=e?e:"OT"}initializeMarketoData(){return this.integrationDataStorage.getData("marketo").map((e=>null!=e?e:{})).orElse({})}initializeSalesforceData(){return this.integrationDataStorage.getData("salesforce").map((e=>{const t={};return void 0!==e&&Object.entries(e).forEach((([e,i])=>{Object.entries(i).forEach((([i,s])=>{t[`${e}.${i}`]=s}))})),t})).orElse({})}initializeFirmographicData(){return this.integrationDataStorage.getData("firmographic").map((e=>null!=e?e:{})).orElse({})}initializeSixsenseData(){return this.integrationDataStorage.getData("6sense").map((e=>null!=e?e:{})).orElse({})}initializeGoogleAdsData(){return this.integrationDataStorage.getData("googleAds").map((e=>null!=e?e:{})).orElse({})}initializeDemandbaseData(){return this.integrationDataStorage.getData("demandbase").map((e=>{const t={};return void 0!==e&&Object.entries(e).forEach((([e,i])=>{"custom"===e?Object.entries(i).forEach((([e,i])=>{t[`custom.${e}`]=i})):t[e]=i})),t})).map((e=>null!=e?e:{})).orElse({})}initializeHubspotData(){return this.integrationDataStorage.getData("hubspot").map((e=>{const t={};return void 0!==e&&Object.entries(e).forEach((([e,i])=>{Object.entries(i).forEach((([i,s])=>{t[`${e}.${i}`]=s}))})),t})).orElse({})}withAttributeDataOverrides(e){const t=this.override.getAttributeDataOverrides();return this.overrideObject(e.location,t.location),this.overrideObject(e.utmParams,t.utmParams),this.overrideObject(e.userAgent,t.userAgent),void 0!==t.dayPart&&(e.dayPart=t.dayPart),void 0!==t.weekPart&&(e.weekPart=t.weekPart),void 0!==t.trafficSource&&(e.trafficSource=t.trafficSource),this.overrideObject(e.custom,t.custom),this.overrideObject(e.urlParam,t.urlParam),void 0!==t.userVisitStatus&&(e.userVisitStatus=t.userVisitStatus),void 0!==t.userBucket&&(e.userBucket=t.userBucket),e}overrideObject(e,t){Object.entries(t).forEach((([t,i])=>{void 0!==i&&(e[t]=i)}))}}class xo{constructor(e){__publicField(this,"timestamp"),this.timestamp=e.getNowUnixTime()}get id(){return"missing-policy"}getId(){return this.id}getTimestamp(){return this.timestamp}toJson(){return xe({id:this.id,timestamp:this.timestamp})}}function Ao(e){const t=[...e];let i,s=t.length;for(;s>0;)i=Math.floor(Math.random()*s),s--,[t[s],t[i]]=[t[i],t[s]];return t}class Fo{constructor(e){__publicField(this,"id"),__publicField(this,"timestamp"),__publicField(this,"experiences",{}),this.id=N(e.id),this.timestamp=N(e.timestamp),N(e.experiences),Object.keys(e.experiences).forEach((t=>{this.experiences[t]={modelVersion:N(e.experiences[t].modelVersion),variationId:N(e.experiences[t].variationId)}}))}static buildDefaultPolicy(e,t){const i={};return Object.keys(t.candidates).forEach((e=>{const s=t.candidates[e];void 0!==s&&Ao(s).forEach((t=>{(t.isSticky||void 0===i[e])&&(i[e]={modelVersion:"default-model-version",variationId:t.variationId})}))})),new Fo({id:"default-policy",timestamp:e.getNowUnixTime(),experiences:i})}static buildControlPolicy(e){return new ko(e)}getId(){return this.id}getTimestamp(){return this.timestamp}getExperienceModelVersion(e){return void 0===this.experiences[e]?(Io.info(`PolicyV5 could not find experience ${e}`),"NA"):this.experiences[e].modelVersion}getExperienceVariationId(e){return void 0===this.experiences[e]?(Io.info(`PolicyV5 could not find experience ${e}`),"NA"):this.experiences[e].variationId}toJson(){return xe({id:this.id,timestamp:this.timestamp,experiences:this.experiences})}}class ko extends Fo{constructor(e){super({id:"control-policy",timestamp:e.getNowUnixTime(),experiences:{}})}getExperienceModelVersion(e){return"control-experience"}getExperienceVariationId(e){return rt}}const Po=`${be}NativeIdPath`;class Do{constructor(e,t,i,s,n,r,o,a,l){__publicField(this,"customer"),__publicField(this,"environment"),__publicField(this,"user"),__publicField(this,"attributeStorage"),__publicField(this,"pageContext"),__publicField(this,"serverContext"),__publicField(this,"customerStorage"),__publicField(this,"policy"),__publicField(this,"override"),this.customer=N(e),this.environment=N(t),this.user=N(i),this.attributeStorage=N(s),this.pageContext=N(n),this.serverContext=N(r),this.customerStorage=N(o),this.policy=null!=a?a:new xo(t),this.override=N(l)}setPolicy(e){this.policy=e}sendPageview(){return __async(this,null,(function*(){Io.debug("sendPageview()");const e=this.buildPageviewEvent();return this.send(e,!0)}))}sendContext(e){return __async(this,null,(function*(){Io.debug("sendContext()");const t=this.buildContextEvent(e);return this.send(t,!0)}))}sendConversion(e){return __async(this,null,(function*(){Io.debug("sendConversion()");const t=this.buildConversionEvent(e);return this.send(t,!0)}))}sendView(e,t){return __async(this,null,(function*(){Io.debug("sendView()");const i=this.buildViewEvent(e,t);return this.send(i,!0)}))}sendGoal(e,t,i,s){return __async(this,null,(function*(){Io.debug("sendGoal()");const n=this.buildGoalEvent(e,t,i);return this.send(n,s)}))}static get PATH(){return"/logger"}buildPageviewEvent(){Io.debug("buildPageviewEvent()");const e={eventType:"pv"};return this.buildCommonEvent(e),e.pageviewId=this.environment.getPageviewId(),e.sessionId=this.customerStorage.updateAndGetSessionId(),e.policyId=this.policy.getId(),e.policyTimestamp=this.policy.getTimestamp(),this.customerStorage.getCustomerControlStatus(this.customer).ifPresent((t=>{e.controlStatus=t})),e}buildContextEvent(e){Io.debug("buildContextEvent()");const t={eventType:"ctx",pageviewId:this.environment.getPageviewId(),customerId:this.customer.getId(),userId:this.user.getId()},i=e.getAllData();return Object.keys(i).length>0&&(t.integrationData=i),t}buildConversionEvent(e){Io.debug("buildConversionEvent()");const t={eventType:"c"};return this.buildCommonEvent(t),this.populateConversionInfo(t,e),t.pageviewId=this.environment.getPageviewId(),t.sessionId=this.customerStorage.updateAndGetSessionId(),t.policyId=this.policy.getId(),t.policyTimestamp=this.policy.getTimestamp(),this.customerStorage.getCustomerControlStatus(this.customer).ifPresent((e=>{t.controlStatus=e})),t}buildViewEvent(e,t){Io.debug("buildViewEvent()");const i={eventType:"v"};this.buildBaseEvent(i,e);const s=e.getExperience(),n=s.getCampaign(),r=n.getCustomer();return t.isStickyVariation(e)?this.customerStorage.getVariationPredictionModelVersion(e).ifPresent((e=>{i.modelVersion=e})):i.modelVersion=t.getModelVersion(s.getId()),i.isPrediction=!t.isStickyVariation(e)&&e.getId()!==rt,i.isVariationSticky=t.isStickyVariation(e),i.isCampaignFirstTime=this.customerStorage.updateAndGetIsCampaignFirstTimeView(n,this.environment.getInitializeUnixTime()),i.isVariationFirstTime=this.customerStorage.updateAndGetIsVariationFirstTimeView(e,this.environment.getInitializeUnixTime()),i.pageviewId=this.environment.getPageviewId(),i.sessionId=this.customerStorage.updateAndGetSessionId(),i.policyId=this.policy.getId(),i.policyTimestamp=this.policy.getTimestamp(),this.customerStorage.getCustomerControlStatus(r).ifPresent((e=>{i.controlStatus=e})),i}buildGoalEvent(e,t,i){Io.debug("buildGoalEvent()");const s={eventType:"ocg"};this.buildBaseEvent(s,e);const n=e.getExperience().getCampaign();return s.isCampaignFirstTime=this.customerStorage.updateAndGetIsCampaignFirstTimeGoal(n,t,this.environment.getInitializeUnixTime()),s.isVariationFirstTime=this.customerStorage.updateAndGetIsVariationFirstTimeGoal(e,t,this.environment.getInitializeUnixTime()),this.customerStorage.getVariationPredictionModelVersion(e).ifPresent((e=>{s.modelVersion=e})),s.metricId=t.getId(),s.isGoal=t.isGoal(),s.goalPageviewId=this.environment.getPageviewId(),s.goalSessionId=this.customerStorage.updateAndGetSessionId(),this.populateConversionInfo(s,i),this.customerStorage.getVariationPredictionPageviewId(e).ifPresent((e=>{s.pageviewId=e})),this.customerStorage.getVariationPredictionSessionId(e).ifPresent((e=>{s.sessionId=e})),s.policyId=this.policy.getId(),s.policyTimestamp=this.policy.getTimestamp(),this.customerStorage.getCustomerControlStatus(n.getCustomer()).ifPresent((e=>{s.controlStatus=e})),s}populateConversionInfo(e,t){e.actionId=t.getActionId();const i=t.getEvent();i instanceof mi&&t.getNativeMouseEvent().ifPresent((t=>{this.getNearestAnchorHref(t).ifPresent((t=>{e.clickTargetUrl=t})),this.getWebflowNativeIdPathElement(i,t).ifPresent((t=>{e.webflowNativeIdPath=t.dataset[Po],this.getWebflowEventLabel(t).ifPresent((t=>{e.webflowEventLabel=t}))}))})),e.eventId=t.getEventId(),e.eventInstanceId=t.getEventInstanceId(),t.getEventValue().ifPresent((t=>{e.eventValue=t}))}getNearestAnchorHref(e){var t,i;let s,n=e.target;for(;void 0!==n;){if(n instanceof HTMLAnchorElement){s=null!=(t=n.getAttribute("href"))?t:void 0;break}n=null!=(i=n.parentNode)?i:void 0}return j.ofNullable(s)}getWebflowEventLabel(e){let t;return this.getInnerText(e).ifPresent((e=>{const i=e.slice(0,100).trim().replace(/\s+/g," ");i.length>0&&(t=i)})),void 0===t&&this.getAriaLabel(e).ifPresent((e=>{t=e})),void 0===t&&this.getElementId(e).ifPresent((e=>{t=e})),void 0===t&&this.getChildImgElement(e).ifPresent((i=>{this.getAriaLabel(i).ifPresent((e=>{t=e})),void 0===t&&this.getImgAlt(i).ifPresent((e=>{t=e})),void 0===t&&this.getElementId(i).ifPresent((e=>{t=e})),void 0===t&&e instanceof HTMLAnchorElement&&this.getAnchorHrefAttr(e).ifPresent((e=>{t=e})),void 0===t&&this.getImgSrcAttr(i).ifPresent((e=>{t=e}))})).ifAbsent((()=>{e instanceof HTMLAnchorElement&&this.getAnchorHrefAttr(e).ifPresent((e=>{t=e}))})),j.ofNullable(t)}getChildImgElement(e){return 1===e.children.length&&e.children[0]instanceof HTMLImageElement?j.of(e.children[0]):j.empty()}getInnerText(e){return j.ofNullable(e.innerText)}getAriaLabel(e){return j.ofNullable(e.ariaLabel)}getElementId(e){return j.ofNullable(e.id)}getImgAlt(e){return j.ofNullable(e.alt)}getImgSrcAttr(e){return j.ofNullable(e.getAttribute("src"))}getAnchorHrefAttr(e){const t=e.getAttribute("href");return"#"===t?j.empty():j.ofNullable(t)}getWebflowNativeIdPathElement(e,t){if(void 0!==t.target.dataset[Po])return j.of(t.target);const i=t.target.closest(e.getSelector());return i instanceof HTMLElement&&void 0!==i.dataset[Po]?j.of(i):j.empty()}buildBaseEvent(e,t){const i=t.getExperience(),s=i.getCampaign();this.buildCommonEvent(e),e.campaignId=s.getId(),e.experienceId=i.getId(),e.variationId=t.getId()}buildCommonEvent(e){e.userId=this.user.getId(),e.isFirstTimeUser=this.user.isNewVisitor(),e.userVisitStatus=this.customerStorage.getUserVisitStatus(this.user),e.userBucket=this.user.getUserBucket(),e.intellimizeClientIp=this.serverContext.clientIp,e.customerId=this.customer.getId(),this.environment.getNowVisibilityState().ifPresent((t=>{e.visibilityState=t})),e.clientVersion=Q,e.requestId=this.serverContext.requestId,this.environment.getReferrerUrl().ifPresent((t=>{ht.sanitizeUrl(t.getRawUrl()).ifPresent((t=>{e.referrerUrl=t})),e.referrerUrlEnc=t.getRawUrl()})),ht.sanitizeUrl(this.environment.getHostingPageUrl().getRawUrl()).ifPresent((t=>{e.hostingPageUrl=t})),e.hostingPageUrlEnc=this.environment.getHostingPageUrl().getRawUrl(),e.intellimizeUserAgentDigest=this.serverContext.userAgentDigest,e.time=this.environment.getNowUnixTimeMs(),e.timeZone=this.environment.getTimeZone(),this.environment.getWidowWidth().ifPresent((t=>{e.windowWidth=t})),this.environment.getWidowHeight().ifPresent((t=>{e.windowHeight=t})),this.environment.getScreenOrientation().ifPresent((t=>{e.screenOrientation=t}));const t=this.attributeStorage.getFlattenedInternalAttributes();Object.keys(t).length>0&&(e.internalAttributes=t);const i=this.attributeStorage.getFlattenedCustomAttributes();Object.keys(i).length>0&&(e.customAttributes=i);const s=this.pageContext.getPages().map((e=>e.getId()));s.length>0&&(e.pageIds=s);const n=this.pageContext.getAudiences().map((e=>e.getId()));n.length>0&&(e.audienceIds=n);const r=this.environment.getWebflowPageMetadata();void 0!==r.domain&&(e.webflowDomain=r.domain),void 0!==r.siteId&&(e.webflowSiteId=r.siteId),void 0!==r.pageId&&(e.webflowPageId=r.pageId),void 0!==r.collectionId&&(e.webflowCollectionId=r.collectionId),void 0!==r.itemSlug&&(e.webflowItemSlug=r.itemSlug)}send(e,t){return __async(this,null,(function*(){const i=Date.now();Io.debug(`send(async: ${t}) ${i}`);if(("pv"===e.eventType?this.override.sendPageviewBrowserEvents():this.override.sendNonPageviewBrowserEvents()).orElse(!0)){if(t){const t=dt(se,Do.PATH),i=xe(e);yield this.sendBeacon(t,i)}else yield this.environment.legacySynchronousXhr(se,Do.PATH,{method:"POST",body:xe(e)});Io.debug("BrowserEvent sent")}else Io.debug("BrowserEvent send skipped")}))}sendBeacon(e,t){return __async(this,null,(function*(){return new Promise(((i,s)=>{this.environment.sendBeacon(e,t)?i():s()}))}))}}class Mo{constructor(){__publicField(this,"onVariationRecordedCallbackTuples",[])}getVariationRecordedCallbackTuples(){return this.onVariationRecordedCallbackTuples}addVariationRecordedCallbackTuple(e){this.onVariationRecordedCallbackTuples.push(e)}}class No{constructor(e,t){__publicField(this,"attributeData"),__publicField(this,"activityStorage"),this.attributeData=e,this.activityStorage=t}evalBoolean(e){Io.info(`ConditionEvaluationRuntime.evalBoolean(${e.slice(0,10)})`);const t=wt.evalBoolean(e);return Io.info(`ConditionEvaluationRuntime.evalBoolean() => ${t}`),t}getAttributeValue(e){return this.attributeData.getAttributeValue(e)}getActivities(){return this.activityStorage.getAll()}}const Oo=["mutations"],Ro={debug(e,t,i){Io.debug(e,t,i,Oo)},group(e){Io.group(e,Oo)},groupEnd(){Io.groupEnd(Oo)},time(e){Io.time(e,Oo)},timeEnd(e){Io.timeEnd(e,Oo)}};class Lo{attachObserver(){}detachObserver(){}registerSelectorAndExecute(e,t,i,s){const n=document.querySelectorAll(e);Ro.debug(`Found ${n.length} matching elements`),n.length>0?n.forEach((e=>{Ro.debug(`Processing element: ${ke(e)}`),t(e)})):Ro.debug(`No matching elements for selector: ${e}`)}reset(){}}class $o{constructor(){__publicField(this,"state",0),this.state=0}markHiddenIfUnknown(){0===this.state&&(this.state=1)}markRevealed(){this.state=2}isHidden(){return 1===this.state}isRevealed(){return 2===this.state}}class Vo extends $o{constructor(e,t,i,s,n){super(),__publicField(this,"experience"),__publicField(this,"environment"),__publicField(this,"extensionManager"),__publicField(this,"browserStorage"),__publicField(this,"attributeData"),this.experience=e,this.environment=t,this.extensionManager=i,this.browserStorage=s,this.attributeData=n}static getId(e){return`exp-${e.getId()}`}getId(){return Vo.getId(this.experience)}getSelectors(){const e={};return this.experience.getRealVariations().forEach((t=>{t.getSelectors(this.environment,this.extensionManager,this.browserStorage,this.attributeData).forEach((t=>{e[t]=!0}))})),this.experience.getBoundingSelectors().forEach((t=>{e[t]=!0})),Object.keys(e)}getEntityIds(){return{experienceId:this.experience.getId()}}}class Uo extends $o{constructor(e,t,i,s,n){super(),__publicField(this,"page"),__publicField(this,"environment"),__publicField(this,"extensionManager"),__publicField(this,"browserStorage"),__publicField(this,"attributeData"),this.page=e,this.environment=t,this.extensionManager=i,this.browserStorage=s,this.attributeData=n}static getId(e){return`page-${e.getId()}`}getId(){return Uo.getId(this.page)}getSelectors(){const e={};return this.page.getChanges().forEach(((t,i)=>{Hn(t,Mn(this.page),i,this.attributeData,this.environment,this.browserStorage,this.extensionManager).getSelector().ifPresent((t=>{e[t]=!0}))})),Object.keys(e)}getEntityIds(){return{pageId:this.page.getId()}}}class Wo{constructor(e,t){__publicField(this,"environment"),__publicField(this,"extensionManager"),__publicField(this,"regions",{}),this.environment=e,this.extensionManager=t}registerExperience(e,t,i){const s=Vo.getId(e);return void 0===this.regions[s]&&(this.regions[s]=new Vo(e,this.environment,this.extensionManager,t,i)),this.regions[s]}registerPage(e,t,i){const s=Uo.getId(e);return void 0===this.regions[s]&&(this.regions[s]=new Uo(e,this.environment,this.extensionManager,t,i)),this.regions[s]}getAll(){return Object.values(this.regions)}}const zo=class{constructor(e,t,i=!1){__publicField(this,"localWindow"),__publicField(this,"skipRegionHiding"),__publicField(this,"regionRegistry"),__publicField(this,"experienceRegionsHidden",!1),__publicField(this,"pageRegionsHidden",!1),this.localWindow=e.getWindow(),this.skipRegionHiding=i,this.regionRegistry=new Wo(e,t)}static revealAll(e){zo._revealDocument(e),zo._revealAllRegions(e)}static get ANTI_FLICKER_CLASS_NAME(){return"anti-flicker"}static get REGION_TIMEOUT_MS(){return 3e3}static get RENDERING_ATTRIBUTE_NAME(){return`${zo.ATTRIBUTE_NAME_PREFIX}rendering`}static getRegionAttribute(e){return`${zo.ATTRIBUTE_NAME_PREFIX}${e.getId()}`}static _revealDocument(e){Io.debug(`Hider.revealDocument() - before:${e.documentElement.className}`),e.documentElement.className=e.documentElement.className.replace(new RegExp(` ?${zo.ANTI_FLICKER_CLASS_NAME}`,"g"),""),Io.debug(`Hider.revealDocument() - after:${e.documentElement.className}`)}static _revealAllRegions(e){Io.info(`Removing ${zo.RENDERING_ATTRIBUTE_NAME} attribute`),e.documentElement.removeAttribute(zo.RENDERING_ATTRIBUTE_NAME)}revealDocument(){zo._revealDocument(this.localWindow.document)}revealDocumentIfAllRegionsHidden(){this.experienceRegionsHidden&&this.pageRegionsHidden&&this.revealDocument()}startTimedRegionHider(){Io.debug("Hider.startTimedRegionHider()"),this.localWindow.document.documentElement.setAttribute(zo.RENDERING_ATTRIBUTE_NAME,"true"),this.localWindow.setTimeout((()=>{zo._revealAllRegions(this.localWindow.document),this.regionRegistry.getAll().forEach((e=>{e.isHidden()&&Io.warn(`Region (${e.getId()}) was hidden at timeout`,209,e.getEntityIds())}))}),zo.REGION_TIMEOUT_MS)}hideExperiences(e,t,i){for(const s of e)Io.debug(`Hider - hide experience ${s.getId()}`),this.regionRegistry.registerExperience(s,t,i);this.setRegionHidingCss(),this.experienceRegionsHidden=!0}hidePages(e,t,i){for(const s of e)Io.debug(`Hider - hide page ${s.getId()}`),this.regionRegistry.registerPage(s,t,i);this.setRegionHidingCss(),this.pageRegionsHidden=!0}revealExperience(e,t,i){Io.debug(`Hider - reveal experience ${e.getId()}`),this.revealRegion(this.regionRegistry.registerExperience(e,t,i)),this.revealAllIfExperienceRegionsVisible()}revealPage(e,t,i){Io.debug(`Hider - reveal page ${e.getId()}`),this.revealRegion(this.regionRegistry.registerPage(e,t,i))}revealAllIfExperienceRegionsVisible(){this.regionRegistry.getAll().every((e=>e.isRevealed()))&&zo.revealAll(this.localWindow.document)}revealRegion(e){const t=e.getSelectors();if(t.length>0){const i=this.localWindow.document.querySelectorAll(t.join(", "));Array.prototype.forEach.call(i,(t=>{t.setAttribute(`${zo.getRegionAttribute(e)}`,"true")}))}e.markRevealed()}setRegionHidingCss(){if(this.skipRegionHiding)return;const e=[];this.regionRegistry.getAll().forEach((t=>{t.getSelectors().forEach((i=>{const s=`html[${zo.RENDERING_ATTRIBUTE_NAME}] ${i}:not([${zo.getRegionAttribute(t)}])`;e.push(s,`${s} *`)}))}));const t=e.length>0?`${e.join(", ")} { visibility: hidden !important; opacity: 0 !important; }`:"";wt.injectCss(t,"anti-flicker-regions",this.localWindow.document),this.regionRegistry.getAll().forEach((e=>{e.markHiddenIfUnknown()}))}};let jo=zo;__publicField(jo,"ATTRIBUTE_NAME_PREFIX","data-intellimize-anti-flicker-");const Go=2,Bo=1,Ho=Bo,Qo=class{constructor(){__publicField(this,"mutationObserver"),__publicField(this,"mutationHandlers",{}),__publicField(this,"currentUrl"),this.mutationObserver=new MutationObserver((e=>{if(Object.keys(this.mutationHandlers).length>0){if(Ro.group("MutationObserver.observe() - window.location.href: "+window.location.href),this.currentUrl||(this.currentUrl=window.location.href),this.currentUrl!==window.location.href)return Ro.debug("MutationObserver skip processing since URL changed"),void Ro.groupEnd();Qo.containsValidMutations(e)?(Ro.debug("mutationList contains at least one valid mutation; processing store"),this.processStore()):Ro.debug("mutationList contains no valid mutations; skipping store processing"),Ro.groupEnd()}})),this.reset()}static get CALLBACK_MAX_COUNT(){return 25}static get MISSING_ELEMENT_MAX_COUNT(){return 5}static get CALLBACK_THROTTLE_MS(){return 50}static selectorExists(e){try{return Boolean(document.querySelector(e))}catch(t){return!1}}static isProcessed(e,t){var i,s,n,r;switch(Ho){case Bo:return"string"==typeof(null==(i=e.imizeObserverProcessed)?void 0:i[t])||!0===(null==(s=e.imizeObserverProcessed)?void 0:s[t])?(Ro.debug('isProcessed (OPT_CHECK_BOOL): imizeObserverProcessed is "true"'),!0):(Ro.debug('isProcessed (OPT_CHECK_BOOL): imizeObserverProcessed is NOT "true"'),!1);case Go:return"string"==typeof(null==(n=e.imizeObserverProcessed)?void 0:n[t])||!0===(null==(r=e.imizeObserverProcessed)?void 0:r[t])?e.imizeObserverProcessed[t]===e.outerHTML?(Ro.debug("isProcessed (OPT_COMPARE_HTML): imizeObserverProcessed outerHTML matches"),!0):(Ro.debug("isProcessed (OPT_COMPARE_HTML): imizeObserverProcessed outerHTML DOES NOT match"),Ro.debug(`outerHTML: ${e.outerHTML}`),Ro.debug(`imizeObserverProcessed: ${e.imizeObserverProcessed[t]}`),e.imizeObserverProcessed[t]=!1,!1):(Ro.debug("isProcessed (OPT_COMPARE_HTML): imizeObserverProcessed does not exist on the element"),!1);default:return Ro.debug("isProcessed (OPT_ALWAYS_CALLBACK): skipping check"),!1}}static setIsProcessed(e,t){switch(void 0===e.imizeObserverProcessed&&(e.imizeObserverProcessed={}),Ho){case Bo:e.imizeObserverProcessed[t]=!0;break;case Go:e.imizeObserverProcessed[t]=e.outerHTML}}static isValidNodeNameMutation(e){var t;if(Qo.INVALID_NODE_NAMES.includes(e.target.nodeName))return Ro.debug(`Invalid mutation - Node is one of ${Te(Qo.INVALID_NODE_NAMES)}`),!1;if(!0===(null==(t=e.attributeName)?void 0:t.startsWith(jo.ATTRIBUTE_NAME_PREFIX)))return!1;if("childList"===e.type){if(Array.prototype.every.call([...Array.prototype.slice.call(e.addedNodes),...Array.prototype.slice.call(e.removedNodes)],(e=>Qo.INVALID_NODE_NAMES.includes(e.nodeName))))return Ro.debug("Invalid mutation - All nodes in child list contain one of "+Te(Qo.INVALID_NODE_NAMES)),!1}return!0}static isUnchangedAttributeMutation(e){const{target:t,type:i,attributeName:s,oldValue:n}=e;if(t instanceof HTMLElement&&"attributes"===i&&s){const e=t.attributes.getNamedItem(s);if(null!==e&&e.value===n)return Ro.debug(`Invalid mutation - value for attribute "${s}" hasn't changed (value: "${n}")`),!0}return!1}static isStatusModuleNode(e){const t="intellimize____status-module-root";return e instanceof HTMLElement&&(e.id===t?(Ro.debug("Invalid mutation - Node is part of the status module"),!0):null!==e.parentNode&&Qo.isStatusModuleNode(e.parentNode))}static containsValidMutations(e){Ro.group("containsValidMutations()");const t=e.every((e=>(Ro.debug(`Mutation: ${Fe(e)}`),!(Qo.isValidNodeNameMutation(e)&&!Qo.isUnchangedAttributeMutation(e)&&!Qo.isStatusModuleNode(e.target))||(Ro.debug("Found valid mutation"),!1))));return Ro.groupEnd(),!t}registerSelectorAndExecute(e,t,i,s){if(!Qo.selectorExists(e))throw new Error(`Selector "${e}" does not exist in the DOM`);const n=Dt();this.mutationHandlers[n]={selector:e,callback:t,options:i,startTime:new Date,mutationCnt:0,missingElementCnt:0,entityIds:s},Ro.group(`registerSelectorAndExecute(${n})`),Ro.debug("Manually calling handleObservation()"),this.detachObserver(),this.handleObservation(n,!1),this.attachObserver(),Ro.groupEnd()}attachObserver(){Ro.debug("Attaching observer to document"),this.mutationObserver.observe(document.documentElement,Qo.observerOpts)}detachObserver(){Ro.debug("Detaching observer from document"),this.mutationObserver.disconnect()}reset(){Ro.debug("Resetting ElementObserver state"),this.mutationHandlers={},this.currentUrl=void 0,this.detachObserver()}processStore(){Ro.group("ReapplyElementObserver.processStore()"),Ro.debug(`mutationHandlers: ${Te(this.mutationHandlers)}`),this.detachObserver(),Object.keys(this.mutationHandlers).forEach((e=>{this.handleObservation(e,!0)})),this.attachObserver(),Ro.groupEnd()}handleObservation(e,t){const i=this.mutationHandlers[e];if(Ro.group(`handleObservation(${e})`),t&&i.options.observationTimeMs&&Date.now()-i.startTime.getTime()>i.options.observationTimeMs)return 0===i.mutationCnt?void 0!==i.options.onTimeout&&(Io.error(`MutationHandler timed out for ${i.selector}. observationTimeMs (${i.options.observationTimeMs}) has passed.`,140,i.entityIds),i.options.onTimeout()):Io.warn(`Observation cancelled for ${i.selector}. observationTimeMs (${i.options.observationTimeMs}) has passed.`,141,i.entityIds),this.cancelObservation(e),void Ro.groupEnd();if(i.mutationCnt>=Qo.CALLBACK_MAX_COUNT)return Ro.debug(`Reached CALLBACK_MAX_COUNT (${Qo.CALLBACK_MAX_COUNT})`),this.cancelObservation(e),void Ro.groupEnd();if(void 0!==i.lastCallbackTime){const e=Date.now()-i.lastCallbackTime.getTime();if(e<Qo.CALLBACK_THROTTLE_MS)return Ro.debug(`Throttling callback (${Qo.CALLBACK_THROTTLE_MS}ms). Only (${e})ms have elapsed`),void Ro.groupEnd()}const s=document.querySelectorAll(i.selector);if(Ro.debug(`Found ${s.length} matching elements`),s.length>0){const n=t=>!Qo.isProcessed(t,e)||void 0!==i.options.shouldReapply&&i.options.shouldReapply(t);Array.prototype.forEach.call(s,(s=>{if(Ro.debug(`Processing element: ${ke(s)}`),!t||n(s)){Ro.debug("isProcessed: false");let n="Triggering callback for element";t&&(i.mutationCnt+=1,i.lastCallbackTime=new Date,n+=` (mutationCnt: ${i.mutationCnt})`),Ro.debug(n),i.callback(s),Qo.setIsProcessed(s,e),i.options.once&&this.cancelObservation(e)}else Ro.debug("isProcessed: true (skipping)")}))}else Io.warn(`Could not find any matching elements for ${i.selector}`,139,i.entityIds),i.missingElementCnt+=1,i.missingElementCnt>=Qo.MISSING_ELEMENT_MAX_COUNT&&(Ro.debug(`Reached MISSING_ELEMENT_MAX_COUNT (${Qo.MISSING_ELEMENT_MAX_COUNT})`),this.cancelObservation(e));Ro.groupEnd()}cancelObservation(e){delete this.mutationHandlers[e]}};let qo=Qo;__publicField(qo,"INVALID_NODE_NAMES",["HTML","SCRIPT","LINK","STYLE","HEAD","IFRAME","TITLE","META"]),__publicField(qo,"observerOpts",{subtree:!0,childList:!0,attributes:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0});class Ko{constructor(e){__publicField(this,"rawUrl"),__publicField(this,"urlObject"),this.rawUrl=N(e),this.urlObject=new URL(e)}getRawUrl(){return this.rawUrl}getOrigin(){return this.urlObject.origin}getQueryParam(e,t){let i=j.ofNullable(this.urlObject.searchParams.get(e));return i.isPresent()&&!t(i.get())&&(Io.error(`Validator failed for ${e}`,28),i=j.empty()),i}getAllQueryParamsUnsafe(){const e={};for(const[t,i]of this.urlObject.searchParams.entries())t.length>0&&i.length>0&&!Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=i);return e}}var Yo=(e=>(e[e.LN=0]="LN",e[e.EA=1]="EA",e[e.DT=2]="DT",e[e.EE=3]="EE",e[e.NT=4]="NT",e))(Yo||{}),Jo=(e=>(e[e.WD=0]="WD",e[e.WE=1]="WE",e))(Jo||{});const Xo=`${be}Domain`,Zo=`${be}Site`,ea=`${be}Page`,ta=`${be}Collection`,ia=`${be}ItemSlug`,sa=`${be}Experiences`;class na{constructor(e,t){__publicField(this,"localWindow"),__publicField(this,"nativeFetch"),__publicField(this,"nativeSendBeacon"),__publicField(this,"timeZone"),__publicField(this,"date"),__publicField(this,"windowWidth"),__publicField(this,"windowHeight"),__publicField(this,"webflowPageMetadata"),__publicField(this,"pageviewId"),__publicField(this,"visibilityChangeName"),__publicField(this,"isHidden"),__publicField(this,"hostingPageUrl"),__publicField(this,"referrerUrl"),this.nativeFetch=e.fetch.bind(e),this.nativeSendBeacon=e.navigator.sendBeacon.bind(e.navigator),this.timeZone=t,this.localWindow=e,this.visibilityChangeName="visibilitychange",this.isHidden=()=>!1,this.reinitialize()}reinitialize(){Io.debug("Environment.reinitialize()"),this.hostingPageUrl=new Ko(this.localWindow.location.href),this.referrerUrl=b(this.localWindow.document.referrer)?new Ko(this.localWindow.document.referrer):void 0,void 0!==this.localWindow.document.hidden?(this.isHidden=()=>this.localWindow.document.hidden,this.visibilityChangeName="visibilitychange"):void 0!==this.localWindow.document.msHidden?(this.isHidden=()=>this.localWindow.document.msHidden,this.visibilityChangeName="msvisibilitychange"):void 0!==this.localWindow.document.webkitHidden&&(this.isHidden=()=>this.localWindow.document.webkitHidden,this.visibilityChangeName="webkitvisibilitychange"),this.windowWidth=this.localWindow.innerWidth,this.windowHeight=this.localWindow.innerHeight,this.date=this.getNowDate(),this.pageviewId=Dt(),this.reinitializeWebflowPageMetadata()}getHostingPageUrl(){return this.hostingPageUrl}getReferrerUrl(){return j.ofNullable(this.referrerUrl)}hasHostingPageUrlChanged(){const e=new Ko(this.localWindow.location.href);return this.hostingPageUrl.getRawUrl()!==e.getRawUrl()}getTimeZone(){return this.timeZone}getDayPart(){const e=this.getInitializeDate().getHours();let t;return t=e>=0&&e<7?0:e>=7&&e<10?1:e>=10&&e<17?2:e>=17&&e<20?3:4,Yo[t]}getWeekPart(){const e=this.getInitializeDate().getDay();return Jo[0===e||6===e?1:0]}getInitializeDate(){return new Date(this.date.getTime())}getInitializeUnixTime(){return Math.round(this.date.getTime()/q)}getNowDate(){return new Date}getNowUnixTime(){return Math.round(this.getNowUnixTimeMs()/q)}getNowUnixTimeMs(){return this.getNowDate().getTime()}getWidowWidth(){return j.ofNullable(this.windowWidth)}getWidowHeight(){return j.ofNullable(this.windowHeight)}getScreenOrientation(){return void 0!==this.windowHeight&&void 0!==this.windowWidth?this.windowWidth>this.windowHeight?j.of("landscape"):j.of("portrait"):j.empty()}getPageviewId(){return this.pageviewId}writeCookie(e){Io.debug("Environment.writeCookie("+e+")"),this.localWindow.document.cookie=e}readAllCookies(){return j.ofNullable(this.localWindow.document.cookie)}readCookie(e){const t=e+"=";let i=j.empty();return this.readAllCookies().ifPresent((e=>{const s=e.split(";");for(let n of s){for(;n.startsWith(" ");)n=n.slice(1);n.startsWith(t)&&(i=j.of(n.slice(t.length)))}})),i}writeLocalStorage(e,t){this.localWindow.localStorage.setItem(e,t)}readLocalStorage(e){return j.ofNullable(this.localWindow.localStorage.getItem(e))}deleteLocalStorage(e){this.localWindow.localStorage.removeItem(e)}writeSessionStorage(e,t){this.localWindow.sessionStorage.setItem(e,t)}readSessionStorage(e){return j.ofNullable(this.localWindow.sessionStorage.getItem(e))}deleteSessionStorage(e){this.localWindow.sessionStorage.removeItem(e)}readLocalStorageMatching(e){const t={};return Object.keys(this.localWindow.localStorage).forEach((i=>{e.test(i)&&(t[i]=this.readLocalStorage(i).get())})),t}getWindow(){return this.localWindow}getNowVisibilityState(){return"document"in this.localWindow&&"visibilityState"in this.localWindow.document?j.ofNullable(this.localWindow.document.visibilityState):j.empty()}isNowDocumentHidden(){return"document"in this.localWindow?j.ofNullable(this.isHidden()):j.empty()}addListener(e,t){this.localWindow.addEventListener(e,t)}addListenerVisibilityChange(e){this.localWindow.document.addEventListener(this.visibilityChangeName,e,{once:!0,capture:!1})}addUnloadHandler(e){this.localWindow.addEventListener("beforeunload",e,!1)}redirect(e){this.localWindow.document.location.replace(e)}generateActionId(){return this.getNowUnixTime()+"-"+Nt()}injectScript(e,t=!1){const i=this.localWindow.document.createElement("script");i.async=t,i.src=e;const s=this.localWindow.document.querySelectorAll("script")[0];s.parentNode.insertBefore(i,s)}sendBeacon(e,t){return this.nativeSendBeacon(e,t)}fetch(e,t){return __async(this,arguments,(function*(e,t,i={}){const s=dt(e,t);return this.nativeFetch(s,i).then((e=>{if(!e.ok)throw new ra(s,e.status);if(204!==e.status)return e.json()}))}))}legacySynchronousXhr(e,t){return __async(this,arguments,(function*(e,t,i={}){return new Promise(((s,n)=>{var r;const o=dt(e,t),a=new XMLHttpRequest;a.open(null!=(r=i.method)?r:"GET",o,!1),a.addEventListener("load",(()=>{a.status>=200&&a.status<=299?s():n(new ra(o,a.status))})),a.addEventListener("error",(()=>{n(new ra(o,a.status))})),a.send(i.body)}))}))}getWebflowPageMetadata(){return this.webflowPageMetadata}reinitializeWebflowPageMetadata(){var e;const t=this.localWindow.document.documentElement.dataset[Xo],i=this.localWindow.document.documentElement.dataset[Zo],s=this.localWindow.document.documentElement.dataset[ea],n=this.localWindow.document.documentElement.dataset[ta],r=this.localWindow.document.documentElement.dataset[ia],o=(null!=(e=this.localWindow.document.documentElement.dataset[sa])?e:"").split(",");this.webflowPageMetadata={domain:t,pageId:s,siteId:i,collectionId:n,itemSlug:r,experienceIds:o}}}class ra extends Error{constructor(e,t){super(`(${t}) ${e.toString()}`),this.name="JsonFetchError"}}const oa=()=>{const e={};return{getExtension:t=>j.ofNullable(e[t]),registerExtension(t){e[t.getName()]=t}}},aa=e=>{if(on(e)){const t=Object.keys(e);if(4===t.length){if(0===cn(["p","r","push","ready"],t).length&&nn(e.p)&&nn(e.r)&&an(e.push)&&an(e.ready))return!0}}return!1},la=e=>{if(on(e)){const t=Object.keys(e);if(2===t.length){if(0===cn(["r","ready"],t).length&&nn(e.r)&&an(e.ready))return!0}}return!1};class ca{constructor(e){__publicField(this,"environment"),__publicField(this,"callQueue"),__publicField(this,"readyCallbackQueue"),this.environment=e,this.callQueue=[],this.readyCallbackQueue=[]}initialize(){const e=this.environment.getWindow();if(void 0!==e.intellimize)if(nn(e.intellimize))this.setCallQueue(e.intellimize);else if(on(e.intellimize))if(aa(e.intellimize)){const t=e.intellimize;this.setCallQueue(t.p),this.addToReadyCallbackQueue(t.r)}else Qr.consoleError("window.intellimize is an object that does not match the expected definition",116);else Qr.consoleError("window.intellimize is not an object or an array",117);if(void 0!==e.wf)if(on(e.wf))if(la(e.wf)){const t=e.wf;this.addToReadyCallbackQueue(t.r)}else Qr.consoleError("window.wf is an object that does not match the expected definition",264);else Qr.consoleError("window.wf is not an object",263);e.intellimize={ready:this.ready.bind(this),push:this.push.bind(this)},e.wf={ready:this.ready.bind(this)}}extractCallQueue(){const{callQueue:e}=this;return this.callQueue=[],e}extractReadyCallbackQueue(){const{readyCallbackQueue:e}=this;return this.readyCallbackQueue=[],e}ready(e){Qr.validateReadyCallback(e)&&(Io.debug("Registering ready() callback"),this.readyCallbackQueue.push(e))}push(e){Qr.validatePushCommand(e)&&(Io.debug("Adding command to call queue"),this.callQueue.push([...e]))}setCallQueue(e){Io.debug("Storing callQueue"),this.callQueue=[],e.forEach((e=>{Qr.validatePushCommand(e)&&this.callQueue.push([...e])}))}addToReadyCallbackQueue(e){Io.debug("Appending to readyCallbackQueue"),e.forEach((e=>{Qr.validateReadyCallback(e)&&this.readyCallbackQueue.push(e)}))}}class ua{constructor(e,t,i,s,n,r,o,a,l,c,u){__publicField(this,"customer"),__publicField(this,"user"),__publicField(this,"environment"),__publicField(this,"extensionManager"),__publicField(this,"serverContext"),__publicField(this,"taskManager"),__publicField(this,"browserStorage"),__publicField(this,"customerStorage"),__publicField(this,"externalApi"),__publicField(this,"attributeData"),__publicField(this,"elementObserver"),__publicField(this,"storageKey"),this.customer=e,this.user=t,this.environment=i,this.extensionManager=s,this.serverContext=n,this.taskManager=r,this.browserStorage=o,this.customerStorage=a,this.externalApi=l,this.attributeData=c,this.elementObserver=u,this.storageKey=ne+e.getId()}initialize(){if(!this.externalApi.isInitialized)throw new Error("ExternalApi needs to be initialized before calling InternalApi.initialize()");const e=this.environment.getWindow(),{intellimize:t}=e;void 0!==t?(t.plugins={},t.setLocalState=(e,t)=>{Io.info(`intellimize.setLocalState(${e}, ${t})`),this.setLocalState(e,t)},t.getLocalState=e=>{const t=this.getLocalState(e);return Io.info(`intellimize.getLocalState(${e}) => ${t}`),t},t.deleteLocalState=e=>{Io.info(`intellimize.deleteLocalState(${e})`),this.deleteLocalState(e)},t.getSessionId=()=>(Io.info("intellimize.getSessionId()"),this.getSessionId()),t.getUserId=()=>(Io.info("intellimize.getUserId()"),this.getUserId()),t.getPageviewId=()=>(Io.info("intellimize.getPageviewId()"),this.getPageviewId()),t.logErr=e=>{Io.error(`Customer error: ${e}`,1)},t.log=(e,t,s)=>{const n=1e4;s&&(!/^\d{5}$/.test(`${s}`)||s<10001||s>10999)&&(Io.error(`Called intellimize.log with an invalid message code. (Wanted: 10001 < code < 10999. Found: ${s})`,998),s=n);const r=null!=s?s:n;switch(t){case i.LogLevel.TRACE:case i.LogLevel.DEBUG:return void Io.debug(e,r);case i.LogLevel.INFO:return void Io.info(e,r);case i.LogLevel.WARN:return void Io.warn(e,r);case i.LogLevel.ERROR:return void Io.error(e,r);default:Io.error(`Called intellimize.log with an invalid LogLevel (${t}). Treating as "debug".`,999),Io.debug(e,r)}},t.applyChange=e=>{const t=Hn(_s(e),Nn(e),0,this.attributeData,this.environment,this.browserStorage,this.extensionManager);return t.isReadyToApply()?(t.apply((()=>{}),this.elementObserver),F.APPLIED):F.UNAPPLIED},t.undoChange=e=>(Hn(_s(e),Nn(e),0,this.attributeData,this.environment,this.browserStorage,this.extensionManager).undo(),F.UNAPPLIED),t.hasChangeData=e=>In(e),t.getChangeTypeData=(e,t)=>Pn(e,t),t.hasStarted=()=>{const e=this.taskManager.hasStarted();return Io.debug(`intellimize.hasStarted() => ${e}`),e},t.isDone=()=>{const e=this.taskManager.isDone();return Io.debug(`intellimize.isDone() => ${e}`),e},t.onDone=e=>{Io.debug("intellimize.onDone(callbackFunction)"),this.taskManager.onDone(e)},t.isRestarting=()=>{const e=this.taskManager.getClient().isRestarting();return Io.debug(`intellimize.isRestarting() => ${e}`),e},Io.getLevel()<=i.LogLevel.INFO&&(e[e.atob("aWNqc24=")]=this.customer.getData(),e[e.atob("aXBqc24=")]=()=>this.browserStorage.read(le+this.customer.getId()).map((e=>Ae(Me(this.environment,e)))).orElse({})),this.reinitialize()):Io.error("window.intellimize is undefined: Cannot initialize InternalApi",219)}reinitialize(){this.exposeAttributeData()}setLocalState(e,t){const i=this.readState();i[e]=t,this.writeState(i)}getLocalState(e){return this.readState()[e]}deleteLocalState(e){const t=this.readState();delete t[e],this.writeState(t)}getSessionId(){return this.customerStorage.updateAndGetSessionId()}getUserId(){return this.user.getId()}getPageviewId(){return this.environment.getPageviewId()}readState(){let e={};return this.browserStorage.read(this.storageKey).ifPresent((t=>{try{e=Ae(t)}catch(i){const e=new gi("Could not parse internal api storage",i);Io.error(e,33)}})),e}writeState(e){const t=xe(e);this.browserStorage.write(this.storageKey,t)}exposeAttributeData(){var e;const t=this.environment.getWindow(),i=e=>{if(void 0!==e.cityName)return e.cityName.replace(/\s/g,"").toUpperCase()};t.iiloc={country:this.serverContext.location.countryIso,region:null!=(e=this.serverContext.location.subdivision2Iso)?e:this.serverContext.location.subdivision1Iso,city:i(this.serverContext.location),dma:this.serverContext.location.dmaCode,postal:this.serverContext.location.postalCode,tz:this.environment.getTimeZone()};const s=this.attributeData.getUserAgentData(),n=this.attributeData.getTrafficSourceData();t.icntxtlftrs={IP:this.serverContext.clientIp,D:s.deviceType,B:s.browser,OS:s.os,DC:s.deviceClass,DN:s.deviceName,DB:s.deviceBrand,OC:s.osClass,ON:s.osName,OV:s.osVersion,AC:s.agentClass,AN:s.agentName,AV:s.agentVersionMajor,TS:n};const r=this.attributeData.getUtmParamsData();t.iutmprms={uts:r.utmSource,utm:r.utmMedium,utcm:r.utmCampaign,utcn:r.utmContent,utt:r.utmTerm}}}const da="UTC";let ha,ga=!0;function pa(e){var t;if(void 0!==ha)return ha;if(ga){if("undefined"===(null==(t=e.Intl)?void 0:t.DateTimeFormat))return void ma();const i=e.Intl.DateTimeFormat();return void 0===i||void 0===i.resolvedOptions?void ma():(ha=e.Intl,ha)}}function ma(){ga=!1,Io.error("Intl.DateTimeFormat().resolvedOptions() is not supported by the browser",1014)}function va(e){const t=pa(e);let i="";return void 0!==t&&(i=t.DateTimeFormat().resolvedOptions().timeZone),void 0===i||""===i?da:i}class ba{constructor(e,t){__publicField(this,"isEditorMode"),__publicField(this,"_shouldRun"),__publicField(this,"_originAllowed"),__publicField(this,"experienceVariations",{}),__publicField(this,"_allPagesLive"),__publicField(this,"_allAudiencesLive"),__publicField(this,"_allEventsLive"),__publicField(this,"_passExperienceAudience"),__publicField(this,"_passVariationAudience"),__publicField(this,"_isControl"),__publicField(this,"_saveCustomerStorage"),__publicField(this,"_sendBrowserEvents"),__publicField(this,"_sendGoogleAnalytics"),__publicField(this,"_sendSegmentAnalytics"),__publicField(this,"_sendMixpanel"),__publicField(this,"_showStatusModule"),__publicField(this,"_showBasesite"),__publicField(this,"_expires"),__publicField(this,"attributeData",{location:{},utmParams:{},userAgent:{},dayPart:void 0,weekPart:void 0,trafficSource:void 0,custom:{},urlParam:{},userVisitStatus:void 0,userBucket:void 0}),__publicField(this,"_requestAnimationFrame");const i=ut(t,e.getHostingPageUrl().getOrigin());i.isPresent()&&!i.get()&&(this._originAllowed=!1);const s=e.getHostingPageUrl().getQueryParam("intellimize_no_run",jt("true")).isPresent(),n=e.getHostingPageUrl().getQueryParam("imize_editor",jt("true")).isPresent();if(n)return void(this.isEditorMode=!0);s&&!n&&(this._shouldRun=!1);const r=e.getWindow().iOverride;if(void 0!==r){if(void 0!==r.experienceVariations){const{experienceVariations:e}=r;Object.keys(e).forEach((t=>{var i;null==(i=e[t])||i.forEach((e=>{t in this.experienceVariations||(this.experienceVariations[t]={}),this.experienceVariations[t][e]=!0}))}))}this._allPagesLive=r.allPagesLive,this._allAudiencesLive=r.allAudiencesLive,this._allEventsLive=r.allEventsLive,this._passExperienceAudience=r.passExperienceAudience,this._passVariationAudience=r.passVariationAudience,this._isControl=r.isControl,this._saveCustomerStorage=r.saveCustomerStorage,this._sendBrowserEvents=r.sendBrowserEvents,this._sendGoogleAnalytics=r.sendGoogleAnalytics,this._sendSegmentAnalytics=r.sendSegmentAnalytics,this._sendMixpanel=r.sendMixpanel,this._showStatusModule=r.showStatusModule,this._expires=r.expires}e.readLocalStorage("intellimize_override").ifPresent((e=>{let t={};try{t=Ae(e)}catch(i){const e=new gi("Could not parse override",i);Io.error(e,192)}void 0!==t.raf&&(this._requestAnimationFrame=t.raf)})),e.getHostingPageUrl().getQueryParam("iev",jt("[0-9;:]+")).ifPresent((e=>{this.experienceVariations={},e.split(";").forEach((t=>{const i=t.split(":");if(2===i.length){const e=i[0],t=i[1];e in this.experienceVariations||(this.experienceVariations[e]={}),this.experienceVariations[e][t]=!0}else Io.error(`Override could not parse iev ${e}`,34)})),void 0!==r&&0!==Object.keys(r).length||(this._passExperienceAudience=!0,this._passVariationAudience=!0,this._saveCustomerStorage=!1,this._sendBrowserEvents=!1),this._isControl=!1,this._sendGoogleAnalytics=!1,this._sendSegmentAnalytics=!1,this._sendMixpanel=!1,this._showStatusModule=!0})),e.getHostingPageUrl().getQueryParam("showBasesite",jt("1")).ifPresent((()=>{this._showBasesite=!0,this._showStatusModule=!0})),e.getHostingPageUrl().getQueryParam("iea",zt).ifPresent((e=>{"1"===e&&(this._passExperienceAudience=void 0)})),e.getHostingPageUrl().getQueryParam("iva",zt).ifPresent((e=>{"1"===e&&(this._passVariationAudience=void 0)})),e.getHostingPageUrl().getQueryParam("is",zt).ifPresent((e=>{"1"===e?this._showStatusModule=!0:"0"===e&&(this._showStatusModule=!1)}));let o=!1;[["ictxt_city","city","([A-Z0-9]){1,40}"],["ictxt_region","state","([a-zA-Z0-9]){1,40}"],["ictxt_country","country","[A-Z]{2}"],["ictxt.city","city","([A-Z0-9]){1,40}"],["ictxt.region","state","([a-zA-Z0-9]){1,40}"],["ictxt.country","country","[A-Z]{2}"]].forEach((t=>{e.getHostingPageUrl().getQueryParam(t[0],jt(t[2])).ifPresent((e=>{this.attributeData.location[t[1]]=e,o=!0}))}));[["ictxt_d","deviceType","[DPT]"]].forEach((t=>{e.getHostingPageUrl().getQueryParam(t[0],jt(t[2])).ifPresent((e=>{this.attributeData.userAgent[t[1]]=e,o=!0}))})),e.getHostingPageUrl().getQueryParam("ictxt_ts",jt("[A-Z]{2}")).ifPresent((e=>{this.attributeData.trafficSource=e,o=!0})),e.getHostingPageUrl().getQueryParam("raf",Gt).ifPresent((e=>{"true"===e?this._requestAnimationFrame=!0:"false"===e&&(this._requestAnimationFrame=!1)})),o&&(this._isControl=!1,this._saveCustomerStorage=!1,this._sendBrowserEvents=!1,this._sendGoogleAnalytics=!1,this._sendSegmentAnalytics=!1,this._sendMixpanel=!1)}getExpirationMs(){return j.ofNullable(this._expires)}setExpiration(e){this._expires=e}getOverrideJson(){const e={allPagesLive:this._allPagesLive,allAudiencesLive:this._allAudiencesLive,allEventsLive:this._allEventsLive,isControl:this._isControl,passExperienceAudience:this._passExperienceAudience,passVariationAudience:this._passVariationAudience,saveCustomerStorage:this._saveCustomerStorage,sendBrowserEvents:this._sendBrowserEvents,sendGoogleAnalytics:this._sendGoogleAnalytics,sendMixpanel:this._sendMixpanel,showStatusModule:this._showStatusModule},t={};return Object.keys(this.experienceVariations).forEach((e=>{t[e]=Object.keys(this.experienceVariations[e])})),t&&Object.keys(t).length>0&&(e.experienceVariations=t),Object.keys(e).forEach((t=>{void 0===e[t]&&delete e[t]})),e}isPageLive(e){return j.ofNullable(this._allPagesLive)}isAudienceLive(e){return j.ofNullable(this._allAudiencesLive)}isEventLive(e){return j.ofNullable(this._allEventsLive)}isExperienceEnabled(e){return this.hasExperienceVariationsSet()?j.of(this.isExperienceSet(e)):j.empty()}passExperienceCondition(){return j.ofNullable(this._passExperienceAudience)}isExperienceIncluded(e){return this.hasExperienceVariationsSet()?j.of(this.isExperienceSet(e)):j.empty()}hasExperienceIds(){if(this.hasExperienceVariationsSet()){const e=Object.keys(this.experienceVariations);return Io.debug("hasExperienceIds => "+e+" (override)"),j.of(e)}return j.empty()}hasVariationIds(e){const t=e.getId();if(this.hasExperienceVariationsSet()&&t in this.experienceVariations){const e=Object.keys(this.experienceVariations[t]);return Io.debug("hasVariationIds => "+e+" (override)"),j.of(e)}return j.empty()}isVariationEnabled(e){return this.hasExperienceVariationsSet()?j.of(this.isVariationSet(e)):j.empty()}passVariationCondition(){return j.ofNullable(this._passVariationAudience)}isControl(){return j.ofNullable(this._isControl)}saveCustomerStorage(){const e=j.ofNullable(this._saveCustomerStorage);return e.ifPresent((e=>{Io.debug(`save CustomerStorage => ${e} (override)`)})),e}sendGoogleAnalytics(){const e=j.ofNullable(this._sendGoogleAnalytics);return e.ifPresent((e=>{Io.debug(`send GoogleAnalytics => ${e} (override)`)})),e}sendSegmentAnalytics(){const e=j.ofNullable(this._sendSegmentAnalytics);return e.ifPresent((e=>{Io.debug(`send SegmentAnalytics => ${e} (override)`)})),e}sendMixpanel(){const e=j.ofNullable(this._sendMixpanel);return e.ifPresent((e=>{Io.debug(`send Mixpanel => ${e} (override)`)})),e}getAttributeDataOverrides(){return __spreadValues({},this.attributeData)}showStatusModule(){return j.ofNullable(this._showStatusModule)}isExperienceSet(e){return!0!==this._showBasesite&&e.getId()in this.experienceVariations}isVariationSet(e){var t;const i=e.getExperience().getId(),s=e.getId();return Boolean(null==(t=this.experienceVariations[i])?void 0:t[s])}showBasesite(){return j.ofNullable(this._showBasesite)}requestAnimationFrame(){return j.ofNullable(this._requestAnimationFrame)}hasExperienceVariationsSet(){return!0===this._showBasesite||Object.keys(this.experienceVariations).length>0}shouldRun(){return j.ofNullable(this._shouldRun)}shouldHide(){return!0===this.isEditorMode||!1===this._originAllowed?j.of(!1):j.empty()}useStorageType(){return!0===this.isEditorMode||!1===this._originAllowed||this.hasExperienceVariationsSet()?j.of("SessionStorage"):j.empty()}useElementObserver(){return!0===this.isEditorMode||!1===this._originAllowed?j.of(!1):j.empty()}injectVisualEditor(){return!0===this.isEditorMode?j.of(!0):j.empty()}shouldRunTasks(){let e;return!0!==this.isEditorMode&&!1!==this._originAllowed||(e=!1),void 0!==e&&Io.debug(`send BrowserEvent => ${e} (override)`),j.ofNullable(e)}sendNonPageviewBrowserEvents(){let e;return!1!==this._sendBrowserEvents&&!1!==this._originAllowed&&!0!==this.isEditorMode||(e=!1),void 0!==e&&Io.debug(`send BrowserEvent => ${e} (override)`),j.ofNullable(e)}sendPageviewBrowserEvents(){let e;return!1===this._sendBrowserEvents&&(e=!1),!0===this.isEditorMode&&(e=!1),void 0!==e&&Io.debug(`send BrowserEvent => ${e} (override)`),j.ofNullable(e)}shouldCheckOptOut(){return!0===this.isEditorMode||!1===this._originAllowed?j.of(!1):j.empty()}saveActivity(){let e;return!1!==this._sendBrowserEvents&&!1!==this._originAllowed&&!0!==this.isEditorMode||(e=!1),void 0!==e&&Io.debug(`save activity => ${e} (override)`),j.ofNullable(e)}}class fa{constructor(e,t,i,s,n,r,o,a,l,c,u){__publicField(this,"environment"),__publicField(this,"browserStorage"),__publicField(this,"extensionManager"),__publicField(this,"customer"),__publicField(this,"conditionEvaluationRuntime"),__publicField(this,"attributeData"),__publicField(this,"override"),__publicField(this,"taskManager"),__publicField(this,"elementObserver"),__publicField(this,"hider"),__publicField(this,"statusModel"),__publicField(this,"pages",[]),__publicField(this,"audiences",[]),__publicField(this,"pageviewId"),__publicField(this,"pageChangelistTasks",{}),this.environment=e,this.browserStorage=t,this.extensionManager=i,this.customer=s,this.conditionEvaluationRuntime=n,this.attributeData=r,this.override=o,this.taskManager=a,this.hider=l,this.elementObserver=c,this.statusModel=u}reinitialize(){const e=this.environment.getPageviewId();this.pageviewId===e&&Io.error("PageContext.reinitialize() called more than once per pageview",244),this.pages=this.determineMatchingPages(),this.hider.hidePages(this.pages,this.browserStorage,this.attributeData),this.hider.revealDocumentIfAllRegionsHidden(),this.pageChangelistTasks=this.schedulePageChangeListTasks(),this.audiences=this.determineMatchingAudiences(),this.pageviewId=e}getPages(){return this.pageviewId!==this.environment.getPageviewId()&&Io.error("PageContext.getPages() called before initialization",151),this.pages}getPageChangelistTask(e){return this.pageviewId!==this.environment.getPageviewId()&&Io.error("PageContext.getPageChangeListTask() called before initialization",243,{pageId:e.getId()}),j.ofNullable(this.pageChangelistTasks[e.getId()])}getAudiences(){return this.pageviewId!==this.environment.getPageviewId()&&Io.error("PageContext.getAudiences() called before initialization",152),this.audiences}determineMatchingPages(){const e=this.customer.getPages().filter((e=>this.override.isPageLive(e).orElse("live"===e.getState()))),t=this.environment.getHostingPageUrl().getRawUrl(),i=e.filter((e=>e.matches(t,wt.evalBoolean))),s=Rs.filterPages(i);return s.length>0?s:i}schedulePageChangeListTasks(){const e={};return this.override.shouldRunTasks().orElse(!0)&&this.pages.forEach((t=>{const i=t.getChanges().map(((e,i)=>Hn(e,Mn(t),i,this.attributeData,this.environment,this.browserStorage,this.extensionManager)));if(i.length>0){const s=new Qn(i,(()=>{this.hider.revealPage(t,this.browserStorage,this.attributeData)}),{pageId:t.getId()},this.elementObserver);e[t.getId()]=s,this.taskManager.addTask(s),this.statusModel.setPage(t,"status",s.getStatus()),s.onDone((()=>{this.statusModel.setPage(t,"status",s.getStatus())}))}else this.hider.revealPage(t,this.browserStorage,this.attributeData)})),e}determineMatchingAudiences(){return this.customer.getAudiences().filter((e=>this.override.isAudienceLive(e).orElse("live"===e.getState()))).filter((e=>{let t=!1;try{t=e.getCondition().evaluate(this.conditionEvaluationRuntime)}catch(i){t=!1;const s=new gi("Audience condition evaluation failed ",i);Io.error(s,205,{audienceId:e.getId()})}return Io.debug(`check audience: ${e.getName()} (${e.getId()}) => ${t}`),t}))}}class _a{update(){}}class Ea{constructor(e,t,i,s){__publicField(this,"environment"),__publicField(this,"localStorage"),__publicField(this,"customer"),__publicField(this,"override"),__publicField(this,"overrideModule"),__publicField(this,"eventLogStorageKey"),__publicField(this,"expVarModel",{campaigns:{}}),__publicField(this,"pageModel",{}),__publicField(this,"eventModel",{count:0,campaigns:{}}),this.customer=t,this.environment=e,this.localStorage=s,this.override=i,this.eventLogStorageKey=`${pe}event_log_${t.getId()}`,this.overrideModule=new _a(this.environment,i,this.customer,this.reinitializeGoalEvents.bind(this)),this.initializeGoalEvents()}reinitializeExperienceVariations(){this.expVarModel={campaigns:{}},this.overrideModule.update({experienceVariations:this.expVarModel})}reinitializeGoalEvents(){this.eventModel={count:0,campaigns:{}},this.writeEventModelToLocalStorage(),this.initializeGoalEvents(),this.overrideModule.update({goalEvents:this.eventModel})}initializeGoalEvents(){this.eventModel=this.readEventModelFromLocalStorage();const e=this.environment.getHostingPageUrl().getRawUrl();this.customer.getEvents().forEach((t=>{let i="custom"===t.getType();(t instanceof vi||t instanceof Si)&&(i=t.getPages().some((t=>t.matches(e,(()=>!0))))),i&&t.getMetrics().forEach((e=>{e.getCampaign().ifPresent((t=>{this.getCampaignEventData(t).metrics[e.getId()]=this.getMetricEventData(e)}))}))})),this.overrideModule.update({goalEvents:this.eventModel})}setCustomer(e,t){this.expVarModel[e]=t,this.overrideModule.update({experienceVariations:this.expVarModel})}setCampaign(e,t,i){const s=this.getCampaignData(e),n=s[t];s[t]=i,n!==i&&this.overrideModule.update({experienceVariations:this.expVarModel})}setExperience(e,t,i){const s=this.getExperienceData(e),n=s[t];s[t]=i,n!==i&&!0===(null==s?void 0:s.enabled)&&this.overrideModule.update({experienceVariations:this.expVarModel})}setVariation(e,t,i){const s=this.getVariationData(e),n=s[t];s[t]=i,n!==i&&this.overrideModule.update({experienceVariations:this.expVarModel})}setPage(e,t,i){this.getPageData(e)[t]=i,this.overrideModule.update({pagesChanges:this.pageModel})}setExperienceSortedVariations(e,t){this.getExperienceData(e).variationsSorted=t,this.overrideModule.update({experienceVariations:this.expVarModel})}setMetricEventData(e){this.eventModel=this.readEventModelFromLocalStorage(),e.forEach((({metric:e,event:t,status:i,id:s})=>{if(!e.getCampaign().isPresent())return;const n=this.getCampaignEventData(e.getCampaign().get()),r=this.getMetricEventData(e);void 0===r.events[s]?(r.events[s]={name:t.getName(),type:t.getType(),status:i,instanceId:s},this.eventModel.count+=1,n.count+=1,r.count+=1):(r.events[s].status=i,r.events[s].timestamp=i===It.SUCCEEDED?(new Date).toISOString():void 0,r.count=Object.keys(r.events).length)})),this.overrideModule.update({goalEvents:this.eventModel}),this.writeEventModelToLocalStorage()}getCampaignData(e){return void 0===this.expVarModel.campaigns[e.getId()]&&(this.expVarModel.campaigns[e.getId()]={campaign:e,experiences:{}}),this.expVarModel.campaigns[e.getId()]}getExperienceData(e){const t=this.getCampaignData(e.getCampaign());return void 0===t.experiences&&(t.experiences={}),void 0===t.experiences[e.getId()]&&(t.experiences[e.getId()]={experience:e,variations:{},variationsSorted:[]}),t.experiences[e.getId()]}getVariationData(e){const t=this.getExperienceData(e.getExperience());return void 0===t.variations&&(t.variations={}),void 0===t.variations[e.getId()]&&(t.variations[e.getId()]={variation:e}),t.variations[e.getId()]}getPageData(e){var t;const i=null!=(t=this.pageModel[e.getId()])?t:{page:e,status:It.NOT_STARTED};return this.pageModel[e.getId()]=i,i}getMetricEventData(e){if(!e.getCampaign().isPresent())throw new V("Metric not in campaign");const t=this.getCampaignEventData(e.getCampaign().get());return void 0===t.metrics[e.getId()]&&(t.metrics[e.getId()]=this.getInitialMetricEventData(e)),t.metrics[e.getId()]}getCampaignEventData(e){return void 0===this.eventModel.campaigns[e.getId()]&&(this.eventModel.campaigns[e.getId()]={name:e.getName(),count:0,metrics:{}}),this.eventModel.campaigns[e.getId()]}getMetricMeasurement(e){const t=e.getCountingMethod(),i=e.getScope();let s,n;return e instanceof Gs?(n=`$${(e.getValue()/100).toFixed(2)}`,s=`${t} static value per ${i}`):s=e instanceof js?`${t} dynamic value per ${i}`:`${t} conversion per ${i}`,{measurement:s,value:n}}getInitialMetricEventData(e){return __spreadValues({name:e.getName(),isGoal:e.isGoal(),events:{},count:0},this.getMetricMeasurement(e))}shouldUseLocalStorage(){let e=!1;return this.override.getExpirationMs().ifPresent((t=>{e=t>Date.now()})),e}deleteEventModelFromLocalStorage(){this.localStorage.delete(this.eventLogStorageKey)}writeEventModelToLocalStorage(){this.shouldUseLocalStorage()&&this.localStorage.write(this.eventLogStorageKey,xe(this.eventModel))}readEventModelFromLocalStorage(){let e=this.eventModel;return this.shouldUseLocalStorage()?this.localStorage.read(this.eventLogStorageKey).ifPresent((t=>{try{e=Ae(t)}catch(i){}})):this.deleteEventModelFromLocalStorage(),e}}class ya{reinitializeExperienceVariations(){}reinitializeGoalEvents(){}setCustomer(e,t){}setCampaign(e,t,i){}setExperience(e,t,i){}setVariation(e,t,i){}setPage(e,t,i){}setExperienceSortedVariations(e,t){}setMetricEventData(e){}}class Sa{constructor(e,t,i,s){__publicField(this,"storageKey"),__publicField(this,"environment"),__publicField(this,"browserStorage"),__publicField(this,"user"),__publicField(this,"pageviewAttributes",{id:void 0,custom:{},internal:{}}),this.storageKey=re+e.getId(),this.browserStorage=i,this.environment=t,this.user=s}setCustomAttributes(e,t){const i=this.getAttributeData(e);Object.keys(t).forEach((e=>{i.custom[e]=t[e]})),this.saveAttributeData(e,i)}setInternalAttributes(e,t){const i=this.getAttributeData(e);Object.keys(t).forEach((e=>{i.internal[e]=t[e]})),this.saveAttributeData(e,i)}getCustomAttributes(e,t){const i=this.getAttributeData(e),s={};return Object.keys(i.custom).forEach((e=>{(void 0===t||t.includes(e))&&(s[e]=i.custom[e])})),s}getInternalAttributes(e,t){const i=this.getAttributeData(e),s={};return Object.keys(i.internal).forEach((e=>{(void 0===t||t.includes(e))&&(s[e]="object"==typeof i.internal[e]?Ae(xe(i.internal[e])):i.internal[e])})),s}getFlattenedCustomAttributes(){const e=this.getCustomAttributes("user"),t=this.getCustomAttributes("pageview");return Object.keys(t).forEach((i=>{e[i]=t[i]})),e}getFlattenedInternalAttributes(){const e=this.getInternalAttributes("user"),t=this.getInternalAttributes("pageview");return Object.keys(t).forEach((i=>{e[i]=t[i]})),e}deleteCustomAttributes(e,t){const i=this.getAttributeData(e);for(const s in i.custom)Object.prototype.hasOwnProperty.call(i.custom,s)&&(void 0===t||t.includes(s))&&delete i.custom[s];this.saveAttributeData(e,i)}deleteInternalAttributes(e,t){const i=this.getAttributeData(e);void 0===t?i.internal={}:t.forEach((e=>{delete i.internal[e]})),this.saveAttributeData(e,i)}getAttributeData(e){let t,i={id:void 0,custom:{},internal:{}};return"pageview"===e?(i=this.pageviewAttributes,t=this.environment.getPageviewId()):"user"===e?(i=this.readBrowserStorage(),t=this.user.getId()):Io.error(`Tried to get attribute data for invalid scope ${e}`,49),t!==i.id&&(Io.debug(`Mismatching IDs ("${t}" != "${i.id}"). Resetting AttributeData`),i.id=t,i.internal={},i.custom={}),i}saveAttributeData(e,t){"pageview"===e||("user"===e?this.saveBrowserStorage(t):Io.error(`Tried to save attribute data for invalid scope ${e}`,50))}readBrowserStorage(){let e={id:void 0,custom:{},internal:{}};return this.browserStorage.read(this.storageKey).ifPresent((t=>{try{e=Ae(t)}catch(i){const e=new gi("Could not parse attribute storage",i);Io.error(e,51)}})),e}saveBrowserStorage(e){const t=xe(e);this.browserStorage.write(this.storageKey,t)}}class wa{constructor(e,t,i,s){__publicField(this,"storageKey"),__publicField(this,"browserStorage"),__publicField(this,"environment"),__publicField(this,"override"),this.storageKey=ae+e.getId(),this.browserStorage=i,this.environment=t,this.override=s}static get VERSION(){return 2}static getPath(e,t){if(0===t.length)return e;const i=t[0];return i in e||(e[i]={}),t.splice(0,1),wa.getPath(e[i],t)}getCustomerControlStatus(e){if(!e.isCampaignControl()){const e=this.readState();if(!0===e.c)return j.of("c");if(!1===e.c)return j.of("i");this.override.saveCustomerStorage().orElse(!0)&&Io.warn("Attempting to retrieve control value, but not set",52)}return j.empty()}updateAndGetControl(e){Io.debug("updateAndGetControl(campaign)");const t=e.getCustomer();return t.isCampaignControl()?this.setAndGetCampaignControl(e):this.setAndGetCustomerControl(t)}setAndGetCustomerControl(e){R(!e.isCampaignControl());const t=this.readState(),i=t,s=e.getControlTrafficPercentage().get();return void 0!==t.cpg&&Object.keys(t.cpg).forEach((e=>{void 0!==t.cpg&&(delete t.cpg[e].c,delete t.cpg[e].ct)})),this.setAndGetControl(e,i,t,s)}updateAndGetExperienceInclusion(e){const t=this.environment.getInitializeUnixTime(),i=this.readState(),s=e.getId(),n=e.getCampaign().getId(),r=wa.getPath(i,["cpg",n,"exp",s]);if(e.getInclusionStickyConfig().isSticky()&&void 0!==r.i&&void 0!==r.it){const i=r.it;if(!e.getInclusionStickyConfig().isExpired(t,i)){const t=r.i;return Io.info(`Experience ${e.getId()} sticky inclusion decision => ${t}`),t}}const o=Math.random()<1-e.getIgnore()/1e4;return r.i=o,r.it=t,this.writeState(i),Io.info(`Experience ${e.getId()} new inclusion decision => ${o}`),o}getStickyVariation(e){Io.group("getStickyVariation(experience:"+e.getId()+")");const t=this.environment.getInitializeUnixTime(),i=this.readState(),s=e.getId(),n=e.getCampaign().getId(),r=wa.getPath(i,["cpg",n,"exp",s]);if(e.getVariationStickyConfig().isSticky()&&void 0!==r.v&&void 0!==r.vt){const i=r.vt;if(!e.getVariationStickyConfig().isExpired(t,i))return Io.debug("found sticky, non-expired variation: "+r.v),Io.groupEnd(),e.getVariation(r.v)}return Io.groupEnd(),j.empty()}getVariation(e){Io.group("getVariation(experience:"+e.getId()+")");const t=this.readState(),i=e.getId(),s=e.getCampaign().getId(),n=wa.getPath(t,["cpg",s,"exp",i]);return void 0!==n.v?(Io.groupEnd(),e.getVariation(n.v)):(Io.groupEnd(),j.empty())}saveVariationStickySelection(e,t){const i=e.getExperience().getId(),s=e.getExperience().getCampaign().getId(),n=this.readState(),r=wa.getPath(n,["s"]),o=wa.getPath(n,["cpg",s,"exp",i]);e.getId()!==o.v&&Io.error(`Updating variation page view id in local storage, but variation changed from ${o.v} to ${e.getId()}`,53,{campaignId:s,experienceId:i,variationId:e.getId()}),o.v=e.getId(),o.gpvid=t,o.gsid=r.id,this.writeState(n)}saveVariationPredictionSelection(e,t,i){const s=e.getExperience().getId(),n=e.getExperience().getCampaign().getId(),r=this.readState(),o=wa.getPath(r,["s"]),a=wa.getPath(r,["cpg",n,"exp",s]);a.v=e.getId(),a.vt=this.environment.getNowUnixTime(),a.mv=t,a.gpvid=i,a.gsid=o.id,this.writeState(r)}deleteExperiencePredictionSelection(e){const t=e.getId(),i=e.getCampaign().getId(),s=this.readState(),n=wa.getPath(s,["cpg",i,"exp",t]);0!==Object.keys(n).length&&(delete n.v,delete n.vt,delete n.mv,delete n.gpvid,delete n.gsid,this.writeState(s))}updateAndGetIsCampaignFirstTimeView(e,t){return this.updateAndGetIsFirstTime([e.getId(),"v"],t)}updateAndGetIsCampaignFirstTimeGoal(e,t,i){return this.updateAndGetIsFirstTime([e.getId(),t.getId(),"g"],i)}updateAndGetIsVariationFirstTimeView(e,t){return this.updateAndGetIsFirstTime([e.getExperience().getCampaign().getId(),e.getExperience().getId(),e.getId(),"v"],t)}updateAndGetIsVariationFirstTimeGoal(e,t,i){return this.updateAndGetIsFirstTime([e.getExperience().getCampaign().getId(),t.getId(),e.getExperience().getId(),e.getId(),"g"],i)}getVariationPredictionModelVersion(e){const t=this.readState(),i=wa.getPath(t,["cpg",e.getExperience().getCampaign().getId(),"exp",e.getExperience().getId()]);return j.ofNullable(i.mv)}getVariationPredictionPageviewId(e){const t=this.readState(),i=wa.getPath(t,["cpg",e.getExperience().getCampaign().getId(),"exp",e.getExperience().getId()]);return j.ofNullable(i.gpvid)}getVariationPredictionSessionId(e){const t=this.readState(),i=wa.getPath(t,["cpg",e.getExperience().getCampaign().getId(),"exp",e.getExperience().getId()]);return j.ofNullable(i.gsid)}getPageviewSelections(e){const t=[],i=this.readState();return void 0!==i.cpg&&Object.keys(i.cpg).forEach((s=>{if(void 0!==i.cpg){const n=i.cpg[s];"exp"in n&&Object.keys(n.exp).forEach((i=>{const r=n.exp[i];void 0!==r.v&&"gpvid"in r&&r.gpvid===e&&t.push({campaignId:s,experienceId:i,variationId:r.v})}))}})),t}getSessionId(){const e=this.readState(),t=wa.getPath(e,["s"]);return j.ofNullable(t.id)}updateAndGetSessionId(){const e=this.environment.getNowUnixTime(),t=this.readState(),i=wa.getPath(t,["s"]);return void 0===i.st&&(i.st=e),(void 0===i.id||void 0===i.t||e-i.t>Y||e-i.st>J)&&(Io.debug("Starting a new session"),i.id=this.generateSessionId(),i.st=e),Io.debug("Extending current session"),i.t=e,this.writeState(t),i.id}getUserVisitStatus(e){return this.isFirstSession(e)?"N":"R"}isFirstSession(e){const t=e.getFirstVisitTimeSec();this.updateAndGetSessionId();const i=this.readState(),s=wa.getPath(i,["s"]).st;return Io.info(`user.getId(): ${e.getId()}`),Io.info(`userCreationTimeSec: ${t}`),Io.info(`currentSessionStartTimeSec: ${s}`),Math.abs(t-s)<Y/2}setAndGetCampaignControl(e){const t=e.getCustomer();R(t.isCampaignControl());const i=this.readState(),s=wa.getPath(i,["cpg",e.getId()]),n=e.getControlTrafficPercentage().get();return delete i.c,delete i.ct,this.setAndGetControl(t,s,i,n)}setAndGetControl(e,t,i,s){const n=this.environment.getInitializeUnixTime();if(e.getControlStickyConfig().isSticky()||Io.error("Control is not sticky, but should be",54),e.getControlStickyConfig().isSticky()&&void 0!==t.c&&void 0!==t.ct){const i=t.ct;if(!e.getControlStickyConfig().isExpired(n,i))return Io.debug("control: "+t.c+" (sticky decision)"),t.c;Io.error(`Control sticky decision expired. now:${n}, last:${i}`,55)}void 0!==t.c&&Io.error(`Making new control decision, but c is present: ${t.c}`,56),void 0!==t.ct&&Io.error(`Making new control decision, but ct is present: ${t.ct}`,57);const r=Math.random()<s;return t.c=r,t.ct=n,this.writeState(i),Io.debug("control: "+t.c),r}generateSessionId(){return this.environment.getNowUnixTime()+"-"+Mt()}updateAndGetIsFirstTime(e,t){let i=!1;const s=this.readState(),n=wa.getPath(s,["uu"]),r=e.join(":");return r in n?n[r]===t&&(i=!0):(n[r]=t,this.writeState(s),i=!0),i}readState(){let e={};return this.browserStorage.read(this.storageKey).ifPresent((t=>{try{e=Ae(t)}catch(i){const e=new gi("Could not parse customer storage",i);Io.error(e,58)}})),$(!Object.prototype.hasOwnProperty.call(e,"vr")||e.vr===wa.VERSION),e}writeState(e){e.vr=wa.VERSION;const t=xe(e);this.override.saveCustomerStorage().orElse(!0)&&this.browserStorage.write(this.storageKey,t)}}class Ia{constructor(e,t){__publicField(this,"customer"),__publicField(this,"storageKey"),__publicField(this,"browserStorage"),this.customer=e,this.storageKey=`${oe}${e.getId()}`,this.browserStorage=t,this.initialize()}setDataAndMetadata(e,t,i){const s=this.getAllDataAndMetadata();s.data[e]=t,s.meta[e]=i,this.setAll(s)}getData(e){const t=this.getAllData()[e];return void 0===t||0===Object.keys(t).length?j.empty():j.ofNullable(t)}getAllData(){return this.getAllDataAndMetadata().data}getMetadata(e){const t=this.getAllMetdata()[e];return void 0===t||0===Object.keys(t).length?j.empty():j.ofNullable(t)}getAllMetdata(){return this.getAllDataAndMetadata().meta}setAllDataAndMetadata(e,t){const i={data:e,meta:t};this.setAll(i)}deleteAll(){this.browserStorage.delete(this.storageKey)}getAllDataAndMetadata(){const e=this.browserStorage.read(this.storageKey);let t=this.emptyStorage();if(e.ifPresent((e=>{try{t=Ae(e)}catch(i){const e=new gi("Could not parse integration data storage",i);Io.error(e,59),this.deleteAll()}})),null==t||0===Object.keys(t).length)t=this.emptyStorage();else{const e=t;on(e)&&void 0===e.__marketoLead||(t=this.emptyStorage())}return void 0===t.meta&&(t.meta={}),cr(t.data.marketo)&&(t.data.marketo={}),t}setAll(e){const t=this.emptyStorage();Xn.forEach((i=>{br[i](this.customer)&&(t.data[i]=e.data[i],t.meta[i]=e.meta[i])})),this.browserStorage.write(this.storageKey,xe(t))}emptyStorage(){return{data:{},meta:{}}}initialize(){const e=this.getAllDataAndMetadata();Xn.forEach((t=>{br[t](this.customer)||(delete e.data[t],delete e.meta[t])})),this.setAll(e)}}class Ca{constructor(e){if(__publicField(this,"environment"),!St(e,"localStorage"))throw new Error("LocalStorage is not available");this.environment=e}write(e,t){Et(e)||Io.error(`Writing an unknown key to LocalStorage: ${e}`,180),this.environment.writeLocalStorage(e,t)}read(e){return this.environment.readLocalStorage(e)}delete(e){this.environment.deleteLocalStorage(e)}}class Ta{constructor(e,t){__publicField(this,"storageKey"),__publicField(this,"browserStorage"),this.storageKey=ce+e.getId(),this.browserStorage=t}static fromJson(e){try{const t=Ae(e);return j.of(t)}catch(t){const e=new gi("Could not build server context from localStorage",t);Io.error(e,157)}return j.empty()}set(e){this.browserStorage.write(this.storageKey,xe(e))}get(){return this.browserStorage.read(this.storageKey).flatMap((e=>Ta.fromJson(e)))}clear(){this.browserStorage.delete(this.storageKey)}}var xa={},Aa={get exports(){return xa},set exports(e){xa=e}},Fa={};!function(e){function t(e,t){var i,s,n,r,o,a,l,c;for(i=3&e.length,s=e.length-i,n=t,o=3432918353,a=461845907,c=0;c<s;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(r=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}e.exports=t}({get exports(){return Fa},set exports(e){Fa=e}});var ka={};!function(e){function t(e,t){for(var i,s=e.length,n=t^s,r=0;s>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),s-=4,++r;switch(s){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}e.exports=t}({get exports(){return ka},set exports(e){ka=e}});var Pa=Fa,Da=ka;Aa.exports=Pa;var Ma=xa.murmur3=Pa;function Na(e,t){return Ma(e,t)}xa.murmur2=Da;const Oa=__pow(2,32);function Ra(e,t){const i=(e>>>0)/Oa;return Math.floor(i*t)}class La{constructor(e,t,i){let s;__publicField(this,"browserStorage"),__publicField(this,"environment"),__publicField(this,"id"),__publicField(this,"storageKey"),this.browserStorage=e,this.environment=t,this.storageKey=`${de}${i.getId()}`,this.browserStorage.read(this.storageKey).ifPresent((e=>{s=e,Io.debug(`User: Found existing User ID: ${s}`)})),void 0===s&&(s=this.generateId(),Io.debug(`User: No existing User ID; generated new ID: ${s}`),this.browserStorage.write(this.storageKey,s)),this.id=s}getId(){if(void 0===this.id)throw new L("user id not defined");const e=this.browserStorage.read(this.storageKey);return e.isPresent()?e.get()!==this.id&&Io.error(`User id in memory (${this.id}) not the same as user id in localStorage (${e.get()})`,62):Io.error("User id is missing from localStorage",61),this.id}isNewVisitor(){const e=this.getFirstVisitTimeSec();return this.environment.getNowUnixTime()-e<X}isReturningVisitor(){return!this.isNewVisitor()}getFirstVisitTimeSec(){const e=this.getId().split(".",2);return Number(e[1])}getUserBucket(){const e=100,t=Ra(Na(this.getId(),1),e);return Math.floor(t+1)}generateId(){const e=this.environment.getNowUnixTime();return`${Nt()}.${e}`}}class $a{constructor(e,t){__publicField(this,"client"),__publicField(this,"environment"),__publicField(this,"taskQueue",[]),__publicField(this,"completedTasks",[]),__publicField(this,"isRunning",!1),__publicField(this,"isStopping",!1),__publicField(this,"timeoutId"),__publicField(this,"queueChecksum"),__publicField(this,"doneCallbacks",[]),__publicField(this,"latestQueueChecksum"),__publicField(this,"latestQueueTimeMs"),this.client=e,this.environment=t}onDone(e){this.doneCallbacks.push(e)}isDone(){return 0===this.taskQueue.length}hasStarted(){return this.taskQueue.length>0||this.completedTasks.length>0}getClient(){return this.client}addTask(e){Io.debug("TaskManager.addTask("+e.toString()+")"),this.isStopping?Io.warn(`Rejecting addTask(${e.toString()}) request since TaskManager is stopping`,35,e.getEntityIds()):(e.setManager(this),this.handleNotDone(e),this.queueChecksum=void 0,this.runAfter(0))}runNow(){Io.debug("TaskManager run now - synchronously"),this.eventLoop()}findTasks(e){return[...this.taskQueue,...this.completedTasks].filter((t=>e(t)))}stop(){Io.debug("TaskManager.stop()"),this.isStopping=!0,this.runAfter(0)}eventLoop(){if(Io.group("TaskManager.eventLoop()"),Io.time("TaskManager.eventLoop()"),this.isRunning)return Io.debug("TaskManager called again when already running. Back to work..."),void Io.groupEnd();if(this.isRunning=!0,this.clearTimeout(),this.taskQueue.length>0&&void 0!==this.latestQueueChecksum&&void 0!==this.latestQueueTimeMs&&this.environment.getNowUnixTimeMs()-this.latestQueueTimeMs>NO_PROGRESS_TOLERANCE_TIME_MS&&!this.isQueueBlocked()){const e=this.extractVictim();void 0===e?Io.error("Unable to extract latest task when trying to make progress",37):(Io.error(`Unable to make progress. Canceling task ${e.toString()}. Queue: ${this.queueToString()}`,36,e.getEntityIds()),this.cancelTask(e))}if(this.isStopping?this.stopTasks():this.runTasks(),this.taskQueue.length>0){const e=this.computeChecksum();e!==this.latestQueueChecksum&&(this.latestQueueChecksum=e,this.latestQueueTimeMs=this.environment.getNowUnixTimeMs())}else this.latestQueueChecksum=void 0,this.latestQueueTimeMs=void 0;if(this.taskQueue.length>0)this.isQueueBlocked()?(Io.debug("TaskManager queue is blocked on WAITING tasks. Sleeping."),this.clearTimeout(),this.latestQueueChecksum=void 0,this.latestQueueTimeMs=void 0):(Io.debug("TaskManager schedule callback for later"),this.runAfter(K));else if(this.isStopping)Io.debug("TaskManager schedule callback for now"),this.runAfter(0);else{for(Io.group("TaskManager done"),this.clearTimeout(),this.latestQueueChecksum=void 0,this.latestQueueTimeMs=void 0;this.doneCallbacks.length>0;){const e=this.doneCallbacks.shift();void 0!==e&&(Io.group("executing done callback"),wt.executeFunction(e,155),Io.groupEnd())}Io.groupEnd()}this.isRunning=!1,Io.timeEnd("TaskManager.eventLoop()"),Io.groupEnd()}extractVictim(){let e;for(let t=0;t<this.taskQueue.length;t++)this.taskQueue[t].isBlocked()||(void 0===e||this.taskQueue[t].getId()>this.taskQueue[e].getId())&&(e=t);if(void 0!==e)return this.taskQueue.splice(e,1)[0]}stopTasks(){Io.group("TaskManager.stopTasks()");for(const e of this.completedTasks)e.cleanup();for(;this.taskQueue.length>0;){const e=this.taskQueue.shift();void 0!==e&&(Io.error(`Stopping and had to cancel task ${e.toString()}`,38,e.getEntityIds()),this.cancelTask(e))}for(;this.completedTasks.length>0;)this.completedTasks.shift();Io.debug("Cleanup of all Tasks complete. taskQueue and completedTasks are now empty"),Io.groupEnd(),this.isStopping=!1}cancelTask(e){void 0!==e&&(Io.debug("Canceling task "+e.toString()),e.cancel(),this.handleDone(e))}handleNotDone(e){this.taskQueue.push(e)}handleDone(e){this.completedTasks.push(e),this.queueChecksum=void 0}runTasks(){Io.group("TaskManager.runTasks()"),this.queueChecksum=this.computeChecksum();let e=!0;for(;0!==this.taskQueue.length;){const t=this.getUnloadingTasks();if(!e&&0===t.length)break;Io.debug(`task queue: ${this.queueToString()}`);const i=this.taskQueue.shift();if(void 0===i)continue;let s=!1,n=!1;t.length>0&&(i.isUnloading()&&e?s=!0:0===i.getNotDoneDependencies().length&&(n=!0));const r=this.computeChecksum();let o;s?(Io.debug(`Skipping unloading task ${i.toString()}. TM in unloading state and still making progress`),o=It.TRY_LATER):i.getStatus()===It.WAITING?(Io.debug(`Skipping waiting task ${i.toString()}`),o=It.WAITING):(Io.debug(`TaskManager running ${i.toString()}`),Io.time(`Task running ${i.toString()}`),o=i.runWrapper(),Io.timeEnd(`Task running ${i.toString()}`),Io.debug("TaskManager "+i.toString()+" returned "+It[o]));const a=this.computeChecksum();if(n&&r!==a&&(n=!1),n&&!i.isDone())i.inTransaction()&&Io.warn(`Unloading ${t[0].toString()} and transaction task is not done. Canceling ${i.toString()}`,39,i.getEntityIds()),this.cancelTask(i);else switch(o){case It.TRY_LATER:this.handleNotDone(i);break;case It.FAILED:case It.SUCCEEDED:this.handleDone(i);break;case It.CANCELED:this.handleDone(i),Io.debug("Task self-canceled "+i.toString());break;case It.WAITING:this.handleNotDone(i);break;default:this.handleDone(i),Io.error(`Invalid task status ${o} for ${i.toString()}`,40,i.getEntityIds())}const l=this.computeChecksum();if(l!==this.queueChecksum){if(this.isStopping)break;void 0===this.queueChecksum&&(this.queueChecksum=l)}else e=!1}Io.debug("No more work to do now."),Io.groupEnd()}getUnloadingTasks(){return this.taskQueue.filter((e=>e.isUnloading()))}clearTimeout(){void 0!==this.timeoutId&&(Io.debug("TaskManager clearing timeoutId: "+this.timeoutId),this.environment.getWindow().clearTimeout(this.timeoutId),this.timeoutId=void 0)}runAfter(e){Io.debug("TaskManager runAfter("+e+"ms)"),this.clearTimeout(),this.timeoutId=this.environment.getWindow().setTimeout((()=>{try{Io.debug("TaskManager callback triggered"),this.eventLoop()}catch(e){const t=new gi("TaskManager exception",e);Io.error(t,41)}}),e),Io.debug("TaskManager set new timer: "+this.timeoutId)}computeChecksum(){return this.taskQueue.map((e=>e.getId().toString())).join("-")}queueToString(){return this.taskQueue.map((e=>e.toString())).join(", ")}isQueueBlocked(){return this.taskQueue.every((e=>e.isBlocked()))}}class Va extends xt{constructor(e,t,i){super(),__publicField(this,"environment"),__publicField(this,"browserEventLogger"),__publicField(this,"integrationDataStorage"),__publicField(this,"sent",!1),__publicField(this,"deliveryStatus",It.NOT_STARTED),this.environment=N(e),this.browserEventLogger=N(t),this.integrationDataStorage=N(i)}toString(){return`ContextEventTask(${this.environment.getPageviewId()})`}inTransaction(){return!0}isUnloading(){return!1}run(){return this.sendOnce(),this.deliveryStatus===It.SUCCEEDED?It.SUCCEEDED:this.deliveryStatus===It.FAILED?It.FAILED:(Io.debug("Waiting for context event delivery confirmation"),It.TRY_LATER)}sendOnce(){this.sent||(Io.info("Sending context event"),this.browserEventLogger.sendContext(this.integrationDataStorage).then((()=>{Io.info(`Context ${this.environment.getPageviewId()} event delivery success`),this.deliveryStatus=It.SUCCEEDED})).catch((e=>{const t=new gi(`Context ${this.environment.getPageviewId()} event delivery failed`,e);Io.warn(t,224),this.deliveryStatus=It.FAILED})),this.sent=!0)}}function Ua(e,t){return t.filter((t=>za(e,t)))}function Wa(e,t){return t.some((t=>za(e,t)))}function za(e,t){return e.getPages().some((e=>e.getId()===t.getId()))}class ja{constructor({environment:e,browserEventLogger:t,customer:i,customerStorage:s,attributeStorage:n,activityStorage:r,user:o,override:a,pageContext:l,statusModel:c,taskManager:u}){__publicField(this,"override"),__publicField(this,"pageContext"),__publicField(this,"environment"),__publicField(this,"customer"),__publicField(this,"taskManager"),__publicField(this,"browserEventLogger"),__publicField(this,"customerStorage"),__publicField(this,"attributeStorage"),__publicField(this,"activityStorage"),__publicField(this,"user"),__publicField(this,"statusModel"),this.environment=N(e),this.browserEventLogger=N(t),this.customer=N(i),this.customerStorage=N(s),this.attributeStorage=N(n),this.activityStorage=N(r),this.user=N(o),this.override=N(a),this.pageContext=N(l),this.statusModel=N(c),this.taskManager=N(u)}cleanup(){}sendConversionEvent(e,t,i){Io.group(`sendConversionEvent(${e.getName()}, ${t})`);const s=new Kn(e,t,void 0,i);this.activityStorage.add(Vr.buildConversionActivity(s,this.customer,this.environment,this.user,this.attributeStorage,this.customerStorage));const n=new _r(s,this.browserEventLogger,this.customer,this.customerStorage,this.statusModel);this.taskManager.addTask(n),Io.groupEnd()}}class Ga extends ja{constructor(){super(...arguments),__publicField(this,"registeredClickEvents",[])}cleanup(){Io.group("InstrumentClickEvent.cleanup()"),this.registeredClickEvents.forEach((([e,t])=>{Io.debug('removing handler: events="'+this.getEventName()+'", selector="'+e.getSelector()+'"');try{this.environment.getWindow().document.removeEventListener("click",t,!0)}catch(i){const t=new gi("Failed to unregister click event",i);Io.error(t,194,{eventId:e.getId()})}})),Io.groupEnd()}instrumentClickEvent(e){Io.group("instrumentClickEvent("+e.getName()+")"),Io.info(`Instrument click event ${e.getId()}, selector ${e.getSelector()}`),Io.debug('adding handler: events="'+this.getEventName()+'", selector="'+e.getSelector()+'"');const t=t=>{try{if(t.target instanceof Element&&t.target.closest(e.getSelector())instanceof Element){if(!(t.target instanceof HTMLElement||t.target instanceof SVGElement))return void Io.warn(`Click event triggered for event ID ${e.getId()} (selector: "${e.getSelector()}"), but target is neither an HTMLElement or SVGElement`,259);const i=this.environment.generateActionId();this.handleClickEvent(e,i,t)}}catch(i){const t=new gi("Failed to handle click event",i);Io.error(t,167,{eventId:e.getId()})}};try{this.environment.getWindow().document.addEventListener("click",t,!0)}catch(i){const t=new gi("Failed to register click event",i);Io.error(t,193,{eventId:e.getId()})}this.registeredClickEvents.push([e,t]),Io.groupEnd()}getEventName(){return"click."+this.environment.getPageviewId()}}class Ba extends Ga{initialize(e){Io.group("InstrumentStandardClickEvents.initialize()"),vi.filterEvents(e).filter((e=>Wa(this.pageContext,e.getPages()))).forEach((e=>{this.instrumentClickEvent(e)})),Io.groupEnd()}handleClickEvent(e,t,i){Io.group(`handleClickEvent(${e.getName()}, ${t})`),Io.debug("handleClickEvent run code");e.executeCode(wt.evalBoolean)?(this.sendConversionEvent(e,t,i),Io.groupEnd(),this.taskManager.runNow()):Io.groupEnd()}}class Ha extends ja{initialize(e){Io.group("InstrumentViewEvents.initialize()");const t=this.environment.getPageviewId();Si.filterEvents(e).filter((e=>Wa(this.pageContext,e.getPages()))).forEach((e=>{this.handleViewEvent(e,t)}))}handleViewEvent(e,t){Io.group(`handleViewEvent(${e.getName()}, ${t})`),Io.debug("handleViewEvent run code");e.executeCode(wt.evalBoolean)?(this.sendConversionEvent(e,t),Io.groupEnd()):Io.groupEnd()}}class Qa extends Ga{initialize(e){Io.group("InstrumentWebflowClickEngagementEvents.initialize()");const t=wi.filterEvents(e);if(t.length>0){const e=t[0];t.length>1&&Io.error(`Expected exactly one WebflowClickEngagementEvent, but found ${t.length}`,256),this.instrumentClickEvent(e)}Io.groupEnd()}handleClickEvent(e,t,i){Io.group(`handleWebflowClickEngagementEvent(${e.getName()}, ${t})`),this.sendConversionEvent(e,t,i),Io.groupEnd(),this.taskManager.runNow()}}class qa extends Ga{initialize(e){Io.group("InstrumentWebflowClickEvents.initialize()"),Ii.filterEvents(e).forEach((e=>{this.instrumentClickEvent(e)})),Io.groupEnd()}handleClickEvent(e,t,i){Io.group(`handleWebflowClickEvent(${e.getName()}, ${t})`),this.sendConversionEvent(e,t,i),Io.groupEnd(),this.taskManager.runNow()}}class Ka extends xt{constructor(e,t,i,s,n,r,o,a,l,c){super(),__publicField(this,"environment"),__publicField(this,"browserEventLogger"),__publicField(this,"customer"),__publicField(this,"customerStorage"),__publicField(this,"attributeStorage"),__publicField(this,"activityStorage"),__publicField(this,"user"),__publicField(this,"override"),__publicField(this,"pageContext"),__publicField(this,"instrumentations",[]),__publicField(this,"statusModel"),this.environment=N(e),this.browserEventLogger=N(t),this.customer=N(i),this.customerStorage=N(s),this.attributeStorage=N(n),this.activityStorage=N(r),this.user=N(o),this.override=N(a),this.pageContext=N(l),this.statusModel=N(c)}toString(){return"ConversionEventInstrumentationTask()"}inTransaction(){return!0}isUnloading(){return!1}cleanup(){this.instrumentations.forEach((e=>{e.cleanup()}))}run(){return this.instrumentEvents(),It.SUCCEEDED}instrumentEvents(){Io.group("instrumentEvents()");const e=this.customer.getEvents().filter((e=>this.override.isEventLive(e).orElse("live"===e.getState()))),t={environment:this.environment,browserEventLogger:this.browserEventLogger,customer:this.customer,customerStorage:this.customerStorage,attributeStorage:this.attributeStorage,activityStorage:this.activityStorage,user:this.user,override:this.override,pageContext:this.pageContext,statusModel:this.statusModel,taskManager:this.manager},i=new Ba(t);i.initialize(e),this.instrumentations.push(i);const s=new qa(t);s.initialize(e),this.instrumentations.push(s);const n=new Ha(t);n.initialize(e),this.instrumentations.push(n);const r=new Qa(t);r.initialize(e),this.instrumentations.push(r),Io.groupEnd()}}const Ya=class extends xt{constructor(e,t,i,s){super(),__publicField(this,"environment"),__publicField(this,"customer"),__publicField(this,"endpoint"),__publicField(this,"getCookie"),__publicField(this,"startTimeMs"),__publicField(this,"sent",!1),__publicField(this,"deliveryStatus",It.NOT_STARTED),this.environment=e,this.customer=t,this.endpoint=i,this.getCookie=s,this.startTimeMs=this.environment.getNowUnixTimeMs()}toString(){return`CookieAssociatorTask(${this.endpoint})`}inTransaction(){return!0}isUnloading(){return!1}run(){if(this.sendOnce(),this.deliveryStatus===It.SUCCEEDED)return It.SUCCEEDED;if(this.deliveryStatus===It.FAILED)return It.FAILED;return this.environment.getNowUnixTimeMs()-this.startTimeMs>=Ya.WAIT_FOR_COOKIE_MS?(Io.warn(`Cookie not present on the page within ${Ya.WAIT_FOR_COOKIE_MS}ms (${this.endpoint} )`,81),It.SUCCEEDED):It.TRY_LATER}sendOnce(){if(this.sent)return;const e=this.getCookie();if(!e.isPresent())return;const t=e.get(),i=this.customer.getId();Io.info(`Sending id association request. Customer: ${i}`),this.environment.fetch(se,this.endpoint,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:xe({customerId:this.customer.getId(),cookie:t})}).then((()=>{Io.info("Successfully sent id association request"),this.deliveryStatus=It.SUCCEEDED})).catch((e=>{const t=new gi(`Error calling ${this.endpoint} `,e);Io.error(t,82),this.deliveryStatus=It.FAILED})),this.sent=!0}};let Ja=Ya;__publicField(Ja,"WAIT_FOR_COOKIE_MS",5e3);class Xa extends xt{constructor(e){super(),__publicField(this,"elementObserver"),this.elementObserver=e}toString(){return"ElementObserverTask()"}inTransaction(){return!1}isUnloading(){return!1}cleanup(){Io.group("ElementObserverTask.cleanup()"),this.elementObserver.reset(),Io.groupEnd()}run(){return Io.debug("ElementObserverTask no-op done"),It.SUCCEEDED}}class Za extends xt{constructor(e,t,i,s,n,r,o,a,l){if(super(),__publicField(this,"environment"),__publicField(this,"browserEventLogger"),__publicField(this,"customer"),__publicField(this,"user"),__publicField(this,"override"),__publicField(this,"activityStorage"),__publicField(this,"attributeStorage"),__publicField(this,"customerStorage"),__publicField(this,"statusModel"),!nr(i))throw new Error("Hubspot integration must be enabled for the customer to use the HubspotFormsTask");this.environment=N(e),this.browserEventLogger=N(t),this.customer=N(i),this.user=N(s),this.override=N(n),this.activityStorage=N(r),this.attributeStorage=N(o),this.customerStorage=N(a),this.statusModel=N(l)}toString(){return"HubspotFormsTask()"}inTransaction(){return!1}isUnloading(){return!1}run(){return this.attachFormHandler(),It.SUCCEEDED}attachFormHandler(){window.addEventListener("message",(e=>{if(or(e)){const t=e.data.id;Io.debug(`handler fired for hubspot form; triggering lead association request (Form ID: ${t})`);const i=this.environment.generateActionId();this.findEvents(t).forEach((e=>{this.sendConversionEvent(e,i)}));const s=new Ja(this.environment,this.customer,"/hubspot-id-associator",(()=>rr(this.environment)));this.manager.addTask(s)}}))}findEvents(e){return fi.filterEvents(this.customer.getEvents()).filter((e=>this.override.isEventLive(e).orElse("live"===e.getState()))).filter((t=>t.getFormId()===e))}sendConversionEvent(e,t){Io.debug("Hubspot form submission send conversion event");const i=new Kn(e,t,void 0,void 0);this.activityStorage.add(Vr.buildConversionActivity(i,this.customer,this.environment,this.user,this.attributeStorage,this.customerStorage));const s=new _r(i,this.browserEventLogger,this.customer,this.customerStorage,this.statusModel);this.manager.addTask(s)}}const el=class extends xt{constructor(e,t,i,s,n,r,o,a,l){if(super(),__publicField(this,"environment"),__publicField(this,"browserEventLogger"),__publicField(this,"customer"),__publicField(this,"user"),__publicField(this,"override"),__publicField(this,"activityStorage"),__publicField(this,"attributeStorage"),__publicField(this,"customerStorage"),__publicField(this,"statusModel"),__publicField(this,"startTimeMs"),__publicField(this,"trackedForms",[]),!ar(i))throw new Error("Marketo integration must be enabled for the customer to use the MarketoFormsTask");this.environment=N(e),this.browserEventLogger=N(t),this.customer=N(i),this.user=N(s),this.override=N(n),this.activityStorage=N(r),this.attributeStorage=N(o),this.customerStorage=N(a),this.statusModel=N(l),this.startTimeMs=this.environment.getNowUnixTimeMs()}toString(){return"MarketoFormsTask()"}inTransaction(){return!1}isUnloading(){return!1}run(){const e=this.environment.getNowUnixTimeMs(),t=this.environment.getWindow();if(void 0!==t.MktoForms2)return Io.debug("marketo forms library ready"),this.attachFormHandlers(t.MktoForms2),It.SUCCEEDED;return e-this.startTimeMs>=el.WAIT_FOR_MKTOFORMS2_MS?(Io.debug(`marketo forms library not present on the page within ${el.WAIT_FOR_MKTOFORMS2_MS}ms`),It.SUCCEEDED):(Io.debug("marketo forms library not present; Will try again later."),It.TRY_LATER)}attachFormHandlers(e){e.whenReady((e=>{const t=String(e.getId());this.trackedForms.includes(t)?Io.debug(`marketo form already tracked (Form ID: ${t})`):(this.trackedForms.push(t),Io.debug(`attaching success handler to marketo (Form ID: ${t})`),e.onSuccess((()=>{Io.debug(`success handler fired for marketo form; triggering lead association request (Form ID: ${t})`);const e=this.environment.generateActionId();this.findEvents(t).forEach((t=>{this.sendConversionEvent(t,e)}));const i=new Ja(this.environment,this.customer,"/marketo-id-associator",(()=>lr(this.environment)));this.manager.addTask(i)})))}))}findEvents(e){return _i.filterEvents(this.customer.getEvents()).filter((e=>this.override.isEventLive(e).orElse("live"===e.getState()))).filter((t=>t.getFormId()===e))}sendConversionEvent(e,t){Io.debug("Marketo form submission send conversion event");const i=new Kn(e,t,void 0,void 0);this.activityStorage.add(Vr.buildConversionActivity(i,this.customer,this.environment,this.user,this.attributeStorage,this.customerStorage));const s=new _r(i,this.browserEventLogger,this.customer,this.customerStorage,this.statusModel);this.manager.addTask(s)}};let tl=el;__publicField(tl,"WAIT_FOR_MKTOFORMS2_MS",5e3);class il extends xt{toString(){return"PageUnloadingTask()"}inTransaction(){return!1}isUnloading(){return!0}run(){return Io.debug("page unload no-op done"),It.SUCCEEDED}}class sl extends xt{constructor(e,t){super(),__publicField(this,"environment"),__publicField(this,"browserEventLogger"),__publicField(this,"sent",!1),__publicField(this,"deliveryStatus",It.NOT_STARTED),this.environment=N(e),this.browserEventLogger=N(t)}toString(){return`PageviewEventTask(${this.environment.getPageviewId()})`}inTransaction(){return!0}isUnloading(){return!1}run(){return this.sendOnce(),this.deliveryStatus===It.SUCCEEDED?It.SUCCEEDED:this.deliveryStatus===It.FAILED?It.FAILED:(Io.debug("Waiting for pageview event delivery confirmation"),It.TRY_LATER)}sendOnce(){this.sent||(Io.info("Sending pageview event"),this.browserEventLogger.sendPageview().then((()=>{Io.info(`Pageview ${this.environment.getPageviewId()} event delivery success`),this.deliveryStatus=It.SUCCEEDED})).catch((e=>{const t=new gi(`Pageview ${this.environment.getPageviewId()} event delivery failed`,e);Io.warn(t,83),this.deliveryStatus=It.FAILED})),this.sent=!0)}}var nl=(e=>(e[e.TS=0]="TS",e[e.TZ=1]="TZ",e[e.DP=2]="DP",e[e.WP=3]="WP",e[e.US=4]="US",e[e.UM=5]="UM",e[e.UCM=6]="UCM",e[e.UT=7]="UT",e[e.UCN=8]="UCN",e[e.UPN=9]="UPN",e[e.UPNV=10]="UPNV",e[e.CAN=11]="CAN",e[e.CANV=12]="CANV",e[e.PID=13]="PID",e[e.IFTU=14]="IFTU",e[e.AID=15]="AID",e))(nl||{});const rl="=",ol="-";class al{static buildBrowserContext(e,t,i,s,n){const r=t.getInternalAttributes("user"),o=[];n.getExperiences().forEach((e=>{if("cc"!==e.getType()){const t=n.getVariationIds(e.getId());1===t.length?o.push(t[0]):Io.error("Non-cc experience does not have exactly one variation selected",181,{experienceId:e.getId()})}}));const a={isFirstTimeUser:i.isNewVisitor(),timestamp:e.getNowUnixTime(),customAttributes:t.getFlattenedCustomAttributes(),pageIds:s.getPages().map((e=>e.getId())),audienceIds:s.getAudiences().map((e=>e.getId())),selectedVariationIds:o};return void 0!==r.ts&&(a.trafficSource=r.ts),a.timeZone=e.getTimeZone(),void 0!==r.uts&&(a.utmSource=r.uts),void 0!==r.utm&&(a.utmMedium=r.utm),void 0!==r.utcm&&(a.utmCampaign=r.utcm),void 0!==r.utt&&(a.utmTerm=r.utt),void 0!==r.utcn&&(a.utmContent=r.utcn),a.hostingPageUrl=e.getHostingPageUrl().getRawUrl(),a}static buildFeatures(e,t,i,s){const n={},r=t.getInternalAttributes("user");return al.addFeature(n,0,al.getFeatureFromAttribute(r.ts)),al.addFeature(n,4,al.getFeatureFromAttribute(r.uts)),al.addFeature(n,5,al.getFeatureFromAttribute(r.utm)),al.addFeature(n,6,al.getFeatureFromAttribute(r.utcm)),al.addFeature(n,7,al.getFeatureFromAttribute(r.utt)),al.addFeature(n,8,al.getFeatureFromAttribute(r.utcn)),al.addFeature(n,9,al.getUrlParameterName(e)),al.addFeature(n,10,al.getUrlParameterNameValue(e)),al.addFeature(n,1,al.getTimeZoneValue(e)),al.addFeature(n,2,al.getDayPartValue(e)),al.addFeature(n,3,al.getWeekPartValue(e)),al.addFeature(n,11,al.getCustomAttributeName(t)),al.addFeature(n,12,al.getCustomAttributeNameValue(t)),al.addFeature(n,13,al.getPageId(s)),al.addFeature(n,14,al.getIsFirstTimeUser(i)),al.addFeature(n,15,al.getAudienceId(s)),n}static getFeatureFromAttribute(e){return j.ofNullable(e).toArray()}static getTimeZoneValue(e){return[e.getTimeZone()]}static getDayPartValue(e){return[e.getDayPart()]}static getWeekPartValue(e){return[e.getWeekPart()]}static getUrlParameterName(e){return Object.keys(e.getHostingPageUrl().getAllQueryParamsUnsafe()).filter((e=>""!==e))}static getUrlParameterNameValue(e){const t=e.getHostingPageUrl().getAllQueryParamsUnsafe(),i=[];return Object.keys(t).forEach((e=>{i.push(e+ol+t[e])})),i}static getCustomAttributeName(e){const t=e.getFlattenedCustomAttributes();return Object.keys(t)}static getCustomAttributeNameValue(e){const t=e.getFlattenedCustomAttributes();return Object.keys(t).map((e=>e+ol+t[e]))}static getPageId(e){return e.getPages().map((e=>e.getId()))}static getIsFirstTimeUser(e){return[e.isNewVisitor().toString()]}static getAudienceId(e){return e.getAudiences().map((e=>e.getId()))}static buildUnaryFeature(e,t){return nl[e]+rl+t}static addFeature(e,t,i){i.forEach((i=>{e[al.buildUnaryFeature(t,i)]=!0}))}}class ll{constructor(){__publicField(this,"variationLists",{}),__publicField(this,"experiences",{}),__publicField(this,"stickyVariations",{}),__publicField(this,"modelVersions",{})}unshift(e){const t=e.getExperience(),i=t.getId();void 0===this.variationLists[i]&&(this.variationLists[i]=[]),this.variationLists[i].unshift(e),this.experiences[i]=t}isEmpty(){return!Object.keys(this.variationLists).some((e=>this.variationLists[e].length>0))}getExperience(e){return this.experiences[e]}getExperiences(){return Object.keys(this.variationLists).map((e=>this.experiences[e]))}setModelVersion(e,t){this.modelVersions[e]=t}getModelVersion(e){return this.modelVersions[e]}sortVariations(e,t){var i;null==(i=this.variationLists[e])||i.sort(t)}prioritizeStickyVariation(e,t){if(Io.group("prioritizeVariation(experience:"+e+", variation:"+t+")"),e in this.variationLists){let i=-1;this.variationLists[e].forEach(((e,s)=>{e.getId()===t&&(i=s)})),Io.debug("found variation index? => "+i),-1!==i&&(this.variationLists[e]=[this.variationLists[e][i]],e in this.stickyVariations||(this.stickyVariations[e]={}),this.stickyVariations[e][t]=!0)}Io.groupEnd()}getVariationIds(e){var t,i;return null!=(i=null==(t=this.variationLists[e])?void 0:t.map((e=>e.getId())))?i:[]}hasNext(e){const t=this.variationLists[e];return void 0!==t&&t.length>0}shift(e){var t;if(!(e in this.variationLists))throw new V("No value present");const i=null==(t=this.variationLists[e])?void 0:t.shift();if(this.removeIfEmpty(e),void 0!==i)return i;throw new V("No value present")}getFirst(e){var t;const i=this.variationLists[e];if(void 0===i)throw new V("No experience present");if(0===i.length)throw new V("No variations present");const s=null==(t=this.variationLists[e])?void 0:t[0];if(void 0!==s)return s;throw new V("No value present")}removeVariation(e,t){t.getId();const i=this.variationLists[e];if(void 0!==i){let s=-1;i.forEach(((e,i)=>{e.getId()===t.getId()&&(s=i)})),-1!==s&&(i.splice(s,1),this.removeIfEmpty(e))}}removeExperience(e){e in this.experiences&&delete this.experiences[e],e in this.variationLists&&delete this.variationLists[e]}isDecidingExperience(e){return e.getId()in this.experiences}isStickyVariation(e){var t;const i=e.getId(),s=e.getExperience().getId();return Boolean(null==(t=this.stickyVariations[s])?void 0:t[i])}toString(){let e="{\n";return Object.keys(this.variationLists).forEach((t=>{e+="  "+t+": ",e+="["+this.variationLists[t].map((e=>e.getId())).join(", ")+"]",e+="\n"})),e+="}\n",e}removeIfEmpty(e){const t=this.variationLists[e];void 0!==t&&0===t.length&&this.removeExperience(e)}}class cl extends xt{constructor(e,t,i,s,n,r,o,a,l,c,u,d,h,g,p,m,v){super(),__publicField(this,"environment"),__publicField(this,"browserStorage"),__publicField(this,"extensionManager"),__publicField(this,"browserEventLogger"),__publicField(this,"customer"),__publicField(this,"customerStorage"),__publicField(this,"attributeStorage"),__publicField(this,"activityStorage"),__publicField(this,"user"),__publicField(this,"override"),__publicField(this,"pageContext"),__publicField(this,"attributeData"),__publicField(this,"statusModel"),__publicField(this,"elementObserver"),__publicField(this,"runtime"),__publicField(this,"hider"),__publicField(this,"decisionContext"),__publicField(this,"getVariationRecordedCallbackTuples"),__publicField(this,"getEligibleCc",!1),__publicField(this,"selectAb",!1),__publicField(this,"selectRbp",!1),__publicField(this,"haveRunCampaignCode",{}),this.environment=N(e),this.browserStorage=N(t),this.extensionManager=N(i),this.browserEventLogger=N(s),this.customer=N(n),this.customerStorage=N(r),this.attributeStorage=N(o),this.activityStorage=N(a),this.user=N(l),this.override=N(c),this.pageContext=N(u),this.attributeData=N(d),this.statusModel=N(h),this.runtime=N(g),this.hider=N(p),this.getVariationRecordedCallbackTuples=N(m),this.elementObserver=N(v),this.decisionContext=new ll}toString(){return"SelectVariationsTask()"}inTransaction(){return!1}isUnloading(){return!1}selectAbExperienceVariationsOnce(){this.selectAb||(Io.time("selectAbExperienceVariationsOnce"),Io.group("selectAbExperienceVariationsOnce()"),this.customer.getCampaigns().forEach((e=>{Ss.filterExperiences(e.getExperiences()).filter((e=>this.isExperienceEligible(e))).forEach((t=>{let i;if(this.runCampaignCodeOnce(e),this.override.hasVariationIds(t).isPresent()){const e=this.override.hasVariationIds(t).get();i=t.getVariation(e[0])}else{const e=1e3,s=Ra(Na(t.getId()+this.user.getId(),1),e);i=t.selectVariation(s)}i.ifPresent((e=>{this.isVariationEligible(e)?(this.decisionContext.unshift(e),this.decisionContext.setModelVersion(t.getId(),"ab")):Io.error("Selected A/B variation is not eligible",182,{experienceId:t.getId(),variationId:e.getId()})})).ifAbsent((()=>{Io.error("Failed to select variation for A/B experience",183,{experienceId:t.getId()})}))}))})),Io.groupEnd(),Io.timeEnd("selectAbExperienceVariationsOnce"),this.selectAb=!0)}selectRbpExperienceVariationsOnce(){this.selectRbp||(Io.time("selectRbpExperienceVariationsOnce"),Io.group("selectRbpExperienceVariationsOnce()"),this.customer.getCampaigns().forEach((e=>{Is.filterExperiences(e.getExperiences()).filter((e=>this.isExperienceEligible(e))).forEach((t=>{this.runCampaignCodeOnce(e);for(const e of t.getPrioritizedVariations())if(this.isVariationEligible(e)){this.decisionContext.unshift(e),this.decisionContext.setModelVersion(t.getId(),"rbp");break}void 0===this.decisionContext.getExperience(t.getId())&&Io.info("Failed to select variation for RBP",184,{experienceId:t.getId()})}))})),Io.groupEnd(),Io.timeEnd("selectRbpExperienceVariationsOnce"),this.selectRbp=!0)}getCcEligibleVariationsOnce(){this.getEligibleCc||(Io.time("getCcEligibleVariationsOnce"),Io.group("getCcEligibleVariationsOnce()"),this.customer.getCampaigns().forEach((e=>{ws.filterExperiences(e.getExperiences()).filter((e=>this.isExperienceEligible(e))).forEach((t=>{this.runCampaignCodeOnce(e);const i=this.override.isControl().orElseRun((()=>this.customerStorage.updateAndGetControl(e)));if(this.statusModel.setCampaign(e,"control",i),i){const e=t.getControlVariation();this.decisionContext.unshift(e)}else t.getRealVariations().forEach((e=>{this.isVariationEligible(e)&&this.decisionContext.unshift(e)}))}))})),Io.groupEnd(),Io.timeEnd("getCcEligibleVariationsOnce"),this.getEligibleCc=!0)}isExperienceEligible(e){Io.group("isExperienceEligible(experience:"+e.getId()+")"),Io.debug("check experience enabled");let t=" (override)";const i=this.override.isExperienceEnabled(e).orElseRun((()=>(t="",e.isEnabled())));if(Io.info(`Experience ${e.getId()} enabled => ${i}${t}`),this.statusModel.setExperience(e,"enabled",i),!i)return this.customerStorage.deleteExperiencePredictionSelection(e),Io.groupEnd(),!1;let s=!1;Io.debug(`Experience URL match (at least one match), URL: ${this.environment.getHostingPageUrl().getRawUrl()}`);const n=Ua(this.pageContext,e.getPages());if(Io.debug("url match => "+(n.length>0)),this.statusModel.setExperience(e,"urlMatch",n.length>0),n.length>0&&(Io.info(`Experience ${e.getId()} URL check, URL:${this.environment.getHostingPageUrl().getRawUrl()} Page:${n[0].getName()} => true`),s=!0),!s){const{experienceIds:t}=this.environment.getWebflowPageMetadata();t.length>0&&(Io.debug("Webflow Page Metadata Experience ID check"),t.includes(e.getId())&&(Io.debug("Webflow experience => true"),s=!0))}if(!s)return Io.groupEnd(),!1;Io.debug("check experience condition");let r=" (override)";const o=this.override.passExperienceCondition().orElseRun((()=>(r="",Io.debug("evaluating experience condition"),e.getCondition().map((t=>{let i=!1;try{i=t.evaluate(this.runtime)}catch(s){const t=new gi("Experience condition evaluation failed",s);i=!1,Io.error(t,206,{experienceId:e.getId()})}return i})).orElse(!0))));if(Io.info(`Experience ${e.getId()} condition passed => ${o}${r}`),this.statusModel.setExperience(e,"passCondition",o),!o)return Io.groupEnd(),this.customerStorage.deleteExperiencePredictionSelection(e),!1;Io.debug("check experience inclusion");let a=" (override)";const l=this.override.isExperienceIncluded(e).orElseRun((()=>(a="",this.customerStorage.updateAndGetExperienceInclusion(e))));return Io.info(`Experience ${e.getId()} inclusion => ${l}${a}`),this.statusModel.setExperience(e,"inclusion",l),l?(Io.debug("isExperienceEligible => true"),Io.groupEnd(),!0):(Io.groupEnd(),this.customerStorage.deleteExperiencePredictionSelection(e),!1)}isVariationEligible(e){Io.group("isVariationEligible(variation:"+e.getId()+")"),Io.debug("check variation enabled");let t=" (override)";const i=this.override.isVariationEnabled(e).orElseRun((()=>(t="",e.isEnabled())));if(Io.info(`Variation ${e.getExperience().getId()}/${e.getId()} enabled => ${i}${t}`),this.statusModel.setVariation(e,"enabled",i),!i)return Io.groupEnd(),!1;Io.debug("check variation condition");let s=" (override)";const n=this.override.passVariationCondition().orElseRun((()=>(s="",e.getCondition().map((t=>{let i=!1;try{i=t.evaluate(this.runtime)}catch(s){const t=new gi("Variation condition evaluation failed ",s);i=!1,Io.error(t,207,{experienceId:e.getExperience().getId(),variationId:e.getId()})}return i})).orElse(!0))));return Io.info(`Variation ${e.getExperience().getId()}/${e.getId()} condition passed => ${n}${s}`),this.statusModel.setVariation(e,"passCondition",n),n?(Io.debug("isVariationEligible => true"),Io.groupEnd(),!0):(Io.groupEnd(),!1)}runCampaignCodeOnce(e){const t=e.getId();this.haveRunCampaignCode[t]||(this.haveRunCampaignCode[t]=!0,e.getCss().ifPresent((i=>{try{Io.info(`Injecting campaign ${e.getId()} css`),wt.injectCss(i,`campaign-${t}`,this.environment.getWindow().document),this.statusModel.setCampaign(e,"css",!0)}catch(s){const t=new gi(`Campaign (${e.getId()}) css injection failed`,s);Io.error(t,90,{campaignId:e.getId()}),this.statusModel.setCampaign(e,"css",!1)}})),e.getCode().ifPresent((t=>{try{Io.info(`Running campaign ${e.getId()} code`),wt.eval(t),this.statusModel.setCampaign(e,"code",!0)}catch(i){const t=new gi(`Campaign (${e.getId()}) code execution failed`,i);Io.error(t,14,{campaignId:e.getId()}),this.statusModel.setCampaign(e,"code",!1)}})))}}class ul extends cl{constructor(){super(...arguments),__publicField(this,"policyCallbackFunctions",[]),__publicField(this,"executeExperiencesTask"),__publicField(this,"policy"),__publicField(this,"sent",!1),__publicField(this,"apiStatus",It.WAITING)}static get PREDICTION_ENDPOINT(){return"/prediction"}toString(){return"SelectVariationsTaskV5()"}onPolicyReady(e){void 0===this.policy?this.policyCallbackFunctions.push(e):e(this.policy)}run(){return this.selectAbExperienceVariationsOnce(),this.selectRbpExperienceVariationsOnce(),this.getCcEligibleVariationsOnce(),Io.debug("decisionContext: "+this.decisionContext),void 0===this.executeExperiencesTask&&(this.executeExperiencesTask=new zr(this.environment,this.browserStorage,this.extensionManager,this.browserEventLogger,this.attributeStorage,this.activityStorage,this.customerStorage,this.decisionContext,this.pageContext,this.attributeData,this.user,this.override,this.statusModel,this.hider,!0,this.getVariationRecordedCallbackTuples,this.elementObserver)),this.executeExperiencesTask.hideExperiencesOnce(),this.sendOnce(),this.apiStatus===It.FAILED?It.FAILED:this.apiStatus===It.SUCCEEDED?It.SUCCEEDED:It.TRY_LATER}buildRequest(){const e=this.user.getId(),t=this.customerStorage.updateAndGetSessionId(),i=this.override.isControl().orElseRun((()=>this.customerStorage.setAndGetCustomerControl(this.customer))),s={};ws.filterExperiences(this.decisionContext.getExperiences()).forEach((e=>{const t=e.getId(),i=this.customerStorage.getStickyVariation(e).map((e=>e.getId())).orElse("NEVER_MATCH");s[t]=this.decisionContext.getVariationIds(t).map((e=>({variationId:e,isSticky:i===e})))}));const n=al.buildBrowserContext(this.environment,this.attributeStorage,this.user,this.pageContext,this.decisionContext);return{userId:e,sessionId:t,isControl:i,candidates:s,context:n}}sendOnce(){if(this.sent)return;Io.debug("SelectVariationsTaskV5.sendOnce()");const e=this.buildRequest();this.environment.fetch(ie,`${ul.PREDICTION_ENDPOINT}/${this.customer.getId()}`,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:xe(e)}).then((t=>{if(Bt(t)){const e=this.environment.getHostingPageUrl().getOrigin();console.warn(`${e} is not allowed to receive this data. If youre expecting data to work here, check the Allowed Domains list at https://app.intellimize.com`)}Io.debug("SelectVariationsTaskV5.sendOnce() => got reply");const i=this.override.isControl().orElseRun((()=>this.customerStorage.setAndGetCustomerControl(this.customer)));this.policy=i?Fo.buildControlPolicy(this.environment):Bt(t)?Fo.buildDefaultPolicy(this.environment,e):new Fo(t.policy),this.prioritizeCcVariations(this.policy),this.apiStatus=It.SUCCEEDED,this.executePolicyReadyFunctions(this.policy),this.manager.addTask(this.executeExperiencesTask),this.manager.runNow()})).catch((e=>{const t=new gi("Caught exception in prediction call",e);Io.error(t,148),this.apiStatus=It.FAILED})),this.sent=!0}prioritizeCcVariations(e){Io.debug("SelectVariationsTaskV5.prioritizeCcVariations()"),ws.filterExperiences(this.decisionContext.getExperiences()).forEach((t=>{const i=t.getId(),s=e.getExperienceVariationId(i);let n;for(;this.decisionContext.hasNext(i);){const e=this.decisionContext.shift(i);e.getId()===s&&(n=e)}void 0===n?Io.error("Prediction API did not select an eligible variation",149):(this.decisionContext.unshift(n),this.customerStorage.getStickyVariation(this.decisionContext.getExperience(i)).ifPresent((e=>{Io.info(`Variation ${i}/${e.getId()} selection was sticky`),this.decisionContext.prioritizeStickyVariation(i,e.getId())})),this.decisionContext.setModelVersion(i,e.getExperienceModelVersion(i))),this.statusModel.setExperienceSortedVariations(this.decisionContext.getExperience(i),this.decisionContext.getVariationIds(i))})),Io.debug(`decisionContext: ${this.decisionContext}`)}executePolicyReadyFunctions(e){Io.debug("SelectVariationsTaskV5.executePolicyReadyFunctions()");for(let t=this.policyCallbackFunctions.shift();void 0!==t;t=this.policyCallbackFunctions.shift())t(e)}}class dl extends xt{constructor(e,t,i,s){super(),__publicField(this,"environment"),__publicField(this,"customer"),__publicField(this,"integrationDataStorage"),__publicField(this,"user"),__publicField(this,"apiStatus",It.NOT_STARTED),__publicField(this,"sent",!1),this.environment=e,this.customer=t,this.user=i,this.integrationDataStorage=s}static get ENDPOINT(){return"/context-v2"}toString(){return"ServerContextTask()"}inTransaction(){return!1}isUnloading(){return!1}run(){return this.sendOnce(),this.apiStatus===It.SUCCEEDED?It.SUCCEEDED:this.apiStatus===It.FAILED?It.FAILED:(Io.debug("Waiting for server response"),It.TRY_LATER)}buildRequestBody(){return this.getCommonRequestBody()}handleResponse(e,t){this.integrationDataStorage.setDataAndMetadata("marketo",t.integrationData.marketo,void 0===e.marketo?void 0:{})}getCommonRequestBody(){const e={clientVersion:Q,userId:this.user.getId()};return ar(this.customer)&&lr(this.environment).ifPresent((t=>{e.marketo={cookie:t}})),e}sendOnce(){if(!this.sent){const e=this.buildRequestBody();this.environment.fetch(ie,`${dl.ENDPOINT}/${this.customer.getId()}`,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:xe(e)}).then((t=>{if(Bt(t)){const t=this.environment.getHostingPageUrl().getOrigin();console.warn(`${t} is not allowed to receive this data. If youre expecting data to work here, check the Allowed Domains list at https://app.intellimize.com`),this.handleResponse(e,{requestId:"00000000-0000-1000-a000-000000000000",clientIp:"0.0.0.0",userAgentDigest:"00000000000000000000000000000000",userAgent:{},location:{},integrationData:{}})}else Io.info("Successfully retrieved ServerContext"),this.handleResponse(e,t);this.apiStatus=It.SUCCEEDED,this.manager.runNow()})).catch((e=>{const t=new gi("Caught exception in server context task",e);Io.error(t,156),this.apiStatus=It.FAILED}))}this.sent=!0}}class hl extends dl{constructor(e,t,i,s,n,r){super(e,t,i,s),__publicField(this,"serverContextStorage"),__publicField(this,"isNewSession"),this.serverContextStorage=n,this.isNewSession=r}static get DOMAIN_NOT_AVAILABLE(){return"NA"}static shouldWaitForServerContext(e,t,i,s,n){var r,o,a;let l=!1;pr(e)&&mr(t).ifPresent((e=>{const t=i.getMetadata("salesforce").orElse({});void 0!==(null==e?void 0:e.leadIdHash)&&(null==t?void 0:t.leadIdHash)!==e.leadIdHash&&(l=!0),void 0!==(null==e?void 0:e.contactIdHash)&&(null==t?void 0:t.contactIdHash)!==e.contactIdHash&&(l=!0)}));const c=i.getAllMetdata(),u=Jn(e)&&void 0===(null==(r=c.firmographic)?void 0:r.domain)||vr(e)&&void 0===(null==(o=c["6sense"])?void 0:o.domain)||Yn(e)&&void 0===(null==(a=c.demandbase)?void 0:a.website),d=!s.get().map((e=>Object.keys(null==e?void 0:e.location).length>0&&Object.keys(null==e?void 0:e.userAgent).length>0)).orElse(!1);return l||u||d||n}toString(){return"ServerContextTaskV5()"}buildRequestBody(){const e=this.getCommonRequestBody();if(this.serverContextStorage.get().map((e=>e.clientIp)).ifPresent((t=>{e.clientIp=t})),pr(this.customer)){const t=this.integrationDataStorage.getMetadata("salesforce").orElse({}),i=mr(this.environment),s=null==t?void 0:t.leadIdHash,n=i.map((e=>null==e?void 0:e.leadIdHash)).orElse(void 0),r=null!=n?n:s,o=null==t?void 0:t.contactIdHash,a=i.map((e=>null==e?void 0:e.contactIdHash)).orElse(void 0),l=null!=a?a:o;if(void 0!==r||void 0!==l){const t={};void 0!==r&&(t.leadIdHash=r),void 0!==l&&(t.contactIdHash=l),e.salesforce=t}}return this.isNewSession||(this.integrationDataStorage.getMetadata("firmographic").flatMap((e=>j.ofNullable(null==e?void 0:e.domain))).ifPresent((t=>{e.firmographic={domain:t}})),this.integrationDataStorage.getMetadata("6sense").flatMap((e=>j.ofNullable(null==e?void 0:e.domain))).ifPresent((t=>{e["6sense"]={domain:t}})),this.integrationDataStorage.getMetadata("demandbase").flatMap((e=>j.ofNullable(null==e?void 0:e.website))).ifPresent((t=>{e.demandbase={website:t}}))),nr(this.customer)&&rr(this.environment).ifPresent((t=>{e.hubspot={cookie:t}})),e}handleResponse(e,t){var i,s,n,r,o,a,l,c,u,d,h,g,p;const m=t,{integrationData:v}=m,b=__objRest(m,["integrationData"]);this.integrationDataStorage.setDataAndMetadata("marketo",v.marketo,void 0===e.marketo?void 0:{}),this.integrationDataStorage.setDataAndMetadata("salesforce",v.salesforce,null!=(i=e.salesforce)?i:void 0),this.integrationDataStorage.setDataAndMetadata("hubspot",v.hubspot,void 0===e.hubspot?void 0:{}),(null==(s=e.firmographic)?void 0:s.domain)!==(null==(n=v.firmographic)?void 0:n.domain)&&((null==(r=v.firmographic)?void 0:r.domain)===hl.DOMAIN_NOT_AVAILABLE?this.integrationDataStorage.setDataAndMetadata("firmographic",{},{domain:hl.DOMAIN_NOT_AVAILABLE}):this.integrationDataStorage.setDataAndMetadata("firmographic",v.firmographic,{domain:null==(o=v.firmographic)?void 0:o.domain})),(null==(a=e["6sense"])?void 0:a.domain)!==(null==(l=v["6sense"])?void 0:l.domain)&&((null==(c=v["6sense"])?void 0:c.domain)===hl.DOMAIN_NOT_AVAILABLE?this.integrationDataStorage.setDataAndMetadata("6sense",{},{domain:hl.DOMAIN_NOT_AVAILABLE}):this.integrationDataStorage.setDataAndMetadata("6sense",v["6sense"],{domain:null==(u=v["6sense"])?void 0:u.domain})),(null==(d=e.demandbase)?void 0:d.website)!==(null==(h=v.demandbase)?void 0:h.website)&&((null==(g=v.demandbase)?void 0:g.website)===hl.DOMAIN_NOT_AVAILABLE?this.integrationDataStorage.setDataAndMetadata("demandbase",{},{website:hl.DOMAIN_NOT_AVAILABLE}):this.integrationDataStorage.setDataAndMetadata("demandbase",v.demandbase,{website:null==(p=v.demandbase)?void 0:p.website})),this.serverContextStorage.set(b)}}class gl{constructor(e,t,i){__publicField(this,"environment"),__publicField(this,"storageKeyPrefix"),__publicField(this,"eventProcessor"),__publicField(this,"isObserving",!1),__publicField(this,"pollTimer"),this.environment=e,this.storageKeyPrefix=t,this.eventProcessor=i}static get POLLING_INTERVAL_MS(){return 1e3}start(){this.isObserving||(Io.debug("StorageQueueConsumer starting to poll"),this.isObserving=!0,this.poll())}stop(){Io.debug("StorageQueueConsumer stopping polling"),this.environment.getWindow().clearTimeout(this.pollTimer),this.isObserving=!1}handlePageUnload(){this.poll(),this.stop()}readSessionStorage(e){try{return this.environment.readSessionStorage(e)}catch(t){const i=new gi(`StorageQueueConsumer: Storage failed for getItem("${e}")`,t);throw Io.warn(i,227),i}}writeSessionStorage(e,t){try{this.environment.writeSessionStorage(e,t)}catch(i){const t=new gi(`StorageQueueConsumer: Storage failed for setItem("${e}")`,i);throw Io.warn(t,228),t}}removeSessionStorage(e){try{this.environment.deleteSessionStorage(e)}catch(t){const i=new gi(`StorageQueueConsumer: Storage failed for removeItem("${e}")`,t);throw Io.warn(i,229),i}}poll(){const e=`${this.storageKeyPrefix}lastWrittenId`,t=`${this.storageKeyPrefix}lastReadId`;let i=j.empty(),s=0;try{i=this.readSessionStorage(e).map((e=>Number.parseInt(e,10))),s=this.readSessionStorage(t).map((e=>Number.parseInt(e,10))).orElse(0)}catch(n){return void this.stop()}if(i.isPresent()&&s<i.get()){const e=s+1,i=`${this.storageKeyPrefix}event-${e}`;let o=j.empty();try{o=this.readSessionStorage(i)}catch(n){return void this.stop()}try{this.writeSessionStorage(t,e.toString()),this.removeSessionStorage(i)}catch(n){return void this.stop()}if(o.isPresent()){let e;try{e=JSON.parse(o.get())}catch(r){const e=new gi(`StorageQueueConsumer: Event in queue is not valid JSON: "${o.get()}"`,r);Io.error(e,230)}if(void 0!==e)try{Io.debug(`StorageQueueConsumer processing event ${Te(e)}`),this.eventProcessor(e)}catch(r){const e=new gi("StorageQueueConsumer: Could not process event",r);Io.error(e,231)}this.poll()}else Io.error(new Error(`StorageQueueConsumer: event-${e} not found in session storage`),232),this.pollAfterDelay()}else this.pollAfterDelay()}pollAfterDelay(){this.environment.getWindow().clearTimeout(this.pollTimer),this.pollTimer=this.environment.getWindow().setTimeout((()=>{this.poll()}),gl.POLLING_INTERVAL_MS)}}const pl=3e3,ml=1;class vl extends xt{constructor(e,t,i,s,n,r,o,a,l){super(),__publicField(this,"environment"),__publicField(this,"browserEventLogger"),__publicField(this,"customer"),__publicField(this,"customerStorage"),__publicField(this,"attributeStorage"),__publicField(this,"activityStorage"),__publicField(this,"user"),__publicField(this,"statusModel"),__publicField(this,"taskManager"),__publicField(this,"taskStartTime"),__publicField(this,"storageQueueConsumer"),this.environment=N(e),this.browserEventLogger=N(t),this.customer=N(i),this.customerStorage=N(s),this.attributeStorage=N(n),this.activityStorage=N(r),this.user=N(o),this.statusModel=N(a),this.taskManager=N(l),R(this.customer.getIntegrationShopify().isPresent())}inTransaction(){return!0}isUnloading(){return!1}getStorageQueueConsumer(){return j.ofNullable(this.storageQueueConsumer)}run(){void 0===this.taskStartTime&&(this.taskStartTime=this.environment.getNowDate(),Io.debug(`ShopifyStorageQueueTask start time: ${this.taskStartTime.getTime()}`));const e=this.environment.getNowDate().getTime()-this.taskStartTime.getTime(),t=this.waitForCurrencyRate(e);return t.isPresent()?(this.storageQueueConsumer=new gl(this.environment,`${ge}${this.customer.getId()}_`,(e=>{Ir(e,t.get(),this.customer,this.environment,this.customerStorage,this.attributeStorage,this.activityStorage,this.user,this.statusModel,this.taskManager,this.browserEventLogger)})),this.storageQueueConsumer.start(),It.SUCCEEDED):It.TRY_LATER}waitForCurrencyRate(e){const t=this.environment.getWindow();if(void 0===t.Shopify)Io.debug(`window.Shopify not defined after ${e} ms`);else{if(!on(t.Shopify))return Io.error("window.Shopify is not an object",245),j.of(ml);if(void 0===t.Shopify.currency)Io.debug(`window.Shopify.currency not defined after ${e} ms`);else{if(!on(t.Shopify.currency))return Io.error("window.Shopify.currency is not an object",246),j.of(ml);if(void 0!==t.Shopify.currency.rate)return b(t.Shopify.currency.rate)?(Io.debug(`window.Shopify.currency defined after ${e} ms (${t.Shopify.currency.rate})`),j.of(Number(t.Shopify.currency.rate))):(Io.error("window.Shopify.currency.rate is not a non-empty string",247),j.of(ml));Io.debug(`window.Shopify.currency.rate not defined after ${e} ms`)}}return e>=pl?(Io.error(`Timed out waiting for window.Shopify.currency (waited ${e}ms)`,248),j.of(ml)):j.empty()}}class bl extends Mo{constructor(){super(...arguments),__publicField(this,"hasRun",!1),__publicField(this,"isRestartingStatus",!1),__publicField(this,"taskManager"),__publicField(this,"environment"),__publicField(this,"override"),__publicField(this,"customer"),__publicField(this,"conditionEvaluationRuntime"),__publicField(this,"elementObserver"),__publicField(this,"pageContext"),__publicField(this,"customerStorage"),__publicField(this,"attributeStorage"),__publicField(this,"integrationDataStorage"),__publicField(this,"serverContextStorage"),__publicField(this,"intellimizeApi"),__publicField(this,"user"),__publicField(this,"browserStorage"),__publicField(this,"localStorage"),__publicField(this,"statusModel"),__publicField(this,"attributeData"),__publicField(this,"activityStorage"),__publicField(this,"internalApi"),__publicField(this,"hider"),__publicField(this,"browserEventLogger"),__publicField(this,"shopifyStorageQueueTask",j.empty()),__publicField(this,"extensionManager")}run(){return __async(this,null,(function*(){if(Io.info("Starting client"),Io.time("Client run time"),this.hasRun)return void Io.error("Tried to run client again",143);Io.time("new Environment");const e=va(window);this.environment=new na(window,e),Io.configureEnvironment(this.environment),Io.timeEnd("new Environment");if(void 0!==this.environment.getWindow().ipgvidtfr)return void Io.error("Intellimize duplicate code detected on page.",144);this.environment.getWindow().ipgvidtfr=this.environment.getPageviewId(),this.extensionManager=oa(),this.hider=new jo(this.environment,this.extensionManager),this.hider.startTimedRegionHider();const t=Kt(this.environment);if(!t.isPresent())return void jo.revealAll(this.environment.getWindow().document);const i=Xt(t.get());if(!i.isPresent())return void jo.revealAll(this.environment.getWindow().document);if(this.customer=i.get(),Io.configureCustomer(this.customer),Io.time("load json"),this.override=new ba(this.environment,this.customer),!this.override.shouldRun().orElse(!0))return Io.info("Client not running"),this.environment.getWindow().inrsgew=!0,void jo.revealAll(this.environment.getWindow().document);if(this.override.shouldHide().orElse(!0)||jo.revealAll(this.environment.getWindow().document),this.localStorage=new Ca(this.environment),this.intellimizeApi=new ca(this.environment),this.intellimizeApi.initialize(),this.taskManager=new $a(this,this.environment),this.override.shouldCheckOptOut().orElse(!0)&&Zt(this.customer,this.localStorage,this.environment))return void jo.revealAll(this.environment.getWindow().document);Io.time("Setup storage"),this.browserStorage=yield ei(this.localStorage,this.environment,this.taskManager,this.customer,this.override),this.user=new La(this.browserStorage,this.environment,this.customer),Io.configureUser(this.user),this.statusModel=this.override.showStatusModule().orElse(!1)?new Ea(this.environment,this.customer,this.override,this.browserStorage):new ya,this.customerStorage=new wa(this.customer,this.environment,this.browserStorage,this.override);const s=this.customerStorage.getSessionId(),n=this.customerStorage.updateAndGetSessionId(),r=!s.map((e=>e===n)).orElse(!1);if(this.customer.isCampaignControl()||this.customerStorage.setAndGetCustomerControl(this.customer),this.attributeStorage=new Sa(this.customer,this.environment,this.browserStorage,this.user),this.activityStorage=new Vr(this.customer,this.browserStorage,this.environment,this.override),Ht(this.environment,this.attributeStorage,this.customer),this.integrationDataStorage=new Ia(this.customer,this.browserStorage),tr(this.customer)&&ir(this.environment,this.integrationDataStorage,this.customer),this.serverContextStorage=new Ta(this.customer,this.browserStorage),Io.timeEnd("Setup storage"),this.environment.addUnloadHandler((()=>{try{this.handlePageUnload()}catch(e){const t=new gi("Exception in ClientV5 unload handler",e);Io.error(t,240)}})),this.attributeData=new To(this.environment,void 0,this.attributeStorage,this.override,this.customerStorage,this.integrationDataStorage,this.user),this.conditionEvaluationRuntime=new No(this.attributeData,this.activityStorage),this.customer.getLimitedModeCondition().isPresent()){const e=this.customer.getLimitedModeCondition().get();let t=!1;try{t=e.evaluate(this.conditionEvaluationRuntime)}catch(a){t=!1;const e=new gi('"Limited mode" condition evaluation failed',a);Io.error(e,261)}if(Io.debug(`check "limited mode" => ${t}`),t)return this.environment.getWindow().inrsgew=!0,void jo.revealAll(this.environment.getWindow().document)}const o=new hl(this.environment,this.customer,this.user,this.integrationDataStorage,this.serverContextStorage,r);hl.shouldWaitForServerContext(this.customer,this.environment,this.integrationDataStorage,this.serverContextStorage,r)?o.onDone((()=>{this.postServerContextWork()})):this.postServerContextWork(),this.taskManager.addTask(o),this.hasRun=!0,Io.timeEnd("Client run time"),this.taskManager.runNow()}))}reRun(e){Io.info("Client.reRun()"),this.isRestartingStatus=!0,this.handlePageUnload(),this.environment.getWindow().setTimeout((()=>{this.taskManager.stop(),this.taskManager.onDone((()=>{this.statusModel.reinitializeExperienceVariations(),this.environment.reinitialize(),this.taskManager.addTask(new Xa(this.elementObserver)),this.customerStorage.updateAndGetSessionId(),Ht(this.environment,this.attributeStorage,this.customer),tr(this.customer)&&ir(this.environment,this.integrationDataStorage,this.customer),this.attributeData.reinitialize(),this.internalApi.reinitialize(),e.forEach((e=>{wt.executeFunction(e,150)})),this.activityStorage.add(Vr.buildPageviewActivity(this.customer,this.environment,this.user,this.attributeStorage,this.customerStorage)),this.pageContext.reinitialize(),Qt(this.customer,this.statusModel,this.environment.getWindow().document),this.scheduleTasks(),this.isRestartingStatus=!1}))}),0)}isRestarting(){return Io.debug(`Client.isRestarting() => ${this.isRestartingStatus}`),this.isRestartingStatus}postServerContextWork(){Io.time("postServerContextWork");const e=this.serverContextStorage.get();if(!e.isPresent())return void Io.error("Expected ServerContext is missing",146);const t=e.get();Io.debug(`postServerContextWork() serverContext: ${Te(t)}`),Io.configureServerContext(t),this.attributeData.setServerContext(t),this.elementObserver=this.override.useElementObserver().orElse(!0)?new qo:new Lo,this.taskManager.addTask(new Xa(this.elementObserver)),this.pageContext=new fa(this.environment,this.browserStorage,this.extensionManager,this.customer,this.conditionEvaluationRuntime,this.attributeData,this.override,this.taskManager,this.hider,this.elementObserver,this.statusModel),this.browserEventLogger=new Do(this.customer,this.environment,this.user,this.attributeStorage,this.pageContext,t,this.customerStorage,void 0,this.override);const i=new Qr(this.environment,this.extensionManager,this.browserEventLogger,this.taskManager,this.customerStorage,this.attributeStorage,this.activityStorage,this.integrationDataStorage,this.customer,this.user,this.override,this.statusModel,this.intellimizeApi.extractCallQueue(),this.intellimizeApi.extractReadyCallbackQueue(),(e=>{this.addVariationRecordedCallbackTuple(e)}));i.initialize(),this.internalApi=new ua(this.customer,this.user,this.environment,this.extensionManager,t,this.taskManager,this.browserStorage,this.customerStorage,i,this.attributeData,this.elementObserver),this.internalApi.initialize(),this.activityStorage.add(Vr.buildPageviewActivity(this.customer,this.environment,this.user,this.attributeStorage,this.customerStorage)),Qt(this.customer,this.statusModel,this.environment.getWindow().document),this.pageContext.reinitialize(),this.scheduleTasks(this.browserEventLogger),this.override.injectVisualEditor().orElse(!1)&&this.environment.injectScript("https://intellimizeditor.com/common.js"),Io.timeEnd("postServerContextWork")}scheduleTasks(e){if(Io.debug("scheduleTasks()"),this.override.shouldRunTasks().orElse(!0)){const t=new ul(this.environment,this.browserStorage,this.extensionManager,this.browserEventLogger,this.customer,this.customerStorage,this.attributeStorage,this.activityStorage,this.user,this.override,this.pageContext,this.attributeData,this.statusModel,this.conditionEvaluationRuntime,this.hider,this.getVariationRecordedCallbackTuples.bind(this),this.elementObserver);t.onPolicyReady((t=>{void 0!==e&&e.setPolicy(t),Io.debug("scheduleTasks() onPolicyReady()"),this.override.sendPageviewBrowserEvents().orElse(!0)&&this.taskManager.addTask(new sl(this.environment,this.browserEventLogger));const i=new Ka(this.environment,this.browserEventLogger,this.customer,this.customerStorage,this.attributeStorage,this.activityStorage,this.user,this.override,this.pageContext,this.statusModel),s=new Va(this.environment,this.browserEventLogger,this.integrationDataStorage);if(this.taskManager.addTask(s),this.taskManager.addTask(i),this.customer.getIntegrationShopify().isPresent()){Io.debug("Shopify Pixel enabled for customer");const e=new vl(this.environment,this.browserEventLogger,this.customer,this.customerStorage,this.attributeStorage,this.activityStorage,this.user,this.statusModel,this.taskManager);this.shopifyStorageQueueTask=j.of(e),this.taskManager.addTask(e)}if(ar(this.customer)){if(this.environment.getHostingPageUrl().getQueryParam(Ie,b).isPresent()){const e=new Ja(this.environment,this.customer,"/marketo-id-associator",(()=>lr(this.environment)));this.taskManager.addTask(e)}const e=new tl(this.environment,this.browserEventLogger,this.customer,this.user,this.override,this.activityStorage,this.attributeStorage,this.customerStorage,this.statusModel);this.taskManager.addTask(e)}if(nr(this.customer)){if(this.environment.getHostingPageUrl().getQueryParam(Ce,b).isPresent()){const e=new Ja(this.environment,this.customer,"/hubspot-id-associator",(()=>rr(this.environment)));this.taskManager.addTask(e)}const e=new Za(this.environment,this.browserEventLogger,this.customer,this.user,this.override,this.activityStorage,this.attributeStorage,this.customerStorage,this.statusModel);this.taskManager.addTask(e)}})),this.taskManager.addTask(t)}else this.override.sendPageviewBrowserEvents().orElse(!0)&&this.taskManager.addTask(new sl(this.environment,this.browserEventLogger))}handlePageUnload(){Io.debug("(Prepare for Shutdown): handlePageUnload() giving the client one more chance to run tasks..."),this.shopifyStorageQueueTask.ifPresent((e=>{e.getStorageQueueConsumer().ifPresent((e=>{e.handlePageUnload()}))}));this.taskManager.findTasks((e=>!e.isDone())).length>0&&(this.taskManager.addTask(new il),this.taskManager.runNow())}}function fl(e,t){return i=>{Io.time("frameTick",["raf"]);const s=null!=t?t:i;i-s<e&&window.requestAnimationFrame(fl(e,s)),Io.timeEnd("frameTick",["raf"])}}function _l(){new MutationObserver((e=>{Ro.time(`mutations: ${e.length}`),e.forEach((e=>{Ro.debug(`Doc mutation: ${Fe(e)}`)})),Ro.timeEnd(`mutations: ${e.length}`)})).observe(document.documentElement,{subtree:!0,childList:!0,attributes:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0})}(()=>{__async(this,null,(function*(){try{Io.time("client startup time"),Io.getLevel()<=i.LogLevel.DEBUG&&(window.requestAnimationFrame(fl(2e3)),_l());const e=new bl;yield e.run(),Io.timeEnd("client startup time")}catch(e){jo.revealAll(document);const t=hi(e);Io.error(t,142)}}))})()}();

